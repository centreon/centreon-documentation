"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[90507],{69050:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>m,contentTitle:()=>c,default:()=>v,frontMatter:()=>p,metadata:()=>u,toc:()=>d});n(67294);var r=n(3905),a=n(51715),l=n(7626);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const p={id:"centreon-agent",title:"Installer l'Agent Centreon"},c=void 0,u={unversionedId:"health/centreon-agent",id:"version-23.10/health/centreon-agent",title:"Installer l'Agent Centreon",description:"Introduction",source:"@site/i18n/fr/docusaurus-plugin-content-docs/version-23.10/health/centreon-agent.md",sourceDirName:"health",slug:"/health/centreon-agent",permalink:"/centreon-documentation/pr-preview/staging/pr-2776/fr/docs/health/centreon-agent",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/i18n/fr/docusaurus-plugin-content-docs/version-23.10/health/centreon-agent.md",tags:[],version:"23.10",lastUpdatedAt:1699395750,formattedLastUpdatedAt:"7 nov. 2023",frontMatter:{id:"centreon-agent",title:"Installer l'Agent Centreon"},sidebar:"version-23.10/docs",previous:{title:"Mont\xe9e de version de Centreon HA depuis Centreon 22.10",permalink:"/centreon-documentation/pr-preview/staging/pr-2776/fr/docs/upgrade/centreon-ha/upgrade-centreon-ha-from-22-10"},next:{title:"Centreon Platform 23.04",permalink:"/centreon-documentation/pr-preview/staging/pr-2776/fr/docs/releases/introduction"}},m={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Pr\xe9requis",id:"pr\xe9requis",level:2},{value:"Installer l&#39;Agent",id:"installer-lagent",level:2},{value:"Sur un serveur central Centreon",id:"sur-un-serveur-central-centreon",level:3},{value:"Sur d&#39;autres machines h\xf4tes (serveur distant, collecteur, MAP, etc.)",id:"sur-dautres-machines-h\xf4tes-serveur-distant-collecteur-map-etc",level:3},{value:"Configurer l&#39;Agent",id:"configurer-lagent",level:2},{value:"R\xe9seau",id:"r\xe9seau",level:3},{value:"Configuration proxy",id:"configuration-proxy",level:4},{value:"Configuration en mode passerelle",id:"configuration-en-mode-passerelle",level:4},{value:"Activer la collecte de logs Centreon",id:"activer-la-collecte-de-logs-centreon",level:3},{value:"Utiliser les mod\xe8les",id:"utiliser-les-mod\xe8les",level:4},{value:"Finaliser la configuration des mod\xe8les",id:"finaliser-la-configuration-des-mod\xe8les",level:4},{value:"D\xe9marrer la collecte des logs",id:"d\xe9marrer-la-collecte-des-logs",level:4},{value:"Tags",id:"tags",level:3},{value:"Base de donn\xe9es d\xe9port\xe9e",id:"base-de-donn\xe9es-d\xe9port\xe9e",level:3},{value:"Rotation des logs",id:"rotation-des-logs",level:3},{value:"Tester l&#39;Agent",id:"tester-lagent",level:2},{value:"Tester le service centreon-agent",id:"tester-le-service-centreon-agent",level:3},{value:"Tester la collecte de donn\xe9es",id:"tester-la-collecte-de-donn\xe9es",level:3},{value:"Tester l&#39;acc\xe8s \xe0 la Plateforme Centreon Cloud",id:"tester-lacc\xe8s-\xe0-la-plateforme-centreon-cloud",level:3},{value:"Mettre \xe0 jour l&#39;Agent",id:"mettre-\xe0-jour-lagent",level:2}],g={toc:d},k="wrapper";function v(e){var{components:t}=e,n=i(e,["components"]);return(0,r.kt)(k,s(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){o(e,t,n[t])}))}return e}({},g,n),{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"L'Agent Centreon est un logiciel qui supervise sa machine h\xf4te et les services qui y tournent."),(0,r.kt)("p",null,"L'Agent peut \xeatre utilis\xe9 pour superviser des serveurs qui exploitent un service Centreon On-Premise (central, serveur distant, collecteur, Map, etc.). L'Agent est disponible sur Alma/RHEL/Oracle Linux 8 et 9."),(0,r.kt)("p",null,"Les donn\xe9es sont envoy\xe9es vers la Plateforme Centreon Cloud. Aucune donn\xe9e personnelle n'est collect\xe9e."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Bien que la proc\xe9dure suivante et que les fichiers de configuration de l'Agent en g\xe9n\xe9ral permettent les personnalisations, nous vous recommandons vivement de laisser les noms de fichiers, etc. tels quels.")),(0,r.kt)("h2",{id:"pr\xe9requis"},"Pr\xe9requis"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Pour que les m\xe9triques parviennent \xe0 la Plateforme Centreon Cloud (o\xf9 la supervision de la supervision est effectu\xe9e), l'Agent Centreon doit pouvoir acc\xe9der \xe0 notre endpoint public \xe0 l'adresse suivante :"),(0,r.kt)("p",{parentName:"li"},"  ",(0,r.kt)("inlineCode",{parentName:"p"},"https://api.a.prod.mycentreon.com/v1/observability")," (port 443)"),(0,r.kt)("p",{parentName:"li"},"  Vous pouvez tester si votre machine peut acc\xe9der \xe0 notre endpoint \xe0 l'aide de la commande suivante :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"curl -v https://api.a.prod.mycentreon.com/v1/observability\n")),(0,r.kt)("p",{parentName:"li"},"  Vous pouvez aussi faire le test en passant par un proxy avec la commande suivante :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"curl -v https://api.a.prod.mycentreon.com/v1/observability \\\n--proxy [protocol://]host[:port] --proxy-insecure\n")),(0,r.kt)("p",{parentName:"li"},"  Exemple :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"curl -v https://api.a.prod.mycentreon.com/v1/observability \\\n--proxy http://proxy.local.net:3128 --proxy-insecure\n")))),(0,r.kt)("p",null,"  Le message suivant sera retourn\xe9 si la connexion aboutit:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'"Missing Authentication Token"\n')),(0,r.kt)("p",null,"  Si vous recevez une r\xe9ponse diff\xe9rente ou pas de r\xe9ponse du tout, c'est que votre machine ne peut pas acc\xe9der \xe0 notre endpoint, probablement \xe0 cause de vos param\xe8tres r\xe9seau (pare-feu, proxy, etc.)."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Si un proxy est configur\xe9 sur la machine h\xf4te, vous devez copier l'adresse et le port du proxy dans le fichier de configuration de l'Agent (voir la section ",(0,r.kt)("a",{parentName:"p",href:"#r%C3%A9seau"},"R\xe9seau"),").")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Si une machine h\xf4te n'a pas d'acc\xe8s direct \xe0 l'ext\xe9rieur, deux options compl\xe9mentaires l'une de l'autre se pr\xe9sentent : la ",(0,r.kt)("a",{parentName:"p",href:"#configuration-proxy"},"configuration proxy")," et la ",(0,r.kt)("a",{parentName:"p",href:"#configuration-en-mode-passerelle"},"configuration passerelle"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Les fichiers RPM sont disponibles sur les d\xe9p\xf4ts Centreon officiels des versions actuellement support\xe9es. Le d\xe9p\xf4t Centreon officiel doit \xeatre install\xe9 :"))),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(l.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"dnf config-manager --add-repo https://packages.centreon.com/rpm-standard/23.04/el8/centreon-23.04.repo\ndnf clean all --enablerepo=*\ndnf update\n"))),(0,r.kt)(l.Z,{value:"Alma / RHEL / Oracle Linux 9",label:"Alma / RHEL / Oracle Linux 9",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"dnf config-manager --add-repo https://packages.centreon.com/rpm-standard/23.04/el9/centreon-23.04.repo\ndnf clean all --enablerepo=*\ndnf update\n")))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Vous devez \xeatre en possession de votre jeton unique vous permettant d'envoyer des donn\xe9es vers notre plateforme. Ce jeton vous est fourni par notre \xe9quipe support.")),(0,r.kt)("h2",{id:"installer-lagent"},"Installer l'Agent"),(0,r.kt)("p",null,"Tous les composants Centreon que vous voulez superviser (central, collecteur, serveur distant, etc.) doivent chacun avoir un Agent install\xe9 sur leur machine h\xf4te."),(0,r.kt)("h3",{id:"sur-un-serveur-central-centreon"},"Sur un serveur central Centreon"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Installez ",(0,r.kt)("strong",{parentName:"p"},"centreon-helios"),":"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"dnf install centreon-helios\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Installez l'Agent :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"dnf install centreon-agent\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Si vous installez l'Agent pour la premi\xe8re fois sur ce serveur, g\xe9n\xe9rez le fichier yaml de configuration \xe0 l'aide de la commande Shell suivante :"),(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("p",{parentName:"blockquote"},"Ne r\xe9alisez cette \xe9tape que si l'Agent n'a jamais \xe9t\xe9 configur\xe9. Dans le cas contraire, vous \xe9craseriez votre configuration pr\xe9c\xe9dente.")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"/usr/sbin/centreon-agent config \\\n--token [votre-jeton] \\\n--type central \\\n--output /etc/centreon-agent/centreon-agent.yml\n")),(0,r.kt)("p",{parentName:"li"},"Exemple :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"/usr/sbin/centreon-agent config \\\n--token aaaa-aaaa-aaaa-aaaa \\\n--type central \\\n--output /etc/centreon-agent/centreon-agent.yml\n")),(0,r.kt)("p",{parentName:"li"},"Certains param\xe8tres ont des valeurs par d\xe9faut. \xc9ditez le fichier ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/centreon-agent/centreon-agent.yml")," et v\xe9rifiez les valeurs suivantes :"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"centreonengine_stats_file : le nom et le chemin du fichier sont-ils corrects (au cas o\xf9 vous les auriez personnalis\xe9s sur votre plateforme)?")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"centreonbroker_stats_files : le nom et le chemin du fichier sont-ils corrects (au cas o\xf9 vous les auriez personnalis\xe9s sur votre plateforme)?")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"centreonweb : les param\xe8tres de la base de donn\xe9es sont-ils corrects? Le format est le suivant :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"collect:\n  centreonweb:\n    config_dsn: [utilisateur]:[mot-de-passe]@tcp([h\xf4tebdd])/[nombddcentreon]\n    storage_dsn: [utilisateur]:[mot-de-passe]@tcp([h\xf4tebdd])/[nombddcentreon_storage]\n")),(0,r.kt)("p",{parentName:"li"},"  Exemple :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"collect:\n  centreonweb:\n    config_dsn: admin:UzG2b5wcMf8EqM2b@tcp(172.28.2.60)/centreon\n    storage_dsn: admin:UzG2b5wcMf8EqM2b@tcp(172.28.2.60)/centreon_storage\n")),(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("p",{parentName:"blockquote"},"La fonction Topologie se base sur le fichier ",(0,r.kt)("inlineCode",{parentName:"p"},"centreon-agent.yml")," pour collecter les informations dont il a besoin : ce comportement est cod\xe9 en dur. Si vous changez le nom de ce fichier YAML, la collecte \xe9chouera."))))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Ajoutez un ",(0,r.kt)("a",{parentName:"p",href:"#tags"},"tag")," ",(0,r.kt)("strong",{parentName:"p"},"environment")," :"),(0,r.kt)("p",{parentName:"li"},"Ouvrez le fichier ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/centreon-agent/centreon-agent.yml")," g\xe9n\xe9r\xe9 \xe0 l'installation et ajoutez les informations suivantes dans la section ",(0,r.kt)("strong",{parentName:"p"},"collect"),"."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"collect:\n  tags:\n    environment: [staging|preproduction|production|your-custom-value]\n")),(0,r.kt)("p",{parentName:"li"},"Exemple :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"collect:\n  tags:\n    environment: production\n")),(0,r.kt)("p",{parentName:"li"},'Si vous avez plusieurs environnements du m\xeame type, vous pouvez ajouter un _suffixe \xe0 votre type d\'environnement (par exemple : "production_client1").')),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Activez le service ",(0,r.kt)("strong",{parentName:"p"},"centreon-agent")," :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"systemctl enable centreon-agent.service\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"D\xe9marrez le service ",(0,r.kt)("strong",{parentName:"p"},"centreon-agent")," :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"systemctl start centreon-agent.service\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Activez la planification de la topologie: \xe9ditez le fichier cron ",(0,r.kt)("strong",{parentName:"p"},"/etc/cron.d/centreon-helios")," et d\xe9commentez la ligne suivante (c'est-\xe0-dire supprimez le caract\xe8re ",(0,r.kt)("strong",{parentName:"p"},"#"),"):"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"0 0 * * * centreon /usr/sbin/centreon-helios.phar\n")),(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("p",{parentName:"blockquote"},"Si vous avez une pr\xe9c\xe9dente version de l'agent d\xe9j\xe0 install\xe9e, la ligne concern\xe9e peut \xeatre diff\xe9rente : dans ce cas, remplacez-la par la ligne ci-dessus.")),(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("p",{parentName:"blockquote"},"La fonction Topologie utilise le fichier ",(0,r.kt)("strong",{parentName:"p"},"centreon-agent.yml")," pour collecter les informations n\xe9cessaires: ce comportement est cod\xe9 en dur. Si vous changez le nom de ce fichier YAML, la fonction \xe9chouera."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Vous pouvez maintenant ",(0,r.kt)("a",{parentName:"p",href:"#configurer-lagent"},"configurer votre Agent")," (passerelle, proxy etc.), puis ",(0,r.kt)("a",{parentName:"p",href:"#tester-lagent"},"tester")," votre configuration g\xe9n\xe9rale."))),(0,r.kt)("h3",{id:"sur-dautres-machines-h\xf4tes-serveur-distant-collecteur-map-etc"},"Sur d'autres machines h\xf4tes (serveur distant, collecteur, MAP, etc.)"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Installez l'Agent:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"dnf install centreon-agent\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Si vous installez l'Agent pour la premi\xe8re fois sur ce serveur, configurez le fichier ",(0,r.kt)("inlineCode",{parentName:"p"},"centreon-agent.yml")," :"),(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("p",{parentName:"blockquote"},"Ne r\xe9alisez cette \xe9tape que si l'Agent n'a jamais \xe9t\xe9 configur\xe9. Dans le cas contraire, vous \xe9craseriez votre configuration pr\xe9c\xe9dente.")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"/usr/sbin/centreon-agent config \\\n--token [votre-jeton] \\\n--type [system|central|remote|poller|map] \\\n--output /etc/centreon-agent/centreon-agent.yml\n")),(0,r.kt)("p",{parentName:"li"},"Exemple :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"/usr/sbin/centreon-agent config \\\n--token aaaa-aaaa-aaaa-aaaa \\\n--type poller \\\n--output /etc/centreon-agent/centreon-agent.yml\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Ajoutez un ",(0,r.kt)("a",{parentName:"p",href:"#tags"},"tag")," ",(0,r.kt)("strong",{parentName:"p"},"environment")," :"),(0,r.kt)("p",{parentName:"li"},"Ouvrez le fichier ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/centreon-agent/centreon-agent.yml")," g\xe9n\xe9r\xe9 \xe0 l'installation et ajoutez les informations suivantes dans la section ",(0,r.kt)("strong",{parentName:"p"},"collect"),"."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"collect:\n  tags:\n    environment: [staging|preproduction|production|valeur-personnalis\xe9e]\n")),(0,r.kt)("p",{parentName:"li"},"Exemple :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"collect:\n  tags:\n    environment: production\n")),(0,r.kt)("p",{parentName:"li"},'Si vous avez plusieurs environnements du m\xeame type, vous pouvez ajouter un _suffixe \xe0 votre type d\'environnement (par exemple : "production_client1").')),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Activez le service ",(0,r.kt)("strong",{parentName:"p"},"centreon-agent")," :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"systemctl enable centreon-agent.service\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"D\xe9marrez le service ",(0,r.kt)("strong",{parentName:"p"},"centreon-agent")," :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"systemctl start centreon-agent.service\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Vous pouvez maintenant ",(0,r.kt)("a",{parentName:"p",href:"#configurer-lagent"},"configurer votre Agent")," (passerelle, proxy etc.), puis ",(0,r.kt)("a",{parentName:"p",href:"#tester-lagent"},"tester")," votre configuration g\xe9n\xe9rale."))),(0,r.kt)("h2",{id:"configurer-lagent"},"Configurer l'Agent"),(0,r.kt)("h3",{id:"r\xe9seau"},"R\xe9seau"),(0,r.kt)("p",null,"Si un Agent n'a pas d'acc\xe8s direct \xe0 l'ext\xe9rieur, deux options vous permettent de r\xe9soudre le probl\xe8me : l'acc\xe8s via un proxy HTTP et/ou l'acc\xe8s en mode passerelle. Dans ce dernier, l'Agent qui a besoin d'acc\xe9der \xe0 l'ext\xe9rieur (appel\xe9 \"Passerelle cliente\") peut passer par un autre Agent pouvant acc\xe9der \xe0 l'ext\xe9rieur (appel\xe9 \"Passerelle serveur\")."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Exemple")," "),(0,r.kt)("p",null,"Votre infrastructure est prot\xe9g\xe9e (en milieu ferm\xe9) et un serveur proxy g\xe8re tout le trafic sortant. Vous voulez donner acc\xe8s \xe0 l'ext\xe9rieur uniquement \xe0 l'Agent install\xe9 sur la machine h\xf4te du serveur central Centreon. Dans ce cas, vous pourriez configurer votre r\xe9seau de la mani\xe8re suivante :"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Configurez le proxy sur l'Agent du serveur central pour lui permettre d'acc\xe9der \xe0 l'ext\xe9rieur")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Configurez cet Agent en tant que passerelle serveur")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Configurez tous les autres Agents (install\xe9s sur les collecteurs, serveurs distants, MAP, etc.) en tant que passerelles clientes"))),(0,r.kt)("h4",{id:"configuration-proxy"},"Configuration proxy"),(0,r.kt)("p",null,"Si un acc\xe8s proxy est configur\xe9 sur la machine h\xf4te, copiez les param\xe8tres du proxy dans le fichier ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/centreon-agent/centreon-agent.yml")," \xe0 l'endroit suivant :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"output:\n  token: [votre-jeton]\n  proxy_url: [addresse-du-proxy]:[port]\n  proxy_ssl_insecure: [true|false]\n")),(0,r.kt)("p",null,"Exemple :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"output:\n  token: aaaa-aaaa-aaaa-aaaa\n  proxy_url: http//proxy.local.net:3128\n  proxy_ssl_insecure: false\n")),(0,r.kt)("p",null,"Red\xe9marrez ensuite l'Agent:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"systemctl restart centreon-agent.service\n")),(0,r.kt)("h4",{id:"configuration-en-mode-passerelle"},"Configuration en mode passerelle"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Passerelle Serveur: copiez le code suivant dans le fichier ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/centreon-agent/centreon-agent.yml")," de l'Agent qui tiendra le r\xf4le de passerelle serveur. Pour renforcer la s\xe9curit\xe9 des \xe9changes entre la passerelle client et la passerelle serveur, vous pouvez d\xe9finir un jeton d'authentification ",(0,r.kt)("inlineCode",{parentName:"p"},"auth-token"),", c'est-\xe0-dire la cha\xeene de caract\xe8res de votre choix (diff\xe9rente du jeton que vous avez entr\xe9 pour configurer le fichier ",(0,r.kt)("inlineCode",{parentName:"p"},"centreon-agent.yml"),")."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"gateway:\n  enable: true\n  listen_port: [port-d-\xe9coute]\n  auth_token: [votre-jeton-de-passerelle]\n")),(0,r.kt)("p",{parentName:"li"},"  Example:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"gateway:\n  enable: true\n  listen_port: 54321\n  auth_token: azerty1234\n")),(0,r.kt)("p",{parentName:"li"},"  Red\xe9marrez ensuite l'Agent :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"systemctl restart centreon-agent.service\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Passerelle cliente"),(0,r.kt)("p",{parentName:"li"},"  En mode passerelle, la passerelle cliente d\xe9l\xe8gue la configuration de son jeton principal \xe0 la passerelle serveur (puisque seule celle-ci communique avec la Plateforme Centreon Cloud). En cons\xe9quence, commentez la ligne ",(0,r.kt)("inlineCode",{parentName:"p"},"token")," \xe0 l'aide de l'op\xe9rateur yaml \u201c#\u201d.\nSi vous avez d\xe9fini un jeton d'authentification (",(0,r.kt)("inlineCode",{parentName:"p"},"auth_token"),") sur la passerelle serveur, vous devez \xe9galement l'ajouter \xe0 la configuration de la passerelle cliente. "),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"output:\n#token: [votre-jeton]\n  gateway:\n    url: http://[addresse-ip-de-la-passerelle-serveur]:[port-d-\xe9coute]\n    auth_token: [votre-jeton-de-passerelle]\n")),(0,r.kt)("p",{parentName:"li"},"  Exemple :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"output:\n#token: aaaa-aaaa-aaaa-aaaa\n  gateway:\n    url: http://172.28.6.145:54321\n    auth_token: azerty1234\n")),(0,r.kt)("p",{parentName:"li"},"  Red\xe9marrez ensuite l'Agent :"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"systemctl restart centreon-agent.service\n")))),(0,r.kt)("h3",{id:"activer-la-collecte-de-logs-centreon"},"Activer la collecte de logs Centreon"),(0,r.kt)("p",null,"\xc0 partir de la version 2 de ",(0,r.kt)("strong",{parentName:"p"},"centreon-agent"),", il est possible de r\xe9cup\xe9rer les logs g\xe9n\xe9r\xe9s par le composant Centreon supervis\xe9. "),(0,r.kt)("p",null,"Pour d\xe9finir quels logs doivent \xeatre r\xe9cup\xe9r\xe9s, vous devez cr\xe9er des fichiers yml de configuration dans le dossier suivant : ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/centreon-agent/conf.d"),".\nPour r\xe9cup\xe9rer un log pr\xe9cis, le fichier de configuration doit contenir les arguments suivants : ",(0,r.kt)("inlineCode",{parentName:"p"},"path"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"type")," et ",(0,r.kt)("inlineCode",{parentName:"p"},"pattern")," du log choisi. Exemple :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'- path: /var/log/centreon-gorgone/gorgoned.log\n  pattern: "%{CENTREONGORGONE}"\n  type: file\n')),(0,r.kt)("p",null,"Vous pouvez avoir plusieurs fichiers de configuration (chaque fichier est analys\xe9 et les fichiers de logs d\xe9finis sont ajout\xe9s \xe0 la collecte)."),(0,r.kt)("h4",{id:"utiliser-les-mod\xe8les"},"Utiliser les mod\xe8les"),(0,r.kt)("p",null,"Pour simplifier la configuration de la collecte de logs, des mod\xe8les pr\xe9-configur\xe9s sont fournis. Chaque mod\xe8le couvre un p\xe9rim\xe8tre sp\xe9cifique en fonction du composant Centreon, de sa version, etc."),(0,r.kt)("p",null,"Les mod\xe8les sont situ\xe9s dans le r\xe9pertoire suivant :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"/usr/share/centreon-agent/examples\n")),(0,r.kt)("p",null,"Suivant le composant Centreon supervis\xe9, vous pouvez simplement copier-coller le mod\xe8le correspondant dans votre r\xe9pertoire ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/centreon-agent/conf.d"),"."),(0,r.kt)("h4",{id:"finaliser-la-configuration-des-mod\xe8les"},"Finaliser la configuration des mod\xe8les"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Pour les collecteurs Centreon, les fichiers de log sont pr\xe9fix\xe9s du nom du collecteur. Vous devez donc adapter le mod\xe8le.\nOuvrez le mod\xe8le ",(0,r.kt)("inlineCode",{parentName:"p"},"poller")," et remplacez tous les noms g\xe9n\xe9riques ",(0,r.kt)("inlineCode",{parentName:"p"},"POLLERNAME")," dans la section ",(0,r.kt)("inlineCode",{parentName:"p"},"path")," par le vrai nom du collecteur.")),(0,r.kt)("p",null,"Les mod\xe8les fournis fonctionneront directement avec une installation Centreon standard. En cas de doute, vous pouvez localiser le fichier de log d\xe9sir\xe9 et comparer son chemin avec celui indiqu\xe9 dans la section ",(0,r.kt)("inlineCode",{parentName:"p"},"path")," du mod\xe8le."),(0,r.kt)("p",null,"En cas d'erreurs, vous trouverez des explications d\xe9taill\xe9es du probl\xe8me dans les logs de ",(0,r.kt)("strong",{parentName:"p"},"centreon-agent")," dans ",(0,r.kt)("inlineCode",{parentName:"p"},"/var/log/centreon-agent/centreon-agent.log"),"."),(0,r.kt)("h4",{id:"d\xe9marrer-la-collecte-des-logs"},"D\xe9marrer la collecte des logs"),(0,r.kt)("p",null,"Une fois la collecte de vos logs configur\xe9e, red\xe9marrez l'agent en utilisant la commande suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"systemctl restart centreon-agent.service\n")),(0,r.kt)("h3",{id:"tags"},"Tags"),(0,r.kt)("p",null,"L'Agent peut contextualizer la collecte de donn\xe9es avec vos propres tags personnalis\xe9s afin de d\xe9finir son p\xe9rim\xe8tre d'action. Ces tags seront utilis\xe9s par la suite pour agr\xe9ger les donn\xe9es de supervision et cr\xe9er des tableaux de bord ou des rapports dans des contextes pertinents."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Nous recommandons fortement que le premier tag que vous d\xe9finissiez soit \u201cenvironment\u201d afin de disposer d'une r\xe9f\xe9rence commune \xe0 tous les utilisateurs.")),(0,r.kt)("p",null,"Les tags peuvent \xeatre configur\xe9s dans le fichier YAML ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/centreon-agent/centreon-agent.yml")," g\xe9n\xe9r\xe9 \xe0 l'installation. Les tags sont sensibles \xe0 la casse (",(0,r.kt)("inlineCode",{parentName:"p"},"production")," et ",(0,r.kt)("inlineCode",{parentName:"p"},"Production")," sont consid\xe9r\xe9s comme deux tags diff\xe9rents)."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"collect:\n  tags:\n    environment: [staging|preproduction|production|valeur-personnalis\xe9e]\n    [tag2]: [valeur-personnalis\xe9e2]    \n    [tag3]: [valeur-personnalis\xe9e3]\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"collect:\n  tags:\n    environment: production\n    City: Paris   \n")),(0,r.kt)("p",null,"Red\xe9marrez ensuite l'Agent :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"systemctl restart centreon-agent.service\n")),(0,r.kt)("h3",{id:"base-de-donn\xe9es-d\xe9port\xe9e"},"Base de donn\xe9es d\xe9port\xe9e"),(0,r.kt)("p",null,"Si le composant Centreon supervis\xe9 par l'Agent est configur\xe9 avec une base de donn\xe9e sp\xe9cifique ou d\xe9port\xe9e, vous pouvez sp\xe9cifier l'acc\xe8s \xe0 la base de donn\xe9es dans le fichier YAML ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/centreon-agent/centreon-agent.yml")," g\xe9n\xe9r\xe9 \xe0 l'installation."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"collect:\n    centreonweb:\n        config_dsn: [utilisateur]:[mot-de-passe]@tcp([h\xf4tebdd])/[nombddcentreon]\n        storage_dsn: [utilisateur]:[mot-de-passe]@tcp([h\xf4tebdd])/[nombddcentreon_storage]\n")),(0,r.kt)("p",null,"Exemple :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"collect:\n    centreonweb:\n      config_dsn: admin:UzG2b5wcMf8EqM2b@tcp(172.28.2.60)/centreon\n      storage_dsn: admin:UzG2b5wcMf8EqM2b@tcp(172.28.2.60)/centreon_storage\n\n")),(0,r.kt)("p",null,"Red\xe9marrez ensuite l'Agent :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"systemctl restart centreon-agent.service\n")),(0,r.kt)("h3",{id:"rotation-des-logs"},"Rotation des logs"),(0,r.kt)("p",null,"L'Agent enregistre toute activit\xe9 (nominale ou en erreur) dans le fichier ",(0,r.kt)("inlineCode",{parentName:"p"},"/var/log/centreon-agent/centreon-agent.log"),"."),(0,r.kt)("p",null,"Par d\xe9faut, un fichier ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/logrotate.d/centreon-agent")," a \xe9t\xe9 cr\xe9\xe9 \xe0 l'installation et configur\xe9 de la mani\xe8re suivante :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"/var/log/centreon-agent/centreon-agent.log {\n  daily\n  copytruncate\n  rotate 7\n  compress\n}\n")),(0,r.kt)("p",null,"Vous pouvez le laisser ainsi ou bien ajuster la politique de rotation des logs pour mieux correspondre \xe0 vos besoins en utilisant les param\xe8tres de ",(0,r.kt)("a",{parentName:"p",href:"https://www.unix.com/man-page/redhat/8/LOGROTATE/"},"logrotate"),"."),(0,r.kt)("h2",{id:"tester-lagent"},"Tester l'Agent"),(0,r.kt)("h3",{id:"tester-le-service-centreon-agent"},"Tester le service centreon-agent"),(0,r.kt)("p",null,"\xc0 cette \xe9tape, le service ",(0,r.kt)("strong",{parentName:"p"},"centreon-agent")," doit tourner, et \xeatre param\xe9tr\xe9 pour se lancer au d\xe9marrage du syst\xe8me.\nLa commande suivante v\xe9rifie que le service a \xe9t\xe9 configur\xe9 correctement :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"systemctl status centreon-agent\n")),(0,r.kt)("p",null,"Si tout s'est bien pass\xe9, le r\xe9sultat ressemblera \xe0 l'exemple suivant :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"systemctl status centreon-agent\n\u25cf centreon-agent.service - The Centreon Agent collect metrics and send them to Centreon SaaS Platform\n   Loaded: loaded (/etc/systemd/system/centreon-agent.service; enabled; vendor preset: disabled)\n   Active: active (running) since ven. 2019-11-08 14:52:26 CET; 5 days ago\n Main PID: 22331 (centreon-agent)\n   CGroup: /system.slice/centreon-agent.service\n           \u2514\u250022331 /usr/sbin/centreon-agent run\n")),(0,r.kt)("h3",{id:"tester-la-collecte-de-donn\xe9es"},"Tester la collecte de donn\xe9es"),(0,r.kt)("p",null,"Une fois l'installation et la configuration termin\xe9es, vous pouvez utiliser la commande suivante pour forcer la collecte de donn\xe9es :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"centreon-agent sample\n")),(0,r.kt)("p",null,"Le r\xe9sultat devrait ressembler \xe0 \xe7a :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"1624977737000000// centreonengine_uptime_seconds{_cmaas=cmco,hostname=val-central.centreon.io,os=linux,osfamily=rhel} 693583\n1624977737000000// centreonengine_command_buffers_used{_cmaas=cmco,hostname=val-central.centreon.io,os=linux,osfamily=rhel} 0\n1624977737000000// centreonengine_command_buffers_high{_cmaas=cmco,hostname=val-central.centreon.io,os=linux,osfamily=rhel} 0\n1624977737000000// centreonengine_command_buffers_total{_cmaas=cmco,hostname=val-central.centreon.io,os=linux,osfamily=rhel} 4096\n1624977737000000// centreonengine_external_command_1m{_cmaas=cmco,hostname=val-central.centreon.io,os=linux,osfamily=rhel} 0\n1624977737000000// centreonengine_general_external_command_5m{_cmaas=cmco,hostname=val-central.centreon.io,os=linux,osfamily=rhel} 0\n")),(0,r.kt)("p",null,"Si vous obtenez des erreurs en testant la collecte, les logs du fichier ",(0,r.kt)("inlineCode",{parentName:"p"},"/var/log/centreon-agent/centreon-agent.log")," peuvent vous aider \xe0 r\xe9soudre le probl\xe8me."),(0,r.kt)("h3",{id:"tester-lacc\xe8s-\xe0-la-plateforme-centreon-cloud"},"Tester l'acc\xe8s \xe0 la Plateforme Centreon Cloud"),(0,r.kt)("p",null,"Une fois l'installation et la configuration termin\xe9es, utilisez la commande suivante pour tester la connexion entre l'Agent et la Plateforme Centreon Cloud :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"centreon-agent ping --config [chemin vers votre fichier centreon-agent.yml]\n")),(0,r.kt)("p",null,"L'Agent retournera l'un des messages suivants :"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Unable to reach the Centreon Cloud Platform, check your network configuration")," : v\xe9rifiez votre configuration r\xe9seau (proxy etc.)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Centreon Cloud Platform reached successfully but your token is not recognized")," : votre jeton n'est pas reconnu")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Centreon Cloud Platform reached successfully and authentication was successful")," : l'Agent est bien connect\xe9 \xe0 notre plateforme."))),(0,r.kt)("h2",{id:"mettre-\xe0-jour-lagent"},"Mettre \xe0 jour l'Agent"),(0,r.kt)("p",null,"Pour mettre \xe0 jour l'Agent, entrez :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"dnf clean all --enablerepo=*\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"dnf update centreon-agent\n")))}v.isMDXComponent=!0}}]);