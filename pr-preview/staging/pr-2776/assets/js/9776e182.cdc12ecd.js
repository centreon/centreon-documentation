"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[13917],{72982:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>p,toc:()=>c});n(67294);var a=n(3905);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const l={id:"concepts",title:"Concepts"},s=void 0,p={unversionedId:"reporting/concepts",id:"version-23.10/reporting/concepts",title:"Concepts",description:"Availability & events",source:"@site/versioned_docs/version-23.10/reporting/concepts.md",sourceDirName:"reporting",slug:"/reporting/concepts",permalink:"/centreon-documentation/pr-preview/staging/pr-2776/docs/reporting/concepts",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/versioned_docs/version-23.10/reporting/concepts.md",tags:[],version:"23.10",lastUpdatedAt:1699395750,formattedLastUpdatedAt:"Nov 7, 2023",frontMatter:{id:"concepts",title:"Concepts"},sidebar:"version-23.10/docs",previous:{title:"Configure",permalink:"/centreon-documentation/pr-preview/staging/pr-2776/docs/reporting/configure"},next:{title:"Report development",permalink:"/centreon-documentation/pr-preview/staging/pr-2776/docs/reporting/report-development"}},u={},c=[{value:"Availability &amp; events",id:"availability--events",level:2},{value:"Availability",id:"availability",level:3},{value:"Hosts",id:"hosts",level:4},{value:"Services",id:"services",level:4},{value:"Events",id:"events",level:3},{value:"Additional indicators",id:"additional-indicators",level:3},{value:"Best practices",id:"best-practices",level:2},{value:"Best practices for monitoring",id:"best-practices-for-monitoring",level:3},{value:"Quality of plugins, performance and capacity data",id:"quality-of-plugins-performance-and-capacity-data",level:4},{value:"Default units",id:"default-units",level:4},{value:"Best practices for configuring Centreon objects",id:"best-practices-for-configuring-centreon-objects",level:3},{value:"Host groups and categories",id:"host-groups-and-categories",level:3},{value:"Service categories",id:"service-categories",level:3},{value:"Extract, Transform, Load (ETL)",id:"extract-transform-load-etl",level:2},{value:"Change history",id:"change-history",level:3},{value:"Execution modes",id:"execution-modes",level:3},{value:"Execution Options",id:"execution-options",level:4},{value:"Performance",id:"performance",level:4},{value:"Purge",id:"purge",level:3},{value:"How to apply a new configuration to historical data",id:"how-to-apply-a-new-configuration-to-historical-data",level:3},{value:"Import the latest Centreon configuration",id:"import-the-latest-centreon-configuration",level:4},{value:"Calculate reporting dimensions",id:"calculate-reporting-dimensions",level:4},{value:"Aggregate events and availability",id:"aggregate-events-and-availability",level:4},{value:"Aggregate performance data (storage, traffic, etc.)",id:"aggregate-performance-data-storage-traffic-etc",level:4},{value:"How to rebuild missing reporting data",id:"how-to-rebuild-missing-reporting-data",level:3},{value:"Prerequisites",id:"prerequisites",level:4},{value:"Import the missing data",id:"import-the-missing-data",level:4},{value:"Update reporting dimensions",id:"update-reporting-dimensions",level:4},{value:"Rebuild missing events and availability data",id:"rebuild-missing-events-and-availability-data",level:4},{value:"Rebuild the missing performance data",id:"rebuild-the-missing-performance-data",level:4},{value:"What to do after executing the scripts",id:"what-to-do-after-executing-the-scripts",level:4},{value:"Centreon BAM statistics",id:"centreon-bam-statistics",level:3},{value:"How to rebuild only Centile statistics",id:"how-to-rebuild-only-centile-statistics",level:3}],d={toc:c},m="wrapper";function h(e){var{components:t}=e,l=o(e,["components"]);return(0,a.kt)(m,i(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){r(e,t,n[t])}))}return e}({},d,l),{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"availability--events"},"Availability & events"),(0,a.kt)("p",null,"Availability and event data relate to changes in the state of hosts and\nservices. These data are used in report designs and by the event and\navailability widgets included in Centreon MBI."),(0,a.kt)("p",null,"There are no special system prerequisites for creating the reports that\nuse this information, other than a plugin that returns the state. This\nsection describes basic concepts and calculations needed for using and\nanalyzing Centreon MBI reports."),(0,a.kt)("h3",{id:"availability"},"Availability"),(0,a.kt)("h4",{id:"hosts"},"Hosts"),(0,a.kt)("p",null,'A host is considered available when its state is "Up".'),(0,a.kt)("p",null,'The formula for calculating the availability rate is: "Up" duration /\n("Up" + "Down" durations)'),(0,a.kt)("p",null,"Additional rules:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},'Time spent in the "Unreachable" state is not considered in the\ncalculation of availability.'),(0,a.kt)("li",{parentName:"ul"},'Time spent in "Planned Downtime" is not considered in the\ncalculation of availability.')),(0,a.kt)("p",null,"Example: For a report covering one day, if a host is available 23 hours\nand unavailable 1 hour out of a 24 hour-period, its availability will be\n23 hours / (23 + 1) ~ 95.8%."),(0,a.kt)("h4",{id:"services"},"Services"),(0,a.kt)("p",null,'A service is considered available when its state is "OK" or\n"Warning"'),(0,a.kt)("p",null,'The formula for calculating the availability rate is: ("OK" + "Warning"\ndurations) / ("OK" + "Warning" + "Critical" durations)'),(0,a.kt)("p",null,"Additional rules:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},'Time spent in the "Unknown" state is not considered in the\ncalculation of the availability.'),(0,a.kt)("li",{parentName:"ul"},'Time spent in "Planned Downtime" is not considered in the\ncalculation of availability.')),(0,a.kt)("h3",{id:"events"},"Events"),(0,a.kt)("p",null,"Only ",(0,a.kt)("strong",{parentName:"p"},"validated"),' events are considered in the calculation of events.\nThis corresponds to the "HARD" state in Centreon.'),(0,a.kt)("p",null,"In the reports, several message types correspond to different states:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},'Exception: Denotes a "Down" state for a host and a "Critical"\nstate for a service.'),(0,a.kt)("li",{parentName:"ul"},'Warning: Denotes a "Warning" state for the services, but there is\nno equivalent for hosts.'),(0,a.kt)("li",{parentName:"ul"},"Information: Any other state.")),(0,a.kt)("p",null,"An event on a host or service is characterized by three values:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"A start date"),(0,a.kt)("li",{parentName:"ul"},"An end date"),(0,a.kt)("li",{parentName:"ul"},"A state.")),(0,a.kt)("h3",{id:"additional-indicators"},"Additional indicators"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"MTRS (Mean Time To Restore Service) pertains to maintainability:\nAverage duration of the failure. This indicator should be as low as\npossible."),(0,a.kt)("li",{parentName:"ul"},"MTBF (Mean Time Between Failures) pertains to reliability: Average\ntime between the end of an incident and the beginning of the next.\nThis indicator should be as high as possible."),(0,a.kt)("li",{parentName:"ul"},"MTBSI (Mean Time Between Service Incidents): Average time between the\nbeginning of two incidents. This indicator should be as high as\npossible.")),(0,a.kt)("p",null,"The diagram below shows the scope of these indicators:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image",src:n(60861).Z,width:"2052",height:"662"})),(0,a.kt)("h2",{id:"best-practices"},"Best practices"),(0,a.kt)("h3",{id:"best-practices-for-monitoring"},"Best practices for monitoring"),(0,a.kt)("h4",{id:"quality-of-plugins-performance-and-capacity-data"},"Quality of plugins, performance and capacity data"),(0,a.kt)("p",null,"To obtain reporting on performance data using default Centreon MBI\nreports, you should monitor at least some basic performance indicators\n(metrics):"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"CPU -- Should return a percentage value, using one or more metrics\n(cpu_total, cpu_sys, cpu_1, etc.), with 100 as the maximum value.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Memory should return at least one metric with this information:")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Memory usage: the value expressed in bytes only")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Memory usage warning threshold")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Memory usage critical threshold")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Total allocated memory in Bytes."))),(0,a.kt)("p",null,"The plugin for monitoring this indicator must return the following output:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"status information | metric_name=valueunit;warning_threshold;critical_threshold;min_value;max_value\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Storage usage -- Two possible kinds of service:")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},'Monitoring one partition by service (metrics are often designated  as "used" and "size")')),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Monitoring multiple partitions by service and each metric corresponds to a partition name."),(0,a.kt)("p",{parentName:"li"},"In these two cases, the performance data returned by storage plugins must correspond to this format:"),(0,a.kt)("p",{parentName:"li"},"   status information | metric_name=valueunit;warning_threshold;critical_threshold;min_value;max_value metric_name_2=value...")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Traffic -- Standard traffic reports use two metrics in parameters,\none for the inbound traffic and one for the outbound. For\ncompatibility, your plugins must return two metrics, although their\nnames do not matter. For each metric, the maximum possible value\nmust be specified. This is the recommended plugin format:"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"any status information | $inboundTrafic=$value$unit;$warning_threshold;$critical_threshold;$min_value;$max_value $outBoundTrafic=...\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Using the Centreon Monitoring Connectors guarantees the quality of your data.")),(0,a.kt)("h4",{id:"default-units"},"Default units"),(0,a.kt)("p",null,"Be sure that the data sent by the plugins is expressed in the same units\nas similar data used with other services. We strongly recommend\nverifying that the plugins use these units:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Time: seconds"),(0,a.kt)("li",{parentName:"ul"},"Traffic: bits/sec"),(0,a.kt)("li",{parentName:"ul"},"Storage: bytes"),(0,a.kt)("li",{parentName:"ul"},"Memory/Swap: bytes")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Using the Centreon Monitoring Connectors guarantees the quality of your data.")),(0,a.kt)("h3",{id:"best-practices-for-configuring-centreon-objects"},"Best practices for configuring Centreon objects"),(0,a.kt)("p",null,"In Centreon MBI, each report design has several parameters that allow\nyou to generate customized documents according to your business\nrequirements."),(0,a.kt)("p",null,"Parameter types can be:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"A main object on which the report will be generated, such as:"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"A host"),(0,a.kt)("li",{parentName:"ul"},"A host group: functional group defined in Centreon to classify\nhosts by customer, application, business unit, country, etc."),(0,a.kt)("li",{parentName:"ul"},"Several host groups."))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},'A time period (or "Business hours" also called "Live service")\nfor which statistics will be calculated.')),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Filters that take into account only specific types of hardware,\nservices and metrics from selected host groups:")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Host categories: Classifies hosts into technical groups for determining the type or technical function\nof a host (e.g., Linux servers, Windows servers, Cisco routers, printers).")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Service categories: Defines the type of service (e.g., CPU, physical memory, storage).")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},'Metrics: Indicates performance data collected by the services\n(monitoring indicators). One monitoring service can collect\nseveral metrics. However metric names and units are not\nstandardized. For instance, one CPU-type service can collect only\na metric called "cpu_average" defined in percentages, and\nanother CPU-type service can collect a metric by CPU core\nconfigured in the hardware. Therefore, when generating a report,\nit is essential to select the metrics used in calculating the statistics.'))),(0,a.kt)("h3",{id:"host-groups-and-categories"},"Host groups and categories"),(0,a.kt)("p",null,"The definitions of host groups and categories listed in the previous\nchapter comply with the best practices established by Centreon."),(0,a.kt)("p",null,"However, the groups and categories that you create should correspond to\nyour business requirements."),(0,a.kt)("p",null,"Example:"),(0,a.kt)("p",null,"If you need to report the number of alerts generated by IT field, with a\ndetailed distribution by type of hardware, you will have to define the\nhost groups and categories using this method:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Host groups: ",(0,a.kt)("strong",{parentName:"li"},"Databases"),", Applications, Security, Network, Mail,\netc."),(0,a.kt)("li",{parentName:"ul"},"Host categories: DB2-Servers, MySQL-Servers, Oracle-Servers,\nSQL-Servers, etc.")),(0,a.kt)("p",null,"Here is an example of statistics that you can obtain using those groups\nand categories:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image",src:n(1525).Z,width:"711",height:"338"})),(0,a.kt)("p",null,"The host group is the first analysis axis. The host category allows you\nto analyze the statistics in subsets."),(0,a.kt)("p",null,"In the same way, we can analyze the statistics using the following\ndimensions:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"By country (host group) with a data distribution by type of network\nhardware (host category)"),(0,a.kt)("li",{parentName:"ul"},"By country (host group) with a data distribution by customer (host\ncategory)"),(0,a.kt)("li",{parentName:"ul"},"By customer (host group) with a data distribution by country (host\ncategory)"),(0,a.kt)("li",{parentName:"ul"},"By customer (host group) with a data distribution by application\nserver (host category)")),(0,a.kt)("p",null,"There is no standard set of rules for defining host groups and\ncategories. They must correspond to your reporting needs."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Creating categories and groups")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"You associate hosts to host groups in the ",(0,a.kt)("em",{parentName:"li"},"Configuration > Hosts >\nHost groups")," menu on the Centreon interface. You can also use the\n",(0,a.kt)("em",{parentName:"li"},"Relations")," tab in the host add/modification form."),(0,a.kt)("li",{parentName:"ul"},"You associate hosts and host categories in the\n",(0,a.kt)("strong",{parentName:"li"},"Configuration > Hosts > Categories")," menu. You can also use the\n",(0,a.kt)("strong",{parentName:"li"},"Relations")," tab in the host add/modification form.")),(0,a.kt)("h3",{id:"service-categories"},"Service categories"),(0,a.kt)("p",null,"Service categories allow you to organize services (monitoring\nindicators) into subsets. The most common usage of service categories is\nfor defining categories based on service types, e.g., CPU, physical\nmemory, storage, Process-Oracle, DNS, Process-WebSphere."),(0,a.kt)("p",null,"This type of configuration lets you:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Compare the number of alerts generated by each type of service."),(0,a.kt)("li",{parentName:"ul"},"Select the service category that indicates storage usage information\nwhen you need to generate a capacity report.")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Like the host groups and categories, service categories must be\ndefined according to your reporting needs.")),(0,a.kt)("p",null,'For instance, if you need to analyze the storage space allocated and\nused by DBMS or an application type, you may need to create several\nservice categories. Instead of using only one service category named\n"Storage" or "Disk", you could create these service categories:'),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},'"Operating system"'),(0,a.kt)("li",{parentName:"ul"},'"Oracle"'),(0,a.kt)("li",{parentName:"ul"},'"SQL Server"')),(0,a.kt)("p",null,"Here is an example of statistics that you can obtain using these service\ncategories:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image",src:n(10557).Z,width:"680",height:"271"})),(0,a.kt)("p",null,"You associate services and service categories in the ",(0,a.kt)("em",{parentName:"p"},"Configuration > Services > Categories")," menu in\nthe Centreon Interface. You can also use the ",(0,a.kt)("em",{parentName:"p"},"Relation")," tab in the add/modification form of a given service."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"For managing service categories, we highly recommend that you only use the service templates.")),(0,a.kt)("h2",{id:"extract-transform-load-etl"},"Extract, Transform, Load (ETL)"),(0,a.kt)("h3",{id:"change-history"},"Change history"),(0,a.kt)("p",null,"Centreon MBI logs every change affecting the relationships between\nhosts, services, groups and categories."),(0,a.kt)("p",null,"Example:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},'Host "H1" is related to host group "G1" in January.'),(0,a.kt)("li",{parentName:"ul"},'Host "H1" no longer belongs to group "G1" as of February 1.'),(0,a.kt)("li",{parentName:"ul"},'After this change, if a report is generated for group "G1" over\nthe reporting period of January, the statistics of host "H1" will\nbe considered in the statistics of group "G1".'),(0,a.kt)("li",{parentName:"ul"},'The statistics of host "H1" will not be considered for group\n"G1" if the reporting period selected is February.'),(0,a.kt)("li",{parentName:"ul"},'If the reporting period starts on January 15 and ends on February\n15, the statistics of host "H1" will be considered for the\nstatistics of group "G1" only from January 15 to January 31.')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"The initial Centreon setup and the relationship between objects must\nbe clearly defined before installing Centreon MBI on a production\nplatform. Any change to the configuration of a host, group or category\nis considered to be a normal part of their lifecycle.")),(0,a.kt)("h3",{id:"execution-modes"},"Execution modes"),(0,a.kt)("p",null,'The Centreon MBI reporting database or "data warehouse" is updated every\nday with aggregated data calculated by the ETL, processing potentially\nmillions of lines of data on your platform. For this reason the ETL and\ndata warehouse play a critical role that should be understood.'),(0,a.kt)("p",null,"The ETL operates in ",(0,a.kt)("strong",{parentName:"p"},"two modes"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Daily mode"),": When up and running, Centreon MBI reporting platform\nnormally functions in this mode. Centreon data is imported daily\ninto the reporting database, but incrementally. More specifically:"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"data_bin is imported incrementally and aggregations are\ncalculated only for the previous day."),(0,a.kt)("li",{parentName:"ul"},"the entire hoststatevents and servicestatevents tables are\nimported but events are calculated incrementally.")),(0,a.kt)("p",{parentName:"li"},"The update process can take a matter of seconds up to several minutes\ndepending on the size of your monitored environment.\nThe daily mode is configured in a crontab file located in\n",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/cron.d/centreon-bi-engine"),":"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"30 4 * * * root /usr/share/centreon-bi/bin/centreonBIETL --daily >> /var/log/centreon-bi/centreonBIETL.log 2>&1\n")))),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("strong",{parentName:"p"},"Warning")),(0,a.kt)("p",{parentName:"blockquote"},"Executing this script multiple times on the same day will cause\nduplication problems.")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Rebuild mode"),": After installation of the Centreon MBI platform,\nthis mode if often used in case of data corruption. You can import\nand calculate statistics over a defined period, or by using the\n",(0,a.kt)("strong",{parentName:"p"},"retention parameters"),"."),(0,a.kt)("p",{parentName:"li"},"Example:"),(0,a.kt)("p",{parentName:"li"},"/usr/share/centreon-bi/bin/centreonBIETL -r"),(0,a.kt)("p",{parentName:"li"},"To obtain acceptable execution times and manage all the data generated\nby your Centreon platform, the hardware configuration, storage\ncapacity and MariaDB optimizations are three important points to\nconsider when installing Centreon MBI. For recommendations, consult\nthe online documentation in the Architecture & Pre-requisites\nchapters."))),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"We advise you to monitor the reporting database using the dedicated Monitoring Connector. If the ETL does\nnot work for several days or the raw data is not up to date, you\nmust perform a rebuild for the missing days. The ETL ",(0,a.kt)("strong",{parentName:"p"},"does not\nautomatically")," reimport and calculate the missing days. Do not hesitate\nto contact the Centreon support team for assistance.")),(0,a.kt)("h4",{id:"execution-options"},"Execution Options"),(0,a.kt)("p",null,"Various parameter options can be passed to the script to execute\nspecific actions:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"-c  Create the reporting database model.\n-d  Daily execution to calculate statistics on yesterday.\n-r  Rebuild mode to calculate statistics on a historical period. Can be used with:\n    Extra arguments for options -d and -r (if none of the following is specified, these ones are selected by default: -IDEP):\n-I  Extract data from the monitoring server.\n    Extra arguments for option -I:\n    -C  Extract Centreon configuration database only. Works with option -I.\n    -i  Ignore perfdata extraction from monitoring server.\n    -o  Extract only perfdata from monitoring server.\n\n-D  Calculate dimensions.\n-E  Calculate event and availability statistics.\n-P  Calculate perfdata statistics.\n    Common options for -rIDEP:\n    -s  Start date in format YYYY-MM-DD.\n        By default, the program uses the data retention period from Centreon MBI configuration.\n    -e  End date in format YYYY-MM-DD.\n        By default, the program uses the data retention period from Centreon MBI configuration.\n    -p  Do not empty statistic tables; delete only entries for the processed period.\n        Does not work on raw data tables, only on Centreon MBI statistics tables.\n")),(0,a.kt)("p",null,'If no "start" or "end" date is given to the ETL script, the start\nand end date are automatically calculated using the retention parameters\nconfigured on the interface in General Option > Data retention\nParameter.'),(0,a.kt)("h4",{id:"performance"},"Performance"),(0,a.kt)("p",null,"If ETL processing seems too long in daily or rebuild mode, you should\nconsider optimizing your reporting server by:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Optimizing the MariaDB configuration."),(0,a.kt)("li",{parentName:"ul"},"Storing the database on a high-performance disk (e.g., with no i/o\nwait time)."),(0,a.kt)("li",{parentName:"ul"},"Adding more physical memory (+ optimize configuration)."),(0,a.kt)("li",{parentName:"ul"},"Not sharing storage or the database with other applications.")),(0,a.kt)("h3",{id:"purge"},"Purge"),(0,a.kt)("p",null,"Data purging can be activated in Centreon MBI General Options to ensure\nthat the database complies with the retention configuration. You\nactivate this function through the interface AND in the following cron\non the reporting server: ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/cron.d/centreon-bi-purge"),"."),(0,a.kt)("p",null,"Reporting dimensions (combination of groups/host\ncategories/services/metrics) with no relating data are automatically\ndeleted from the reporting database."),(0,a.kt)("h3",{id:"how-to-apply-a-new-configuration-to-historical-data"},"How to apply a new configuration to historical data"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"This procedure deletes all previously calculated data (and links between\nobjects) and recalculates data based on the retention period in the\nlatest Centreon configuration.")),(0,a.kt)("p",null,"When implementing Centreon reporting, you may expect to re-execute your\nstatistical calculations a number of times if the Centreon configuration\nchanges. When you have finished making changes to groups and categories,\nyou can run the commands below on the REPORTING server, preferably in\nthe morning (due to several hours of potential processing time). This\nprocedure does not include the importing of logs or raw data. Make sure\nall data imported from Centreon is up to date on your reporting server\nby running the following command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"/usr/share/centreon-bi/etl/centreonbiMonitoring.pl --db-content\n")),(0,a.kt)("p",null,'And make sure "ETL OK - Database is up to date" appears OR that the\nfollowing tables are not listed:'),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"data_bin"),(0,a.kt)("li",{parentName:"ul"},"hoststatevents"),(0,a.kt)("li",{parentName:"ul"},"servicestateevents")),(0,a.kt)("p",null,"If you run the following set of ETL commands without any start and end\nparameters, the calculations will be based on the retention parameter\ndefined in the Centreon MBI > General Option > Data retention tab\nmenu. If you are currently installing or testing the product, you may\nconsider reducing the retention time BEFORE processing and restore the\ndefault value (365 days) AFTER processing. This will help speed up\ncalculation time."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image",src:n(39762).Z,width:"1686",height:"634"})),(0,a.kt)("h4",{id:"import-the-latest-centreon-configuration"},"Import the latest Centreon configuration"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"/usr/share/centreon-bi/etl/importData.pl -r --centreon-only\n")),(0,a.kt)("h4",{id:"calculate-reporting-dimensions"},"Calculate reporting dimensions"),(0,a.kt)("p",null,"This command will erase all previous changes tracked by the reporting\nmechanism and include only the latest. If you want to include former\nchanges, replace the ",(0,a.kt)("strong",{parentName:"p"},"-r")," by ",(0,a.kt)("strong",{parentName:"p"},"-d"),"::"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"/usr/share/centreon-bi/etl/dimensionsBuilder.pl -r\n")),(0,a.kt)("h4",{id:"aggregate-events-and-availability"},"Aggregate events and availability"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"nohup /usr/share/centreon-bi/etl/eventStatisticsBuilder.pl -r > /var/log/centreon-bi/rebuildAllEvents.log &\n")),(0,a.kt)("h4",{id:"aggregate-performance-data-storage-traffic-etc"},"Aggregate performance data (storage, traffic, etc.)"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"nohup /usr/share/centreon-bi/etl/perfdataStatisticsBuilder.pl -r > /var/log/centreon-bi/rebuildAllPerf.log &\n")),(0,a.kt)("h3",{id:"how-to-rebuild-missing-reporting-data"},"How to rebuild missing reporting data"),(0,a.kt)("p",null,'You may require this procedure when the monitoring plugin of your\nreporting server returns a state other than "OK". This may appear\nduring daily processing (e.g., data is not up to date, there is\ninsufficient space on the reporting server, or processing was manually\ninterrupted).'),(0,a.kt)("p",null,"The plugin may return a message that your database is not up to date, as\nin the following example: :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"/usr/share/centreon-bi/etl/centreonbiMonitoring.pl --db-content\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"[Table mod_bam_reporting, last entry: 2020-07-01 00:00:00] [Table mod_bi_ba_incidents, last entry: 2020-07-01 00:00:00] [Table hoststateevents, last entry: 2020-07-01 00:00:00]\n[Table servicestateevents, last entry: 2020-07-01 00:00:00] [Table mod_bi_hoststateevents, last entry: 2020-07-01 00:00:00]\n[Table mod_bi_servicestateevents, last entry: 2020-07-01 00:00:00] [Table mod_bi_hostavailability, last entry: 2020-07-01 00:00:00]\n[Table mod_bi_serviceavailability, last entry: 2020-07-01 00:00:00] [Table data_bin, last entry: 2020-08-01 00:00:00] [Table mod_bi_metricdailyvalue, last entry: 2020-08-01 00:00:00]\n[Table mod_bi_metrichourlyvalue, last entry: 2020-08-01 23:00:00]\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"When only the ",(0,a.kt)("inlineCode",{parentName:"p"},"mod_bi")," tables appear, there is an incident\nwith aggregated data and not the Centreon data."),(0,a.kt)("p",{parentName:"li"},"In this case, ",(0,a.kt)("strong",{parentName:"p"},'skip the "Import Missing data" section')," below.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"If the following tables appear, a problem has occurred with the raw\ndata imported from Centreon:")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"hoststatevents")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"servicestateevents")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"All the mod_bam_reporting* tables")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"data_bin."))),(0,a.kt)("p",null,"First resolve any incidents on the Centreon side before executing the\nprocedure below."),(0,a.kt)("h4",{id:"prerequisites"},"Prerequisites"),(0,a.kt)("p",null,"Before running the commands in the procedure below, check that:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The Centreon platform is up and running, and data is up to date."),(0,a.kt)("li",{parentName:"ul"},"The daily cron centreonBIETL is not enabled (it should be commented\nout) on the reporting server in the file\n/etc/cron.d/centreon-bi-engine. It must be enabled at the end of the\nprocedure."),(0,a.kt)("li",{parentName:"ul"},"The script dataRetentionManager.pl is not enabled (also commented\nout) on the reporting server in the file\n/etc/cron.d/centreon-bi-purge. It must be enabled at the end of the\nprocedure."),(0,a.kt)("li",{parentName:"ul"},"Retention is enabled on the interface."),(0,a.kt)("li",{parentName:"ul"},"Retention is configured for no more than 1024 days."),(0,a.kt)("li",{parentName:"ul"},"The scripts in ",(0,a.kt)("inlineCode",{parentName:"li"},"/etc/cron.d/centreon-bi-backup-reporting-server")," are not enabled\n(commented out). They must be enabled at the end of the procedure.")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},'For the following commands, we advise you to use "screen" or "nohup" to\nprevent disconnection due to timeout. And you must manually replace the following elements:'),(0,a.kt)("ul",{parentName:"blockquote"},(0,a.kt)("li",{parentName:"ul"},"$date_start$ should be replaced according to the data you want to retrieve (based on retention or starting point of missing data)"),(0,a.kt)("li",{parentName:"ul"},'$date_end$ most of the time corresponds to the "today" date'))),(0,a.kt)("h4",{id:"import-the-missing-data"},"Import the missing data"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Import the data, without the performance data (data_bin table),\nfrom a specific date according to the Availability retention period\nyou defined in ",(0,a.kt)("inlineCode",{parentName:"li"},"Centreon MBI > Generation Option > Data Retention\nParameters"),":")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"nohup /usr/share/centreon-bi/etl/importData.pl -r -s $date_start$-e $date_end$ --ignore-databin > /var/log/centreon-bi/rebuild_importDataEvents.log &\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"*Execution time: fast (minutes)*\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Import the data from data_bin, starting from the date the last data\nwas present in the database. You will find that date next to the\ndata_bin table, returned by the plugin: :")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"nohup /usr/share/centreon-bi/etl/importData.pl -r --no-purge --databin-only -s $date_start$ -e $date_end$ > /var/log/centreon-bi/rebuild_importDataBin.log &\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"*Execution time: fast (minutes), depending on the number of days imported.*\n")),(0,a.kt)("h4",{id:"update-reporting-dimensions"},"Update reporting dimensions"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Update the dimensions. Using the ",(0,a.kt)("strong",{parentName:"li"},'"-d"'),' option keeps the history\nof changes made in the configuration. Avoid using the "-r" option\nor you will have to rebuild all statistics: :')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"nohup /usr/share/centreon-bi/etl/dimensionsBuilder.pl -d > /var/log/centreon-bi/rebuild_dimensions.log &\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"*Execution time: fast (seconds or minutes)*\n")),(0,a.kt)("h4",{id:"rebuild-missing-events-and-availability-data"},"Rebuild missing events and availability data"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Rebuild events from a specific date according to the retention\nperiod defined in Centreon MBI > Generation Option > Data\nRetention Parameters: :")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"nohup /usr/share/centreon-bi/etl/eventStatisticsBuilder.pl -r --events-only > /var/log/centreon-bi/rebuild_events.log &\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"*Execution time: Depending on the monitoring perimeter and the\nnumber of events: several hours but normally not longer than 24\nhours. In excess of this limit, please contact the Centreon support\nteam.*\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Rebuild the availability tables, starting from the day where the\nlast data was present. Check the mod_bi_hostavailability and\nmod_bi_serviceavailability date returned by the plugin for the\nlatest build data:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"nohup /usr/share/centreon-bi/etl/eventStatisticsBuilder.pl -r --no-purge --availability-only -s $date_start$ -e $date_end$ > /var/log/centreon-bi/rebuild_availability.log &\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"*Execution time: From a few minutes to several hours, depending on\nthe number of days of rebuild*.\n")),(0,a.kt)("h4",{id:"rebuild-the-missing-performance-data"},"Rebuild the missing performance data"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Rebuild the missing performance statistics. Check the earliest date\nnext to the mod_bi_metrichourlyvalue and mod_bi_metricdailyvalue\ntables returned by the plugin for the last data calculated: :")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"nohup /usr/share/centreon-bi/etl/perfdataStatisticsBuilder.pl -r --no-purge -s $date_start$ -e $date_end$ > /var/log/centreon-bi/rebuild_perfData.log &\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"*Execution time: From a few minutes to several hours, depending on\nthe number of days to calculate. If the number of days of rebuild is\ngreater than the hourly retention setting, the amount of data\ngenerated may be voluminous and the rebuild time long.*\n")),(0,a.kt)("h4",{id:"what-to-do-after-executing-the-scripts"},"What to do after executing the scripts"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Case 1: ",(0,a.kt)("strong",{parentName:"p"},"The rebuild is performed on the same day")),(0,a.kt)("p",{parentName:"li"},"Uncomment the lines in ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/cron.d/centreon-bi-engine")," and\n",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/cron.d/centreon-bi-purge")," and restart the cron service:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"systemctl restart crond restart\n"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Case 2 : ",(0,a.kt)("strong",{parentName:"p"},"The rebuild finishes the next day")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Uncomment the lines in ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/cron.d/centreon-bi-engine")," and\n",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/cron.d/centreon-bi-purge")," and restart the cron service:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"   systemctl restart crond restart\n"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Manually execute the daily script:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"/usr/share/centreon-bi/bin/centreonBIETL -d\n"))))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Case 3: ",(0,a.kt)("strong",{parentName:"p"},"In other cases"),": Follow the procedure of partial rebuild for the missing days."),(0,a.kt)("p",{parentName:"li"},"Example:\nThe rebuild took 4 days, from January 1 to January 4: You need to follow the procedure from the beginning and use date_start = 01-01 and date_end = 04/01\nThe procedure is over, the output of the BI monitoring plugin should be \u201cETL execution OK, database is up-to-date\u201d."))),(0,a.kt)("h3",{id:"centreon-bam-statistics"},"Centreon BAM statistics"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Follow this procedure if you rebuilt the Centreon BAM statistics."),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Reimport the BAM data from the central server to the reporting server by running the following command:")),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"/usr/share/centreon-bi/etl/importData.pl -r --bam-only\n")),(0,a.kt)("p",{parentName:"li"},"This will import all Centreon BAM reporting tables.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"If statistics are not up to date, follow this procedure:"),(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"You need first to execute the following command to rebuild statistics on the central server:")),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"/usr/share/centreon/www/modules/centreon-bam-server/engine/centreon-bam-rebuild-events --all\n")),(0,a.kt)("ol",{parentName:"li",start:2},(0,a.kt)("li",{parentName:"ol"},"Then import them using this command on the reporting server:")),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"/usr/share/centreon-bi/etl/importData.pl -r --bam-only\n")))),(0,a.kt)("h3",{id:"how-to-rebuild-only-centile-statistics"},"How to rebuild only Centile statistics"),(0,a.kt)("p",null,'To use the "Monthly Network Percentile" report you must activate\ncentile calculation and storage. Go to the ',(0,a.kt)("em",{parentName:"p"},"Reporting > Business\nIntelligence > General Options | ETL Tab"),' page and configure the\nsubsection "Centile parameters" as described below to create a\nrelevant centile/timeperiod combination(s). If this report is not\nrequired, simply leave the default values.'),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,a.kt)("th",{parentName:"tr",align:null},"Value"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Calculate centile aggregation"),(0,a.kt)("td",{parentName:"tr",align:null},"Monthly (minimum)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Select service categories to aggregate centile on"),(0,a.kt)("td",{parentName:"tr",align:null},"Select at least one traffic service category")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Set first day of the week"),(0,a.kt)("td",{parentName:"tr",align:null},"Monday (default)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Create the required centile-time period combination(s)"),(0,a.kt)("td",{parentName:"tr",align:null},"Create at least one combination, e.g. 99.0000 - 24x7")))),(0,a.kt)("p",null,"See example in the screenshot below:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image",src:n(34725).Z,width:"1339",height:"344"})),(0,a.kt)("p",null,'Only service categories selected in "Reporting perimeter selection"\nwill appear in the list of service categories available for centile\nstatistics.'),(0,a.kt)("p",null,"You can create as many centile-time period combinations as you like, but\nbe advised that this may increase calculation time. Start with a small\nnumber of parameter combinations to determine the impact on calculation\ntime."),(0,a.kt)("p",null,"On the ",(0,a.kt)("strong",{parentName:"p"},"reporting")," server, run the following command to import the\nconfiguration data:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"/usr/share/centreon-bi/bin/centreonBIETL -rIC\n")),(0,a.kt)("p",null,"Then, run the following command to update the centile configuration in\nthe datawarehouse:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"/usr/share/centreon-bi/etl/dimensionsBuilder.pl -d\n")),(0,a.kt)("p",null,"Finally, run the following command to calculate only the centile\nstatistics:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"/usr/share/centreon-bi/etl/perfdataStatisticsBuilder.pl -r --centile-only\n")))}h.isMDXComponent=!0},34725:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/centileParameters-d6cc1e29c23dae38d42ee2a7d42bc34c.png"},39762:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/etl_dataRetention-75d8b5ebfae865e339d641b91a259ecd.png"},60861:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/mtbf_mtbsi_mtrs_explanation-c309e18559c129e1da9dcd0cab037e08.png"},1525:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/pie_charts-1f2b9904e42f161e886628868ce3e935.png"},10557:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/storage_example-1002826480ef742c7259fc135fb81021.png"}}]);