"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[78497],{57332:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>c,default:()=>g,frontMatter:()=>p,metadata:()=>u,toc:()=>m});n(67294);var a=n(3905),r=n(51715),o=n(7626);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const p={id:"overview",title:"Centreon HA"},c=void 0,u={unversionedId:"installation/installation-of-centreon-ha/overview",id:"version-23.10/installation/installation-of-centreon-ha/overview",title:"Centreon HA",description:"Introduction",source:"@site/versioned_docs/version-23.10/installation/installation-of-centreon-ha/overview.md",sourceDirName:"installation/installation-of-centreon-ha",slug:"/installation/installation-of-centreon-ha/overview",permalink:"/centreon-documentation/pr-preview/staging/pr-2596/docs/installation/installation-of-centreon-ha/overview",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/versioned_docs/version-23.10/installation/installation-of-centreon-ha/overview.md",tags:[],version:"23.10",lastUpdatedAt:1699359701,formattedLastUpdatedAt:"Nov 7, 2023",frontMatter:{id:"overview",title:"Centreon HA"},sidebar:"version-23.10/docs",previous:{title:"Graphical views API (beta)",permalink:"/centreon-documentation/pr-preview/staging/pr-2596/docs/api/graph-views-api"},next:{title:"Installing a Centreon HA 2-nodes cluster",permalink:"/centreon-documentation/pr-preview/staging/pr-2596/docs/installation/installation-of-centreon-ha/installation-2-nodes"}},d={},m=[{value:"Introduction",id:"introduction",level:2},{value:"Concepts",id:"concepts",level:2},{value:"MariaDB functional group",id:"mariadb-functional-group",level:3},{value:"Centreon functional group",id:"centreon-functional-group",level:3},{value:"Resources type description",id:"resources-type-description",level:3},{value:"Resource constraints",id:"resource-constraints",level:3},{value:"QDevice and votes",id:"qdevice-and-votes",level:3},{value:"Support",id:"support",level:2},{value:"Software &amp; operating systems",id:"software--operating-systems",level:3},{value:"Architectures",id:"architectures",level:3},{value:"Additional information",id:"additional-information",level:2},{value:"Server organization",id:"server-organization",level:3},{value:"Role of the Centreon central server",id:"role-of-the-centreon-central-server",level:3},{value:"VIP and load balancing",id:"vip-and-load-balancing",level:3}],k={toc:m},h="wrapper";function g(e){var{components:t}=e,p=s(e,["components"]);return(0,a.kt)(h,l(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){i(e,t,n[t])}))}return e}({},k,p),{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"introduction"},"Introduction"),(0,a.kt)("p",null,"Centreon-HA is the only official and supported solution to set up a highly available monitoring cluster. It\nincludes the following: "),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Documentation, mainly to describe how to set up your Cluster on top of your Centreon solution."),(0,a.kt)("li",{parentName:"ul"},"Script collection enabling safe and efficient management of Centreon-related resources."),(0,a.kt)("li",{parentName:"ul"},"Additional files that extend the default Centreon capabilities. ")),(0,a.kt)("p",null,"Its architecture relies on the ",(0,a.kt)("a",{parentName:"p",href:"https://clusterlabs.org/"},"ClusterLabs")," components pacemaker and corosync,\nallowing fault tolerance on the following components: "),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Central Server applicative daemons",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"centreon-engine (scheduler)"),(0,a.kt)("li",{parentName:"ul"},"centreon-broker (multiplexer)"),(0,a.kt)("li",{parentName:"ul"},"centreon-gorgone (task manager)"),(0,a.kt)("li",{parentName:"ul"},"centreon-central-sync (config file replication)"),(0,a.kt)("li",{parentName:"ul"},"snmptrapd and centreontrapd (system and applicative trap management processes)"))),(0,a.kt)("li",{parentName:"ul"},"Central Server third-party daemons",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"php-fpm (FastCGI PHP cache)"),(0,a.kt)("li",{parentName:"ul"},"apache server (webserver)"))),(0,a.kt)("li",{parentName:"ul"},"Databases",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Active/Passive binlog replication (storage)"))),(0,a.kt)("li",{parentName:"ul"},"Host failures",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Virtual machines or Physical servers")))),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("strong",{parentName:"p"},"Warning:")," If you have an IT or Business subscription, please get in touch with your Centreon Sales\nrepresentative or Technical Account Manager before implementing this. Extensions need specific license\nfiles to work on both nodes smoothly.  ")),(0,a.kt)("h2",{id:"concepts"},"Concepts"),(0,a.kt)("p",null,"The solution implements three different kinds of resources: "),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("em",{parentName:"li"},"Multi-state")," resource running on both nodes with different roles. "),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("em",{parentName:"li"},"Clone")," resources, running on both primary and secondary nodes."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("em",{parentName:"li"},"Unique")," resources, part of a ",(0,a.kt)("em",{parentName:"li"},"group"),", and running on only one node.")),(0,a.kt)("p",null,"The cluster services are divided into two functional groups."),(0,a.kt)("h3",{id:"mariadb-functional-group"},"MariaDB functional group"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"ms_mysql")," functional group is a ",(0,a.kt)("em",{parentName:"p"},"multi-state")," resource. This resource can be in active/primary mode\non one node and in secondary/passive mode on another node. "),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"ms_mysql-master")," meta-resource is assigned to the primary database. "),(0,a.kt)("h3",{id:"centreon-functional-group"},"Centreon functional group"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"centreon")," functional group gathers all Centreon resources to manage them. "),(0,a.kt)("h3",{id:"resources-type-description"},"Resources type description"),(0,a.kt)("p",null,"All these resources are described in the table below."),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Name"),(0,a.kt)("th",{parentName:"tr",align:null},"Type"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"ms_mysql")),(0,a.kt)("td",{parentName:"tr",align:null},"multi-state resource"),(0,a.kt)("td",{parentName:"tr",align:null},"Handles the ",(0,a.kt)("inlineCode",{parentName:"td"},"mysql")," process and data replication")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"ms_mysql-master")),(0,a.kt)("td",{parentName:"tr",align:null},"location"),(0,a.kt)("td",{parentName:"tr",align:null},"Set MariaDB Master server rule preference")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"php8")),(0,a.kt)("td",{parentName:"tr",align:null},"clone service"),(0,a.kt)("td",{parentName:"tr",align:null},"FastCGI Process Manager service (",(0,a.kt)("inlineCode",{parentName:"td"},"php-fpm"),")")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"cbd_rrd")),(0,a.kt)("td",{parentName:"tr",align:null},"clone service"),(0,a.kt)("td",{parentName:"tr",align:null},"Broker RRD service (",(0,a.kt)("inlineCode",{parentName:"td"},"cbd"),")")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"centreon")),(0,a.kt)("td",{parentName:"tr",align:null},"group"),(0,a.kt)("td",{parentName:"tr",align:null},'Centreon "primitive services" group')),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"vip")),(0,a.kt)("td",{parentName:"tr",align:null},"primitive service"),(0,a.kt)("td",{parentName:"tr",align:null},"VIP address for centreon")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"http")),(0,a.kt)("td",{parentName:"tr",align:null},"primitive service"),(0,a.kt)("td",{parentName:"tr",align:null},"Apache service (",(0,a.kt)("inlineCode",{parentName:"td"},"httpd24-httpd"),")")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"gorgone")),(0,a.kt)("td",{parentName:"tr",align:null},"primitive service"),(0,a.kt)("td",{parentName:"tr",align:null},"Gorgone service (",(0,a.kt)("inlineCode",{parentName:"td"},"gorgoned"),")")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"centreon_central_sync")),(0,a.kt)("td",{parentName:"tr",align:null},"primitive service"),(0,a.kt)("td",{parentName:"tr",align:null},"File synchronization service")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"cbd_central_broker")),(0,a.kt)("td",{parentName:"tr",align:null},"primitive service"),(0,a.kt)("td",{parentName:"tr",align:null},"Central Broker service (",(0,a.kt)("inlineCode",{parentName:"td"},"cbd-sql"),")")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"centengine")),(0,a.kt)("td",{parentName:"tr",align:null},"primitive service"),(0,a.kt)("td",{parentName:"tr",align:null},"Centreon-Engine service (",(0,a.kt)("inlineCode",{parentName:"td"},"centengine"),")")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"centreontrapd")),(0,a.kt)("td",{parentName:"tr",align:null},"primitive service"),(0,a.kt)("td",{parentName:"tr",align:null},"SNMP Traps management service (",(0,a.kt)("inlineCode",{parentName:"td"},"centreontrapd"),")")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"snmptrapd")),(0,a.kt)("td",{parentName:"tr",align:null},"primitive service"),(0,a.kt)("td",{parentName:"tr",align:null},"SNMP Traps listening service (",(0,a.kt)("inlineCode",{parentName:"td"},"snmptrapd"),")")))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Note:")," The resources of the ",(0,a.kt)("inlineCode",{parentName:"p"},"centreon")," group are started one after the other in the list order."),(0,a.kt)("h3",{id:"resource-constraints"},"Resource constraints"),(0,a.kt)("p",null,"Pacemaker offers various types of constraints:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Location: where the resource should or shouldn't run."),(0,a.kt)("li",{parentName:"ul"},"Colocation: how resources behave to each other.")),(0,a.kt)("p",null,"For example, Centreon-HA uses location constraints to specify to Pacemaker that the database process\nneeds to be up on backend nodes but not on frontend nodes. "),(0,a.kt)("p",null,"Regarding colocation constraints, they can ensure a Virtual IP sticks to the master nodes and/or role.\nTherefore Users, Pollers, and Daemons constantly interact with the primary node. "),(0,a.kt)("h3",{id:"qdevice-and-votes"},"QDevice and votes"),(0,a.kt)("p",null,"The configuration of a qdevice is ",(0,a.kt)("strong",{parentName:"p"},"mandatory")," to avoid split-brain and other situations nobody wants\nto face in a Cluster. The server with the ",(0,a.kt)("inlineCode",{parentName:"p"},"quorum-device")," role aims to obtain an absolute majority in a vote\nto elect a master node or resource role."),(0,a.kt)("h2",{id:"support"},"Support"),(0,a.kt)("h3",{id:"software--operating-systems"},"Software & operating systems"),(0,a.kt)("p",null,"Centreon officially supports clustering on the following products: "),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Any Centreon Licensed Editions "),(0,a.kt)("li",{parentName:"ul"},"Centreon Map Server ")),(0,a.kt)("p",null,"And on the following Operating Systems: "),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Alma / RHEL / Oracle Linux 8"),(0,a.kt)("li",{parentName:"ul"},"Debian 11 ")),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"Important:")," To install pacemaker and corosync packages on RedHat systems, servers must have access to\nthe ",(0,a.kt)("em",{parentName:"p"},"Red Hat Enterprise Linux High Availability")," licensed repository.  "),(0,a.kt)("p",null,"The only official database server Centreon supports is MariaDB. "),(0,a.kt)("p",null,"Nevertheless, note that we validated that the whole solution can run on MySQL 8 ",(0,a.kt)("em",{parentName:"p"},"with some\nmodifications"),"; only the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/centreon-ha/issues"},"community")," (or your DBAs)\ncan help and support you in running a cluster on top of an Oracle MySQL server."),(0,a.kt)("p",null,"For both MariaDB and Oracle MySQL, the replication configuration might be intrusive. We ",(0,a.kt)("em",{parentName:"p"},"strongly discourage you")," from setting\nup a cluster on a server holding other application databases, and we won't support it. "),(0,a.kt)("h3",{id:"architectures"},"Architectures"),(0,a.kt)("p",null,"Centreon supports both two- and four-node architectures. We recommend using a two-node architecture, unless\nyour organization requires a systematic split of front and back servers or your monitoring\nscope is above 5k Hosts. "),(0,a.kt)("p",null,"The schemas below show both the architecture flavor and network flows between servers. To get the complete network\nflow matrix, refer to the architecture dedicated installation page."),(0,a.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,a.kt)(o.Z,{value:"Two-nodes-cluster",label:"Two-nodes-cluster",mdxType:"TabItem"},(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image",src:n(52787).Z,width:"2044",height:"1530"})),(0,a.kt)("p",null,"Go to ",(0,a.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2596/docs/installation/installation-of-centreon-ha/installation-2-nodes"},"this page")," to start your two-node setup! ")),(0,a.kt)(o.Z,{value:"Four-nodes-cluster",label:"Four-nodes-cluster",mdxType:"TabItem"},(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image",src:n(76908).Z,width:"2228",height:"1517"})),(0,a.kt)("p",null,"Go to ",(0,a.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2596/docs/installation/installation-of-centreon-ha/installation-4-nodes"},"this page")," to start your four-node setup!"))),(0,a.kt)("h2",{id:"additional-information"},"Additional information"),(0,a.kt)("h3",{id:"server-organization"},"Server organization"),(0,a.kt)("p",null,"Setting up a Centreon-HA cluster might be overkill, or at least not optimal, when all your servers are running in\nthe same datacenter or (even more so) within the same rack. "),(0,a.kt)("p",null,"In a perfect world, the primary and secondary nodes would be running on different (geographical) sites, and the qdevice\nwould communicate with both sites independently. Obviously, all nodes need to communicate with each other."),(0,a.kt)("h3",{id:"role-of-the-centreon-central-server"},"Role of the Centreon central server"),(0,a.kt)("p",null,"In the case of a highly available architecture the ",(0,a.kt)("strong",{parentName:"p"},"Centreon central cluster must not be used as a poller"),".\nIn other words, it should not monitor resources. Its monitoring ability should only be used to monitor its pollers.\nIf this recommendation is not followed, the ",(0,a.kt)("inlineCode",{parentName:"p"},"centengine")," service will take too long to restart\nand ",(0,a.kt)("strong",{parentName:"p"},"it may cause the functional ",(0,a.kt)("inlineCode",{parentName:"strong"},"centreon")," group to failover"),"."),(0,a.kt)("h3",{id:"vip-and-load-balancing"},"VIP and load balancing"),(0,a.kt)("p",null,"Centreon recommends using VIP addresses."),(0,a.kt)("p",null,"Using a load balancer is an option, but it should support custom rules to route application flows."),(0,a.kt)("p",null,"For example, in a four-node setup, a load balancer can rely on:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"frontend-vip: the listening port or the apache process state to route Users and Pollers' communication toward frontend servers."),(0,a.kt)("li",{parentName:"ul"},'backend-vip: the value of the "read_only" flag on both database servers to determine which is the primary one.')))}g.isMDXComponent=!0},52787:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/centreon-ha-2-nodes-arch-eb3645f78eb3e10060716ab57e32d533.png"},76908:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/centreon-ha-4-nodes-arch-c1a4828019f6de055b39d23ce6a046b0.png"}}]);