"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[22178],{57456:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>u,default:()=>g,frontMatter:()=>l,metadata:()=>d,toc:()=>m});n(67294);var r=n(3905),o=n(51715),a=n(7626);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function c(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}const l={id:"troubleshooting-guide",title:"Troubleshooting HA"},u=void 0,d={unversionedId:"administration/centreon-ha/troubleshooting-guide",id:"version-23.10/administration/centreon-ha/troubleshooting-guide",title:"Troubleshooting HA",description:"A failed action is displayed in crm_mon but the resource seems to be working fine",source:"@site/versioned_docs/version-23.10/administration/centreon-ha/troubleshooting-guide.md",sourceDirName:"administration/centreon-ha",slug:"/administration/centreon-ha/troubleshooting-guide",permalink:"/centreon-documentation/pr-preview/staging/pr-2596/docs/administration/centreon-ha/troubleshooting-guide",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/versioned_docs/version-23.10/administration/centreon-ha/troubleshooting-guide.md",tags:[],version:"23.10",lastUpdatedAt:1699359701,formattedLastUpdatedAt:"Nov 7, 2023",frontMatter:{id:"troubleshooting-guide",title:"Troubleshooting HA"},sidebar:"version-23.10/docs",previous:{title:"Operating guide",permalink:"/centreon-documentation/pr-preview/staging/pr-2596/docs/administration/centreon-ha/operating-guide"},next:{title:"Updating Centreon-HA platform",permalink:"/centreon-documentation/pr-preview/staging/pr-2596/docs/update/update-centreon-ha"}},p={},m=[{value:"A failed action is displayed in <code>crm_mon</code> but the resource seems to be working fine",id:"a-failed-action-is-displayed-in-crm_mon-but-the-resource-seems-to-be-working-fine",level:2},{value:"Resource not starting",id:"resource-not-starting",level:2},{value:"One resource or resource group does not start on any node",id:"one-resource-or-resource-group-does-not-start-on-any-node",level:2}],A={toc:m},E="wrapper";function g(e){var{components:t}=e,n=c(e,["components"]);return(0,r.kt)(E,i(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){s(e,t,n[t])}))}return e}({},A,n),{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"a-failed-action-is-displayed-in-crm_mon-but-the-resource-seems-to-be-working-fine"},"A failed action is displayed in ",(0,r.kt)("inlineCode",{parentName:"h2"},"crm_mon")," but the resource seems to be working fine"),(0,r.kt)(o.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(a.Z,{value:"RHEL 8 / Oracle Linux 8",label:"RHEL 8 / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.0.5-9.0.1.el8_4.1-ba59be7122) - partition with quorum\n  * Last updated: Wed Sep 15 16:35:47 2021\n  * Last change:  Wed Sep 15 10:41:50 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\nFull List of Resources:\n  * Clone Set: ms_mysql-clone [ms_mysql] (promotable):\n    * Masters: [ @CENTRAL_MASTER_NAME@ ]\n    * Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: php-clone [php]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: cbd_rrd-clone [cbd_rrd]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Resource Group: centreon:\n    * vip       (ocf::heartbeat:IPaddr2):        Started @CENTRAL_MASTER_NAME@\n    * http      (systemd:httpd):         Started @CENTRAL_MASTER_NAME@\n    * gorgone   (systemd:gorgoned):      Started @CENTRAL_MASTER_NAME@\n    * centreon_central_sync     (systemd:centreon-central-sync):         Started @CENTRAL_MASTER_NAME@\n    * cbd_central_broker        (systemd:cbd-sql):       Started @CENTRAL_MASTER_NAME@\n    * centengine        (systemd:centengine):    Started @CENTRAL_MASTER_NAME@\n    * centreontrapd     (systemd:centreontrapd):         Stopped\n    * snmptrapd (systemd:snmptrapd):     Stopped\nFailed Resource Actions:\n* centreontrapd_start_0 on @CENTRAL_MASTER_NAME@ 'not running' (7): call=82, status=complete, exitreason='',\n    last-rc-change='Wed Sep 15 13:42:19 2021', queued=1ms, exec=2122ms\n")))),(0,r.kt)("h2",{id:"resource-not-starting"},"Resource not starting"),(0,r.kt)("p",null,"In the event of a Centreon resource (e.g. ",(0,r.kt)("inlineCode",{parentName:"p"},"centreontrapd"),") failing to start, ",(0,r.kt)("em",{parentName:"p"},"failed actions")," will appear at the bottom of the ",(0,r.kt)("inlineCode",{parentName:"p"},"crm_mon")," command's output ",(0,r.kt)("strong",{parentName:"p"},"and")," the resources that are supposed to be started are listed after it. It will look like this:"),(0,r.kt)(o.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(a.Z,{value:"RHEL 8 / Oracle Linux 8",label:"RHEL 8 / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.0.5-9.0.1.el8_4.1-ba59be7122) - partition with quorum\n  * Last updated: Wed Sep 15 16:35:47 2021\n  * Last change:  Wed Sep 15 10:41:50 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\nFull List of Resources:\n  * Clone Set: ms_mysql-clone [ms_mysql] (promotable):\n    * Slaves: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: php-clone [php]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: cbd_rrd-clone [cbd_rrd]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n")))),(0,r.kt)("p",null,"To obtain more information regarding this failure, you should first check the service's status by running this command on the node ",(0,r.kt)("strong",{parentName:"p"},"where the service should be currently running"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl status centreontrapd -l\n")),(0,r.kt)("p",null,"If this does not provide enough information, you can try forcing the service to start and check for error messages:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource debug-start centreontrapd\n")),(0,r.kt)("p",null,'Once the root cause has been identified, run the following command for the cluster to "forget" these errors and restart the service:'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource cleanup centreontrapd\n")),(0,r.kt)("h2",{id:"one-resource-or-resource-group-does-not-start-on-any-node"},"One resource or resource group does not start on any node"),(0,r.kt)("p",null,"If the following situation occurs after a failover, whether a manual one or after a server shutdown:"),(0,r.kt)(o.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(a.Z,{value:"RHEL 8 / Oracle Linux 8",label:"RHEL 8 / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Stack: corosync\nCurrent DC: @CENTRAL_SLAVE_NAME@ (version 1.1.20-5.el8_7.2-3c4c782f70) - partition with quorum\nLast updated: Thu Feb 20 14:48:12 2020\nLast change: Thu Feb 20 14:47:47 2020 by root via crm_resource on @CENTRAL_MASTER_NAME@\n\n2 nodes configured\n14 resources configured\n\nOnline: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\nActive resources:\n\n Master/Slave Set: ms_mysql-clone [ms_mysql]\n     Slaves: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n")))),(0,r.kt)("p",null,"No error is displayed, but the centreon group no longer shows up and none of its resources is started. This mostly happens when there were multiple failovers (",(0,r.kt)("inlineCode",{parentName:"p"},"pcs resource move ...."),") without deleting the constraint. To check that:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs constraint show\n")),(0,r.kt)(o.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(a.Z,{value:"RHEL 8 / Oracle Linux 8",label:"RHEL 8 / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Location Constraints:\n    Disabled on: @CENTRAL_SLAVE_NAME@ (score:-INFINITY) (role: Started)\n    Disabled on: @CENTRAL_MASTER_NAME@ (score:-INFINITY) (role: Started)\nOrdering Constraints:\nColocation Constraints:\n  centreon with ms_mysql-clone (score:INFINITY) (rsc-role:Started) (with-rsc-role:Master)\n  ms_mysql-clone with centreon (score:INFINITY) (rsc-role:Master) (with-rsc-role:Started)\nTicket Constraints:\n")))),(0,r.kt)("p",null,"We notice that the centreon group is not authorized to start on any node."),(0,r.kt)("p",null,"To free the resource group from its constraints, run the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource clear centreon\n")),(0,r.kt)("p",null,"Resources should be starting now."))}g.isMDXComponent=!0}}]);