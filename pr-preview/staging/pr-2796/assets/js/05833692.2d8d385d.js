"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[69408],{85673:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>c,default:()=>k,frontMatter:()=>m,metadata:()=>p,toc:()=>u});n(67294);var a=n(3905),r=n(51715),o=n(7626);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const m={id:"dsm",title:"Dynamic Service Management"},c=void 0,p={unversionedId:"monitoring/passive-monitoring/dsm",id:"version-23.10/monitoring/passive-monitoring/dsm",title:"Dynamic Service Management",description:"The Centreon Dynamic Service Management module (Centreon-DSM) is an extension to manage alarms with an eventlogs system.",source:"@site/versioned_docs/version-23.10/monitoring/passive-monitoring/dsm.md",sourceDirName:"monitoring/passive-monitoring",slug:"/monitoring/passive-monitoring/dsm",permalink:"/centreon-documentation/pr-preview/staging/pr-2796/docs/monitoring/passive-monitoring/dsm",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/versioned_docs/version-23.10/monitoring/passive-monitoring/dsm.md",tags:[],version:"23.10",lastUpdatedAt:1699281350,formattedLastUpdatedAt:"Nov 6, 2023",frontMatter:{id:"dsm",title:"Dynamic Service Management"},sidebar:"version-23.10/docs",previous:{title:"Debug SNMP Traps management",permalink:"/centreon-documentation/pr-preview/staging/pr-2796/docs/monitoring/passive-monitoring/debug-snmp-traps-management"},next:{title:"Auto Remediation",permalink:"/centreon-documentation/pr-preview/staging/pr-2796/docs/monitoring/event-handler"}},d={},u=[{value:"Installation",id:"installation",level:2},{value:"On a central server",id:"on-a-central-server",level:3},{value:"On a poller",id:"on-a-poller",level:3},{value:"Architecture",id:"architecture",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Configure Slots",id:"configure-slots",level:3},{value:"Configure traps",id:"configure-traps",level:3},{value:"Configure Trap links",id:"configure-trap-links",level:3},{value:"Administration",id:"administration",level:2},{value:"Advanced configuration",id:"advanced-configuration",level:3},{value:"Purging cache",id:"purging-cache",level:3}],h={toc:u},g="wrapper";function k(e){var{components:t}=e,m=l(e,["components"]);return(0,a.kt)(g,i(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){s(e,t,n[t])}))}return e}({},h,m),{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"The Centreon Dynamic Service Management module (Centreon-DSM) is an extension to manage alarms with an eventlogs system.\nWith DSM, Centreon can receive events such as SNMP traps resulting from the detection of a problem and assign events\ndynamically to a slot defined in Centreon, like a trap event."),(0,a.kt)("p",null,'A resource has a set number of "slots" (containers) on which alerts will be assigned (stored). Until this event has\nbeen taken into account by a human action, it will remain visible in the Centreon interface. When the event is\nacknowledged, the slot becomes available for new events.'),(0,a.kt)("p",null,"The purpose of this module is to improve Centreon\u2019s basic trap management system. The basic function runs with a"),(0,a.kt)("h2",{id:"installation"},"Installation"),(0,a.kt)("h3",{id:"on-a-central-server"},"On a central server"),(0,a.kt)("p",null,"This section describes how to install ",(0,a.kt)("strong",{parentName:"p"},"Centreon DSM")," on a central server. The Centreon DSM server and client will be installed on the\nmain server."),(0,a.kt)("p",null,"Run the command:"),(0,a.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,a.kt)(o.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"dnf install centreon-dsm-server centreon-dsm-client\n"))),(0,a.kt)(o.Z,{value:"Alma / RHEL / Oracle Linux 9",label:"Alma / RHEL / Oracle Linux 9",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"dnf install centreon-dsm-server centreon-dsm-client\n"))),(0,a.kt)(o.Z,{value:"Debian 11",label:"Debian 11",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"apt install centreon-dsm-server centreon-dsm-client\n")))),(0,a.kt)("p",null,"After installing the rpm, you must finish installing the module through the web frontend. Go to\n",(0,a.kt)("strong",{parentName:"p"},"Administration > Extensions > Manager")," and search for ",(0,a.kt)("strong",{parentName:"p"},"dsm"),". Click ",(0,a.kt)("strong",{parentName:"p"},"Install selection"),".\nYour Centreon DSM Module is now installed."),(0,a.kt)("p",null,"You can now start and enable the daemon on your server:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl enable dsmd\nsystemctl start dsmd\n")),(0,a.kt)("h3",{id:"on-a-poller"},"On a poller"),(0,a.kt)("p",null,"This part is to install ",(0,a.kt)("strong",{parentName:"p"},"Centreon DSM")," on a poller. Only the client will be installed."),(0,a.kt)("p",null,"Run the command:"),(0,a.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,a.kt)(o.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"dnf install centreon-dsm-client\n"))),(0,a.kt)(o.Z,{value:"Alma / RHEL / Oracle Linux 9",label:"Alma / RHEL / Oracle Linux 9",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"dnf install centreon-dsm-client\n"))),(0,a.kt)(o.Z,{value:"Debian 11",label:"Debian 11",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"apt install centreon-dsm-client\n")))),(0,a.kt)("p",null,"You must now create an access from the poller to the DBMS server on the ",(0,a.kt)("strong",{parentName:"p"},"centreon_storage")," database."),(0,a.kt)("h2",{id:"architecture"},"Architecture"),(0,a.kt)("p",null,"The event must be transmitted to the server via an SNMP trap. The SNMP trap is thus collected by the\n",(0,a.kt)("strong",{parentName:"p"},"snmptrapd daemon"),". If the reception parameters are not valid (authorized community), the event is deleted."),(0,a.kt)("p",null,"Once the SNMP trap has been received, it is sent to the ",(0,a.kt)("strong",{parentName:"p"},"centreontrapdforward")," script, which writes the information\nreceived in a buffer folder (by default: ",(0,a.kt)("strong",{parentName:"p"},"/var/spool/centreontrapd/"),")."),(0,a.kt)("p",null,"The ",(0,a.kt)("strong",{parentName:"p"},"centreontrapd")," service reads the information received in the buffer folder and interprets the traps received\nchecking, in the centreon database, the actions necessary to process these events. In Centreon DSM we execute a ",(0,a.kt)("strong",{parentName:"p"},"special command"),"."),(0,a.kt)("p",null,"This special command is executing binary ",(0,a.kt)("strong",{parentName:"p"},"dsmclient.pl")," with arguments. This client will store the new trap in a slot\nqueue that the daemon reads every 5 seconds."),(0,a.kt)("p",null,"The daemon ",(0,a.kt)("strong",{parentName:"p"},"dsmd.pl"),' will search in the "centreon" database for name slots (pool service liabilities) associated with the host.\nIf no slot is created, the event is deleted. Otherwise, the process will search to find out if there is at least one free slot. If at\nleast one slot is free, then it will transmit external commands to the monitoring engine to change the state of the slot.\nOtherwise, the data will wait for a slot to be released. To be releasable, a slot must be created by a\npassive service template.'),(0,a.kt)("h2",{id:"configuration"},"Configuration"),(0,a.kt)("h3",{id:"configure-slots"},"Configure Slots"),(0,a.kt)("p",null,"Go to ",(0,a.kt)("strong",{parentName:"p"},"Administration > Modules > Dynamic Services")," and click ",(0,a.kt)("strong",{parentName:"p"},"Add")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image",src:n(38887).Z,width:"770",height:"470"})),(0,a.kt)("p",null,"Please use the table below understand the roles of all the parameters:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Name"),": This is the name of the slot group."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Description"),": This is the description of the group."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Host Name"),": The name which hosts the slots."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Service template based"),": The base service template used to create service slots on the host. This template must\nhave been a passive template. This template must be 100% passive and a custom macro must be created on it. The\nmacro is named ",(0,a.kt)("strong",{parentName:"li"},"ALARM_ID")," and the default value must be ",(0,a.kt)("strong",{parentName:"li"},"empty"),"."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Number of slots"),": The number of slots that Centreon will create on the selected host when the form is validated."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Slot name prefix"),": The prefix is used to name the slots. The name will be followed by a number incremented\nfrom 0 to the number of slots."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Check command"),": This check command is used when the service has to be forced in order to free a slot. The check\ncommand must send an ok return code."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Status"),": The status of the slot.")),(0,a.kt)("p",null,"An example of a passive service template is available below:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image",src:n(75960).Z,width:"815",height:"664"})),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"The macro ",(0,a.kt)("strong",{parentName:"p"},"ALARM_ID")," is mandatory. The default ",(0,a.kt)("strong",{parentName:"p"},"empty")," value is also necessary.")),(0,a.kt)("p",null,"When you validate the form, Centreon will create or update all slots. If you have not changed any value, you do not\nneed to perform any other action. Otherwise, you must ",(0,a.kt)("em",{parentName:"p"},(0,a.kt)("a",{parentName:"em",href:"/centreon-documentation/pr-preview/staging/pr-2796/docs/monitoring/monitoring-servers/deploying-a-configuration"},"deploy the configuration")),"."),(0,a.kt)("h3",{id:"configure-traps"},"Configure traps"),(0,a.kt)("p",null,"The last step is to configure the traps that you want to redirect to your slots."),(0,a.kt)("p",null,"Edit an SNMP trap that you want to redirect to slot systems. Go to ",(0,a.kt)("strong",{parentName:"p"},"Configuration > SNMP traps > SNMP traps"),"\nand edit an SNMP trap definition."),(0,a.kt)("p",null,"In order to redirect alarms to slots, enable ",(0,a.kt)("strong",{parentName:"p"},"Execute special command")," in the form and add the following\ncommand to the ",(0,a.kt)("strong",{parentName:"p"},"special command")," field:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"/usr/share/centreon/bin/dsmclient.pl -H @HOSTADDRESS@ -o 'Example output : $*' -i 'linkdown' -s 1 -t @TIME@\n")),(0,a.kt)("p",null,"Each trap receives this command in order to redirect alarms to dsmd daemon."),(0,a.kt)("p",null,"This command takes some parameters. You can find the list and the description of each parameter in the following table:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"-H"),": Host address (ip or name) in which you want to redirect the alarm. You can enter the value @HOSTADDRESS@ in\norder to keep the same host, or you can use whatever you want in order to centralize all alarms on the same virtual\nhost, for example, that hosts all alarms."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"-o"),": This is the output that dsm will provide when the command submits the result in the correct slot. This output\ncan be built with all $* values and with a specific string that you set as a parameter."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"-i"),": This is the id of the alarm. The alarm id can be built by concatenating some variables such as \u201c$1-$4\u201d.\nThe id enables the possibility to use the option of auto-acknowledgement of an alarm when you have the possibility to\ncreate the same id during the opening and closing treatment of the alarm."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"-s"),": This is the status that you want to enter as a parameter to the alarm. You can use @STATUS@ in order to use the\ninherited status build from the matching rule system."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"-t"),": This is the time that you want to set to dsm in order to keep the real trap reception time."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"-m"),": This is the list of macros and its values that you want to update during the treatment of the alarm. Please\nuse the following syntax: macro1=value1|macro2=value2|macro3=value3 This function is used to update some parameters in\nlive on the Centreon-Engine core memory without a restart.")),(0,a.kt)("p",null,"Your form should now be like this:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image",src:n(35795).Z,width:"1030",height:"646"})),(0,a.kt)("p",null,"After saving the form, please generate the\n",(0,a.kt)("em",{parentName:"p"},(0,a.kt)("a",{parentName:"em",href:"/centreon-documentation/pr-preview/staging/pr-2796/docs/monitoring/passive-monitoring/monitoring-with-snmp-traps#Applying-the-changes"},"SNMP traps database definition")),"."),(0,a.kt)("h3",{id:"configure-trap-links"},"Configure Trap links"),(0,a.kt)("p",null,"One thing that is different compared to the Centreon Trap system is that you cannot directly link the service template of the\nslot to the trap in order to not receive the trap x times (here, x represents the number of slots)."),(0,a.kt)("p",null,"You must link traps to an active service of the resource, for example the ",(0,a.kt)("strong",{parentName:"p"},"Ping")," service."),(0,a.kt)("h2",{id:"administration"},"Administration"),(0,a.kt)("h3",{id:"advanced-configuration"},"Advanced configuration"),(0,a.kt)("p",null,"It is possible to overwrite the default configuration of the module by creating/editing the\n",(0,a.kt)("strong",{parentName:"p"},"/etc/centreon/centreon_dsmd.pm")," file:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"%centreon_dsmd_config = (\n    # which user will send action\n    centreon_user => 'centreon',\n    # timeout to send command\n    submit_command_timeout => 5,\n    # custom macro used to keep alarm ID\n    macro_config => 'ALARM_ID',\n    # number of alarms retrieved from the cache for analysis\n    sql_fetch => 1000,\n    # interval in seconds to clean locks\n    clean_locks_time => 3600,\n    # duration in seconds to keep locks\n    clean_locks_keep_stored => 3600,\n);\n\n1;\n")),(0,a.kt)("h3",{id:"purging-cache"},"Purging cache"),(0,a.kt)("p",null,"All actions performed by the DSMD engine are logged in the database\n",(0,a.kt)("strong",{parentName:"p"},"centreon_storage"),". A cron is provided to delete the data based on retention."),(0,a.kt)("p",null,"To modify the retention period, by default ",(0,a.kt)("strong",{parentName:"p"},"180 days"),", you can create/edit the\n",(0,a.kt)("strong",{parentName:"p"},"/etc/centreon/centreon_dsmd.pm")," file:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"%centreon_dsm_purge_config = (\n    # period in days\n    history_time => 180,\n);\n\n1;\n")),(0,a.kt)("p",null,"To modify the hour of the cron job, you can edit the ",(0,a.kt)("strong",{parentName:"p"},"/etc/cron.d/centreon-dsm")," file:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"#####################################\n# Centreon DSM\n#\n\n30 22 * * * root /usr/share/centreon/www/modules/centreon-dsm//cron/centreon_dsm_purge.pl --config='/etc/centreon/conf.pm' --severity=error >> /var/log/centreon/centreon_dsm_purge.log 2>&1\n")))}k.isMDXComponent=!0},75960:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/form-passive-service-e5c48215ae0046f00fc69a85a7c68052.png"},38887:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/form-slot-608269a8170d39da1cf7f7dcbf4728cf.png"},35795:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/trap-form-2-f1eadb2826eff5675a8b420e15dc2b7b.png"}}]);