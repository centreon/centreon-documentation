"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[12831],{14416:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>s,metadata:()=>u,toc:()=>m});a(67294);var n=a(3905),r=a(51715),o=a(7626);function p(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})),e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}const s={id:"upgrade",title:"Upgrading the extension"},c=void 0,u={unversionedId:"graph-views/upgrade",id:"version-23.10/graph-views/upgrade",title:"Upgrading the extension",description:"This chapter describes how to upgrade your Centreon MAP (Legacy) extension. This",source:"@site/versioned_docs/version-23.10/graph-views/upgrade.md",sourceDirName:"graph-views",slug:"/graph-views/upgrade",permalink:"/centreon-documentation/pr-preview/staging/pr-2796/docs/graph-views/upgrade",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/versioned_docs/version-23.10/graph-views/upgrade.md",tags:[],version:"23.10",lastUpdatedAt:1699374559,formattedLastUpdatedAt:"Nov 7, 2023",frontMatter:{id:"upgrade",title:"Upgrading the extension"},sidebar:"version-23.10/docs",previous:{title:"Updating the extension",permalink:"/centreon-documentation/pr-preview/staging/pr-2796/docs/graph-views/update"},next:{title:"Migrate the extension",permalink:"/centreon-documentation/pr-preview/staging/pr-2796/docs/graph-views/migrate"}},d={},m=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Update the RPM signing key",id:"update-the-rpm-signing-key",level:3},{value:"Step 1: Centreon MAP (Legacy) server",id:"step-1-centreon-map-legacy-server",level:2},{value:"Java version requirement",id:"java-version-requirement",level:3},{value:"Procedure",id:"procedure",level:3},{value:"Step 2: Centreon MAP (Legacy) web interface",id:"step-2-centreon-map-legacy-web-interface",level:2},{value:"Step 3: Centreon MAP (Legacy) desktop client",id:"step-3-centreon-map-legacy-desktop-client",level:2},{value:"Step 4: Update dialects in .properties files",id:"step-4-update-dialects-in-properties-files",level:2},{value:"Step 5: MariaDB database",id:"step-5-mariadb-database",level:2}],g={toc:m},k="wrapper";function h(e){var{components:t}=e,a=i(e,["components"]);return(0,n.kt)(k,l(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){p(e,t,a[t])}))}return e}({},g,a),{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"This chapter describes how to upgrade your Centreon MAP (Legacy) extension. This\nis done by upgrading the four main components:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Centreon MAP (Legacy) server"),(0,n.kt)("li",{parentName:"ul"},"Centreon MAP (Legacy) web interface and its widget"),(0,n.kt)("li",{parentName:"ul"},"Desktop client (automatically updated)"),(0,n.kt)("li",{parentName:"ul"},"MariaDB database.")),(0,n.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,n.kt)("p",null,"Before upgrading Centreon MAP (Legacy) server, we highly recommend performing a\nMariaDB dump (backup) of your ",(0,n.kt)("strong",{parentName:"p"},"centreon_studio")," database. This will\nallow you easily to roll back to the previous state if necessary."),(0,n.kt)("p",null,"Be sure to read the release notes for an explanation of features, fixes\nand custom procedures."),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"When you are upgrading to a new major or minor version (i.e: A.B.x with\nA or B that changes), you need to contact our Support service to retrieve\nthe new repository"),"."),(0,n.kt)("h3",{id:"update-the-rpm-signing-key"},"Update the RPM signing key"),(0,n.kt)("p",null,"For security reasons, the keys used to sign Centreon RPMs are rotated regularly. The last change occurred on October 14, 2021. When upgrading from an older version, you need to go through the ",(0,n.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2796/docs/security/key-rotation#existing-installation"},"key rotation procedure")," to remove the old key and install the new one."),(0,n.kt)("h2",{id:"step-1-centreon-map-legacy-server"},"Step 1: Centreon MAP (Legacy) server"),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"If you are still running version ",(0,n.kt)("strong",{parentName:"p"},"4.0.X"),", you ",(0,n.kt)("strong",{parentName:"p"},"must first install and run the server in version 4.1.X before upgrading to the latest version"),".")),(0,n.kt)("h3",{id:"java-version-requirement"},"Java version requirement"),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"Ensure a version of Java 17 (or 18) is installed before you start the procedure.")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"If you need to check the Java version, enter the following command:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"java -version\n"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"If you need to upgrade the Java installation to Java 17 (or 18), go to the ",(0,n.kt)("a",{parentName:"p",href:"https://www.oracle.com/java/technologies/downloads/#java17"},"Oracle official download")," page.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"If several Java versions are installed, you need to activate the right version. Display the installed versions using the following command and select the Java 17 (or 18) version:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"sudo update-alternatives --config java\n")),(0,n.kt)("p",{parentName:"li"},"Then restart the service:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl restart centreon-map\n"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"If you need to use your platform in HTTPS, you will have to generate a keystore file for the Java 17 (or 18) version (",(0,n.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2796/docs/graph-views/secure-your-map-platform#httpstls-configuration-with-a-recognized-key"},"see the procedure"),")."))),(0,n.kt)("h3",{id:"procedure"},"Procedure"),(0,n.kt)("p",null,"Run the following commands to upgrade your Centreon MAP (Legacy) server:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Update Centreon and Centreon MAP (Legacy) repositories:")),(0,n.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,n.kt)(o.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"dnf config-manager --add-repo https://packages.centreon.com/rpm-standard/23.04/el8/centreon-23.04.repo\n")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"Install the Centreon MAP (Legacy) repository. You can find it on the\n",(0,n.kt)("a",{parentName:"p",href:"https://support.centreon.com/s/repositories"},"support portal"),".")),(0,n.kt)("ol",{start:2},(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Update Centreon MAP (Legacy) server:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"dnf update centreon-map-server\n"))))),(0,n.kt)(o.Z,{value:"Alma / RHEL / Oracle Linux 9",label:"Alma / RHEL / Oracle Linux 9",mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"dnf config-manager --add-repo https://packages.centreon.com/rpm-standard/23.04/el9/centreon-23.04.repo\n")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"Install the Centreon Business repository. You can find it on the\n",(0,n.kt)("a",{parentName:"p",href:"https://support.centreon.com/hc/en-us/categories/10341239833105-Repositories"},"support portal"),".")),(0,n.kt)("ol",{start:2},(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Update the Centreon MAP (Legacy) server:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"dnf update centreon-map-server\n"))))),(0,n.kt)(o.Z,{value:"Debian 11",label:"Debian 11",mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},'echo "deb https://packages.centreon.com/apt-standard-23.04-stable/ $(lsb_release -sc) main" | tee /etc/apt/sources.list.d/centreon.list\necho "deb https://packages.centreon.com/apt-plugins-stable/ $(lsb_release -sc) main" | tee /etc/apt/sources.list.d/centreon-plugins.list\n')),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"Install the Centreon Business repository. You can find it on the ",(0,n.kt)("a",{parentName:"p",href:"https://support.centreon.com/hc/en-us/categories/10341239833105-Repositories"},"support portal"),".")),(0,n.kt)("ol",{start:2},(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Update Centreon MAP (Legacy) server:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"apt update && apt upgrade centreon-map-server\n")))))),(0,n.kt)("ol",{start:3},(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Enable and start the ",(0,n.kt)("strong",{parentName:"p"},"centreon-map")," service:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl enable centreon-map\nsystemctl start centreon-map\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"This point only applies if you customized your ",(0,n.kt)("strong",{parentName:"p"},"centreon-map.conf")," configuration file. When upgrading your MAP (Legacy) module, the ",(0,n.kt)("strong",{parentName:"p"},"/etc/centreon-studio/centreon-map.conf")," file is not upgraded automatically; the new configuration file brought by the rpm does not replace the old file. You must copy the changes manually to your customized configuration file."))),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"The old configuration file is renamed ",(0,n.kt)("strong",{parentName:"p"},"centreon-map.conf.rpmsave"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"The upgrade installs a new ",(0,n.kt)("strong",{parentName:"p"},"centreon-map.conf")," file."),(0,n.kt)("p",{parentName:"li"},"Run a diff between the old and the new configuration files:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"diff -u /etc/centreon-studio/centreon-map.conf /etc/centreon-studio/centreon-map.conf.rpmsave\n")),(0,n.kt)("p",{parentName:"li"},"For each difference between the files, assess whether you should copy it from ",(0,n.kt)("strong",{parentName:"p"},"centreon-map.conf.rpmsave")," to ",(0,n.kt)("strong",{parentName:"p"},"centreon-map.conf"),"."))),(0,n.kt)("h2",{id:"step-2-centreon-map-legacy-web-interface"},"Step 2: Centreon MAP (Legacy) web interface"),(0,n.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,n.kt)(o.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"dnf update centreon-map-web-client\n"))),(0,n.kt)(o.Z,{value:"Alma / RHEL / Oracle Linux 9",label:"Alma / RHEL / Oracle Linux 9",mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"dnf update centreon-map-web-client\n"))),(0,n.kt)(o.Z,{value:"Debian 11",label:"Debian 11",mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"apt update && apt upgrade centreon-map-web-client\n")))),(0,n.kt)("p",null,"Complete the upgrade: "),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Go to ",(0,n.kt)("strong",{parentName:"li"},"Administration > Extensions > Manager"),"."),(0,n.kt)("li",{parentName:"ol"},"Search for ",(0,n.kt)("strong",{parentName:"li"},"Map web client"),"."),(0,n.kt)("li",{parentName:"ol"},"Click the update button (module & widget parts).")),(0,n.kt)("h2",{id:"step-3-centreon-map-legacy-desktop-client"},"Step 3: Centreon MAP (Legacy) desktop client"),(0,n.kt)("p",null,"If the user's computer has an online connection, the desktop client is\nautomatically upgraded to the latest version that corresponds to the server."),(0,n.kt)("p",null,"Alternatively, the client can be downloaded through the ",(0,n.kt)("inlineCode",{parentName:"p"},"Monitoring >\nMap")," menu and the ",(0,n.kt)("strong",{parentName:"p"},"Desktop client")," button."),(0,n.kt)("h2",{id:"step-4-update-dialects-in-properties-files"},"Step 4: Update dialects in .properties files"),(0,n.kt)("p",null,"In the ",(0,n.kt)("strong",{parentName:"p"},"/etc/centreon-studio/centreon-database.properties")," and the ",(0,n.kt)("strong",{parentName:"p"},"/etc/centreon-studio/studio-database.properties")," files, replace ",(0,n.kt)("strong",{parentName:"p"},"MySQL5Dialect")," with ",(0,n.kt)("strong",{parentName:"p"},"MariaDB10Dialect"),"."),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"This configuration also works with a MySQL database.")),(0,n.kt)("h2",{id:"step-5-mariadb-database"},"Step 5: MariaDB database"),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"Mistakes when editing configuration files can lead to malfunctions of the software. We recommend that you make a backup of the file before editing it and that you only change the settings advised by Centreon.")),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Stop the ",(0,n.kt)("strong",{parentName:"p"},"centreon-map")," service:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl stop centreon-map\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"See ",(0,n.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2796/docs/upgrade/upgrade-mariadb"},"Upgrading MariaDB"),".")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"If you have upgraded your Centreon platform from a version earlier than 22.10, the new BBDO v3 protocol is enabled. You need to edit the following file to allow MAP to work properly: ",(0,n.kt)("strong",{parentName:"p"},"/etc/centreon-studio/studio-config.properties")),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-text"},"broker.pb.message.enabled=true\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Start the ",(0,n.kt)("strong",{parentName:"p"},"centreon-map")," service:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl start centreon-map\n")))))}h.isMDXComponent=!0}}]);