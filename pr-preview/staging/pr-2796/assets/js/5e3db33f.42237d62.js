"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[87765],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>k});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),d=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(s.Provider,{value:t},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),u=d(n),m=r,k=u["".concat(s,".").concat(m)]||u[m]||c[m]||l;return n?a.createElement(k,i(i({ref:t},p),{},{components:n})):a.createElement(k,i({ref:t},p))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[u]="string"==typeof e?e:r,i[1]=o;for(var d=2;d<l;d++)i[d]=n[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},56141:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>k,frontMatter:()=>o,metadata:()=>d,toc:()=>u});n(67294);var a=n(3905);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const o={id:"cloud-kubernetes-api",title:"Kubernetes API"},s=void 0,d={unversionedId:"integrations/plugin-packs/procedures/cloud-kubernetes-api",id:"integrations/plugin-packs/procedures/cloud-kubernetes-api",title:"Kubernetes API",description:"Overview",source:"@site/pp/integrations/plugin-packs/procedures/cloud-kubernetes-api.md",sourceDirName:"integrations/plugin-packs/procedures",slug:"/integrations/plugin-packs/procedures/cloud-kubernetes-api",permalink:"/centreon-documentation/pr-preview/staging/pr-2796/pp/integrations/plugin-packs/procedures/cloud-kubernetes-api",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/pp/integrations/plugin-packs/procedures/cloud-kubernetes-api.md",tags:[],version:"current",frontMatter:{id:"cloud-kubernetes-api",title:"Kubernetes API"},sidebar:"pp",previous:{title:"IICS Rest API",permalink:"/centreon-documentation/pr-preview/staging/pr-2796/pp/integrations/plugin-packs/procedures/cloud-iics-restapi"},next:{title:"Kubernetes w/ Prometheus",permalink:"/centreon-documentation/pr-preview/staging/pr-2796/pp/integrations/plugin-packs/procedures/cloud-prometheus-kubernetes-api"}},p={},u=[{value:"Overview",id:"overview",level:2},{value:"Pack assets",id:"pack-assets",level:2},{value:"Discovery",id:"discovery",level:3},{value:"Templates",id:"templates",level:3},{value:"Monitored metrics and indicators",id:"monitored-metrics-and-indicators",level:2},{value:"Cluster events",id:"cluster-events",level:3},{value:"CronJobs status",id:"cronjobs-status",level:3},{value:"DaemonSets status",id:"daemonsets-status",level:3},{value:"Deployments status",id:"deployments-status",level:3},{value:"Nodes status",id:"nodes-status",level:3},{value:"Nodes usage",id:"nodes-usage",level:3},{value:"PersistentVolumes status",id:"persistentvolumes-status",level:3},{value:"Pods status",id:"pods-status",level:3},{value:"ReplicaSets status",id:"replicasets-status",level:3},{value:"ReplicationControllers status",id:"replicationcontrollers-status",level:3},{value:"StatefulSets status",id:"statefulsets-status",level:3},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Centreon Plugin",id:"centreon-plugin",level:3},{value:"Kubernetes",id:"kubernetes",level:3},{value:"Create a service account",id:"create-a-service-account",level:4},{value:"Using RestAPI",id:"using-restapi",level:4},{value:"Expose the API",id:"expose-the-api",level:5},{value:"Retrieve token from service account",id:"retrieve-token-from-service-account",level:5},{value:"Using kubectl",id:"using-kubectl",level:4},{value:"Install kubectl",id:"install-kubectl",level:5},{value:"Create a kubectl configuration",id:"create-a-kubectl-configuration",level:5},{value:"Monitoring configuration",id:"monitoring-configuration",level:2},{value:"Manual creation",id:"manual-creation",level:3},{value:"Automatic discovery",id:"automatic-discovery",level:3},{value:"Host discovery",id:"host-discovery",level:4},{value:"Service discovery",id:"service-discovery",level:4},{value:"Troubleshooting",id:"troubleshooting",level:2}],c={toc:u},m="wrapper";function k(e){var{components:t}=e,o=i(e,["components"]);return(0,a.kt)(m,l(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){r(e,t,n[t])}))}return e}({},c,o),{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"overview"},"Overview"),(0,a.kt)("p",null,"Kubernetes is an open-source container-orchestration system for automating\ncomputer application deployment, scaling, and management."),(0,a.kt)("p",null,"This Pack aims to monitor both infrastructure layer (nodes) and cluster\nservices (deployments, daemonsets, etc)."),(0,a.kt)("h2",{id:"pack-assets"},"Pack assets"),(0,a.kt)("p",null,"The Kubernetes API Pack gives multiple choices regarding the way you can\narrange a cluster monitoring."),(0,a.kt)("p",null,"There is mainly three ways:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Gather all metrics on only one Centreon host with a service per Kubernetes\nunit (i.e. deployments, daemonsets, etc) - apply\n",(0,a.kt)("a",{parentName:"li",href:"#manual-creation"},"manual creation")," procedure,"),(0,a.kt)("li",{parentName:"ul"},"Gather all metrics on only one Centreon host with a service for each\ninstances of each Kubernetes units - apply ",(0,a.kt)("a",{parentName:"li",href:"#manual-creation"},"manual creation"),"\nand ",(0,a.kt)("a",{parentName:"li",href:"#service-discovery"},"service discovery")," procedures,"),(0,a.kt)("li",{parentName:"ul"},"Collect infrastructural metrics (master and worker nodes) with a Centreon\nhost per Kubernetes node, and keep orchestration/application metrics\non a unique host (using one of the 2 previous scenarii) - apply\n",(0,a.kt)("a",{parentName:"li",href:"#host-discovery"},"host discovery")," procedure.")),(0,a.kt)("p",null,"For all those scenarii, discovery and classic templating will be used."),(0,a.kt)("p",null,"You just need to choose which flavor you like the most: communicating with\nthe RestAPI exposed by the Kubernetes cluster, or using the CLI tool ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl"),"\nto communicate with the cluster's control plane."),(0,a.kt)("h3",{id:"discovery"},"Discovery"),(0,a.kt)("p",null,"The Kubernetes API Pack comes with several discovery providers and rules."),(0,a.kt)("p",null,"Here is the list of the Host Discovery providers:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Provider"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Kubernetes Nodes (RestAPI)"),(0,a.kt)("td",{parentName:"tr",align:null},"Discover Kubernetes nodes by requesting Kubernetes RestAPI")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Kubernetes Nodes (Kubectl)"),(0,a.kt)("td",{parentName:"tr",align:null},"Discover Kubernetes nodes by requesting Kubernetes cluster using kubectl")))),(0,a.kt)("p",null,"Both providers will search for Kubernetes nodes, and link them to a minimal\nhost template to monitor the node usage in terms of pods allocation, cpu and\nmemory requests/limits."),(0,a.kt)("p",null,"In parallel to this discovery, unitary services can be created thanks to\nthe Service Discovery rules:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Rule"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Cloud-Kubernetes-Api-CronJobs-Status"),(0,a.kt)("td",{parentName:"tr",align:null},"Discover Kubernetes CronJobs to monitor their status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Cloud-Kubernetes-Api-Daemonsets-Status"),(0,a.kt)("td",{parentName:"tr",align:null},"Discover Kubernetes DaemonSets to monitor their status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Cloud-Kubernetes-Api-Deployments-Status"),(0,a.kt)("td",{parentName:"tr",align:null},"Discover Kubernetes Deployments to monitor their status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Cloud-Kubernetes-Api-Nodes-Status"),(0,a.kt)("td",{parentName:"tr",align:null},"Discover Kubernetes Nodes to monitor their status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Cloud-Kubernetes-Api-Nodes-Usage"),(0,a.kt)("td",{parentName:"tr",align:null},"Discover Kubernetes Nodes to monitor their usage")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Cloud-Kubernetes-Api-PersistentVolumes-Status"),(0,a.kt)("td",{parentName:"tr",align:null},"Discover Kubernetes PersistentVolumes to monitor their status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Cloud-Kubernetes-Api-Pods-Status"),(0,a.kt)("td",{parentName:"tr",align:null},"Discover Kubernetes Pods to monitor their status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Cloud-Kubernetes-Api-ReplicaSets-Status"),(0,a.kt)("td",{parentName:"tr",align:null},"Discover Kubernetes ReplicaSets to monitor their status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Cloud-Kubernetes-Api-ReplicationControllers-Status"),(0,a.kt)("td",{parentName:"tr",align:null},"Discover Kubernetes ReplicationControllers to monitor their status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Cloud-Kubernetes-Api-StatefulSets-Status"),(0,a.kt)("td",{parentName:"tr",align:null},"Discover Kubernetes StatefulSets to monitor their status")))),(0,a.kt)("h3",{id:"templates"},"Templates"),(0,a.kt)("p",null,"The Kubernetes API Pack brings 2 different host templates to be used depending\non the scenarii mentioned earlier:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"All in one host template that will gather checks and metrics with a\nservice per Kubernetes unit:"),(0,a.kt)("table",{parentName:"li"},(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Cloud-Kubernetes-Api"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Cluster Events")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"CronJob Status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"DaemonSet Status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Deployment Status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Node Status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Node Usage")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"PersistentVolume Status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Pod Status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"ReplicatSet Status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"ReplicationController Status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"StatefulSet Status"))))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"A minimal host template that will only collect metrics for the Kubernetes\nnodes:"),(0,a.kt)("table",{parentName:"li"},(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Cloud-Kubernetes-Node-Api"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Node Usage")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Node Status")))))),(0,a.kt)("h2",{id:"monitored-metrics-and-indicators"},"Monitored metrics and indicators"),(0,a.kt)("h3",{id:"cluster-events"},"Cluster events"),(0,a.kt)("p",null,"This indicator allows to watch the number of events occurring on the cluster,\nlike the ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get events")," can provide:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},'NAMESPACE   LAST SEEN   TYPE      REASON      OBJECT           MESSAGE\ngraphite    26m         Warning   Unhealthy   pod/graphite-0   Liveness probe failed: Get "http://10.244.2.10:8080/": context deadline exceeded (Client.Timeout exceeded while awaiting headers)\n')),(0,a.kt)("p",null,"The resulting output in Centreon could look like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Event 'Warning' for object 'Pod/graphite-0' with message 'Liveness probe failed: Get \"http://10.244.2.10:8080/\": context deadline exceeded (Client.Timeout exceeded while awaiting headers)', Count: 1, First seen: 26m 21s ago (2021-03-11T12:26:23Z), Last seen: 26m 21s ago (2021-03-11T12:26:23Z)\n")),(0,a.kt)("p",null,"The collected metrics will be:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Metric"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"events.type.warning.count"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"events.type.normal.count"))))),(0,a.kt)("p",null,"It is then possible to place thresholds using the following special variables:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{type}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{object}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{message}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{count}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{first_seen}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{last_seen}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{name}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{namespace}"))),(0,a.kt)("p",null,"The defaults values are the following:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Threshold"),(0,a.kt)("th",{parentName:"tr",align:null},"Value"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Warning"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"%{type} =~ /warning/i")),(0,a.kt)("td",{parentName:"tr",align:null},"Will raise a warning alert if there is ",(0,a.kt)("inlineCode",{parentName:"td"},"warning")," events")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Critical"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"%{type} =~ /error/i")),(0,a.kt)("td",{parentName:"tr",align:null},"Will raise a critical alert if there is ",(0,a.kt)("inlineCode",{parentName:"td"},"error")," events")))),(0,a.kt)("p",null,"Refer to the\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/tasks/debug-application-cluster/debug-application-introspection/"},"official documentation"),"\nfor more information about collected metrics and how to fine tune your\nthresholds."),(0,a.kt)("h3",{id:"cronjobs-status"},"CronJobs status"),(0,a.kt)("p",null,"This indicator allows to check that CronJobs are executed as they should,\nlike the ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get cronjobs")," can provide:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"NAME    SCHEDULE      SUSPEND   ACTIVE   LAST SCHEDULE   AGE\nhello   */1 * * * *   False     1        6s              2d1h\n")),(0,a.kt)("p",null,"The resulting output in Centreon could look like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"CronJob 'hello' Jobs Active: 1, Last schedule time: 6s ago (2021-03-11T12:31:00Z)\n")),(0,a.kt)("p",null,"The collected metric for each CronJobs will be:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Metric"),(0,a.kt)("th",{parentName:"tr",align:null},"Kubernetes metric"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"cronjob.jobs.active.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"active"))))),(0,a.kt)("p",null,"If the service collects metrics of several CronJobs (depending on the\nchosen scenario), CronJob's name will be appended to the metric name:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Metric"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"hello#cronjob.jobs.active.count"))))),(0,a.kt)("p",null,"It is then possible to place thresholds using the following special variables:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{active}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{last_schedule}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{name}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{namespace}"))),(0,a.kt)("p",null,"There is no default thresholds. An interesting one could be the following:\n",(0,a.kt)("inlineCode",{parentName:"p"},"%{last_schedule} > x")," where ",(0,a.kt)("inlineCode",{parentName:"p"},"x")," in seconds is the duration beyond which\nthe CronJob is considered not running as scheduled."),(0,a.kt)("p",null,"Refer to the\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/"},"official documentation"),"\nfor more information about collected metrics and how to fine tune your\nthresholds."),(0,a.kt)("h3",{id:"daemonsets-status"},"DaemonSets status"),(0,a.kt)("p",null,"This indicator will ensure that DaemonSets are within defined bounds by\nlooking at the number of available and/or up-to-date pods compared to\nthe desired count, like the ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get daemonsets")," can provide:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"NAMESPACE     NAME                    DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR                   AGE\nkube-system   kube-flannel-ds-amd64   3         3         3       3            3           beta.kubernetes.io/arch=amd64   624d\nkube-system   kube-proxy              3         3         3       3            3           kubernetes.io/os=linux          624d\n")),(0,a.kt)("p",null,"The resulting output in Centreon could look like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Daemonset 'kube-flannel-ds-amd64' Pods Desired: 3, Current: 3, Available: 3, Up-to-date: 3, Ready: 3, Misscheduled: 0\nDaemonset 'kube-proxy' Pods Desired: 3, Current: 3, Available: 3, Up-to-date: 3, Ready: 3, Misscheduled: 0\n")),(0,a.kt)("p",null,"The collected metrics for each Daemonsets will be:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Metric"),(0,a.kt)("th",{parentName:"tr",align:null},"Kubernetes metric"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"daemonset.pods.desired.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"desiredNumberScheduled"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"daemonset.pods.current.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"currentNumberScheduled"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"daemonset.pods.available.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"numberAvailable"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"daemonset.pods.uptodate.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"updatedNumberScheduled"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"daemonset.pods.ready.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"numberReady"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"daemonset.pods.misscheduled.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"numberMisscheduled"))))),(0,a.kt)("p",null,"If the service collects metrics of several DaemonSets (depending on the\nchosen scenario), DaemonSet's name will be appended to the metric name:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Metric"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"kube-proxy#daemonset.pods.desired.count"))))),(0,a.kt)("p",null,"It is then possible to place thresholds using the following special variables:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{desired}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{current}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{available}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{up_to_date}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{ready}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{misscheduled}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{name}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{namespace}"))),(0,a.kt)("p",null,"The defaults values are the following:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Threshold"),(0,a.kt)("th",{parentName:"tr",align:null},"Value"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Warning"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"%{up_to_date} < %{desired}")),(0,a.kt)("td",{parentName:"tr",align:null},"Will raise a warning alert if the number of up-to-date pods is lower than the desired number")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Critical"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"%{available} < %{desired}")),(0,a.kt)("td",{parentName:"tr",align:null},"Will raise a critical alert if the number of available pods is lower than the desired number")))),(0,a.kt)("p",null,"Refer to the\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/"},"official documentation"),"\nfor more information about collected metrics and how to fine tune your\nthresholds."),(0,a.kt)("h3",{id:"deployments-status"},"Deployments status"),(0,a.kt)("p",null,"This indicator will ensure that Deployments are within defined bounds by\nlooking at the number of available and/or up-to-date replicas compared to\nthe desired count, like the ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get deployments")," can provide:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"NAMESPACE              NAME                        READY   UP-TO-DATE   AVAILABLE   AGE\nkube-system            coredns                     2/2     2            2           624d\nkube-system            tiller-deploy               1/1     1            1           624d\nkubernetes-dashboard   dashboard-metrics-scraper   1/1     1            1           37d\nkubernetes-dashboard   kubernetes-dashboard        1/1     1            1           37d\n")),(0,a.kt)("p",null,"The resulting output in Centreon could look like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Deployment 'coredns' Replicas Desired: 2, Current: 2, Available: 2, Ready: 2, Up-to-date: 2\nDeployment 'tiller-deploy' Replicas Desired: 1, Current: 1, Available: 1, Ready: 1, Up-to-date: 1\nDeployment 'dashboard-metrics-scraper' Replicas Desired: 1, Current: 1, Available: 1, Ready: 1, Up-to-date: 1\nDeployment 'kubernetes-dashboard' Replicas Desired: 1, Current: 1, Available: 1, Ready: 1, Up-to-date: 1\n")),(0,a.kt)("p",null,"The collected metrics for each Deployments will be:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Metric"),(0,a.kt)("th",{parentName:"tr",align:null},"Kubernetes metric"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"deployment.replicas.desired.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"replicas")," (in ",(0,a.kt)("inlineCode",{parentName:"td"},"spec")," entry)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"deployment.replicas.current.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"replicas")," (in ",(0,a.kt)("inlineCode",{parentName:"td"},"status")," entry)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"deployment.replicas.available.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"availableReplicas"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"deployment.replicas.ready.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"readyReplicas"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"deployment.replicas.uptodate.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"updatedReplicas"))))),(0,a.kt)("p",null,"If the service collects metrics of several Deployments (depending on the\nchosen scenario), Deployment's name will be appended to the metric name:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Metric"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"tiller-deploy#deployment.replicas.desired.count"))))),(0,a.kt)("p",null,"It is then possible to place thresholds using the following special variables:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{desired}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{current}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{available}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{ready}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{up_to_date}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{name}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{namespace}"))),(0,a.kt)("p",null,"The defaults values are the following:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Threshold"),(0,a.kt)("th",{parentName:"tr",align:null},"Value"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Warning"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"%{up_to_date} < %{desired}")),(0,a.kt)("td",{parentName:"tr",align:null},"Will raise a warning alert if the number of up-to-date replicas is lower than the desired number")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Critical"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"%{available} < %{desired}")),(0,a.kt)("td",{parentName:"tr",align:null},"Will raise a critical alert if the number of available replicas is lower than the desired number")))),(0,a.kt)("p",null,"Refer to the\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/workloads/controllers/deployment/"},"official documentation"),"\nfor more information about collected metrics and how to fine tune your\nthresholds."),(0,a.kt)("h3",{id:"nodes-status"},"Nodes status"),(0,a.kt)("p",null,"This indicator will ensure that Nodes are running well by looking at the\nconditions statuses, like the ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl describe nodes")," can list:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Conditions:\n  Type             Status  LastHeartbeatTime                 LastTransitionTime                Reason                       Message\n  ----             ------  -----------------                 ------------------                ------                       -------\n  MemoryPressure   False   Thu, 11 Mar 2021 14:20:25 +0100   Tue, 26 Jan 2021 09:38:11 +0100   KubeletHasSufficientMemory   kubelet has sufficient memory available\n  DiskPressure     False   Thu, 11 Mar 2021 14:20:25 +0100   Wed, 17 Feb 2021 09:37:40 +0100   KubeletHasNoDiskPressure     kubelet has no disk pressure\n  PIDPressure      False   Thu, 11 Mar 2021 14:20:25 +0100   Tue, 26 Jan 2021 09:38:11 +0100   KubeletHasSufficientPID      kubelet has sufficient PID available\n  Ready            True    Thu, 11 Mar 2021 14:20:25 +0100   Tue, 26 Jan 2021 17:26:36 +0100   KubeletReady                 kubelet is posting ready status\n")),(0,a.kt)("p",null,"The resulting output in Centreon could look like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Condition 'DiskPressure' Status is 'False', Reason: 'KubeletHasNoDiskPressure', Message: 'kubelet has no disk pressure'\nCondition 'MemoryPressure' Status is 'False', Reason: 'KubeletHasSufficientMemory', Message: 'kubelet has sufficient memory available'\nCondition 'PIDPressure' Status is 'False', Reason: 'KubeletHasSufficientPID', Message: 'kubelet has sufficient PID available'\nCondition 'Ready' Status is 'True', Reason: 'KubeletReady', Message: 'kubelet is posting ready status'\n")),(0,a.kt)("p",null,"No metrics are collected."),(0,a.kt)("p",null,"It is possible to place thresholds using the following special variables:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{type}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{status}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{reason}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{message}"))),(0,a.kt)("p",null,"The defaults values are the following:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Threshold"),(0,a.kt)("th",{parentName:"tr",align:null},"Value"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Critical"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("code",null,"(%{type} =~ /Ready/i && %{status} !~ /True/i) ","|","|"," (%{type} =~ /.*Pressure/i && %{status} !~ /False/i)")),(0,a.kt)("td",{parentName:"tr",align:null},"Will raise a critical alert if the status of the ",(0,a.kt)("inlineCode",{parentName:"td"},"Ready")," condition is not ",(0,a.kt)("inlineCode",{parentName:"td"},"True")," or if the status of a ",(0,a.kt)("inlineCode",{parentName:"td"},"Pressure")," condition is not ",(0,a.kt)("inlineCode",{parentName:"td"},"False"))))),(0,a.kt)("p",null,"Refer to the\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/architecture/nodes/#condition"},"official documentation"),"\nfor more information about statuses and how to fine tune your thresholds."),(0,a.kt)("h3",{id:"nodes-usage"},"Nodes usage"),(0,a.kt)("p",null,"This indicator will gather metrics about Nodes usage like pods allocation,\nrequests for CPU and memory made by those pods, and limits for CPU and\nmemory allowed to those same pods."),(0,a.kt)("p",null,"Using Kubernetes command line tool, it could look like the following:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Nodes capacity:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'kubectl get nodes -o=custom-columns="NODE:.metadata.name,PODS ALLOCATABLE:.status.allocatable.pods,CPU ALLOCATABLE:.status.allocatable.cpu,MEMORY ALLOCATABLE:.status.allocatable.memory"\nNODE          PODS ALLOCATABLE   CPU ALLOCATABLE   MEMORY ALLOCATABLE\nmaster-node   110                2                 3778172Ki\nworker-node   110                2                 3778184Ki\n'))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Running pods:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'kubectl get pods -o=custom-columns="NODE:.spec.nodeName,POD:.metadata.name,CPU REQUESTS:.spec.containers[*].resources.requests.cpu,CPU LIMITS:.spec.containers[*].resources.limits.cpu,MEMORY REQUESTS:.spec.containers[*].resources.requests.memory,MEMORY LIMITS:.spec.containers[*].resources.limits.memory"\nNODE          POD                                     CPU REQUESTS   CPU LIMITS   MEMORY REQUESTS   MEMORY LIMITS\nworker-node   coredns-74ff55c5b-g4hmt                 100m           <none>       70Mi              170Mi\nmaster-node   etcd-master-node                        100m           <none>       100Mi             <none>\nmaster-node   kube-apiserver-master-node              250m           <none>       <none>            <none>\nmaster-node   kube-controller-manager-master-node     200m           <none>       <none>            <none>\nmaster-node   kube-flannel-ds-amd64-fk59g             100m           100m         50Mi              50Mi\nworker-node   kube-flannel-ds-amd64-jwzms             100m           100m         50Mi              50Mi\nmaster-node   kube-proxy-kkwmb                        <none>         <none>       <none>            <none>\nworker-node   kube-proxy-vprs8                        <none>         <none>       <none>            <none>\nmaster-node   kube-scheduler-master-node              100m           <none>       <none>            <none>\nmaster-node   kubernetes-dashboard-7d75c474bb-7zc5j   <none>         <none>       <none>            <none>\n')))),(0,a.kt)("p",null,"From the Kubernetes dashboard, the metrics can be found in the\n",(0,a.kt)("inlineCode",{parentName:"p"},"Cluser > Nodes")," menu:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Listing from ",(0,a.kt)("inlineCode",{parentName:"p"},"Cluser > Nodes"),":"),(0,a.kt)("p",{parentName:"li"},"  ",(0,a.kt)("img",{alt:"Cluster nodes listing",src:n(89152).Z,width:"1920",height:"489"}))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Allocation detail for a node:"),(0,a.kt)("p",{parentName:"li"},"  ",(0,a.kt)("img",{alt:"Node allocation detail",src:n(76710).Z,width:"1920",height:"504"})))),(0,a.kt)("p",null,"The resulting output in Centreon could look like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Node 'master-node' CPU requests: 37.50% (0.75/2), CPU limits: 5.00% (0.1/2), Memory requests: 3.96% (150.00MB/3.70GB), Memory limits: 1.32% (50.00MB/3.70GB), Pods allocation: 7.27% (8/110)\nNode 'worker-node' CPU requests: 35.00% (0.7/2), CPU limits: 115.00% (2.3/2), Memory requests: 31.51% (1.17GB/3.70GB), Memory limits: 115.21% (4.26GB/3.70GB), Pods allocation: 9.09% (10/110)\n")),(0,a.kt)("p",null,"The collected metrics for each Nodes will be:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Metric"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"cpu.requests.percentage"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"cpu.limits.percentage"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"memory.requests.percentage"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"memory.limits.percentage"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"pods.allocation.percentage"))))),(0,a.kt)("p",null,"If the service collects metrics of several Nodes (depending on the\nchosen scenario), Node's name will be appended to the metric name:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Metric"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"worker-node#pods.allocation.percentage"))))),(0,a.kt)("p",null,"Thresholds expressed in percentage can be put for all metrics, for warning\nand critical alerts."),(0,a.kt)("h3",{id:"persistentvolumes-status"},"PersistentVolumes status"),(0,a.kt)("p",null,"This indicator will ensure that PersistentVolumes are operating correctly by\nlooking at the phase they are in, like the ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get pv")," can provide:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"NAME                     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM                   STORAGECLASS   REASON   AGE\npv-nfs-kubestorage-001   5Gi        RWO            Retain           Available                                                   630d\npv-nfs-kubestorage-002   5Gi        RWO            Retain           Bound       tick/data-influxdb                              630d\npv-nfs-kubestorage-003   5Gi        RWO            Retain           Released    graphite/graphite-pvc                           630d\n")),(0,a.kt)("p",null,"The resulting output in Centreon could look like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Persistent Volume 'pv-nfs-kubestorage-001' Phase is 'Available'\nPersistent Volume 'pv-nfs-kubestorage-002' Phase is 'Bound'\nPersistent Volume 'pv-nfs-kubestorage-003' Phase is 'Released'\n")),(0,a.kt)("p",null,"No metrics are collected."),(0,a.kt)("p",null,"It is possible to place thresholds using the following special variables:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{phase}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{name}"))),(0,a.kt)("p",null,"The defaults values are the following:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Threshold"),(0,a.kt)("th",{parentName:"tr",align:null},"Value"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Critical"),(0,a.kt)("td",{parentName:"tr",align:null},"`%{phase} !~ /Bound"),(0,a.kt)("td",{parentName:"tr",align:null},"Available")))),(0,a.kt)("p",null,"Refer to the\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/storage/persistent-volumes/"},"official documentation"),"\nfor more information about statuses and how to fine tune your thresholds."),(0,a.kt)("h3",{id:"pods-status"},"Pods status"),(0,a.kt)("p",null,"This indicator will ensure that Pods and their containers are within defined\nbounds by looking at the number of ready containers compared to\nthe desired count, like the ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get pods")," can provide:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"NAMESPACE              NAME                                                     READY   STATUS        RESTARTS   AGE\nkube-system            kube-proxy-65zhn                                         1/1     Running       0          37d\nkube-system            kube-proxy-kkwmb                                         1/1     Running       0          37d\nkube-system            kube-proxy-vprs8                                         1/1     Running       0          37d\nkube-system            tiller-deploy-7bf78cdbf7-z5n24                           1/1     Running       5          550d\nkubernetes-dashboard   dashboard-metrics-scraper-79c5968bdc-vncxc               1/1     Running       0          37d\nkubernetes-dashboard   kubernetes-dashboard-7448ffc97b-42rps                    1/1     Running       0          37d\n")),(0,a.kt)("p",null,"The resulting output in Centreon could look like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Checking pod 'kube-proxy-65zhn'\n    Containers Ready: 1/1 (100.00%), Status is 'Running', Restarts: 0\n    Container 'kube-proxy' Status is 'running', State is 'ready', Restarts: 0\nChecking pod 'kube-proxy-kkwmb'\n    Containers Ready: 1/1 (100.00%), Status is 'Running', Restarts: 0\n    Container 'kube-proxy' Status is 'running', State is 'ready', Restarts: 0\nChecking pod 'kube-proxy-vprs8'\n    Containers Ready: 1/1 (100.00%), Status is 'Running', Restarts: 0\n    Container 'kube-proxy' Status is 'running', State is 'ready', Restarts: 0\nChecking pod 'tiller-deploy-7bf78cdbf7-z5n24'\n    Containers Ready: 1/1 (100.00%), Status is 'Running', Restarts: 5\n    Container 'tiller' Status is 'running', State is 'ready', Restarts: 5\nChecking pod 'dashboard-metrics-scraper-79c5968bdc-vncxc'\n    Containers Ready: 1/1 (100.00%), Status is 'Running', Restarts: 0\n    Container 'dashboard-metrics-scraper' Status is 'running', State is 'ready', Restarts: 0\nChecking pod 'kubernetes-dashboard-7448ffc97b-42rps'\n    Containers Ready: 1/1 (100.00%), Status is 'Running', Restarts: 0\n    Container 'kubernetes-dashboard' Status is 'running', State is 'ready', Restarts: 0\n")),(0,a.kt)("p",null,"The collected metrics for each Pods will be:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Metric"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"containers.ready.count"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"restarts.total.count"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"containers.restarts.count"))))),(0,a.kt)("p",null,"If the service collects metrics of several Pods (depending on the\nchosen scenario), Pod's name and container's name will be appended to the\nmetric name:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Metric"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"coredns-74ff55c5b-g4hmt#containers.ready.count"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"coredns-74ff55c5b-g4hmt#restarts.total.count"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"coredns-74ff55c5b-g4hmt_coredns#containers.restarts.count"))))),(0,a.kt)("p",null,"It is then possible to place thresholds using the following special variables:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{name}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{status}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{state}")," (containers only)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{name}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{namespace}")," (Pods only)")),(0,a.kt)("p",null,"The defaults values are the following:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Threshold"),(0,a.kt)("th",{parentName:"tr",align:null},"Value"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Critical (pod)"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"%{status} !~ /running/i")),(0,a.kt)("td",{parentName:"tr",align:null},"Will raise a critical alert if a pod is not in a ",(0,a.kt)("inlineCode",{parentName:"td"},"running")," status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Critical (container)"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("code",null,"%{status} !~ /running/i ","|","|"," %{state} !~ /^ready$/")),(0,a.kt)("td",{parentName:"tr",align:null},"Will raise a critical alert if a container is not in a ",(0,a.kt)("inlineCode",{parentName:"td"},"running")," status or not in a ",(0,a.kt)("inlineCode",{parentName:"td"},"ready")," state")))),(0,a.kt)("p",null,"Refer to the\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/workloads/pods/"},"official documentation"),"\nfor more information about collected metrics and how to fine tune your\nthresholds."),(0,a.kt)("h3",{id:"replicasets-status"},"ReplicaSets status"),(0,a.kt)("p",null,"This indicator will ensure that ReplicaSets are within defined bounds by\nlooking at the number of ready replicas compared to the desired count,\nlike the ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get replicasets")," can provide:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"NAMESPACE              NAME                                   DESIRED   CURRENT   READY   AGE\nkube-system            coredns-74ff55c5b                      2         2         2       44d\nkube-system            tiller-deploy-7bf78cdbf7               1         1         1       630d\nkubernetes-dashboard   dashboard-metrics-scraper-79c5968bdc   1         1         1       44d\nkubernetes-dashboard   kubernetes-dashboard-7448ffc97b        1         1         1       44d\n")),(0,a.kt)("p",null,"The resulting output in Centreon could look like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"ReplicaSet 'coredns-74ff55c5b' Replicas Desired: 2, Current: 2, Ready: 2\nReplicaSet 'tiller-deploy-7bf78cdbf7' Replicas Desired: 1, Current: 1, Ready: 1\nReplicaSet 'dashboard-metrics-scraper-79c5968bdc' Replicas Desired: 1, Current: 1, Ready: 1\nReplicaSet 'kubernetes-dashboard-7448ffc97b' Replicas Desired: 1, Current: 1, Ready: 1\n")),(0,a.kt)("p",null,"The collected metrics for each ReplicaSets will be:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Metric"),(0,a.kt)("th",{parentName:"tr",align:null},"Kubernetes metric"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"replicaset.replicas.desired.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"replicas")," (in ",(0,a.kt)("inlineCode",{parentName:"td"},"spec")," entry)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"replicaset.replicas.current.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"replicas")," (in ",(0,a.kt)("inlineCode",{parentName:"td"},"status")," entry)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"replicaset.replicas.ready.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"readyReplicas"))))),(0,a.kt)("p",null,"If the service collects metrics of several ReplicaSets (depending on the\nchosen scenario), ReplicaSet's name will be appended to the metric name:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Metric"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"tiller-deploy-7bf78cdbf7#replicaset.replicas.desired.count"))))),(0,a.kt)("p",null,"It is then possible to place thresholds using the following special variables:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{desired}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{current}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{ready}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{name}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{namespace}"))),(0,a.kt)("p",null,"The defaults values are the following:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Threshold"),(0,a.kt)("th",{parentName:"tr",align:null},"Value"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Critical"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"%{ready} < %{desired}")),(0,a.kt)("td",{parentName:"tr",align:null},"Will raise a critical alert if the number of ready replicas is lower than the desired number")))),(0,a.kt)("p",null,"Refer to the\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/"},"official documentation"),"\nfor more information about collected metrics and how to fine tune your\nthresholds."),(0,a.kt)("h3",{id:"replicationcontrollers-status"},"ReplicationControllers status"),(0,a.kt)("p",null,"This indicator will ensure that ReplicationControllers are within defined\nbounds by looking at the number of ready replicas compared to the desired\ncount, like the ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get rc")," can provide:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"NAMESPACE   NAME    DESIRED   CURRENT   READY   AGE\nelk         nginx   3         3         3       2d19h\n")),(0,a.kt)("p",null,"The resulting output in Centreon could look like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"ReplicationController 'nginx' Replicas Desired: 3, Current: 3, Ready: 3\n")),(0,a.kt)("p",null,"The collected metrics for each ReplicaSets will be:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Metric"),(0,a.kt)("th",{parentName:"tr",align:null},"Kubernetes metric"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"replicationcontroller.replicas.desired.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"replicas")," (in ",(0,a.kt)("inlineCode",{parentName:"td"},"spec")," entry)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"replicationcontroller.replicas.current.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"replicas")," (in ",(0,a.kt)("inlineCode",{parentName:"td"},"status")," entry)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"replicationcontroller.replicas.ready.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"readyReplicas"))))),(0,a.kt)("p",null,"If the service collects metrics of several ReplicationControllers (depending\non the chosen scenario), ReplicationController's name will be appended to\nthe metric name:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Metric"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"nginx#replicationcontroller.replicas.desired.count"))))),(0,a.kt)("p",null,"It is then possible to place thresholds using the following special variables:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{desired}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{current}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{ready}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{name}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{namespace}"))),(0,a.kt)("p",null,"The defaults values are the following:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Threshold"),(0,a.kt)("th",{parentName:"tr",align:null},"Value"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Critical"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"%{ready} < %{desired}")),(0,a.kt)("td",{parentName:"tr",align:null},"Will raise a critical alert if the number of ready replicas is lower than the desired number")))),(0,a.kt)("p",null,"Refer to the\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/workloads/controllers/replicationcontroller/"},"official documentation"),"\nfor more information about collected metrics and how to fine tune your\nthresholds."),(0,a.kt)("h3",{id:"statefulsets-status"},"StatefulSets status"),(0,a.kt)("p",null,"This indicator will ensure that StatefulSets are within defined bounds by\nlooking at the number of ready/up-to-date replicas compared to the desired\ncount, like the ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get statefulsets")," can provide:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"NAMESPACE    NAME                                        READY   AGE\nelk          elasticsearch-master                        2/2     44d\ngraphite     graphite                                    1/1     3d\nprometheus   prometheus-prometheus-operator-prometheus   1/1     619d\n")),(0,a.kt)("p",null,"The resulting output in Centreon could look like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"StatefulSet 'elasticsearch-master' Replicas Desired: 2, Current: 2, Up-to-date: 2, Ready: 2\nStatefulSet 'graphite' Replicas Desired: 1, Current: 1, Up-to-date: 1, Ready: 1\nStatefulSet 'prometheus-prometheus-operator-prometheus' Replicas Desired: 1, Current: 1, Up-to-date: 1, Ready: 1\n")),(0,a.kt)("p",null,"The collected metrics for each StatefulSets will be:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Metric"),(0,a.kt)("th",{parentName:"tr",align:null},"Kubernetes metric"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"statefulset.replicas.desired.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"replicas")," (in ",(0,a.kt)("inlineCode",{parentName:"td"},"spec")," entry)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"statefulset.replicas.current.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"currentReplicas"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"statefulset.replicas.ready.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"readyReplicas"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"statefulset.replicas.uptodate.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"updatedReplicas"))))),(0,a.kt)("p",null,"If the service collects metrics of several StatefulSets (depending on the\nchosen scenario), StatefulSet's name will be appended to the metric name:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Metric"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"graphite#statefulset.replicas.desired.count"))))),(0,a.kt)("p",null,"It is then possible to place thresholds using the following special variables:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{desired}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{current}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{ready}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{up_to_date}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{name}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{namespace}"))),(0,a.kt)("p",null,"The defaults values are the following:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Threshold"),(0,a.kt)("th",{parentName:"tr",align:null},"Value"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Warning"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"%{up_to_date} < %{desired}")),(0,a.kt)("td",{parentName:"tr",align:null},"Will raise a warning alert if the number of up-to-date replicas is lower than the desired number")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Critical"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"%{ready} < %{desired}")),(0,a.kt)("td",{parentName:"tr",align:null},"Will raise a critical alert if the number of ready replicas is lower than the desired number")))),(0,a.kt)("p",null,"Refer to the\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/"},"official documentation"),"\nfor more information about collected metrics and how to fine tune your\nthresholds."),(0,a.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,a.kt)("h3",{id:"centreon-plugin"},"Centreon Plugin"),(0,a.kt)("p",null,"Install this Plugin on each needed Poller:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"yum install centreon-plugin-Cloud-Kubernetes-Api\n")),(0,a.kt)("h3",{id:"kubernetes"},"Kubernetes"),(0,a.kt)("p",null,"As mentioned in the introduction, two ways of communication are available:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"the RestAPI exposed by the Kubernetes cluster,"),(0,a.kt)("li",{parentName:"ul"},"the CLI tool kubectl to communicate with the cluster's control plane.")),(0,a.kt)("p",null,"For better performances, we recommend to use the RestAPI."),(0,a.kt)("h4",{id:"create-a-service-account"},"Create a service account"),(0,a.kt)("p",null,"Both flavors can use a service account with sufficient rights to access\nKubernetes API."),(0,a.kt)("p",null,"Create a dedicated service account ",(0,a.kt)("inlineCode",{parentName:"p"},"centreon-service-account")," in the\n",(0,a.kt)("inlineCode",{parentName:"p"},"kube-system")," namespace to access the API:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl create serviceaccount centreon-service-account --namespace kube-system\n")),(0,a.kt)("p",null,"Create a cluster role ",(0,a.kt)("inlineCode",{parentName:"p"},"api-access")," with needed privileges for the Plugin,\nand bind it to the newly created service account:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'cat <<EOF | kubectl create -f -\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: api-access\nrules:\n  - apiGroups:\n      - ""\n      - apps\n      - batch\n    resources:\n      - cronjobs\n      - daemonsets\n      - deployments\n      - events\n      - namespaces\n      - nodes\n      - persistentvolumes\n      - pods\n      - replicasets\n      - replicationcontrollers\n      - statefulsets\n    verbs:\n      - get\n      - list\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: api-access\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: api-access\nsubjects:\n- kind: ServiceAccount\n  name: centreon-service-account\n  namespace: kube-system\nEOF\n')),(0,a.kt)("p",null,"Refer to the official documentation for\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/reference/access-authn-authz/authentication/#service-account-tokens"},"service account creation"),"\nor information about\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/configuration/secret/"},"secret concept"),"."),(0,a.kt)("h4",{id:"using-restapi"},"Using RestAPI"),(0,a.kt)("p",null,"If you chose to communicate with your Kubernetes platform's RestAPI, the\nfollowing prerequisites need to be matched:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Expose the API with TLS,"),(0,a.kt)("li",{parentName:"ul"},"Retrieve token from service account.")),(0,a.kt)("h5",{id:"expose-the-api"},"Expose the API"),(0,a.kt)("p",null,"As the API is using HTTPS, you will need a certificate."),(0,a.kt)("p",null,"You can make an auto-signed key/certificate couple with the following\ncommand:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/kubernetesapi.key -out /etc/ssl/certs/kubernetesapi.crt\n")),(0,a.kt)("p",null,"Then load it as ",(0,a.kt)("inlineCode",{parentName:"p"},"api-certificate")," into the cluster, from the master node:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl create secret tls api-certificate --key /etc/ssl/private/kubernetesapi.key --cert /etc/ssl/certs/kubernetesapi.crt\n")),(0,a.kt)("p",null,"The ingress can now be created:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'cat <<EOF | kubectl create -f -\napiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n  name: kubernetesapi-ingress\n  namespace: default\n  annotations:\n    kubernetes.io/ingress.class: "nginx"\n    nginx.ingress.kubernetes.io/backend-protocol: HTTPS\nspec:\n  tls:\n    - hosts:\n      - kubernetesapi.local.domain\n      secretName: api-certificate\n  rules:\n  - host: kubernetesapi.local.domain\n    http:\n      paths:\n      - backend:\n          serviceName: kubernetes\n          servicePort: 443\n        path: /\nEOF\n')),(0,a.kt)("p",null,"Adapt the host entry to your needs."),(0,a.kt)("p",null,"Refer to the official documentation for\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/services-networking/ingress/"},"ingresses management"),"."),(0,a.kt)("h5",{id:"retrieve-token-from-service-account"},"Retrieve token from service account"),(0,a.kt)("p",null,"Retrieve the secret name from the previously created service account:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl get serviceaccount centreon-service-account --namespace kube-system --output jsonpath='{.secrets[].name}'\n")),(0,a.kt)("p",null,"Then retrieve the token from the service account secret:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl get secrets centreon-service-account-token-xqw7m --namespace kube-system --output jsonpath='{.data.token}' | base64 --decode\n")),(0,a.kt)("p",null,"This token will be used later for Centreon host configuration."),(0,a.kt)("h4",{id:"using-kubectl"},"Using kubectl"),(0,a.kt)("p",null,"If you chose to communicate with the cluster's control plane with kubectl, the\nfollowing prerequisites need to be matched:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Install the kubectl tool,"),(0,a.kt)("li",{parentName:"ul"},"Create a kubectl configuration.")),(0,a.kt)("p",null,"Those actions are needed on all Pollers that will do Kubernetes monitoring."),(0,a.kt)("h5",{id:"install-kubectl"},"Install kubectl"),(0,a.kt)("p",null,"Download the latest release with the following command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"\n')),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Be sure to download a version within one minor version difference of\nyour cluster. To download a specific version, change the embedded curl by\nthe version like ",(0,a.kt)("inlineCode",{parentName:"p"},"v1.20.0"),".")),(0,a.kt)("p",null,"Install the tool in the binaries directory:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl\n")),(0,a.kt)("p",null,"Refer to the\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/"},"official documentation"),"\nfor more details."),(0,a.kt)("h5",{id:"create-a-kubectl-configuration"},"Create a kubectl configuration"),(0,a.kt)("p",null,"To access the cluster, kubectl needs a configuration file with all needed\ninformation."),(0,a.kt)("p",null,"Here is an example of a configuration file creation based on a service\naccount (created in ",(0,a.kt)("a",{parentName:"p",href:"#create-a-service-account"},"previous chapter"),")."),(0,a.kt)("p",null,"You will need to fill the following information and execute the commands\non the master node:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"ip=<master node ip>\nport=<api port>\naccount=centreon-service-account\nnamespace=kube-system\nclustername=my-kube-cluster\ncontext=my-kube-cluster\nsecret=$(kubectl get serviceaccount $account --namespace $namespace --output jsonpath='{.secrets[].name}')\nca=$(kubectl get secret $secret --namespace $namespace --output jsonpath='{.data.ca\\.crt}')\ntoken=$(kubectl get secret $secret --namespace $namespace --output jsonpath='{.data.token}' | base64 --decode)\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"The account name and namespace must match with the account created earlier.\nAll others need to be adapted.")),(0,a.kt)("p",null,"Then execute this command to generate the config file :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"cat <<EOF >> config\napiVersion: v1\nkind: Config\nclusters:\n- name: ${clustername}\n  cluster:\n    certificate-authority-data: ${ca}\n    server: https://${ip}:${port}\ncontexts:\n- name: ${context}\n  context:\n    cluster: ${clustername}\n    namespace: ${namespace}\n    user: ${account}\ncurrent-context: ${context}\nusers:\n- name: ${account}\n  user: ${token}\nEOF\n")),(0,a.kt)("p",null,"This will create a ",(0,a.kt)("inlineCode",{parentName:"p"},"config")," file. This file must be copied to the Pollers\nEngine user's home, usually in a ",(0,a.kt)("inlineCode",{parentName:"p"},".kube")," directory (i.e.\n",(0,a.kt)("inlineCode",{parentName:"p"},"/var/lib/centreon-engine/.kube/config"),")."),(0,a.kt)("p",null,"This path will be used later in Centreon host configuration."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"You may also want to copy the configuration to Gorgone user's home\nif using Host Discovery.")),(0,a.kt)("p",null,"Refer to the\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/"},"official documentation"),"\nfor more details."),(0,a.kt)("h2",{id:"monitoring-configuration"},"Monitoring configuration"),(0,a.kt)("h3",{id:"manual-creation"},"Manual creation"),(0,a.kt)("p",null,"Add a host from ",(0,a.kt)("inlineCode",{parentName:"p"},"Configuration > Hosts")," menu and choose a template\nbetween ",(0,a.kt)("inlineCode",{parentName:"p"},"Cloud-Kubernetes-Api")," (global monitoring, scenarii 1 and 2) and\n",(0,a.kt)("inlineCode",{parentName:"p"},"Cloud-Kubernetes-Node-Api")," (unitary monitoring, scenario 3) from the list."),(0,a.kt)("p",null,"In both cases, fill the following fields:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Field"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Host name"),(0,a.kt)("td",{parentName:"tr",align:null},"Name of the host")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Alias"),(0,a.kt)("td",{parentName:"tr",align:null},"Host description")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"IP"),(0,a.kt)("td",{parentName:"tr",align:null},"Host IP Address")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Monitored from"),(0,a.kt)("td",{parentName:"tr",align:null},"Monitoring Poller to use")))),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"IP address can either be the Kubernetes IP (node master) or the IP of each\nnodes if choosing ",(0,a.kt)("inlineCode",{parentName:"p"},"Cloud-Kubernetes-Node-Api")," template.")),(0,a.kt)("p",null,"Then set the values for each needed macros:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"If using RestAPI:"),(0,a.kt)("table",{parentName:"li"},(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Macro"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"),(0,a.kt)("th",{parentName:"tr",align:null},"Example value"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"KUBERNETESAPICUSTOMMODE")),(0,a.kt)("td",{parentName:"tr",align:null},"Plugin custom mode"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"api"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"KUBERNETESAPIHOSTNAME")),(0,a.kt)("td",{parentName:"tr",align:null},"Hostname or address of the Kubernetes API service"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"kubenetesapi.local.domain"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"KUBERNETESAPIPORT")),(0,a.kt)("td",{parentName:"tr",align:null},"Port of the API"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"443"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"KUBERNETESAPIPROTO")),(0,a.kt)("td",{parentName:"tr",align:null},"Protocol used by API"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"https"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"KUBERNETESAPITOKEN")),(0,a.kt)("td",{parentName:"tr",align:null},"Token retrieved from service account"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"eyJhbG...KEw")))))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"If using kubectl:"),(0,a.kt)("table",{parentName:"li"},(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Macro"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"),(0,a.kt)("th",{parentName:"tr",align:null},"Example value"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"KUBERNETESAPICUSTOMMODE")),(0,a.kt)("td",{parentName:"tr",align:null},"Plugin custom mode"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"kubectl"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"KUBECTLCONFIGFILE")),(0,a.kt)("td",{parentName:"tr",align:null},"Path to the configuration file"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"~/.kube/config"))))))),(0,a.kt)("p",null,"Optional macros values can be set:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Macro"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"),(0,a.kt)("th",{parentName:"tr",align:null},"Default value"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"PROXYURL")),(0,a.kt)("td",{parentName:"tr",align:null},"URL of the proxy (if needed)"),(0,a.kt)("td",{parentName:"tr",align:null},"none")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"TIMEOUT")),(0,a.kt)("td",{parentName:"tr",align:null},"Time in seconds before the query timed out"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"10"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"EXTRAOPTIONS")),(0,a.kt)("td",{parentName:"tr",align:null},"Extra options (if needed)"),(0,a.kt)("td",{parentName:"tr",align:null},"none")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"KUBERNETESAPINAMESPACE")),(0,a.kt)("td",{parentName:"tr",align:null},"Namespace filter"),(0,a.kt)("td",{parentName:"tr",align:null},"none")))),(0,a.kt)("p",null,"If choosing ",(0,a.kt)("inlineCode",{parentName:"p"},"Cloud-Kubernetes-Api"),", host will be added with all services to\ncheck each Kubernetes unit (scenario 1)."),(0,a.kt)("p",null,"If choosing ",(0,a.kt)("inlineCode",{parentName:"p"},"Cloud-Kubernetes-Node-Api"),", host will be added with only one\nservice to check node usage (scenario 3)."),(0,a.kt)("p",null,"Click on the ",(0,a.kt)("strong",{parentName:"p"},"Save")," button and you're good to push the configuration to\nthe Engines."),(0,a.kt)("h3",{id:"automatic-discovery"},"Automatic discovery"),(0,a.kt)("h4",{id:"host-discovery"},"Host discovery"),(0,a.kt)("p",null,"Add a job from ",(0,a.kt)("inlineCode",{parentName:"p"},"Configuration > Discovery")," menu and choose a provider\nbetween ",(0,a.kt)("inlineCode",{parentName:"p"},"Kubernetes Nodes (RestAPI)")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"Kubernetes Nodes (Kubectl)"),"\nfrom the list."),(0,a.kt)("p",null,"Set credentials to access the Kubernetes API depending on the chosen flavor:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"If using RestAPI: set the token\n",(0,a.kt)("a",{parentName:"li",href:"#retrieve-token-from-service-account"},"retrieved ealier")," from the service\naccount,"),(0,a.kt)("li",{parentName:"ul"},"If using kubectl: set the path to the\n",(0,a.kt)("a",{parentName:"li",href:"#create-a-kubectl-configuration"},"created configuration file")," (prefer using\nrelative path to make it work for both discovery and monitoring,\ni.e. ",(0,a.kt)("inlineCode",{parentName:"li"},"~/.kube/config"),").")),(0,a.kt)("p",null,"For RestAPI: hostname/address, port and protocol are needed to access\nthe Kubernetes API."),(0,a.kt)("p",null,"By default, discovery will add hosts with a minimal host template that will\nonly collect metrics for the Kubernetes nodes usage. It will then add a\nspecial ",(0,a.kt)("inlineCode",{parentName:"p"},"KUBERNETESNODENAME")," macro with node name as value (scenario 3)."),(0,a.kt)("p",null,"If scheduled, job will add new nodes added to the cluster automatically."),(0,a.kt)("h4",{id:"service-discovery"},"Service discovery"),(0,a.kt)("p",null,"In addition to ",(0,a.kt)("a",{parentName:"p",href:"#manual-creation"},"manual creation"),", it is possible to add a\nservice for each instances of each Kubernetes units (scenario 2). It is then\nrecommended to disable the previously created services when adding host."),(0,a.kt)("p",null,"Launch a scan on the added host from ",(0,a.kt)("inlineCode",{parentName:"p"},"Configuration > Service > Scan")," menu,\nand add all wanted services."),(0,a.kt)("p",null,"If enabled, service discovery rule will add new instances created in the\ncluster automatically."),(0,a.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,a.kt)("p",null,"Here are some common errors and their description. You will often want to use\nthe ",(0,a.kt)("inlineCode",{parentName:"p"},"--debug")," option to get the root error."),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Error"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"UNKNOWN: Cannot decode json response: Can't connect to <hostname>:<port> (certificate verify failed)")),(0,a.kt)("td",{parentName:"tr",align:null},"This error may appear if the TLS cetificate in self-signed. Use the option ",(0,a.kt)("inlineCode",{parentName:"td"},'--ssl-opt="SSL_verify_mode => SSL_VERIFY_NONE"')," to omit the certificate validity.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"UNKNOWN: API return error code '401' (add --debug option for detailed message)")),(0,a.kt)("td",{parentName:"tr",align:null},"If adding ",(0,a.kt)("inlineCode",{parentName:"td"},"--debug")," option, API response message says ",(0,a.kt)("inlineCode",{parentName:"td"},"Unauthorized"),". It generally means that the provided token is not valid.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"UNKNOWN: API return error code '403' (add --debug option for detailed message)")),(0,a.kt)("td",{parentName:"tr",align:null},"If adding ",(0,a.kt)("inlineCode",{parentName:"td"},"--debug")," option, API response message says ",(0,a.kt)("inlineCode",{parentName:"td"},'nodes is forbidden: User "system:serviceaccount:<namespace>:<account>" cannot list resource "nodes" in API group "" at the cluster scope'),". It means that the cluster role RBAC bound to the service account does not have the necessary privileges")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"UNKNOWN: CLI return error code '1' (add --debug option for detailed message)")),(0,a.kt)("td",{parentName:"tr",align:null},"If adding ",(0,a.kt)("inlineCode",{parentName:"td"},"--debug")," option, CLI response message says ",(0,a.kt)("inlineCode",{parentName:"td"},"error: stat ~/.kube/config:: no such file or directory"),". The provided configuration file cannot be found.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"UNKNOWN: CLI return error code '1' (add --debug option for detailed message)")),(0,a.kt)("td",{parentName:"tr",align:null},"If adding ",(0,a.kt)("inlineCode",{parentName:"td"},"--debug")," option, CLI response message says ",(0,a.kt)("inlineCode",{parentName:"td"},'error: error loading config file "/root/.kube/config": open /root/.kube/config: permission denied'),". The provided configuration file cannot be read by current user.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"UNKNOWN: CLI return error code '1' (add --debug option for detailed message)")),(0,a.kt)("td",{parentName:"tr",align:null},"If adding ",(0,a.kt)("inlineCode",{parentName:"td"},"--debug")," option, CLI response message says ",(0,a.kt)("inlineCode",{parentName:"td"},'error: error loading config file "/root/.kube/config": v1.Config.AuthInfos: []v1.NamedAuthInfo: v1.NamedAuthInfo.AuthInfo: v1.AuthInfo.ClientKeyData: decode base64: illegal base64...'),". The provided configuration file is not valid.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"UNKNOWN: CLI return error code '1' (add --debug option for detailed message)")),(0,a.kt)("td",{parentName:"tr",align:null},"If adding ",(0,a.kt)("inlineCode",{parentName:"td"},"--debug")," option, CLI response message says ",(0,a.kt)("inlineCode",{parentName:"td"},"The connection to the server <hostname>:<port> was refused - did you specify the right host or port?"),". The provided configuration file is not valid.")))))}k.isMDXComponent=!0},76710:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/cloud-kubernetes-api-cluster-nodes-detail-ef0a545a1dfd9e156a5451f598548855.png"},89152:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/cloud-kubernetes-api-cluster-nodes-listing-4f09461457985762ae5f1fc9c4b17aa3.png"}}]);