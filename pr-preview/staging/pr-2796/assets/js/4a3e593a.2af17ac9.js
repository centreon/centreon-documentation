"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[11172],{73735:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>u,contentTitle:()=>s,default:()=>g,frontMatter:()=>l,metadata:()=>p,toc:()=>m});n(67294);var a=n(3905);function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(t,e){return e=null!=e?e:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):function(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})),t}function o(t,e){if(null==t)return{};var n,a,r=function(t,e){if(null==t)return{};var n,a,r={},i=Object.keys(t);for(a=0;a<i.length;a++)n=i[a],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(a=0;a<i.length;a++)n=i[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}const l={id:"monitoring-with-snmp-traps",title:"Monitoring with SNMP Traps"},s=void 0,p={unversionedId:"monitoring/passive-monitoring/monitoring-with-snmp-traps",id:"version-23.10/monitoring/passive-monitoring/monitoring-with-snmp-traps",title:"Monitoring with SNMP Traps",description:"Monitoring configuration",source:"@site/versioned_docs/version-23.10/monitoring/passive-monitoring/monitoring-with-snmp-traps.md",sourceDirName:"monitoring/passive-monitoring",slug:"/monitoring/passive-monitoring/monitoring-with-snmp-traps",permalink:"/centreon-documentation/pr-preview/staging/pr-2796/docs/monitoring/passive-monitoring/monitoring-with-snmp-traps",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/versioned_docs/version-23.10/monitoring/passive-monitoring/monitoring-with-snmp-traps.md",tags:[],version:"23.10",lastUpdatedAt:1699374559,formattedLastUpdatedAt:"Nov 7, 2023",frontMatter:{id:"monitoring-with-snmp-traps",title:"Monitoring with SNMP Traps"},sidebar:"version-23.10/docs",previous:{title:"Create SNMP Traps definitions",permalink:"/centreon-documentation/pr-preview/staging/pr-2796/docs/monitoring/passive-monitoring/create-snmp-traps-definitions"},next:{title:"Debug SNMP Traps management",permalink:"/centreon-documentation/pr-preview/staging/pr-2796/docs/monitoring/passive-monitoring/debug-snmp-traps-management"}},u={},m=[{value:"Monitoring configuration",id:"monitoring-configuration",level:2},{value:"Applying the changes",id:"applying-the-changes",level:2},{value:"To go further",id:"to-go-further",level:2},{value:"Modify the output",id:"modify-the-output",level:3},{value:"Use all the arguments",id:"use-all-the-arguments",level:4},{value:"Active checks after trap reception",id:"active-checks-after-trap-reception",level:4},{value:"Execute special command",id:"execute-special-command",level:4},{value:"Use all the arguments (via OID)",id:"use-all-the-arguments-via-oid",level:4},{value:"Use an external variable",id:"use-an-external-variable",level:4},{value:"Use a Regular expression",id:"use-a-regular-expression",level:4},{value:"Route/Transfer SNMP traps",id:"routetransfer-snmp-traps",level:3},{value:"Ignore SNMP Trap when resource is on downtime",id:"ignore-snmp-trap-when-resource-is-on-downtime",level:3}],c={toc:m},d="wrapper";function g(t){var{components:e}=t,l=o(t,["components"]);return(0,a.kt)(d,i(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),a.forEach((function(e){r(t,e,n[e])}))}return t}({},c,l),{components:e,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"monitoring-configuration"},"Monitoring configuration"),(0,a.kt)("p",null,"Go to the ",(0,a.kt)("strong",{parentName:"p"},"Configuration > Services > Services by host")," menu and click ",(0,a.kt)("strong",{parentName:"p"},"Add"),"."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Set a description of the service"),(0,a.kt)("li",{parentName:"ul"},"Select the host to which to attach this service"),(0,a.kt)("li",{parentName:"ul"},"Select the ",(0,a.kt)("strong",{parentName:"li"},"generic-passive-service-custom")," template")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image",src:n(23029).Z,width:"1580",height:"442"})),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Go to the ",(0,a.kt)("strong",{parentName:"li"},"Relation")," tab and select the SNMP traps")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image",src:n(31824).Z,width:"1590",height:"456"})),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Click ",(0,a.kt)("strong",{parentName:"li"},"Save"),".")),(0,a.kt)("h2",{id:"applying-the-changes"},"Applying the changes"),(0,a.kt)("p",null,"To be able to export the OID present in the database in the configuration file to centreontrapd, apply the following procedure:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Go to the ",(0,a.kt)("strong",{parentName:"li"},"Configuration > SNMP traps > Generate")," menu"),(0,a.kt)("li",{parentName:"ol"},"Select the poller to which you want to export the configuration files"),(0,a.kt)("li",{parentName:"ol"},"Check ",(0,a.kt)("strong",{parentName:"li"},"Generate traps database")," and ",(0,a.kt)("strong",{parentName:"li"},"Apply configurations")),(0,a.kt)("li",{parentName:"ol"},"In the dropdown list, choose ",(0,a.kt)("strong",{parentName:"li"},"Send signal")," (the ",(0,a.kt)("strong",{parentName:"li"},"Reload")," option is preferable)"),(0,a.kt)("li",{parentName:"ol"},"Click on the ",(0,a.kt)("strong",{parentName:"li"},"Generate")," button"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("em",{parentName:"li"},(0,a.kt)("a",{parentName:"em",href:"/centreon-documentation/pr-preview/staging/pr-2796/docs/monitoring/monitoring-servers/deploying-a-configuration"},"Export the monitoring configuration")))),(0,a.kt)("h2",{id:"to-go-further"},"To go further"),(0,a.kt)("h3",{id:"modify-the-output"},"Modify the output"),(0,a.kt)("h4",{id:"use-all-the-arguments"},"Use all the arguments"),(0,a.kt)("p",null,"For an SNMP trap, when configuring the output message, the argument ",(0,a.kt)("strong",{parentName:"p"},"$","*")," will display all the information (the value of\narguments) contained within the SNMP trap. However, it is possible to display only certain information contained in the\nSNMP trap by calling unitary arguments."),(0,a.kt)("p",null,"For example:\n",(0,a.kt)("img",{alt:"image",src:n(31824).Z,width:"1590",height:"456"})),(0,a.kt)("p",null,"The output message ",(0,a.kt)("strong",{parentName:"p"},"Link down on interface $2. State: $4.")," will display only the name of the interface and its status\n($2 and $4 argument)."),(0,a.kt)("p",null,"Where can I find the arguments?"),(0,a.kt)("p",null,"The arguments are in the documentation of the MIB manufacturer or in the ",(0,a.kt)("strong",{parentName:"p"},"Comments")," field of the SNMP trap."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image",src:n(24942).Z,width:"1281",height:"195"})),(0,a.kt)("p",null,"To show:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The index link, use the $1 argument"),(0,a.kt)("li",{parentName:"ul"},"The interface name , use the $2 argument"),(0,a.kt)("li",{parentName:"ul"},"The administrative state of the interface, use the $3 argument"),(0,a.kt)("li",{parentName:"ul"},"The state interface, use the $4 argument")),(0,a.kt)("p",null,"For example, the following output message displays all the arguments:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"Link down on interface: $2 (index: $1). Operational state: $4, Administration state: $3\n")),(0,a.kt)("h4",{id:"active-checks-after-trap-reception"},"Active checks after trap reception"),(0,a.kt)("p",null,"The ",(0,a.kt)("strong",{parentName:"p"},"Reschedule associated services")," option allows you to actively check the service after trap reception."),(0,a.kt)("p",null,"The active service linked in the service configuration is executed."),(0,a.kt)("h4",{id:"execute-special-command"},"Execute special command"),(0,a.kt)("p",null,"With Centreontrapd, it is possible to execute a special command after the reception of a SNMP trap. Just use the option\n",(0,a.kt)("strong",{parentName:"p"},"Execute special command")," followed by the description of this command."),(0,a.kt)("h4",{id:"use-all-the-arguments-via-oid"},"Use all the arguments (via OID)"),(0,a.kt)("p",null,"It is also possible to specify an argument value directly without knowing the order of the arguments ($1, $2, $3, etc.). To do this,\nuse the complete OID number of the arguments you need."),(0,a.kt)("p",null,"For example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"Link down on interface: @{.1.3.6.1.2.1.2.2.1.2} (index: @{.1.3.6.1.2.1.2.2.1.1}). Operational state: @{.1.3.6.1.2.1.2.2.1.8}, Administration state: @{.1.3.6.1.2.1.2.2.1.7}\n")),(0,a.kt)("h4",{id:"use-an-external-variable"},"Use an external variable"),(0,a.kt)("p",null,"It is also possible to modify the output message by retrieving information via scripts or external commands and get the\nresult to insert it in the output.\nTo do this, within the definition of your SNMP trap, go to the ",(0,a.kt)("strong",{parentName:"p"},"Advanced")," tab and add one (or more) preexec commands."),(0,a.kt)("p",null,"For example:\n",(0,a.kt)("img",{alt:"image",src:n(18270).Z,width:"904",height:"86"})),(0,a.kt)("p",null,"The first command is ",(0,a.kt)("strong",{parentName:"p"},"snmpget -v 2c -Ovq -c public @HOSTADDRESS@ ifAlias.$1"),' and allows you to retrieve the alias\ninterface. The "$1" variable is for the argument 1 associated value of linkUp/linkDown traps.'),(0,a.kt)("p",null,"The second command is ",(0,a.kt)("strong",{parentName:"p"},"snmpget -v 2c -Ovq -c public @HOSTADDRESS@ ifSpeed.$1"),' and allows you to retrieve interface speed.\nThe "$1" variable is for the argument 1 associated value of linkUp/linkDown traps.'),(0,a.kt)("p",null,"In order to exploit the result of the first command in the output, use the argument $p1. To exploit the\nresult of the second command in the output, use the argument $p2 ."),(0,a.kt)("p",null,"We can then deduce the following output message:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"Link down on interface: $2 (index: $1). Operational state: $4, Administration state: $3, Alias : $p1, Speed : $p2\n")),(0,a.kt)("h4",{id:"use-a-regular-expression"},"Use a Regular expression"),(0,a.kt)("p",null,"It is also possible to modify the output by using a regular expression with the ",(0,a.kt)("strong",{parentName:"p"},"Output Transform")," option. Simply\ndefine the regexp and it will be executed at trap reception."),(0,a.kt)("p",null,"For example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"s/\\|/-/g\n")),(0,a.kt)("p",null,"Will replace ",(0,a.kt)("strong",{parentName:"p"},"|")," in the output to ",(0,a.kt)("strong",{parentName:"p"},"-"),"."),(0,a.kt)("h3",{id:"routetransfer-snmp-traps"},"Route/Transfer SNMP traps"),(0,a.kt)("p",null,"It is possible to have an SNMP trap concentrator. Example: Oracle GRID.\nOracle GRID is responsible for federating information for all Oracle servers. If necessary, the Oracle GRID server sends the SNMP trap to the monitoring server."),(0,a.kt)("p",null,"However, from an SNMP trap sent from Oracle GRID, we want to extract the IP address of the host and display the message in the service trap not belonging to Oracle Grid but to the correct host."),(0,a.kt)("p",null,"To do this, perform the following steps:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Create a generic trap, with the following parameters:")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"On the ",(0,a.kt)("strong",{parentName:"li"},"Main")," tab:")),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Attributes"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Trap Name"),(0,a.kt)("td",{parentName:"tr",align:null},"Trap name")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Mode"),(0,a.kt)("td",{parentName:"tr",align:null},"Unique")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"OID"),(0,a.kt)("td",{parentName:"tr",align:null},"OID of the trap")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Default Status"),(0,a.kt)("td",{parentName:"tr",align:null},"Trap default status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Output Message"),(0,a.kt)("td",{parentName:"tr",align:null},"Custom output message")))),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"In the ",(0,a.kt)("strong",{parentName:"li"},"Advanced")," Tab:")),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Attributes"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Enable routing"),(0,a.kt)("td",{parentName:"tr",align:null},"Checked")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Route definition"),(0,a.kt)("td",{parentName:"tr",align:null},"$2 (In this example $2 argument is for IP address of the host)")))),(0,a.kt)("ol",{start:2},(0,a.kt)("li",{parentName:"ol"},"Create a second trap definition:")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"In the ",(0,a.kt)("strong",{parentName:"li"},"Main")," Tab:")),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Attributes"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Trap Name"),(0,a.kt)("td",{parentName:"tr",align:null},"Trap name (not the same as previous)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"OID"),(0,a.kt)("td",{parentName:"tr",align:null},"OID of the trap (same as previous)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Default Status"),(0,a.kt)("td",{parentName:"tr",align:null},"Trap default status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Output Message"),(0,a.kt)("td",{parentName:"tr",align:null},"Custom output message")))),(0,a.kt)("ol",{start:3},(0,a.kt)("li",{parentName:"ol"},"Associate the first definition to a service (e.g. PING) of the Oracle GRID server"),(0,a.kt)("li",{parentName:"ol"},"Associate the second definition to a passive service of the host."),(0,a.kt)("li",{parentName:"ol"},"Generate SNMP trap definitions and restart centreontrapd")),(0,a.kt)("p",null,"In the ",(0,a.kt)("strong",{parentName:"p"},"Route definition")," field you can use the following arguments:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Variable name"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"@GETHOSTBYADDR($2)@"),(0,a.kt)("td",{parentName:"tr",align:null},"Reverse DNS resolution to know the DNS name from IP address (127.0.0.1 -",">"," localhost)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"@GETHOSTBYNAME($2)@"),(0,a.kt)("td",{parentName:"tr",align:null},"DNS resolution to know the Ip address from the DNS (localhost -",">"," 127.0.0.1)")))),(0,a.kt)("h3",{id:"ignore-snmp-trap-when-resource-is-on-downtime"},"Ignore SNMP Trap when resource is on downtime"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Check Downtime")," allow centreontrapd to check if the service is not in Downtime status at trap reception. The\nsubmission can be canceled."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"This is only possible with Centreon Broker and on central monitoring.")),(0,a.kt)("p",null,"There are three ways to configure this:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"None: nothing to do; the trap is sent as normal;"),(0,a.kt)("li",{parentName:"ul"},"Real-Time: with this option, a trap sent with a current downtime, the service state is not updated;"),(0,a.kt)("li",{parentName:"ul"},"History: option used to not acknowledge an snmp trap concerning a past event during a downtime.")))}g.isMDXComponent=!0},23029:(t,e,n)=>{n.d(e,{Z:()=>a});const a=n.p+"assets/images/06createpassiveservice-bf0354367d640257a23adfe0e022548c.png"},31824:(t,e,n)=>{n.d(e,{Z:()=>a});const a=n.p+"assets/images/06servicetrapsrelation-56ee0bc26d89a7e24c34374433564597.png"},24942:(t,e,n)=>{n.d(e,{Z:()=>a});const a=n.p+"assets/images/klinkcomment-9419412625feb4d0af8b548bbfa802bc.png"},18270:(t,e,n)=>{n.d(e,{Z:()=>a});const a=n.p+"assets/images/kpreexec-caf904abd76e438b759ee14498aec471.png"}}]);