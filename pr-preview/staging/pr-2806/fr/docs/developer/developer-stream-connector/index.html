<!doctype html>
<html lang="fr" dir="ltr" class="docs-wrapper docs-doc-page docs-version-23.10 plugin-docs plugin-id-default docs-doc-id-developer/developer-stream-connector" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Comment écrire un Stream Connector | Centreon Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.centreon.com/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/developer/developer-stream-connector/"><meta data-rh="true" name="docusaurus_locale" content="fr"><meta data-rh="true" name="docsearch:language" content="fr"><meta data-rh="true" name="docusaurus_version" content="23.10"><meta data-rh="true" name="docusaurus_tag" content="docs-default-23.10"><meta data-rh="true" name="docsearch:version" content="23.10"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-23.10"><meta data-rh="true" property="og:title" content="Comment écrire un Stream Connector | Centreon Documentation"><meta data-rh="true" name="description" content="Vue d&#x27;ensemble"><meta data-rh="true" property="og:description" content="Vue d&#x27;ensemble"><link data-rh="true" rel="icon" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.centreon.com/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/developer/developer-stream-connector/"><link data-rh="true" rel="alternate" href="https://docs.centreon.com/centreon-documentation/pr-preview/staging/pr-2806/docs/developer/developer-stream-connector/" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.centreon.com/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/developer/developer-stream-connector/" hreflang="fr"><link data-rh="true" rel="alternate" href="https://docs.centreon.com/centreon-documentation/pr-preview/staging/pr-2806/docs/developer/developer-stream-connector/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://3WEC6XPLDB-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-8418698-13","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BGL69N5GPJ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-BGL69N5GPJ",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Centreon Documentation" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/opensearch.xml"><link rel="stylesheet" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/assets/css/styles.189e4fc9.css">
<link rel="preload" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/assets/js/runtime~main.0643b7b7.js" as="script">
<link rel="preload" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/assets/js/main.03c984fd.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(e){}return e}()||function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Aller au contenu principal"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Aller au contenu principal</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Ouvrir/fermer la barre de navigation" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/"><div class="navbar__logo"><img src="/centreon-documentation/pr-preview/staging/pr-2806/fr/img/logo_centreon_dark.png" alt="Logo Centreon Docs" class="themedImage_ToTc themedImage--light_HNdA"><img src="/centreon-documentation/pr-preview/staging/pr-2806/fr/img/logo_centreon.png" alt="Logo Centreon Docs" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/getting-started/welcome/">Centreon OnPrem</a><a class="navbar__item navbar__link" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/pp/integrations/plugin-packs/getting-started/introduction/">Connecteurs de supervision</a></div><div class="navbar__items navbar__items--right"><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Chercher"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Chercher</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/getting-started/welcome/">⭐ 23.10</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/developer/developer-stream-connector/">⭐ 23.10</a></li><li><hr class="dropdown-separator"></li><li class="dropdown-archived-versions"><b>Versions archivées</b></li><li><a href="https://archives-docs.centreon.com/21.04/" target="_blank" rel="noopener noreferrer" class="dropdown__link">21.04<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://archives-docs.centreon.com/20.10/" target="_blank" rel="noopener noreferrer" class="dropdown__link">20.10<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://archives-docs.centreon.com/20.04/" target="_blank" rel="noopener noreferrer" class="dropdown__link">20.04<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://docs-older.centreon.com" target="_blank" rel="noopener noreferrer" class="dropdown__link">Older<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>🇫🇷 Français</a><ul class="dropdown__menu"><li><a href="/centreon-documentation/pr-preview/staging/pr-2806/docs/developer/developer-stream-connector/" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">🇬🇧 English</a></li><li><a href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/developer/developer-stream-connector/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="fr">🇫🇷 Français</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-label="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Revenez en haut" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/getting-started/welcome/">Getting Started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/installation/introduction/">Installation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/administration/secure-platform/">Sécuriser la plateforme</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/monitoring/about/">Superviser des ressources</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/alerts-notifications/concepts/">Gérer évènements et alertes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/monitoring/basic-objects/contacts/">Gérer les utilisateurs de Centreon</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/metrology/chart-management/">Graphiques de performance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/service-mapping/introduction/">Service Mapping</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/category/graphical-views/">Vues graphiques</a><button aria-label="Toggle the collapsible sidebar category &#x27;Vues graphiques&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/reporting/introduction/">Reporting</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/administration/parameters/centreon-ui/">Administrer</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/update/update-centreon-platform/">Mettre à jour, monter de version et migrer</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/pp/integrations/plugin-packs/getting-started/introduction/">Connecteurs de supervision</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/integrations/introduction-integrations/">Intégrations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/mobile/introduction/">Centreon mobile</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/category/developer-resources/">Ressources développeur</a><button aria-label="Toggle the collapsible sidebar category &#x27;Ressources développeur&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/developer/developer-module/">Comment écrire un module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/developer/developer-stream-connector/">Comment écrire un Stream Connector</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/developer/developer-broker-stream-connector-migration/">Migration des Stream Connectors vers BBDO 3.0.0</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/developer/developer-translate-centreon/">Comment traduire Centreon</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/developer/developer-widget/">Comment écrire un widget</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/developer/developer-broker-stream-connector/">Centreon Broker</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/developer/developer-gorgone-client-server-communication/">Centreon Gorgone</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/api/introduction/">API</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/installation/installation-of-centreon-ha/overview/">Centreon HA</a><button aria-label="Toggle the collapsible sidebar category &#x27;Centreon HA&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/health/centreon-agent/">Superviser la plateforme</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/releases/introduction/">Releases</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/security/">Sécurité</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/resources/known-issues/">Ressources</a></div></li></ul></nav><button type="button" title="Réduire le menu latéral" aria-label="Réduire le menu latéral" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Sur cette page</button></div><div class="theme-doc-markdown markdown"><header><h1>Comment écrire un Stream Connector</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="vue-densemble">Vue d&#x27;ensemble<a href="#vue-densemble" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">​</a></h2><p>Centreon Stream Connector est une fonction introduite dans Centreon 3.4.6. Elle permet d&#x27;exporter les données Centreon (événements et métriques) vers un stockage ou une application externe comme ElasticSearch, Splunk, InfluxDB, des fichiers, etc.</p><p>Dans une plateforme Centreon, le composant qui transporte les informations entre les collecteurs distants et le serveur central Centreon est appelé Centreon Broker. Ce broker stocke les données reçues dans le stockage local de Centreon : MariaDB et RRDtool.</p><p>Le schéma suivant explique le transfert des données collectées et leur insertion dans les stockages :</p><p><img loading="lazy" alt="image" src="data:image/png;base64,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" width="1229" height="417" class="img_ev3q"></p><p>La fonctionnalité Stream Connector est un nouvel output de Centreon Broker qui récupère les données de Centreon Broker Master (également connu sous le nom de Centreon Broker SQL) pour les agréger et les transmettre à un stockage externe.</p><p>Cet output charge un script Lua appelé un Stream Connector, dont la tâche consiste à traiter, agréger et enrichir les données avant de les transmettre au protocole défini :</p><p><img loading="lazy" alt="image" src="data:image/png;base64,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" width="716" height="407" class="img_ev3q"></p><p>Comme il s&#x27;agit d&#x27;un output de Centreon Broker, le principe de la création de fichiers de rétention lors de l&#x27;interruption de l&#x27;accès au stockage externe est conservé. De la même manière, il est possible de filtrer les entrées sur les catégories de flux à traiter.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prérequis">Prérequis<a href="#prérequis" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">​</a></h2><p>Pour utiliser la fonctionnalité Centreon Stream Connector, vous devez disposer au minimum de la version 3.4.6 de Centreon :</p><ul><li>Centreon Web &gt;= 2.8.18</li><li>Centreon Broker &gt;= 3.0.13</li><li>Lua &gt;= 5.1.x</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="création-dun-nouveau-script-lua">Création d&#x27;un nouveau script Lua<a href="#création-dun-nouveau-script-lua" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">​</a></h2><p>La documentation technique complète est disponible <a href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/developer/developer-broker-stream-connector/">ici</a>. Dans ce mode d&#x27;emploi, nous allons écrire deux scripts :</p><ul><li>Le premier, simple, qui explique les bases des Stream Connectors. Son objectif est d&#x27;exporter les données vers un fichier journal.</li><li>Le second est plus exigeant pour le lecteur, il exporte les données de performance vers la TSDB InfluxDB mais est facilement adaptable pour exporter vers une autre TSDB.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="migration-dun-stream-connector-de-bbdo2-vers-bbdo3">Migration d&#x27;un Stream Connector de BBDO 2 vers BBDO 3<a href="#migration-dun-stream-connector-de-bbdo2-vers-bbdo3" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">​</a></h2><p>La documentation technique de la migration est disponible <a href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/developer/developer-broker-stream-connector-migration/">ici</a>. Ce mode d&#x27;emploi donne plusieurs conseils pour réussir la migration et présente un petit exemple.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="langage-de-programmation">Langage de programmation<a href="#langage-de-programmation" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">​</a></h3><p>Centreon a choisi le langage de programmation Lua pour vous permettre de manipuler, d&#x27;agréger et de transférer des données. Lua est un langage de programmation facile à utiliser. De plus amples informations sont disponibles avec la <a href="https://www.lua.org/docs.html" target="_blank" rel="noopener noreferrer">Documentation officielle Lua</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="stockage-des-scripts-lua">Stockage des scripts Lua<a href="#stockage-des-scripts-lua" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">​</a></h3><p>Les scripts Lua de Broker peuvent être stockés dans tout répertoire lisible par l&#x27;utilisateur <strong>centreon-broker</strong>.</p><p>Nous recommandons de les stocker dans <strong>/usr/share/centreon-broker/lua</strong>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="écrire-toutes-les-informations-dans-un-fichier">Écrire toutes les informations dans un fichier<a href="#écrire-toutes-les-informations-dans-un-fichier" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="stocker-les-données-brutes">Stocker les données brutes<a href="#stocker-les-données-brutes" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">​</a></h4><p>Commençons par le premier script. Notre objectif est de stocker tous les événements donnés par Broker dans un fichier journal. Nous allons appeler notre Stream Connector <strong>bbdo2file.lua</strong>.</p><p>Comme nous l&#x27;avons dit précédemment, nous allons stocker ce fichier dans le répertoire <strong>/usr/share/centreon-broker/lua</strong> sur le serveur central Centreon.</p><p>Si le répertoire n&#x27;existe pas, en tant que root, nous pouvons le créer avec la commande suivante :</p><div class="language-Shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p /usr/share/centreon-broker/lua</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Centreon Broker propose plusieurs fonctions de journalisation pour écrire les journaux, les avertissements ou les erreurs dans un fichier. Nous utiliserons une de ces fonctions <em>info()</em> pour écrire les événements de Broker. <a href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/developer/developer-broker-stream-connector/#lobjet-broker_log">Consultez la documentation technique pour plus d&#x27;informations</a>.</p><p>La fonction <em>info()</em> fait partie de l&#x27;objet <em>broker<!-- -->_<!-- -->log</em>. Pour l&#x27;appeler, la syntaxe est la suivante :</p><div class="language-LUA codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-LUA codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">broker_log:info(level, text)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><em>level</em> est un nombre entier de 1 (le plus important) à 3 (le moins important).</li><li><em>text</em> est le texte à écrire comme journal.</li></ul><blockquote><p>Avez-vous remarqué que le séparateur entre <strong>broker<!-- -->_<!-- -->log</strong> et <strong>info</strong> est un double point ? Les fonctions des objets, aussi appelées <em>methods</em> sont appelées comme ceci en Lua.</p></blockquote><p>Commençons notre script. La fonction la plus importante dans un Stream Connector est la fonction <strong>write()</strong>. Chaque fois qu&#x27;un événement est reçu d&#x27;un collecteur via Broker, cette fonction est appelée avec l&#x27;événement comme argument.</p><blockquote><p>Vous n&#x27;aurez jamais à appeler la fonction <strong>write()</strong> par vous-même, c&#x27;est toujours à Broker de le faire. Et ce serait une erreur de faire un tel appel. En d&#x27;autres termes, il ne doit pas y avoir d&#x27;appel à la fonction <strong>write()</strong> dans votre script. <a href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/developer/developer-broker-stream-connector/#la-fonction-write">Consultez la documentation technique pour plus d&#x27;informations</a>.</p></blockquote><p>Voici la première version de <strong>bbdo2file.lua</strong> :</p><div class="language-LUA codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-LUA codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">function init(conf)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  broker_log:set_parameters(3, &quot;/var/log/centreon-broker/bbdo2file.log&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function write(d)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for k,v in pairs(d) do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    broker_log:info(3, k .. &quot; =&gt; &quot; .. tostring(v))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>Les informations sur l&#x27;initialisation de la fonction de journalisation du Broker et ses paramètres sont données ici : <a href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/developer/developer-broker-stream-connector/#lobjet-broker_log">consultez la documentation technique</a>.</p></blockquote><p>Expliquons ce que nous faisons dans ce script.</p><p>Nous devons fournir une fonction <strong>init()</strong>, elle est décrite dans la <a href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/developer/developer-broker-stream-connector/#lobjet-broker_log">documentation technique</a>.</p><p>Cette fonction est appelée pendant l&#x27;initialisation du Stream Connector. Ici, nous l&#x27;utilisons pour initialiser l&#x27;objet <strong>broker<!-- -->_<!-- -->log</strong>. Pour cela, nous appelons la méthode <strong>broker<!-- -->_<!-- -->log::set<!-- -->_<!-- -->parameters()</strong> qui nécessite deux paramètres :</p><ul><li>Un niveau max (de 1 à 3). Si vous indiquez 2 ici, seuls les journaux des niveaux 1 et 2 seront retournés.</li><li>Un fichier dans lequel écrire les journaux. Ce fichier doit se trouver dans un répertoire accessible en écriture pour l&#x27;utilisateur <strong>centreon-broker</strong>.</li></ul><p>La deuxième fonction est la fonction <strong>write()</strong>. Nous avons déjà dit que son argument est un événement de Broker. Ce type d&#x27;objet est une collection de clés/valeurs. Par exemple :</p><div class="language-JSON codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-JSON codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;check_hosts_freshness&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;active_host_checks&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;category&quot;: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;event_handlers&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;instance_id&quot;: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;last_command_check&quot;: 1522836592,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;type&quot;: 65552,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;global_service_event_handler&quot;: &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;obsess_over_services&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;passive_service_checks&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;last_alive&quot;: 1522836593,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;active_service_checks&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;check_services_freshness&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;flap_detection&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;global_host_event_handler&quot;: &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;notifications&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;obsess_over_hosts&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;passive_host_checks&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;element&quot;: 16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Tous les événements comprennent les valeurs <em>category</em>, <em>element</em> et <em>type</em>.</p><ul><li>Les informations sur la <em>catégorie</em> se trouvent <a href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/developer/developer-broker-bbdo/#cat%C3%A9gories-d%C3%A9v%C3%A9nements">dans la documentation bbdo</a>.</li><li>L’<em>élément</em> est la <em>sous-catégorie</em> (également appelé <em>type</em> dans la documentation bbdo).</li><li>Le <em>type</em> est un nombre dérivé de la <em>catégorie</em> et l’<em>élément</em> (concaténation binaire).</li></ul><p>Dans cet exemple, la <em>catégorie</em> est 1 et l’<em>élément</em> est 16. Ainsi, en lisant la documentation, nous pouvons dire que cet événement est un événement NEB avec la sous-catégorie <em>instance-status</em>.</p><p>Pour terminer avec la fonction <strong>write()</strong>, nous faisons une boucle sur les paramètres de l&#x27;événement <strong>d</strong>. Pour chaque étape, <em>k</em> est une clé et <em>v</em> est la valeur correspondante. Et nous envoyons au fichier journal une chaîne <code>k .. &quot; =&gt; &quot; .. tostring(v)</code> qui signifie la <em>concaténation</em>  de <em>k</em>, <em>\=&gt;</em> et <em>v</em>  convertie en une chaîne de caractères. Voici un exemple du résultat ci-dessous.</p><p>Une autre possibilité serait d&#x27;utiliser la fonction <strong>broker.json<!-- -->_<!-- -->encode(d)</strong> qui convertit tout objet Lua en une représentation de chaîne <em>json</em> de celui-ci. Ainsi, nous pourrions écrire la fonction comme ceci :</p><div class="language-LUA codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-LUA codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">function write(d)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  broker_log:info(3, broker.json_encode(d))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>On constate que <strong>broker.json<!-- -->_<!-- -->encode(d)</strong> est composé de <strong>broker</strong> et <strong>json<!-- -->_<!-- -->encode(d)</strong> séparés par un <em>point</em> et non un <em>double point</em>. C&#x27;est parce que <strong>broker</strong> n&#x27;est pas un objet Lua. En fait, vous pouvez le voir comme un ensemble de fonctions fournies par <em>Centreon Broker</em>.</p></blockquote><p>Une fois que votre fichier <strong>/usr/share/centreon-broker/lua/bbdo2file.lua</strong> est prêt, vérifiez qu&#x27;il est lisible par l&#x27;utilisateur <strong>centreon-broker</strong> (ou l&#x27;utilisateur <strong>centreon-engine</strong> qui est le propriétaire du groupe <strong>centreon-broker</strong>), si ce n&#x27;est pas le cas, en tant que root vous pouvez entrer :</p><div class="language-Shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">chown centreon-engine:centreon-engine /usr/share/centreon-broker/lua/bbdo2file.lua</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Ensuite, configurez le nouvel output dans l&#x27;interface Web Centreon dans <strong>Configuration &gt; Collecteurs &gt; Configuration de Centreon Broker &gt; Central Broker</strong>. Dans l’onglet <strong>Output</strong>, sélectionnez <strong>Generic – Stream connector</strong>, puis cliquez sur <strong>Ajouter</strong> :</p><p><img loading="lazy" alt="image" src="/centreon-documentation/pr-preview/staging/pr-2806/fr/assets/images/add_stream_connector-9dbda93bfb72888e2127dfe5b44af843.png" width="857" height="256" class="img_ev3q"></p><p>Définissez le nom de cet output et le chemin vers le connecteur Lua :</p><p><img loading="lazy" alt="image" src="/centreon-documentation/pr-preview/staging/pr-2806/fr/assets/images/describe_output-55b0682c8a216a183d11f3acb92bf2f8.png" width="1017" height="487" class="img_ev3q"></p><p>Cliquez ensuite sur <strong>Sauvegarder</strong> et générez la configuration, puis redémarrez <strong>cbd</strong>.</p><p>Une fois que le Centreon Broker sera redémarré sur votre serveur central Centreon, les données apparaîtront dans votre fichier journal <strong>/var/log/centreon-broker/bbdo2file.log</strong> :</p><div class="language-Shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mer. 28 mars 2018 14:27:35 CEST: INFO: flap_detection =&gt; true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mer. 28 mars 2018 14:27:35 CEST: INFO: enabled =&gt; true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mer. 28 mars 2018 14:27:35 CEST: INFO: host_id =&gt; 102</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mer. 28 mars 2018 14:27:35 CEST: INFO: last_time_ok =&gt; 1522240053</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mer. 28 mars 2018 14:27:35 CEST: INFO: state =&gt; 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mer. 28 mars 2018 14:27:35 CEST: INFO: last_update =&gt; 1522240054</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mer. 28 mars 2018 14:27:35 CEST: INFO: last_check =&gt; 1522240053</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mer. 28 mars 2018 14:27:35 CEST: INFO: execution_time =&gt; 0.005025</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mer. 28 mars 2018 14:27:35 CEST: INFO: acknowledged =&gt; false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mer. 28 mars 2018 14:27:35 CEST: INFO: service_id =&gt; 778</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mer. 28 mars 2018 14:27:35 CEST: INFO: active_checks =&gt; true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mer. 28 mars 2018 14:27:35 CEST: INFO: notify =&gt; false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mer. 28 mars 2018 14:27:35 CEST: INFO: max_check_attempts =&gt; 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mer. 28 mars 2018 14:27:35 CEST: INFO: obsess_over_service =&gt; true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mer. 28 mars 2018 14:27:35 CEST: INFO: check_type =&gt; 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mer. 28 mars 2018 14:27:35 CEST: INFO: last_hard_state_change =&gt; 1522165654</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mer. 28 mars 2018 14:27:35 CEST: INFO: category =&gt; 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mer. 28 mars 2018 14:27:35 CEST: INFO: perfdata =&gt; used=41986296644o;48103633715;54116587930;0;60129542144 size=60129542144o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mer. 28 mars 2018 14:27:35 CEST: INFO: check_interval =&gt; 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mer. 28 mars 2018 14:27:35 CEST: INFO: output =&gt; Disk /var - used : 39.10 Go - size : 56.00 Go - percent : 69 %</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mer. 28 mars 2018 14:27:35 CEST: INFO: check_command =&gt; check-bench-disk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mer. 28 mars 2018 14:27:35 CEST: INFO: check_period =&gt; 24x7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mer. 28 mars 2018 14:27:35 CEST: INFO: type =&gt; 65560</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mer. 28 mars 2018 14:27:35 CEST: INFO: last_hard_state =&gt; 0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>Ce fichier journal va grossir rapidement, n&#x27;oubliez pas d&#x27;ajouter une rotation du journal.</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="utiliser-les-paramètres">Utiliser les paramètres<a href="#utiliser-les-paramètres" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">​</a></h4><p>Les fonctions de journalisation de Centreon Broker ne doivent être utilisées que pour la journalisation. Pour écrire dans un fichier, nous devons utiliser la fonction dédiée de Lua. En outre, il est possible d&#x27;utiliser des paramètres pour définir le nom du fichier journal.</p><p>Il est donc temps d&#x27;améliorer notre Stream Connector :</p><div class="language-LUA codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-LUA codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">function init(conf)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  logFile = conf[&#x27;logFile&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  broker_log:set_parameters(3, &quot;/var/log/centreon-broker/debug.log&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function writeIntoFile(output)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local file,err = io.open(logFile, &#x27;a&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if file == nil then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    broker_log:info(3, &quot;Couldn&#x27;t open file: &quot; .. err)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file:write(output)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file:close()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function write(d)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for k,v in pairs(d) do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    writeIntoFile(k .. &quot; =&gt; &quot; .. tostring(v) .. &quot;\n&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Avez-vous remarqué l&#x27;expression <code>local file,err = io.open(logFile, &#x27;a&#x27;)</code> ?</p><p>Lua est capable de stocker plusieurs variables en même temps. En outre, les fonctions Lua peuvent retourner plusieurs variables.</p><p>Par exemple, si vous voulez échanger les variables <em>a</em> et <em>b</em>, vous pouvez entrer :</p><div class="language-LUA codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-LUA codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">a, b = b, a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Un autre exemple qui illustre plusieurs valeurs retournées :</p><div class="language-LUA codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-LUA codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">function fib(a, b)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return b, a + b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Ainsi, cet appel à <strong>io.open</strong> renvoie deux variables, une première variable <strong>file</strong> qui est un <em>descripteur de fichier</em> utilisé pour accéder au fichier et une seconde variable pas toujours définie qui contient l&#x27;erreur s&#x27;il y en a une ou <strong>nil</strong> (non défini) sinon.</p><p>La fonction <strong>init()</strong> permet d&#x27;obtenir des paramètres et de les définir à partir de l&#x27;interface web Centreon. Consultez la documentation technique pour plus d&#x27;informations. Ici, nous ajoutons la possibilité de choisir le nom du fichier de destination. La table <strong>conf</strong> possède une clé <em>logFile</em> définie dans l&#x27;interface web. La valeur correspondante est le nom du fichier utilisé pour stocker les événements.</p><p>Modifiez votre output Broker pour déclarer ce paramètre :</p><p><img loading="lazy" alt="image" src="/centreon-documentation/pr-preview/staging/pr-2806/fr/assets/images/add_parameter-8c1830a70f2c5ade64633b80306ad8c3.png" width="964" height="388" class="img_ev3q"></p><p>Il est important que le nom du paramètre dans l&#x27;interface web corresponde au nom de la clé dans la table <strong>conf</strong>. Il s’agit ici de <em>logFile</em>.</p><p>Cliquez ensuite sur <strong>Sauvegarder</strong> et générez la configuration, puis redémarrez <strong>cbd</strong>.</p><p>Les données sont stockées dans le fichier journal <strong>/var/log/centreon-broker/bbdo2file.log</strong> comme ceci :</p><div class="language-Shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">name =&gt; error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category =&gt; 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">interval =&gt; 300</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rrd_len =&gt; 3456000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">value =&gt; 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">value_type =&gt; 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type =&gt; 196612</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ctime =&gt; 1522315660</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">index_id =&gt; 4880</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">element =&gt; 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">state =&gt; 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">category =&gt; 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">interval =&gt; 300</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rrd_len =&gt; 3456000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">is_for_rebuild =&gt; false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service_id =&gt; 1056</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type =&gt; 196609</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ctime =&gt; 1522315660</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">host_id =&gt; 145</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">element =&gt; 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">is_for_rebuild =&gt; false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metric_id =&gt; 11920</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="manipuler-les-données">Manipuler les données<a href="#manipuler-les-données" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">​</a></h4><p>Ici, nous continuons à améliorer notre Stream Connector en choisissant les événements à exporter et aussi en améliorant les outputs.</p><p>Nous ne retiendrons que la catégorie NEB et les événements concernant le statut des hôtes et des services.</p><p>Nous savons que NEB est la catégorie 1, que le statut du service est la sous-catégorie 24, et que le statut de l&#x27;hôte est la sous-catégorie 14.</p><p>Donc, seuls les événements répondant aux critères suivants nous intéressent :</p><ul><li>catégorie = 1</li><li>élément = 14 ou élément = 24</li></ul><p>De plus, nous préférerions avoir un nom d&#x27;hôte au lieu d&#x27;un ID d&#x27;hôte et une description de service au lieu d&#x27;un ID de service.</p><p>Enfin, nous aimerions obtenir des informations sur le statut et les outputs.</p><p>Les événements NEB avec les éléments 14 et 24 nous donnent presque toutes les informations que nous voulons sauf les noms d&#x27;hôtes et les descriptions de services.</p><p>Pour obtenir ces deux informations, nous devrons utiliser l&#x27;objet <strong>broker<!-- -->_<!-- -->cache</strong>. Celui-ci est rempli lorsque les collecteurs sont redémarrés ou rechargés. Donc, n&#x27;oubliez pas de redémarrer vos collecteurs si vous voulez avoir quelque chose dans votre objet <strong>broker<!-- -->_<!-- -->cache</strong> !</p><p>Si le cache est bien rempli, il est facile d&#x27;obtenir un nom d&#x27;hôte à partir de l&#x27;ID d&#x27;hôte :</p><div class="language-LUA codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-LUA codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">broker_cache:get_hostname(host_id)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Il est également facile d&#x27;obtenir la description du service à partir de l&#x27;ID d&#x27;hôte et de l&#x27;ID de service :</p><div class="language-LUA codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-LUA codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">broker_cache:get_service_description(host_id, service_id)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Pour installer le filtre sur les événements, il existe une fonction utile appelée <strong>filter()</strong> qui prend en compte deux paramètres : <em>category</em>, <em>element</em>.</p><p>Cette fonction, si elle est définie, est appelée juste avant <strong>write()</strong>. Si elle retourne <strong>true</strong>, la fonction <strong>write()</strong> sera appelée, sinon, l&#x27;événement sera rejeté.</p><p>Complétons notre script Lua :</p><div class="language-LUA codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-LUA codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">function init(conf)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  logFile = conf[&#x27;logFile&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  broker_log:set_parameters(3, &quot;/var/log/centreon-broker/debug.log&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">local function writeIntoFile(output)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local file,err = io.open(logFile, &#x27;a&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if file == nil then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    broker_log:info(3, &quot;Couldn&#x27;t open file: &quot; .. err)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file:write(output)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file:close()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function write(d)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local output = &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local host_name = broker_cache:get_hostname(d.host_id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if not host_name then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    broker_log:info(3, &quot;Unable to get name of host, please restart centengine&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    host_name = d.host_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if d.element == 14 then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output = &quot;HOST:&quot; .. host_name .. &quot;;&quot; .. d.host_id .. &quot;;&quot; .. d.state .. &quot;;&quot; .. d.output</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    writeIntoFile(output)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    broker_log:info(output)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  elseif d.element == 24 then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    local service_description = broker_cache:get_service_description(d.host_id, d.service_id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if not service_description then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      broker_log:info(3, &quot;Unable to get description of service, please restart centengine&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      service_description = d.service_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output = &quot;SERVICE:&quot; .. host_name .. &quot;;&quot; .. d.host_id .. &quot;;&quot; .. service_description .. &quot;;&quot; .. d.service_id .. &quot;;&quot; .. d.state .. &quot;;&quot; .. d.output</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    writeIntoFile(output)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    broker_log:info(output)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function filter(category, element)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -- Get only host status and services status from NEB category</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if category == 1 and (element == 14 or element == 24) then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Juste quelques remarques sur ce nouveau script avant de montrer ce que nous obtenons.</p><p>Dans la fonction <strong>init()</strong>, nous accédons à la clé <em>logFile</em> dans la table <em>conf</em> en utilisant <code>conf[&#x27;logFile&#x27;]</code>. Tandis que dans la fonction <strong>write()</strong>, nous accédons à la clé <em>element</em> dans la table <em>d</em> en utilisant <code>d.element</code>.</p><p>En fait, les deux syntaxes sont autorisées : <code>d.element</code> est la même valeur que <code>d[&#x27;element&#x27;]</code>.</p><p>Autre remarque, dans la fonction <strong>write()</strong>, on peut voir quelque chose comme :</p><div class="language-LUA codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-LUA codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if not host_name then</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Et dans la fonction <strong>writeIntoFile()</strong>, on peut voir que :</p><div class="language-LUA codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-LUA codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if file == nil then</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Les deux syntaxes ont-elles la même signification ? Où est la différence ?</p><p>Vous devez savoir qu&#x27;en Lua, une variable est considérée comme <strong>true</strong> si elle est définie et non <strong>false</strong> :</p><p>Ainsi, le code suivant</p><div class="language-LUA codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-LUA codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if foo then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  print(&quot;Good&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  print(&quot;Bad&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>écrira <em>Good</em> si <em>foo</em> est défini et n&#x27;a pas une valeur <strong>false</strong>. Plus précisément, il écrira <em>Good</em> dans les cas suivants :</p><ul><li>foo=12</li><li>foo=true</li><li>foo=&quot;Une chaîne&quot;</li><li>foo=0 (surprenant !)</li></ul><p>Il écrira <em>Bad</em> dans les cas suivants :</p><ul><li>foo=nil (par défaut, une variable est nil, ce qui signifie non définie)</li><li>foo=false</li></ul><p>Le fichier <strong>/var/log/centreon-broker/bbdo2file.log</strong> contiendra désormais :</p><div class="language-Shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">HOST:srv-DC-djakarta;215;0;OK - srv-DC-djakarta: rta 0.061ms, lost 0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVICE:mail-titan-gateway;92;disk-/usr;623;0;Disk /usr - used : 42.98 Go - size : 142.00 Go - percent : 30 %</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVICE:mail-sun-master;87;memory-stats;535;0;Memory usage (Total 13.0GB): 0.12GB [buffer:0.00GB] [cache:0.01GB] [pages_tables:0.00GB] [mapped:0.00GB] [active:0.07GB] [inactive:0.00GB] [apps:0.02GB] [unused:12.88GB]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVICE:mail-saturn-frontend;86;traffic-eth1;512;0;Traffic In : 4.73 Mb/s (4.73 %), Out : 4.79 Mb/s (4.79 %) - Total RX Bits In : 396.01 Gb, Out : 393.88 Gb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVICE:mail-saturn-frontend;86;memory-stats;515;0;Memory usage (Total 16.0GB): 8.89GB [buffer:0.43GB] [cache:0.95GB] [pages_tables:0.27GB] [mapped:0.15GB] [active:3.92GB] [inactive:0.29GB] [apps:2.88GB] [unused:7.11GB]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVICE:mail-neptune-frontend;80;traffic-eth1;392;0;Traffic In : 4.82 Mb/s (4.82 %), Out : 6.48 Mb/s (6.48 %) - Total RX Bits In : 398.40 Gb, Out : 396.44 Gb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HOST:srv-DC-casablanca;207;0;OK - srv-DC-casablanca: rta 2.042ms, lost 0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVICE:mail-neptune-frontend;80;memory-stats;395;0;Memory usage (Total 9.0GB): 0.54GB [buffer:0.03GB] [cache:0.00GB] [pages_tables:0.01GB] [mapped:0.00GB] [active:0.48GB] [inactive:0.00GB] [apps:0.01GB] [unused:8.46GB]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVICE:mail-mercury-frontend;82;traffic-eth1;432;0;Traffic In : 8.28 Mb/s (8.28 %), Out : 1.23 Mb/s (1.23 %) - Total RX Bits In : 397.71 Gb, Out : 400.34 Gb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVICE:mail-mercury-frontend;82;memory-stats;435;0;Memory usage (Total 12.0GB): 1.58GB [buffer:0.00GB] [cache:0.63GB] [pages_tables:0.00GB] [mapped:0.00GB] [active:0.75GB] [inactive:0.00GB] [apps:0.19GB] [unused:10.42GB]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVICE:mail-mars-frontend;84;traffic-eth1;472;0;Traffic In : 7.24 Mb/s (7.24 %), Out : 3.36 Mb/s (3.36 %) - Total RX Bits In : 399.93 Gb, Out : 395.67 Gb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVICE:mail-mars-frontend;84;memory-stats;475;0;Memory usage (Total 3.0GB): 1.19GB [buffer:0.01GB] [cache:0.59GB] [pages_tables:0.00GB] [mapped:0.00GB] [active:0.15GB] [inactive:0.04GB] [apps:0.39GB] [unused:1.81GB]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVICE:mail-jupiter-frontend;85;traffic-eth1;492;0;Traffic In : 1.41 Mb/s (1.41 %), Out : 9.08 Mb/s (9.08 %) - Total RX Bits In : 388.86 Gb, Out : 394.85 Gb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVICE:mail-jupiter-frontend;85;memory-stats;495;0;Memory usage (Total 12.0GB): 0.57GB [buffer:0.04GB] [cache:0.23GB] [pages_tables:0.02GB] [mapped:0.02GB] [active:0.07GB] [inactive:0.03GB] [apps:0.16GB] [unused:11.43GB]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVICE:mail-io-backend;88;traffic-eth1;547;0;Traffic In : 1.51 Mb/s (1.51 %), Out : 7.12 Mb/s (7.12 %) - Total RX Bits In : 389.61 Gb, Out : 390.54 Gb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERVICE:mail-io-backend;88;diskio-system;551;0;Device /dev/sda: avg read 4.78 (MB/s) and write 9.08 (MB/s)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="exporter-les-données-de-performance-vers-influxdb">Exporter les données de performance vers InfluxDB<a href="#exporter-les-données-de-performance-vers-influxdb" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">​</a></h2><p>Vous avez déjà appris beaucoup de choses sur les Stream Connectors. Il est temps de créer quelque chose de plus utile !</p><p><a href="https://www.influxdata.com/" target="_blank" rel="noopener noreferrer">InfluxDB</a> est une base de données de séries chronologiques (TSDB) Nous utiliserons ce stockage pour insérer les données de performance collectées par la plateforme Centreon. Pour cet exemple, nous allons utiliser le <a href="https://hub.docker.com/_/influxdb/" target="_blank" rel="noopener noreferrer">InfluxDB Docker</a> prédéfini.</p><p>Pour envoyer des données à InfluxDB, nous avons besoin de paramètres pour accéder au stockage InfluxDB :</p><ul><li><strong>http<!-- -->_<!-- -->server<!-- -->_<!-- -->address</strong> : adresse IP du stockage</li><li><strong>http<!-- -->_<!-- -->server<!-- -->_<!-- -->port</strong>: 8086 par défaut</li><li><strong>http<!-- -->_<!-- -->server<!-- -->_<!-- -->protocol</strong> : HTTP ou HTTPS</li><li><strong>influx<!-- -->_<!-- -->database</strong>: nom de la base de données</li><li><strong>influx<!-- -->_<!-- -->user</strong> : utilisateur qui accèdera à la base de données si défini</li><li><strong>influx<!-- -->_<!-- -->password</strong> : mot de passe de l&#x27;utilisateur qui accèdera à la base de données si défini</li></ul><p>Afin de ne pas saturer le stockage, nous ajouterons tous les événements dans une file d&#x27;attente et une fois que sa taille maximale sera atteinte, nous enverrons les données en vrac.</p><p>Nous devons définir la taille de la file d&#x27;attente et le délai maximal avant l&#x27;envoi des événements :</p><ul><li>max<!-- -->_<!-- -->buffer<!-- -->_<!-- -->size</li><li>max<!-- -->_<!-- -->buffer<!-- -->_<!-- -->age</li></ul><p>Pour créer cette file d&#x27;attente, nous introduisons un code un peu plus compliqué. Nous créons un objet <strong>event<!-- -->_<!-- -->queue</strong>. Il est composé de paramètres tels que <em>events</em>, <em>influx<!-- -->_<!-- -->database</em> et des méthodes telles que <em>new()</em>, <em>add()</em>.</p><p>Pour comprendre comment créer un tel objet en Lua, nous recommandons la documentation Lua <a href="https://www.lua.org/pil/16.1.html" target="_blank" rel="noopener noreferrer">pour les classes</a> et <a href="https://www.lua.org/pil/13.html" target="_blank" rel="noopener noreferrer">pour les métatables</a>.</p><p>Pour envoyer des données à un serveur, nous fournissons un objet <strong>broker<!-- -->_<!-- -->tcp<!-- -->_<!-- -->socket</strong>.</p><p>Son API est très simple. Ce <em>socket</em> est un socket TCP, il ne prend pas en charge le chiffrement et il peut être délicat d&#x27;envoyer des données en HTTP. Voici un exemple :</p><div class="language-LUA codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-LUA codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- Here, we create our socket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">local socket = broker_tcp_socket.new()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- We establish the connection with the server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">socket:connect(address, port)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Now, we can send data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">socket:write(&quot;This is a text to send&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- If, we want an answer, we also have a function to read</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">local content = socket:read()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- When exchanges are finished, we can close the socket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">socket:close()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Dans notre cas, nous n&#x27;utilisons pas <strong>broker<!-- -->_<!-- -->tcp<!-- -->_<!-- -->socket</strong> en raison de ses limitations. Nous voulons être en mesure d&#x27;envoyer des données à un serveur HTTPS.</p><p>Un prérequis est d&#x27;installer la <a href="http://w3.impa.br/~diego/software/luasocket/" target="_blank" rel="noopener noreferrer">bibliothèque lua-socket</a>. Cette bibliothèque fournit plusieurs fonctionnalités, nous avons besoin de deux d&#x27;entre elles :</p><ul><li>socket http</li><li>ltn12</li></ul><p>Pour y accéder, Lua fournit la fonction <strong>require</strong>.</p><p>Introduisons le début de notre nouveau Stream Connector.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="les-paramètres-de-la-file-dattente">Les paramètres de la file d&#x27;attente<a href="#les-paramètres-de-la-file-dattente" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">​</a></h3><div class="language-LUA codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-LUA codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- We declare the objects to import here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">local http = require(&quot;socket.http&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">local ltn12 = require(&quot;ltn12&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Here are predefined queue parameters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">local event_queue = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  __internal_ts_last_flush    = nil,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  http_server_address         = &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  http_server_port            = 8086,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  http_server_protocol        = &quot;http&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  events                      = {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  influx_database             = &quot;mydb&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  influx_user                 = &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  influx_password             = &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  max_buffer_size             = 5000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  max_buffer_age              = 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Dans ce tableau, nous donnons des valeurs par défaut aux paramètres qui peuvent éventuellement être modifiés lors de l&#x27;appel <strong>init()</strong>. Cette table sera utilisée pour stocker des données importantes pour le script et est également notre objet de file d&#x27;attente.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="une-méthode-pour-créer-la-file-dattente">Une méthode pour créer la file d&#x27;attente<a href="#une-méthode-pour-créer-la-file-dattente" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">​</a></h3><p>Pour déclarer cette table comme un objet Lua, nous avons besoin d&#x27;un constructeur. Le voici :</p><div class="language-LUA codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-LUA codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- Constructor of the event_queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function event_queue:new(o, conf)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  o = o or {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  setmetatable(o, self)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  self.__index = self</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for i,v in pairs(conf) do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if self[i] and i ~= &quot;events&quot; and string.sub(i, 1, 11) ~= &quot;__internal_&quot; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    broker_log:info(1, &quot;event_queue:new: getting parameter &quot; .. i .. &quot; =&gt; &quot; .. v)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self[i] = v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    broker_log:warning(1, &quot;event_queue:new: ignoring parameter &quot; .. i .. &quot; =&gt; &quot; .. v)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  self.__internal_ts_last_flush = os.time()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  broker_log:info(2, &quot;event_queue:new: setting the internal timestamp to &quot; .. self.__internal_ts_last_flush)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>Dans cette fonction, nous utilisons une astuce Lua « o = o ou {} » qui signifie que <em>o</em> reste le même s&#x27;il est <strong>true</strong>, sinon il est affecté d&#x27;un tableau vide <code>{}</code>.</p><p>Un autre point à noter est l&#x27;opérateur <strong>~=</strong> qui signifie <strong>différent de</strong>.</p><p>Et pour finir sur cette fonction, la variable <strong>self</strong> est implicitement définie lorsque nous déclarons la méthode d&#x27;un objet. Sa signification est la même que celle de <strong>this</strong> en Java ou en C++. Elle représente l&#x27;objet sur lequel nous travaillons.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="une-méthode-pour-ajouter-un-événement-dans-la-file-dattente">Une méthode pour ajouter un événement dans la file d&#x27;attente<a href="#une-méthode-pour-ajouter-un-événement-dans-la-file-dattente" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">​</a></h3><p>Nous avons un objet de file d&#x27;attente. Ce serait formidable de l&#x27;utiliser comme ceci :</p><div class="language-LUA codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-LUA codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- We construct it</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">local queue = event_queue:new(nil, conf)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- We add an event to it</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">queue:add(event)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- When the queue is full, we would like to do something like this</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">queue:flush()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>C&#x27;est parti ! Ci-dessous, nous présentons une méthode <strong>add()</strong> qui récupère un nom d&#x27;hôte et une description de service dans le cache, crée une chaîne à partir de l&#x27;événement et la place sur sa pile.</p><div class="language-LUA codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-LUA codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">function event_queue:add(e)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local metric = e.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -- time is a reserved word in influxDB so I rename it</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if metric == &quot;time&quot; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metric = &quot;_&quot; .. metric</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -- retrieve objects names instead of IDs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local host_name = broker_cache:get_hostname(e.host_id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local service_description = broker_cache:get_service_description(e.host_id, e.service_id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -- what if we could not get them from cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if not host_name then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    broker_log:warning(1, &quot;event_queue:add: host_name for id &quot; .. e.host_id .. &quot; not found. Restarting centengine should fix this.&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    host_name = e.host_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if not service_description then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    broker_log:warning(1, &quot;event_queue:add: service_description for id &quot; .. e.host_id .. &quot;.&quot; .. e.service_id .. &quot; not found. Restarting centengine should fix this.&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service_description = e.service_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service_description = service_description:gsub(&quot; &quot;, &quot;_&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -- we finally append the event to the events table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  metric = metric:gsub(&quot; &quot;, &quot;_&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  broker_log:info(3, &#x27;event_queue:add: adding  &#x27; .. service_description .. &quot;,host=&quot; .. host_name .. &quot; &quot; .. metric .. &quot;=&quot; .. e.value .. &quot; &quot; .. e.ctime .. &#x27;000000000&quot; to event list.&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  self.events[#self.events + 1] = service_description .. &quot;,host=&quot; .. host_name .. &quot; &quot; .. metric .. &quot;=&quot; .. e.value .. &quot; &quot; .. e.ctime .. &quot;000000000\n&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -- then we check whether it is time to send the events to the receiver and flush</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if #self.events &gt;= self.max_buffer_size then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    broker_log:info(2, &quot;event_queue:add: flushing because buffer size reached &quot; .. self.max_buffer_size .. &quot; elements.&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self:flush()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  elseif os.time() - self.__internal_ts_last_flush &gt;= self.max_buffer_age then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    broker_log:info(2, &quot;event_queue:add: flushing &quot; .. #self.events .. &quot; elements because buffer age reached &quot; .. (os.time() - self.__internal_ts_last_flush) .. &quot;s and max age is &quot; .. self.max_buffer_age .. &quot;s.&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self:flush()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="une-méthode-pour-vider-la-file-dattente">Une méthode pour vider la file d&#x27;attente<a href="#une-méthode-pour-vider-la-file-dattente" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">​</a></h3><p>Une fois les événements ajoutés dans la file d&#x27;attente et la taille maximale de la file ou le délai d&#x27;attente atteint, les événements seront envoyés au stockage InfluxDB.</p><p>Cette fonction crée des données à partir de la file d&#x27;attente et les envoie au stockage. Si une erreur se produit, elle introduit une erreur dans le journal.</p><p>C&#x27;est ici que nous utilisons les objets <strong>http</strong> et <strong>ltn12</strong> chargés au début du script.</p><div class="language-LUA codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-LUA codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  function event_queue:flush()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    broker_log:info(2, &quot;event_queue:flush: Concatenating all the events as one string&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --  we concatenate all the events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    local http_post_data = &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    local http_result_body = {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for i, raw_event in ipairs(self.events) do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      http_post_data = http_post_data .. raw_event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    broker_log:info(2, &#x27;event_queue:flush: HTTP POST request &quot;&#x27; .. self.http_server_protocol .. &quot;://&quot; .. self.http_server_address .. &quot;:&quot; .. self.http_server_port .. &quot;/write?db=&quot; .. self.influx_database .. &#x27;&quot;&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    broker_log:info(3, &quot;event_queue:flush: HTTP POST data are: &#x27;&quot; .. http_post_data .. &quot;&#x27;&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -- build url</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    local influxdb_url = self.http_server_protocol .. &quot;://&quot; .. self.http_server_address .. &quot;:&quot; .. self.http_server_port .. &quot;/write?db=&quot; .. self.influx_database</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -- add authentication if needed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if string.len(self.influx_user) &gt;= 1 and string.len(self.influx_password) &gt;= 1 then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      influxdb_url = influxdb_url .. &quot;&amp;u=&quot; .. self.influx_user .. &quot;&amp;p=&quot;..self.influx_password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    local hr_result, hr_code, hr_header, hr_s = http.request{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      url = influxdb_url,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      method = &quot;POST&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      -- sink is where the request result&#x27;s body will go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      sink = ltn12.sink.table(http_result_body),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      -- request body needs to be formatted as a LTN12 source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      source = ltn12.source.string(http_post_data),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      headers = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -- mandatory for POST request with body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [&quot;content-length&quot;] = string.len(http_post_data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -- Handling the return code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if hr_code == 204 then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      broker_log:info(2, &quot;event_queue:flush: HTTP POST request successful: return code is &quot; .. hr_code)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      broker_log:error(1, &quot;event_queue:flush: HTTP POST request FAILED: return code is &quot; .. hr_code)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      for i, v in ipairs(http_result_body) do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        broker_log:error(1, &quot;event_queue:flush: HTTP POST request FAILED: message line &quot; .. i .. &#x27; is &quot;&#x27; .. v .. &#x27;&quot;&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -- now that the data has been sent, we empty the events array</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self.events = {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -- and update the timestamp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self.__internal_ts_last_flush = os.time()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="la-fonction-init-pour-obtenir-les-paramètres-et-créer-la-file-dattente">La fonction init() pour obtenir les paramètres et créer la file d&#x27;attente<a href="#la-fonction-init-pour-obtenir-les-paramètres-et-créer-la-file-dattente" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">​</a></h3><p>Dans ce cas, la fonction <strong>init()</strong> crée la file d&#x27;attente avec les paramètres définis par les utilisateurs dans l&#x27;interface web ou utilise les paramètres par défaut déjà définis dans la file d&#x27;attente. Cette alternative est gérée par le constructeur de la file d&#x27;attente.</p><div class="language-LUA codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-LUA codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  function init(conf)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    broker_log:set_parameters(1, &quot;/var/log/centreon-broker/stream-connector-influxdb.log&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    broker_log:info(2, &quot;init: Beginning init() function&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    queue = event_queue:new(nil, conf)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    broker_log:info(2, &quot;init: Ending init() function, Event queue created&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><strong>queue</strong> n&#x27;est pas définie comme locale, ceci est important pour qu&#x27;elle soit accessible depuis toutes les fonctions.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="la-fonction-write-pour-insérer-les-événements-dans-la-file-dattente">La fonction write() pour insérer les événements dans la file d&#x27;attente<a href="#la-fonction-write-pour-insérer-les-événements-dans-la-file-dattente" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">​</a></h3><p>La fonction <strong>write()</strong> est uniquement utilisée pour insérer des événements filtrés dans la file d&#x27;attente :</p><div class="language-LUA codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-LUA codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  function write(e)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    broker_log:info(3, &quot;write: Beginning write() function&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    queue:add(e)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    broker_log:info(3, &quot;write: Ending write() function\n&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="la-fonction-filter-pour-sélectionner-uniquement-les-événements-de-données-de-performance">La fonction filter() pour sélectionner uniquement les événements de données de performance<a href="#la-fonction-filter-pour-sélectionner-uniquement-les-événements-de-données-de-performance" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">​</a></h3><p>Pour sélectionner uniquement les données de performance, nous devons sélectionner la catégorie 3 (« Storage ») et l&#x27;<em>element</em> 1 pour <em>metric</em> :</p><div class="language-LUA codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-LUA codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  function filter(category, element)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if category == 3 and element == 1 then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="script-complet">Script complet<a href="#script-complet" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">​</a></h3><p>Le script complet peut être téléchargé <a href="https://github.com/centreon/centreon-stream-connector-scripts/blob/master/centreon-certified/influxdb/influxdb-metrics-apiv1.lua" target="_blank" rel="noopener noreferrer">ici</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configurer-centreon-broker">Configurer Centreon Broker<a href="#configurer-centreon-broker" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">​</a></h3><p>Configurez le nouvel output dans l&#x27;interface Web Centreon dans <strong>Configuration &gt; Collecteurs &gt; Configuration de Centreon Broker &gt; Central Broker</strong>. Dans l’onglet <strong>Output</strong>, sélectionnez <strong>Generic – Stream connector</strong>, puis cliquez sur <strong>Ajouter</strong> :</p><p><img loading="lazy" alt="image" src="/centreon-documentation/pr-preview/staging/pr-2806/fr/assets/images/add_stream_connector-9dbda93bfb72888e2127dfe5b44af843.png" width="857" height="256" class="img_ev3q"></p><p>Définissez le nom de cet output et le chemin vers le connecteur Lua :</p><p><img loading="lazy" alt="image" src="/centreon-documentation/pr-preview/staging/pr-2806/fr/assets/images/broker_influxdb_output-a3dd2f65fbef135148c1d4b342d082f7.png" width="1886" height="1358" class="img_ev3q"></p><p>Cliquez ensuite sur <strong>Sauvegarder</strong> et générez la configuration, puis redémarrez <strong>cbd</strong>.</p><blockquote><p>N&#x27;oubliez pas de redémarrer également « centengine » pour créer le cache de Centreon Broker.</p></blockquote><p>Si vous installez le tableau de bord <a href="https://grafana.com/" target="_blank" rel="noopener noreferrer">Grafana</a>, vous pouvez visualiser les données stockées :</p><p><img loading="lazy" alt="image" src="/centreon-documentation/pr-preview/staging/pr-2806/fr/assets/images/visualize_data_grafana-12b2002b7e81b8405edbd0f679609731.png" width="1833" height="748" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="découvrez-dautres-stream-connectors-centreon">Découvrez d&#x27;autres Stream Connectors Centreon<a href="#découvrez-dautres-stream-connectors-centreon" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">​</a></h2><p>Centreon fournit un dépôt Github pour héberger les scripts Lua développés par Centreon et la communauté. Rendez-vous sur le <a href="http://github.com/centreon/centreon-stream-connector-scripts" target="_blank" rel="noopener noreferrer">Github dédié</a>.</p><p>Vous avez besoin d&#x27;aide pour développer votre Stream Connector ? Vous voulez partager votre expérience avec la communauté ? Rejoignez le <a href="https://centreon.github.io/" target="_blank" rel="noopener noreferrer">canal Slack de la communauté Centreon</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/centreon/centreon-documentation/edit/staging/i18n/fr/docusaurus-plugin-content-docs/version-23.10/developer/developer-stream-connector.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Éditer cette page</a></div><div class="col"><svg id="feedback" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 24 24" xml:space="preserve" fill="none" style="height:24px;width:24px;vertical-align:text-top;margin-right:4px"><rect y="0" class="st0" width="24" height="24"></rect><rect x="2" y="2" class="st0" width="20" height="20"></rect><path fill="none" stroke="currentColor" stroke-miterlimit="10" d="M16.14,9.08c0,3.09-2.76,5.6-6.16,5.6c-1.11,0-5.45,0-5.45,0s1.36-1.38,0.93-1.79c-1.02-1-1.64-2.34-1.64-3.81 c0-3.09,2.76-5.6,6.16-5.6S16.14,5.99,16.14,9.08z"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" d="M8.61,16.28c0.76,2.31,3.12,4,5.91,4c1.11,0,5.45,0,5.45,0s-1.36-1.38-0.93-1.79c1.02-1,1.64-2.34,1.64-3.81 c0-2-1.15-3.75-2.88-4.74"></path><line fill="none" stroke="currentColor" stroke-linecap="round" x1="6.78" y1="6.86" x2="13.55" y2="6.86"></line><line fill="none" stroke="currentColor" stroke-linecap="round" x1="6.78" y1="8.74" x2="13.55" y2="8.74"></line><line fill="none" stroke="currentColor" stroke-linecap="round" x1="6.78" y1="10.62" x2="13.55" y2="10.62"></line></svg><a rel="noreferrer noopener" href="https://docs.google.com/forms/d/e/1FAIpQLSdeKkEHWbxn4ZweR1M4OEMzP_QoqKmjl6t4iC_yKeX2CFjzAw/viewform?usp=pp_url&amp;entry.371845164=docs.centreon.com/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/developer/developer-stream-connector/" target="_blank">Envoyer du feedback sur cette page</a></div><div class="col lastUpdated_VsjB"><span class="theme-last-updated">Dernière mise à jour<!-- --> le <b><time datetime="2023-11-10T15:59:42.000Z">10 nov. 2023</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Pagination des documents"><a class="pagination-nav__link pagination-nav__link--prev" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/developer/developer-module/"><div class="pagination-nav__sublabel">Précédent</div><div class="pagination-nav__label">Comment écrire un module</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/developer/developer-broker-stream-connector-migration/"><div class="pagination-nav__sublabel">Suivant</div><div class="pagination-nav__label">Migration des Stream Connectors vers BBDO 3.0.0</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#vue-densemble" class="table-of-contents__link toc-highlight">Vue d&#39;ensemble</a></li><li><a href="#prérequis" class="table-of-contents__link toc-highlight">Prérequis</a></li><li><a href="#création-dun-nouveau-script-lua" class="table-of-contents__link toc-highlight">Création d&#39;un nouveau script Lua</a></li><li><a href="#migration-dun-stream-connector-de-bbdo2-vers-bbdo3" class="table-of-contents__link toc-highlight">Migration d&#39;un Stream Connector de BBDO 2 vers BBDO 3</a><ul><li><a href="#langage-de-programmation" class="table-of-contents__link toc-highlight">Langage de programmation</a></li><li><a href="#stockage-des-scripts-lua" class="table-of-contents__link toc-highlight">Stockage des scripts Lua</a></li><li><a href="#écrire-toutes-les-informations-dans-un-fichier" class="table-of-contents__link toc-highlight">Écrire toutes les informations dans un fichier</a></li></ul></li><li><a href="#exporter-les-données-de-performance-vers-influxdb" class="table-of-contents__link toc-highlight">Exporter les données de performance vers InfluxDB</a><ul><li><a href="#les-paramètres-de-la-file-dattente" class="table-of-contents__link toc-highlight">Les paramètres de la file d&#39;attente</a></li><li><a href="#une-méthode-pour-créer-la-file-dattente" class="table-of-contents__link toc-highlight">Une méthode pour créer la file d&#39;attente</a></li><li><a href="#une-méthode-pour-ajouter-un-événement-dans-la-file-dattente" class="table-of-contents__link toc-highlight">Une méthode pour ajouter un événement dans la file d&#39;attente</a></li><li><a href="#une-méthode-pour-vider-la-file-dattente" class="table-of-contents__link toc-highlight">Une méthode pour vider la file d&#39;attente</a></li><li><a href="#la-fonction-init-pour-obtenir-les-paramètres-et-créer-la-file-dattente" class="table-of-contents__link toc-highlight">La fonction init() pour obtenir les paramètres et créer la file d&#39;attente</a></li><li><a href="#la-fonction-write-pour-insérer-les-événements-dans-la-file-dattente" class="table-of-contents__link toc-highlight">La fonction write() pour insérer les événements dans la file d&#39;attente</a></li><li><a href="#la-fonction-filter-pour-sélectionner-uniquement-les-événements-de-données-de-performance" class="table-of-contents__link toc-highlight">La fonction filter() pour sélectionner uniquement les événements de données de performance</a></li><li><a href="#script-complet" class="table-of-contents__link toc-highlight">Script complet</a></li><li><a href="#configurer-centreon-broker" class="table-of-contents__link toc-highlight">Configurer Centreon Broker</a></li></ul></li><li><a href="#découvrez-dautres-stream-connectors-centreon" class="table-of-contents__link toc-highlight">Découvrez d&#39;autres Stream Connectors Centreon</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.centreon.com/en/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Site Corporate<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.centreon.com/en/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://download.centreon.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Download<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/centreon-documentation/pr-preview/staging/pr-2806/fr/img/logo_centreon.png" alt="Centreon Open Source Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/centreon-documentation/pr-preview/staging/pr-2806/fr/img/logo_centreon.png" alt="Centreon Open Source Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></div><div class="footer__copyright">Copyright © 2005 - 2023 Centreon</div></div></div></footer></div>
<script src="/centreon-documentation/pr-preview/staging/pr-2806/fr/assets/js/runtime~main.0643b7b7.js"></script>
<script src="/centreon-documentation/pr-preview/staging/pr-2806/fr/assets/js/main.03c984fd.js"></script>
</body>
</html>