"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[89646],{87970:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>l,default:()=>g,frontMatter:()=>i,metadata:()=>u,toc:()=>c});t(67294);var r=t(3905);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})),e}function s(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}const i={id:"debug-snmp-traps-management",title:"D\xe9boguer la gestion des traps SNMP"},l=void 0,u={unversionedId:"monitoring/passive-monitoring/debug-snmp-traps-management",id:"version-23.10/monitoring/passive-monitoring/debug-snmp-traps-management",title:"D\xe9boguer la gestion des traps SNMP",description:"D\xe9boguer les interruptions SNMP",source:"@site/i18n/fr/docusaurus-plugin-content-docs/version-23.10/monitoring/passive-monitoring/debug-snmp-traps-management.md",sourceDirName:"monitoring/passive-monitoring",slug:"/monitoring/passive-monitoring/debug-snmp-traps-management",permalink:"/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/monitoring/passive-monitoring/debug-snmp-traps-management",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/i18n/fr/docusaurus-plugin-content-docs/version-23.10/monitoring/passive-monitoring/debug-snmp-traps-management.md",tags:[],version:"23.10",lastUpdatedAt:1699630797,formattedLastUpdatedAt:"10 nov. 2023",frontMatter:{id:"debug-snmp-traps-management",title:"D\xe9boguer la gestion des traps SNMP"},sidebar:"version-23.10/docs",previous:{title:"Monitoring SNMP Traps",permalink:"/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/monitoring/passive-monitoring/monitoring-with-snmp-traps"},next:{title:"Dynamic Service Management",permalink:"/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/monitoring/passive-monitoring/dsm"}},p={},c=[{value:"D\xe9boguer les interruptions SNMP",id:"d\xe9boguer-les-interruptions-snmp",level:2},{value:"Configuration de l\u2019\xe9metteur",id:"configuration-de-l\xe9metteur",level:3},{value:"Pare-feux r\xe9seau et logiciels, routage",id:"pare-feux-r\xe9seau-et-logiciels-routage",level:3},{value:"Snmptrapd",id:"snmptrapd",level:3},{value:"Centreontrapdforward",id:"centreontrapdforward",level:3},{value:"Centreontrapd",id:"centreontrapd",level:3},{value:"Centeon Gorgone",id:"centeon-gorgone",level:3},{value:"Ordonnanceur",id:"ordonnanceur",level:3},{value:"InterfaceCentreon",id:"interfacecentreon",level:3},{value:"Sch\xe9ma d\xe9taill\xe9",id:"sch\xe9ma-d\xe9taill\xe9",level:3}],d={toc:c},m="wrapper";function g(e){var{components:n}=e,i=s(e,["components"]);return(0,r.kt)(m,a(function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){o(e,n,t[n])}))}return e}({},d,i),{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"d\xe9boguer-les-interruptions-snmp"},"D\xe9boguer les interruptions SNMP"),(0,r.kt)("p",null,"Plusieurs \xe9l\xe9ments sont impliqu\xe9s dans la gestion des traps SNMP. En cas de probl\xe8me, il faut v\xe9rifier le bon\nfonctionnement de son architecture, il y a plusieurs choses \xe0 v\xe9rifier."),(0,r.kt)("h3",{id:"configuration-de-l\xe9metteur"},"Configuration de l\u2019\xe9metteur"),(0,r.kt)("p",null,"e premier point \xe0 contr\xf4ler est la configuration de l\u2019\xe9quipement ou application qui a \xe9mis l\u2019interruption que vous\nauriez d\xfb recevoir. V\xe9rifiez l\u2019adresse IP ou nom DNS de destination, la communaut\xe9 SNMP ainsi que la version du\nprotocole."),(0,r.kt)("h3",{id:"pare-feux-r\xe9seau-et-logiciels-routage"},"Pare-feux r\xe9seau et logiciels, routage"),(0,r.kt)("p",null,"Le second point \xe0 contr\xf4ler sont les autorisations des pare-feux r\xe9seau et logiciels ou la mise en place d\u2019un routage\nsp\xe9cifique. Si un ou plusieurs pare-feux r\xe9seau sont pr\xe9sent ou si une translation de port et/ou d\u2019adresse IP est en\nplace, v\xe9rifiez que le flux est possible entre l\u2019\xe9metteur et le collecteur. L\u2019utilisation de sondes r\xe9seau, de\nd\xe9bogage des \xe9quipements r\xe9seau (pare-feux et routeurs) ou des logiciels tcpdump/wireshark sur le collecteur peut vous\npermettre de valider la r\xe9ception du flux de donn\xe9es sur le port UDP 162."),(0,r.kt)("h3",{id:"snmptrapd"},"Snmptrapd"),(0,r.kt)("p",null,"Une fois la r\xe9ception du flux valid\xe9, v\xe9rifiez l\u2019\xe9tat de fonctionnement du processus snmptrapd, qui doit \xeatre en cours\nd\u2019ex\xe9cution, ainsi que ses options de configuration. Il est possible d\u2019activer la journalisation du processus. Pour\ncela modifiez le fichier ",(0,r.kt)("strong",{parentName:"p"},"/etc/sysconfig/snmptrapd"),' et remplacez la ligne "OPTIONS" pour avoir :'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'# snmptrapd command line options\n# OPTIONS="-On -d -t -n -p /var/run/snmptrapd.pid"\nOPTIONS="-On -Lf /var/log/snmptrapd.log -p /var/run/snmptrapd.pid"\n')),(0,r.kt)("p",null,"Red\xe9marrez le processus pour prendre en compte les modifications. Ainsi, pour toute r\xe9ception de traps SNMP, ces\n\xe9v\xe8nements seront inscrit dans le journal ",(0,r.kt)("strong",{parentName:"p"},"/var/log/snmptrapd.log"),". Si les \xe9v\xe8nements sont inscrit dans le journal,\nsupprimez la journalisation et passez \xe0 l\u2019\xe9tape suivante."),(0,r.kt)("p",null,"Dans le cas o\xf9 vous filtrez par communaut\xe9 SNMP, v\xe9rifiez les communaut\xe9s autoris\xe9es dans le fichier de configuration\n",(0,r.kt)("strong",{parentName:"p"},"/etc/snmp/snmptrapd.conf"),". Si apr\xe8s toutes ces v\xe9rifications les traps SNMP ne sont pas inscrites dans le journal,\nv\xe9rifiez que le processus \xe9coute sur le port UDP 162 pour les \xe9quipements distants en utilisant la commande :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"netstat -ano | grep 162\n")),(0,r.kt)("p",null,"Vous devez avoir un r\xe9sultat comme :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"udp        0      0 0.0.0.0:162             0.0.0.0:*                           off (0.00/0/0)\n")),(0,r.kt)("p",null,"Si tel n\u2019est pas le cas, modifiez le port d\u2019\xe9coute du processus."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"On ne le r\xe9p\xe8te jamais assez mais d\xe9sactivez le d\xe9bogage du processus apr\xe8s validation du fonctionnement. Dans le cas\ncontraire, la volum\xe9trie des journaux peut \xeatre tr\xe8s importante.")),(0,r.kt)("h3",{id:"centreontrapdforward"},"Centreontrapdforward"),(0,r.kt)("p",null,"Une fois la validation du processus snmptrapd r\xe9alis\xe9e, contr\xf4lez le processus centreontrapdforward. La premi\xe8re \xe9tape\nconsiste \xe0 v\xe9rifier l\u2019appel de ce processus par snmptrapd dans le fichier ",(0,r.kt)("strong",{parentName:"p"},"/etc/snmp/snmptrapd.conf")," :"),(0,r.kt)("p",null,"V\xe9rifier que le service snmptrapd appelle bien centreontrapdforward. Pour cela, \xe9ditez le fichier ",(0,r.kt)("strong",{parentName:"p"},"/etc/snmp/snmptrapd.conf"),"\net v\xe9rifiez que le fichier contient :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'traphandle default su -l centreon -c "/usr/share/centreon/bin/centreontrapdforward"\n')),(0,r.kt)("p",null,"Si l\u2019acc\xe8s au fichier est incorrect, modifiez le et red\xe9marrez le processus snmptrapd. Vous pouvez contr\xf4ler le bon\nfonctionnement du binaire centreontrapdforward en vous rendant au chapitre de configuration de\n",(0,r.kt)("em",{parentName:"p"},(0,r.kt)("a",{parentName:"em",href:"/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/monitoring/passive-monitoring/enable-snmp-traps#centreontrapdforward"},"centreontrapdforward")),"."),(0,r.kt)("h3",{id:"centreontrapd"},"Centreontrapd"),(0,r.kt)("p",null,"Le prochain binaire est celui de Centreon qui permet de s\xe9lectionner l\u2019h\xf4te poss\xe9dant l\u2019adresse IP ou le nom DNS de\nl\u2019\xe9metteur ainsi que le service li\xe9 \xe0 cet h\xf4te et auquel est reli\xe9e la d\xe9finition de l\u2019interruption SNMP. Pour v\xe9rifier\nson fonctionnement, il convient de v\xe9rifier les param\xe8tres de configuration de centreontrapd."),(0,r.kt)("p",null,"Vous pouvez v\xe9rifier la bonne configuration de centreontrapd au sein du chapitre de configuration de\n",(0,r.kt)("em",{parentName:"p"},(0,r.kt)("a",{parentName:"em",href:"/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/monitoring/passive-monitoring/enable-snmp-traps#centreontrapd"},"centreontrapd")),"."),(0,r.kt)("p",null,"Vous pouvez activer le mode debug pour le service ",(0,r.kt)("strong",{parentName:"p"},"centreontrapd"),". \xc9ditez le fichier suivant :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"vi /etc/sysconfig/centreontrapd\n")),(0,r.kt)("p",null,"Puis modifiez l'option ",(0,r.kt)("strong",{parentName:"p"},"severity")," en ",(0,r.kt)("strong",{parentName:"p"},"debug")," :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'OPTIONS="--logfile=/var/log/centreon/centreontrapd.log --severity=debug --config=/etc/centreon/conf.pm  --config-extra=/etc/centreon/centreontrapd.pm"\n')),(0,r.kt)("p",null,"Puis red\xe9marrez ",(0,r.kt)("strong",{parentName:"p"},"centreontrapd")," :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl restart centreontrapd\n")),(0,r.kt)("h3",{id:"centeon-gorgone"},"Centeon Gorgone"),(0,r.kt)("p",null,"Dans le cas d\u2019un serveur central, le processus Centreon Gorgone doit \xeatre d\xe9marr\xe9 pour transf\xe9rer la commande externe \xe0\nl\u2019ordonnanceur supervisant l\u2019\xe9metteur, v\xe9rifiez son \xe9tat de fonctionnement. Activez le d\xe9bogage du processus via le\nmenu ",(0,r.kt)("strong",{parentName:"p"},"Administration > Parameters > Debug")," et red\xe9marrez le processus."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Vous pouvez modifier le niveau de journalisation des logs  via le menu ",(0,r.kt)("strong",{parentName:"p"},"Administation > Param\xe8tres > D\xe9bogage"))),(0,r.kt)("p",null,'En cas de non r\xe9ception de la commande externe, v\xe9rifiez le chemin d\u2019acc\xe8s au fichier de commande du processus d\xe9fini\ndans la variable "$cmdFile" du fichier de configuration ',(0,r.kt)("strong",{parentName:"p"},"/etc/centreon/conf.pm"),". Le chemin doit \xeatre\n",(0,r.kt)("strong",{parentName:"p"},"/var/lib/centreon/centcore.cmd")," dans le cas d\u2019un serveur central ou le chemin vers le fichier de commande de\nl\u2019ordonnanceur."),(0,r.kt)("h3",{id:"ordonnanceur"},"Ordonnanceur"),(0,r.kt)("p",null,'Que vous ayez configur\xe9 un serveur central ou un collecteur distant pour la r\xe9ception de trap SNMP, l\u2019ordonnanceur\ndoit recevoir la commande externe de changement de statut et/ou de message de sortie ("output"). V\xe9rifiez le journal\nde l\u2019ordonnanceur. Dans le cas de Centreon Engine le fichier est ',(0,r.kt)("strong",{parentName:"p"},"/var/log/centreon-engine/centengine.log"),"."),(0,r.kt)("p",null,"Les lignes suivantes doivent appara\xeetre :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"[1352838428] EXTERNAL COMMAND: PROCESS_SERVICE_CHECK_RESULT;Centreon-Server;Traps-SNMP;2;Critical problem\n[1352838433] PASSIVE SERVICE CHECK: Centreon-Server;Traps-SNMP;2;Critical problem\n")),(0,r.kt)("p",null,'Si seule la commande externe appara\xeet mais pas la prise en compte de celle-ci par l\u2019ordonnanceur ("PASSIVE SERVICE CHECK""),\nil se peut qu\u2019un probl\xe8me de synchronisation de l\u2019horloge syst\xe8me soit en cause. Le serveur est soit en retard et la\ncommande sera trait\xe9e ult\xe9rieurement, soit en avance et la commande ne sera pas prise en compte.'),(0,r.kt)("h3",{id:"interfacecentreon"},"InterfaceCentreon"),(0,r.kt)("p",null,'Afin d\u2019\xeatre visible dans Centreon, l\u2019ordonnanceur doit transmettre les informations, via son module NEB, \xe0 la partie\nserveur du broker pour que ce dernier l\u2019ins\xe8re en base de donn\xe9es. Centreon affichera ensuite le r\xe9sultat \xe0 partir de\nla base de donn\xe9es \xab centreon_storage \xbb. S\u2019il vous est possible de visualiser les informations des derniers contr\xf4les\nde votre collecteur dans l\u2019interface web, alors vous devriez voir le statut et le message de sortie ("output") de\nmodifi\xe9s. Si tel n\u2019est pas le cas, alors votre ordonnanceur n\u2019est pas connect\xe9 \xe0 la partie serveur de votre broker. Les\nprobl\xe8mes peuvent \xeatre les suivants :'),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"L\u2019ordonnanceur n\u2019a pas charg\xe9 le module NEB \xe0 son d\xe9marrage car celui-ci est introuvable ou non d\xe9fini dans les\noptions de l\u2019ordonnanceur"),(0,r.kt)("li",{parentName:"ul"},"Le module NEB n\u2019a pu se connecter \xe0 la partie serveur \xe0 cause d\u2019un probl\xe8me de param\xe9trage."),(0,r.kt)("li",{parentName:"ul"},"Un pare-feu bloque la connexion entre le collecteur et le serveur Centreon qui h\xe9berge la base de donn\xe9es. La partie\nserveur du broker n\u2019est pas fonctionnelle ou n\u2019est pas en cours d\u2019ex\xe9cution")),(0,r.kt)("h3",{id:"sch\xe9ma-d\xe9taill\xe9"},"Sch\xe9ma d\xe9taill\xe9"),(0,r.kt)("p",null,"Vous trouverez ci-dessous un sch\xe9ma d\xe9taill\xe9 de tous les processus utilis\xe9s et/ou pr\xe9sents lors de la r\xe9ception d\u2019une\ninterruption SNMP :"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image",src:t(9896).Z,width:"1119",height:"699"})))}g.isMDXComponent=!0},9896:(e,n,t)=>{t.d(n,{Z:()=>r});const r=t.p+"assets/images/kcentreontrapd_schema-97a5f37cafd87843373b4d9247d9a3bd.png"}}]);