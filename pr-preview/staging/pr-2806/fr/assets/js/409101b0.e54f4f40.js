"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[22034],{86473:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>p,default:()=>g,frontMatter:()=>o,metadata:()=>u,toc:()=>s});n(67294);var r=n(3905);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const o={id:"developer-widget",title:"Comment \xe9crire un widget"},p=void 0,u={unversionedId:"developer/developer-widget",id:"version-23.10/developer/developer-widget",title:"Comment \xe9crire un widget",description:"Centreon offre un syst\xe8me d\u2019affichage personnalis\xe9 qui permet \xe0 l\u2019utilisateur d\u2019afficher un ou plusieurs widgets sur la m\xeame page\xa0: Accueil > Vues personnalis\xe9es.",source:"@site/i18n/fr/docusaurus-plugin-content-docs/version-23.10/developer/developer-widget.md",sourceDirName:"developer",slug:"/developer/developer-widget",permalink:"/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/developer/developer-widget",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/i18n/fr/docusaurus-plugin-content-docs/version-23.10/developer/developer-widget.md",tags:[],version:"23.10",lastUpdatedAt:1699872045,formattedLastUpdatedAt:"13 nov. 2023",frontMatter:{id:"developer-widget",title:"Comment \xe9crire un widget"},sidebar:"version-23.10/docs",previous:{title:"Comment traduire Centreon",permalink:"/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/developer/developer-translate-centreon"},next:{title:"Stream Connectors",permalink:"/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/developer/developer-broker-stream-connector"}},d={},s=[{value:"Dois-je d\xe9velopper un widget ou un module\xa0?",id:"dois-je-d\xe9velopper-un-widget-ou-un-module",level:2},{value:"Structure du r\xe9pertoire",id:"structure-du-r\xe9pertoire",level:2},{value:"Fichier de configuration",id:"fichier-de-configuration",level:2},{value:"Balises de base",id:"balises-de-base",level:3},{value:"Attributs des param\xe8tres",id:"attributs-des-param\xe8tres",level:3},{value:"Code",id:"code",level:3}],m={toc:s},c="wrapper";function g(e){var{components:t}=e,n=i(e,["components"]);return(0,r.kt)(c,l(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){a(e,t,n[t])}))}return e}({},m,n),{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Centreon offre un syst\xe8me d\u2019affichage personnalis\xe9 qui permet \xe0 l\u2019utilisateur d\u2019afficher un ou plusieurs widgets sur la m\xeame page\xa0: ",(0,r.kt)("strong",{parentName:"p"},"Accueil > Vues personnalis\xe9es"),"."),(0,r.kt)("p",null,"Vous pourriez avoir des besoins sp\xe9cifiques qui ne sont pas encore couverts par notre catalogue de widgets et ce tutoriel vous expliquera comment \xe9crire votre premier widget pour Centreon."),(0,r.kt)("h2",{id:"dois-je-d\xe9velopper-un-widget-ou-un-module"},"Dois-je d\xe9velopper un widget ou un module\xa0?"),(0,r.kt)("p",null,"Si vous ne savez pas si vous devez cr\xe9er un module ou un widget, demandez-vous si votre projet est destin\xe9 \xe0 contenir de nombreux menus ou s\u2019il s\u2019agit plut\xf4t d\u2019une page simple qui affichera peu d\u2019informations."),(0,r.kt)("p",null,"Bien s\xfbr, vous pourriez cr\xe9er un widget qui ne fonctionnerait qu\u2019avec un module donn\xe9."),(0,r.kt)("h2",{id:"structure-du-r\xe9pertoire"},"Structure du r\xe9pertoire"),(0,r.kt)("p",null,"Les widgets fonctionnent \xe0 peu pr\xe8s comme les modules. Ils doivent \xeatre plac\xe9s dans le r\xe9pertoire suivant\xa0:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Shell"},"centreon/www/widgets/name-of-your-widget/\n")),(0,r.kt)("p",null,"Votre widget doit contenir un fichier obligatoire nomm\xe9 ",(0,r.kt)("strong",{parentName:"p"},"configs.xml")," \xe0 sa racine."),(0,r.kt)("h2",{id:"fichier-de-configuration"},"Fichier de configuration"),(0,r.kt)("p",null,"Voici le fichier de configuration XML de notre widget d'exemple :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-XML"},'<configs>\n    <title>Dummy</title>\n    <author>Centreon</author>\n    <email>contact@centreon.com</email>\n    <website>http://www.centreon.com</website>\n    <description>Dummy widget</description>\n    <version>1.0.3</version>\n    <keywords>dummy, widget, centreon</keywords>\n    <screenshot></screenshot>\n    <thumbnail>./widgets/dummy/resources/logoCentreon.png</thumbnail>\n    <url>./widgets/dummy/index.php</url>\n    <autoRefresh></autoRefresh>\n    <preferences>\n        <preference label="text preference" name="text preference" defaultValue="default value" type="text"/>\n        <preference label="boolean preference" name="boolean preference" defaultValue="1" type="boolean"/>\n        <preference label="date" name="date" defaultValue="" type="date"/>\n        <preference label="host preference" name="host preference" defaultValue="" type="host"/>\n        <preference label="list preference" name="list preference" defaultValue="none" type="list">\n            <option value="all" label="all"/>\n            <option value="none" label="none"/>\n        </preference>\n        <preference label="range preference" name="range preference" defaultValue="5" type="range" min="0" max="50" step="5"/>\n        <preference label="host search" name="host search" defaultValue="notlike _Module_%" type="compare"/>\n    </preferences>\n</configs>\n')),(0,r.kt)("p",null,"Voyons maintenant \xe0 quoi ces balises font r\xe9f\xe9rence."),(0,r.kt)("h3",{id:"balises-de-base"},"Balises de base"),(0,r.kt)("p",null,"*"," = balise obligatoire"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Nom de la balise"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"title","*"),(0,r.kt)("td",{parentName:"tr",align:null},"Titre de votre widget")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"author","*"),(0,r.kt)("td",{parentName:"tr",align:null},"Votre nom")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"email"),(0,r.kt)("td",{parentName:"tr",align:null},"Votre adresse e-mail")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"website"),(0,r.kt)("td",{parentName:"tr",align:null},"URL de votre projet")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"description","*"),(0,r.kt)("td",{parentName:"tr",align:null},"Br\xe8ve description de votre widget")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"version","*"),(0,r.kt)("td",{parentName:"tr",align:null},"Version de votre widget. Incr\xe9mentez ce num\xe9ro chaque fois que vous publiez une nouvelle version.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"keywords"),(0,r.kt)("td",{parentName:"tr",align:null},"Quelques mots cl\xe9s qui d\xe9crivent votre widget")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"screenshot"),(0,r.kt)("td",{parentName:"tr",align:null},"Une capture d\u2019\xe9cran qui montre votre widget sous son meilleur jour. La capture d\u2019\xe9cran doit \xeatre plac\xe9e dans votre r\xe9pertoire de widgets.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"thumbnail"),(0,r.kt)("td",{parentName:"tr",align:null},"Le logo de votre projet. La taille qui convient le mieux est 100px x 25px. Les vignettes doivent \xeatre plac\xe9es dans votre r\xe9pertoire de widgets.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"url","*"),(0,r.kt)("td",{parentName:"tr",align:null},"Le chemin de la page principale de votre widget")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"autorefresh"),(0,r.kt)("td",{parentName:"tr",align:null},"Ce param\xe8tre n\u2019est pas encore impl\xe9ment\xe9")))),(0,r.kt)("h3",{id:"attributs-des-param\xe8tres"},"Attributs des param\xe8tres"),(0,r.kt)("p",null,"*"," = ",(0,r.kt)("em",{parentName:"p"},"Param\xe8tre obligatoire")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Attributs des balises"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"label","*"),(0,r.kt)("td",{parentName:"tr",align:null},"\xc9tiquette du param\xe8tre")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"name","*"),(0,r.kt)("td",{parentName:"tr",align:null},"Nom du param\xe8tre qui sera utilis\xe9 pour r\xe9cup\xe9rer sa valeur")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"defaultValue","*"),(0,r.kt)("td",{parentName:"tr",align:null},"Valeur par d\xe9faut du param\xe8tre")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"requirePermission"),(0,r.kt)("td",{parentName:"tr",align:null},"La valeur peut \xeatre \xab\xa01\xa0\xbb ou \xab\xa00\xa0\xbb. Lorsqu\u2019il est d\xe9fini sur 1, ce param\xe8tre ne sera pas affich\xe9 pour les utilisateurs non autoris\xe9s.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"type","*"),(0,r.kt)("td",{parentName:"tr",align:null},"Type de param\xe8tre, doit \xeatre l\u2019un des suivants\xa0: text,boolean,date,list,range,compare,host,hostgroup, hostTemplate,servicegroup,serviceTemplate")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"min","*"),(0,r.kt)("td",{parentName:"tr",align:null},"Pour le type de plage uniquement. Il s\u2019agit de la valeur minimale du param\xe8tre de la plage.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"max","*"),(0,r.kt)("td",{parentName:"tr",align:null},"Pour le type de plage uniquement. Il s\u2019agit de la valeur maximale du param\xe8tre de la plage.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"step","*"),(0,r.kt)("td",{parentName:"tr",align:null},"Pour le type de plage uniquement. Il s\u2019agit de la valeur de l\u2019\xe9tape du param\xe8tre de la plage.")))),(0,r.kt)("h1",{id:"type-de-param\xe8tre"},"Type de param\xe8tre"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Nom de la balise"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"text"),(0,r.kt)("td",{parentName:"tr",align:null},"Rend un \xe9l\xe9ment de saisie de texte")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"boolean"),(0,r.kt)("td",{parentName:"tr",align:null},"Rend une case \xe0 cocher")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"date"),(0,r.kt)("td",{parentName:"tr",align:null},"Rend deux \xe9l\xe9ments de saisie de texte. L\u2019un pour la date de d\xe9but, l\u2019autre pour la date de fin.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"list"),(0,r.kt)("td",{parentName:"tr",align:null},"Rend une bo\xeete de s\xe9lection. La bo\xeete de s\xe9lection sera remplie avec les balises d\u2019option qui doivent \xeatre d\xe9finies dans la balise de pr\xe9f\xe9rence.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"range"),(0,r.kt)("td",{parentName:"tr",align:null},"Rend une bo\xeete de s\xe9lection qui sera remplie de valeurs en fonction des d\xe9finitions de min, max et \xe9tape.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"compare"),(0,r.kt)("td",{parentName:"tr",align:null},"Rend une bo\xeete de s\xe9lection et une saisie de texte. La bo\xeete de s\xe9lection contiendra des op\xe9randes SQL tels que\xa0:")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},">","\xa0: sup\xe9rieur \xe0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"\\<\xa0: inf\xe9rieur \xe0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},">","=\xa0: sup\xe9rieur ou \xe9gal \xe0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"\\<=\xa0: inf\xe9rieur ou \xe9gal \xe0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"\\=\xa0: \xe9gal \xe0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"!=\xa0: non \xe9gal \xe0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"LIKE\xa0: peut \xeatre utilis\xe9 avec le caract\xe8re g\xe9n\xe9rique %%.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"NOT LIKE\xa0: peut \xeatre utilis\xe9 avec le caract\xe8re g\xe9n\xe9rique %%.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"host"),(0,r.kt)("td",{parentName:"tr",align:null},"Rend une bo\xeete de s\xe9lection remplie d\u2019une liste d\u2019h\xf4tes.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hostgroup"),(0,r.kt)("td",{parentName:"tr",align:null},"Rend une bo\xeete de s\xe9lection remplie d\u2019une liste de groupes d\u2019h\xf4tes.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hostTemplate"),(0,r.kt)("td",{parentName:"tr",align:null},"Rend une bo\xeete de s\xe9lection remplie d\u2019une liste de mod\xe8les d\u2019h\xf4tes.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"servicegroup"),(0,r.kt)("td",{parentName:"tr",align:null},"Rend une bo\xeete de s\xe9lection remplie d\u2019une liste de groupes de services.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"serviceTemplate"),(0,r.kt)("td",{parentName:"tr",align:null},"Rend une bo\xeete de s\xe9lection remplie d\u2019une liste de mod\xe8les de services.")))),(0,r.kt)("p",null,"La fen\xeatre des pr\xe9f\xe9rences se pr\xe9sente alors comme suit\xa0:"),(0,r.kt)("p",null,".. image\xa0: /","_","static/images/extending/pref","_","dummy","_","widget.png :align: center"),(0,r.kt)("h3",{id:"code"},"Code"),(0,r.kt)("p",null,"Toutes les langues sont s\xe9par\xe9es dans diff\xe9rents fichiers, un fichier pour chaque langue. Le fichier \xab\xa0configs.xml\xa0\xbb appelle le fichier PHP et le fichier php appelle le fichier HTML, etc..."),(0,r.kt)("p",null,"Nous utilisons Smarty, qui est un moteur et un compilateur de templates PHP (",(0,r.kt)("a",{parentName:"p",href:"http://smarty.net"},"http://smarty.net"),")."),(0,r.kt)("p",null,"Pour utiliser Smarty, vous devez\xa0:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-PHP"},"require_once $centreon_path . 'GPL_LIB/Smarty/libs/Smarty.class.php';\n")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Configurer Smarty\xa0:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-PHP"},'$path = $centreon_path . "www/widgets/Dummy/src/";\n$template = new Smarty();\n$template = initSmartyTplForPopup($path, $template, "./", $centreon_path);\n')),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Cr\xe9er un mod\xe8le PHP \xe0 utiliser en html\xa0:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-PHP"},"$template->assign('widgetId', $widgetId);\n$template->assign('autoRefresh', $autoRefresh);\n$template->assign('data', $data);\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Affecter le fichier HTML \xe0 ex\xe9cuter\xa0:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-PHP"},"$template->display('dummy.ihtml');\n")),(0,r.kt)("p",null,"Cette ligne demande \xe0 PHP d'appeler le template smarty ",(0,r.kt)("strong",{parentName:"p"},"dummy.ihtml")," pour afficher le r\xe9sultat :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-PHP"},"$template->display('dummy.ihtml');\n")),(0,r.kt)("p",null,"Pour requ\xeater les bases de donn\xe9es (",(0,r.kt)("strong",{parentName:"p"},"centreon")," pour la configuration et ",(0,r.kt)("strong",{parentName:"p"},"centstorage")," pour les donn\xe9es temps r\xe9el),\nvous devez initialiser l'objet PHP comme d\xe9crit ci-dessous (en utilisant ",(0,r.kt)("strong",{parentName:"p"},"pearDB"),") :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-PHP"},'try {\n    global $pearDB;\n\n    $db_centreon = new CentreonDB("centreon");\n    $db = new CentreonDB("centstorage");\n    $pearDB = $db_centreon;\n\n    $widgetObj = new CentreonWidget($centreon, $db_centreon);\n    $preferences = $widgetObj->getWidgetPreferences($widgetId);\n    $autoRefresh = 0;\n    if (isset($preferences[\'refresh_interval\'])) {\n        $autoRefresh = $preferences[\'refresh_interval\'];\n    }\n} catch (Exception $e) {\n    echo $e->getMessage() . "<br/>";\n    exit;\n}\n')),(0,r.kt)("p",null,"Puis requ\xeater la base en utilisant les m\xe9thodes de la classe."))}g.isMDXComponent=!0}}]);