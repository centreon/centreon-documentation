"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[98742],{62384:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>A,contentTitle:()=>i,default:()=>N,frontMatter:()=>u,metadata:()=>d,toc:()=>E});t(67294);var a=t(3905),r=t(51715),s=t(7626);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})),e}function c(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)t=s[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)t=s[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}const u={id:"acceptance-guide",title:"Guide de recette du cluster"},i=void 0,d={unversionedId:"administration/centreon-ha/acceptance-guide",id:"version-23.10/administration/centreon-ha/acceptance-guide",title:"Guide de recette du cluster",description:"Veuillez noter que toutes les commandes pr\xe9sent\xe9es dans ce document doivent \xeatre ex\xe9cut\xe9es respectivement en tant que root, sauf indication contraire.",source:"@site/i18n/fr/docusaurus-plugin-content-docs/version-23.10/administration/centreon-ha/acceptance-guide.md",sourceDirName:"administration/centreon-ha",slug:"/administration/centreon-ha/acceptance-guide",permalink:"/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/administration/centreon-ha/acceptance-guide",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/i18n/fr/docusaurus-plugin-content-docs/version-23.10/administration/centreon-ha/acceptance-guide.md",tags:[],version:"23.10",lastUpdatedAt:1699631982,formattedLastUpdatedAt:"10 nov. 2023",frontMatter:{id:"acceptance-guide",title:"Guide de recette du cluster"},sidebar:"version-23.10/docs",previous:{title:"Int\xe9grer des Pollers dans un cluster Centreon-HA manuel",permalink:"/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/installation/installation-of-centreon-ha-manual/integrating-pollers"},next:{title:"Supervision de Centreon-HA",permalink:"/centreon-documentation/pr-preview/staging/pr-2806/fr/docs/administration/centreon-ha/monitoring-guide"}},A={},E=[{value:"Conditions requises pour les tests",id:"conditions-requises-pour-les-tests",level:3},{value:"V\xe9rifier l&#39;\xe9tat du cluster",id:"v\xe9rifier-l\xe9tat-du-cluster",level:3},{value:"V\xe9rifier les contraintes",id:"v\xe9rifier-les-contraintes",level:3},{value:"V\xe9rifier l&#39;\xe9tat de la synchronisation de la base de donn\xe9es",id:"v\xe9rifier-l\xe9tat-de-la-synchronisation-de-la-base-de-donn\xe9es",level:3},{value:"Basculement des ressources du Centreon",id:"basculement-des-ressources-du-centreon",level:2},{value:"Etat du cluster avant le failover",id:"etat-du-cluster-avant-le-failover",level:3},{value:"Effectuer un basculement",id:"effectuer-un-basculement",level:3},{value:"Retour \xe0 la situation nominale",id:"retour-\xe0-la-situation-nominale",level:3},{value:"Simuler la perte du noeud secondaire",id:"simuler-la-perte-du-noeud-secondaire",level:2},{value:"Traitement",id:"traitement",level:3},{value:"Retour \xe0 la situation nominale",id:"retour-\xe0-la-situation-nominale-1",level:3},{value:"Simuler la perte du noeud primaire",id:"simuler-la-perte-du-noeud-primaire",level:3},{value:"Traitement",id:"traitement-1",level:3},{value:"Retour \xe0 la situation nominale",id:"retour-\xe0-la-situation-nominale-2",level:3},{value:"Conditions requises pour les tests",id:"conditions-requises-pour-les-tests-1",level:3},{value:"V\xe9rifier l&#39;\xe9tat du cluster",id:"v\xe9rifier-l\xe9tat-du-cluster-1",level:3},{value:"V\xe9rifier les contraintes",id:"v\xe9rifier-les-contraintes-1",level:3},{value:"V\xe9rifier l&#39;\xe9tat de la synchronisation de la base de donn\xe9es",id:"v\xe9rifier-l\xe9tat-de-la-synchronisation-de-la-base-de-donn\xe9es-1",level:3},{value:"Basculement des ressources du Centreon",id:"basculement-des-ressources-du-centreon-1",level:2},{value:"Etat du cluster avant le failover",id:"etat-du-cluster-avant-le-failover-1",level:3},{value:"Effectuer un basculement",id:"effectuer-un-basculement-1",level:3},{value:"Retour \xe0 la situation nominale",id:"retour-\xe0-la-situation-nominale-3",level:3},{value:"Simuler la perte du noeud secondaire",id:"simuler-la-perte-du-noeud-secondaire-1",level:2},{value:"Traitement",id:"traitement-2",level:3},{value:"Retour \xe0 la situation nominale",id:"retour-\xe0-la-situation-nominale-4",level:3},{value:"Simuler la perte du noeud primaire",id:"simuler-la-perte-du-noeud-primaire-1",level:3},{value:"Traitement",id:"traitement-3",level:3},{value:"Retour \xe0 la situation nominale",id:"retour-\xe0-la-situation-nominale-5",level:3}],p={toc:E},m="wrapper";function N(e){var{components:n}=e,t=c(e,["components"]);return(0,a.kt)(m,o(function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},a=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),a.forEach((function(n){l(e,n,t[n])}))}return e}({},p,t),{components:n,mdxType:"MDXLayout"}),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Veuillez noter que toutes les commandes pr\xe9sent\xe9es dans ce document doivent \xeatre ex\xe9cut\xe9es respectivement en tant que ",(0,a.kt)("inlineCode",{parentName:"p"},"root"),", sauf indication contraire.")),(0,a.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,a.kt)(s.Z,{value:"HA 2 Nodes",label:"HA 2 Nodes",mdxType:"TabItem"},(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Ce document fera r\xe9f\xe9rence aux param\xe8tres qui varient d'une installation \xe0 l'autre (par exemple, les noms et adresses IP des n\u0153uds) via les macros d\xe9finies \xe0 la page suivante : ",(0,a.kt)("strong",{parentName:"p"},"Installation d'un cluster \xe0 2 n\u0153uds"),", section ",(0,a.kt)("strong",{parentName:"p"},"D\xe9finition des noms et adresses IP des serveurs"),".")),(0,a.kt)("h3",{id:"conditions-requises-pour-les-tests"},"Conditions requises pour les tests"),(0,a.kt)("p",null,"Pour v\xe9rifier le bon fonctionnement de votre cluster, vous obtiendrez toutes les commandes pour effectuer un test de basculement et simuler des pannes de r\xe9seau."),(0,a.kt)("p",null,"Il est n\xe9cessaire de v\xe9rifier l'\xe9tat du cluster avant d'effectuer les tests d'acceptation."),(0,a.kt)("h3",{id:"v\xe9rifier-l\xe9tat-du-cluster"},"V\xe9rifier l'\xe9tat du cluster"),(0,a.kt)("p",null,"Pour v\xe9rifier l'\xe9tat g\xe9n\xe9ral du cluster, ex\xe9cutez la commande :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"pcs status\n")),(0,a.kt)("p",null,"La commande devrait retourner les informations suivantes :"),(0,a.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,a.kt)(s.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.0.5-9.0.1.el8_4.1-ba59be7122) - partition with quorum\n  * Last updated: Wed Sep 15 16:35:47 2021\n  * Last change:  Wed Sep 15 10:41:50 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\nFull List of Resources:\n  * Clone Set: ms_mysql-clone [ms_mysql] (promotable):\n    * Masters: [ @CENTRAL_MASTER_NAME@ ]\n    * Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: php-clone [php]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: cbd_rrd-clone [cbd_rrd]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Resource Group: centreon:\n    * vip       (ocf::heartbeat:IPaddr2):        Started @CENTRAL_MASTER_NAME@\n    * http      (systemd:httpd):         Started @CENTRAL_MASTER_NAME@\n    * gorgone   (systemd:gorgoned):      Started @CENTRAL_MASTER_NAME@\n    * centreon_central_sync     (systemd:centreon-central-sync):         Started @CENTRAL_MASTER_NAME@\n    * cbd_central_broker        (systemd:cbd-sql):       Started @CENTRAL_MASTER_NAME@\n    * centengine        (systemd:centengine):    Started @CENTRAL_MASTER_NAME@\n    * centreontrapd     (systemd:centreontrapd):         Started @CENTRAL_MASTER_NAME@\n    * snmptrapd (systemd:snmptrapd):     Started @CENTRAL_MASTER_NAME@\n")))),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"V\xe9rifiez les erreurs ",(0,a.kt)("inlineCode",{parentName:"p"},"Failed")," dans les ressources et corrigez-les \xe0 l'aide du guide de d\xe9pannage (page ",(0,a.kt)("strong",{parentName:"p"},"D\xe9panner Centreon-HA"),").")),(0,a.kt)("h3",{id:"v\xe9rifier-les-contraintes"},"V\xe9rifier les contraintes"),(0,a.kt)("p",null,"Pour v\xe9rifier qu'il n'y a pas de ",(0,a.kt)("inlineCode",{parentName:"p"},"Contraintes de localisation"),", ex\xe9cutez la commande :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"pcs constraint\n")),(0,a.kt)("p",null,"La commande devrait renvoyer ceci :"),(0,a.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,a.kt)(s.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Location Constraints:\nOrdering Constraints:\nColocation Constraints:\n  ms_mysql-clone with centreon (score:INFINITY) (rsc-role:Master) (with-rsc-role:Started)\n  centreon with ms_mysql-clone (score:INFINITY) (rsc-role:Master) (with-rsc-role:Started)\nTicket Constraints:\n")))),(0,a.kt)("h3",{id:"v\xe9rifier-l\xe9tat-de-la-synchronisation-de-la-base-de-donn\xe9es"},"V\xe9rifier l'\xe9tat de la synchronisation de la base de donn\xe9es"),(0,a.kt)("p",null,"Pour v\xe9rifier que la synchronisation de la base de donn\xe9es fonctionne, ex\xe9cutez la commande :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/share/centreon-ha/bin/mysql-check-status.sh\n")),(0,a.kt)("p",null,"La commande devrait retourner les informations suivantes :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Connection MASTER Status '@CENTRAL_MASTER_NAME@' [OK]\nConnection SLAVE Status '@CENTRAL_SLAVE_NAME@' [OK]\nSlave Thread Status [OK]\nPosition Status [OK]\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Si la synchronisation indique ",(0,a.kt)("inlineCode",{parentName:"p"},"KO"),", vous devez la corriger \xe0 l'aide du ",(0,a.kt)("strong",{parentName:"p"},"Guide d'exploitation du cluster"),".")),(0,a.kt)("h2",{id:"basculement-des-ressources-du-centreon"},"Basculement des ressources du Centreon"),(0,a.kt)("h3",{id:"etat-du-cluster-avant-le-failover"},"Etat du cluster avant le failover"),(0,a.kt)("p",null,"Avant d'ex\xe9cuter un test de basculement, v\xe9rifiez l'\xe9tat du cluster avec la commande suivante :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"pcs status\n")),(0,a.kt)("p",null,"Le r\xe9sultat attendu est :"),(0,a.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,a.kt)(s.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.0.5-9.0.1.el8_4.1-ba59be7122) - partition with quorum\n  * Last updated: Wed Sep 15 16:35:47 2021\n  * Last change:  Wed Sep 15 10:41:50 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\nFull List of Resources:\n  * Clone Set: ms_mysql-clone [ms_mysql] (promotable):\n    * Masters: [ @CENTRAL_MASTER_NAME@ ]\n    * Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: php-clone [php]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: cbd_rrd-clone [cbd_rrd]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Resource Group: centreon:\n    * vip       (ocf::heartbeat:IPaddr2):        Started @CENTRAL_MASTER_NAME@\n    * http      (systemd:httpd):         Started @CENTRAL_MASTER_NAME@\n    * gorgone   (systemd:gorgoned):      Started @CENTRAL_MASTER_NAME@\n    * centreon_central_sync     (systemd:centreon-central-sync):         Started @CENTRAL_MASTER_NAME@\n    * cbd_central_broker        (systemd:cbd-sql):       Started @CENTRAL_MASTER_NAME@\n    * centengine        (systemd:centengine):    Started @CENTRAL_MASTER_NAME@\n    * centreontrapd     (systemd:centreontrapd):         Started @CENTRAL_MASTER_NAME@\n    * snmptrapd (systemd:snmptrapd):     Started @CENTRAL_MASTER_NAME@\n")))),(0,a.kt)("h3",{id:"effectuer-un-basculement"},"Effectuer un basculement"),(0,a.kt)("p",null,"Pour d\xe9placer les ressources, ex\xe9cutez la commande :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource move centreon\n")),(0,a.kt)("p",null,"Vous pouvez \xe9galement utiliser la commande ",(0,a.kt)("inlineCode",{parentName:"p"},"crm_mon -fr")," pour observer le basculement pendant qu'il se produit. Il sera n\xe9cessaire d'utiliser Ctrl+c pour quitter la commande."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Avertissement : La commande ",(0,a.kt)("inlineCode",{parentName:"p"},"pcs resource move centreon")," d\xe9finit une contrainte ",(0,a.kt)("inlineCode",{parentName:"p"},"-INFINITY")," sur le noeud h\xe9bergeant la ressource, qui n'est plus autoris\xe9e \xe0 \xeatre ex\xe9cut\xe9e sur ce noeud.")),(0,a.kt)("p",null,"En cons\xe9quence, les ressources se d\xe9placent vers un autre noeud. Suite \xe0 cette manipulation, il est donc n\xe9cessaire d'ex\xe9cuter la commande ",(0,a.kt)("inlineCode",{parentName:"p"},"pcs resource clear centreon")," pour s'assurer que les ressources pourront \xeatre d\xe9plac\xe9es \xe0 nouveau vers ce noeud dans le futur."),(0,a.kt)("p",null,"Pour v\xe9rifier que les ressources ont \xe9t\xe9 d\xe9plac\xe9es vers le second n\u0153ud, ex\xe9cutez la commande : "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"pcs status\n")),(0,a.kt)("p",null,"Le r\xe9sultat attendu est :"),(0,a.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,a.kt)(s.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.0.5-9.0.1.el8_4.1-ba59be7122) - partition with quorum\n  * Last updated: Wed Sep 15 16:35:47 2021\n  * Last change:  Wed Sep 15 10:41:50 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\nFull List of Resources:\n  * Clone Set: ms_mysql-clone [ms_mysql] (promotable):\n    * Masters: [ @CENTRAL_MASTER_NAME@ ]\n    * Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: php-clone [php]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: cbd_rrd-clone [cbd_rrd]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Resource Group: centreon:\n    * vip       (ocf::heartbeat:IPaddr2):        Started Started @CENTRAL_SLAVE_NAME@\n    * http      (systemd:httpd):         Started Started @CENTRAL_SLAVE_NAME@\n    * gorgone   (systemd:gorgoned):      Started Started @CENTRAL_SLAVE_NAME@\n    * centreon_central_sync     (systemd:centreon-central-sync):         Started @CENTRAL_SLAVE_NAME@\n    * cbd_central_broker        (systemd:cbd-sql):       Started @CENTRAL_SLAVE_NAME@\n    * centengine        (systemd:centengine):    Started @CENTRAL_SLAVE_NAME@\n    * centreontrapd     (systemd:centreontrapd):         Started @CENTRAL_SLAVE_NAME@\n    * snmptrapd (systemd:snmptrapd):     Started @CENTRAL_SLAVE_NAME@\n")))),(0,a.kt)("p",null,"Vous pouvez remarquer que comme pour les ressources ",(0,a.kt)("inlineCode",{parentName:"p"},"centreon"),", le noeud secondaire a \xe9galement \xe9t\xe9 promu en ",(0,a.kt)("inlineCode",{parentName:"p"},"master")," pour la ressource ",(0,a.kt)("inlineCode",{parentName:"p"},"ms_mysql"),". Ce comportement est voulu et d\xfb aux ",(0,a.kt)("inlineCode",{parentName:"p"},"Colocation Constraints")," entre les ressources ",(0,a.kt)("inlineCode",{parentName:"p"},"centreon")," et ",(0,a.kt)("inlineCode",{parentName:"p"},"msq_mysql"),"."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Les ",(0,a.kt)("inlineCode",{parentName:"p"},"Colocation Constraints")," sont introuvables sur un cluster \xe0 4 n\u0153uds !")),(0,a.kt)("p",null,"Une fois le basculement termin\xe9, ex\xe9cutez la commande :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource clear centreon\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Cela permettra de supprimer les contraintes \xe9tablies lors du basculement.")),(0,a.kt)("p",null,"V\xe9rifiez \xe9galement que la r\xe9plication MySQL est toujours op\xe9rationnelle en utilisant la commande :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/share/centreon-ha/bin/mysql-check-status.sh\n")),(0,a.kt)("p",null,"La commande doit retourner les informations suivantes :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Connection MASTER Status '@CENTRAL_MASTER_NAME@' [OK]\nConnection SLAVE Status '@CENTRAL_SLAVE_NAME@' [OK]\nSlave Thread Status [OK]\nPosition Status [OK]\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Si la synchronisation a ",(0,a.kt)("inlineCode",{parentName:"p"},"KO"),", vous devez la corriger \xe0 l'aide du ",(0,a.kt)("strong",{parentName:"p"},"Guide d'exploitation du cluster"),".")),(0,a.kt)("h3",{id:"retour-\xe0-la-situation-nominale"},"Retour \xe0 la situation nominale"),(0,a.kt)("p",null,"Pour revenir \xe0 la situation nominale, vous devez lancer le basculement des ressources."),(0,a.kt)("p",null,"Ex\xe9cutez la commande :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"pcs status\n")),(0,a.kt)("p",null,"La sortie devrait \xeatre :"),(0,a.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,a.kt)(s.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.0.5-9.0.1.el8_4.1-ba59be7122) - partition with quorum\n  * Last updated: Wed Sep 15 16:35:47 2021\n  * Last change:  Wed Sep 15 10:41:50 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\nFull List of Resources:\n  * Clone Set: ms_mysql-clone [ms_mysql] (promotable):\n    * Masters: [ @CENTRAL_MASTER_NAME@ ]\n    * Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: php-clone [php]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: cbd_rrd-clone [cbd_rrd]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Resource Group: centreon:\n    * vip       (ocf::heartbeat:IPaddr2):         Started @CENTRAL_SLAVE_NAME@\n    * http      (systemd:httpd):          Started @CENTRAL_SLAVE_NAME@\n    * gorgone   (systemd:gorgoned):       Started @CENTRAL_SLAVE_NAME@\n    * centreon_central_sync     (systemd:centreon-central-sync):          Started @CENTRAL_SLAVE_NAME@\n    * cbd_central_broker        (systemd:cbd-sql):       Started @CENTRAL_SLAVE_NAME@\n    * centengine        (systemd:centengine):    Started @CENTRAL_SLAVE_NAME@\n    * centreontrapd     (systemd:centreontrapd):         Started @CENTRAL_SLAVE_NAME@\n    * snmptrapd (systemd:snmptrapd):     Started @CENTRAL_SLAVE_NAME@\n")))),(0,a.kt)("p",null,"Ensuite, ex\xe9cutez la commande de nettoyage des contraintes si vous avez des ",(0,a.kt)("inlineCode",{parentName:"p"},"Contraintes de localisation")," :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource clear centreon\n")),(0,a.kt)("p",null,"Ensuite, ex\xe9cutez la commande de basculement : "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource move centreon\n")),(0,a.kt)("p",null,"Comme pr\xe9c\xe9demment, vous pouvez suivre le basculement avec la commande ",(0,a.kt)("inlineCode",{parentName:"p"},"crm_mon -fr"),"."),(0,a.kt)("p",null,"Enfin, supprimez les contraintes avec la commande :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource clear centreon\n")),(0,a.kt)("p",null,"V\xe9rifiez \xe9galement que la r\xe9plication MySQL est toujours op\xe9rationnelle en utilisant la commande :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/share/centreon-ha/bin/mysql-check-status.sh\n")),(0,a.kt)("p",null,"La commande doit retourner les informations suivantes :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Connection MASTER Status '@CENTRAL_MASTER_NAME@' [OK]\nConnection SLAVE Status '@CENTRAL_SLAVE_NAME@' [OK]\nSlave Thread Status [OK]\nPosition Status [OK]\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Si la synchronisation est ",(0,a.kt)("inlineCode",{parentName:"p"},"KO"),", vous devez la corriger en suivant le ",(0,a.kt)("strong",{parentName:"p"},"Guide d'exploitation du cluster"),".")),(0,a.kt)("h2",{id:"simuler-la-perte-du-noeud-secondaire"},"Simuler la perte du noeud secondaire"),(0,a.kt)("p",null,"Pour simuler une panne de r\xe9seau qui isolerait le noeud secondaire, vous pouvez utiliser ",(0,a.kt)("inlineCode",{parentName:"p"},"iptables")," pour supprimer le trafic depuis et vers le noeud secondaire.\nLe noeud secondaire sera compl\xe8tement exclu du cluster. Le noeud primaire garde la majorit\xe9 avec le QDevice."),(0,a.kt)("h3",{id:"traitement"},"Traitement"),(0,a.kt)("p",null,"Pour effectuer ce test, lancez les commandes ",(0,a.kt)("inlineCode",{parentName:"p"},"iptables")," sur le noeud primaire :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -A INPUT -s @IP_SECONDARY_NODE@ -j DROP\niptables -A OUTPUT -d @IP_SECONDARY_NODE@ -j DROP\n")),(0,a.kt)("p",null,"L'ex\xe9cution de la commande ",(0,a.kt)("inlineCode",{parentName:"p"},"pcs status")," sur le second n\u0153ud indique que les ressources sont arr\xeat\xe9es et que le n\u0153ud primaire est ",(0,a.kt)("inlineCode",{parentName:"p"},"offline"),":"),(0,a.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,a.kt)(s.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Cluster name: centreon_cluster\nCluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_SLAVE_NAME@ (version 2.1.2-4.el8_6.3-ada5c3b36e2) - partition WITHOUT quorum\n  * Last updated: Tue Nov  8 14:33:00 2022\n  * Last change:  Tue Nov  8 14:25:58 2022 by root via crm_resource on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_SLAVE_NAME@ ]\n  * OFFLINE: [ @CENTRAL_MASTER_NAME@ ]\nFull List of Resources:\n  * Clone Set: ms_mysql-clone [ms_mysql] (promotable):\n    * Stopped: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: php-clone [php]:\n    * Stopped: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: cbd_rrd-clone [cbd_rrd]:\n    * Stopped: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Resource Group: centreon:\n    * vip       (ocf::heartbeat:IPaddr2):        Stopped\n    * http      (systemd:httpd):         Stopped\n    * gorgone   (systemd:gorgoned):      Stopped\n    * centreon_central_sync     (systemd:centreon-central-sync):         Stopped\n    * cbd_central_broker        (systemd:cbd-sql):       Stopped\n    * centengine        (systemd:centengine):    Stopped\n    * centreontrapd     (systemd:centreontrapd):         Stopped\n    * snmptrapd (systemd:snmptrapd):     Stopped\nDaemon Status:\n  corosync: active/enabled\n  pacemaker: active/enabled\n  pcsd: active/enabled\n")))),(0,a.kt)("p",null,"Les ressources et le cluster fonctionnent toujours en effectuant un ",(0,a.kt)("inlineCode",{parentName:"p"},"pcs status")," sur le noeud primaire.\nLe noeud secondaire est vu ",(0,a.kt)("inlineCode",{parentName:"p"},"offline")," sur le primaire."),(0,a.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,a.kt)(s.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Cluster name: centreon_cluster\nCluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.1.2-4.el8_6.3-ada5c3b36e2) - partition with quorum\n  * Last updated: Tue Nov  8 15:19:52 2022\n  * Last change:  Tue Nov  8 14:25:58 2022 by root via crm_resource on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\nFull List of Resources:\n  * Clone Set: ms_mysql-clone [ms_mysql] (promotable):\n    * Masters: [ @CENTRAL_MASTER_NAME@ ]\n    @@ -545,40 +609,51 @@ Full List of Resources:\n    * centengine        (systemd:centengine):    Started @CENTRAL_MASTER_NAME@\n    * centreontrapd     (systemd:centreontrapd):         Started @CENTRAL_MASTER_NAME@\n    * snmptrapd (systemd:snmptrapd):     Started @CENTRAL_MASTER_NAME@\nDaemon Status:\n  corosync: active/enabled\n  pacemaker: active/enabled\n  pcsd: active/enabled\n")))),(0,a.kt)("h3",{id:"retour-\xe0-la-situation-nominale-1"},"Retour \xe0 la situation nominale"),(0,a.kt)("p",null,"Pour v\xe9rifier les diff\xe9rentes r\xe8gles iptables configur\xe9es sur le n\u0153ud primaire, ex\xe9cutez la commande suivante :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -L\n")),(0,a.kt)("p",null,"La commande doit retourner les informations suivantes :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Chain INPUT (policy ACCEPT)\ntarget     prot opt source               destination\nDROP       all  --  @CENTRAL_SLAVE_NAME@                 anywhere\n\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination\n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination\nDROP       all  --  anywhere             @CENTRAL_SLAVE_NAME@\n")),(0,a.kt)("p",null,"Si vous n'avez pas d'autres r\xe8gles iptables configur\xe9es, vous pouvez ex\xe9cuter la commande suivante pour supprimer les r\xe8gles li\xe9es au test :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -F\n")),(0,a.kt)("p",null,"Sinon, il sera n\xe9cessaire de lister les num\xe9ros de r\xe8gles avec la commande sp\xe9cifique :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -L --line-numbers\n")),(0,a.kt)("p",null,"Et le supprimer avec la commande :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -D INPUT @RULE_NUMBER@\niptables -D OUTPUT @RULE_NUMBER@\n")),(0,a.kt)("p",null,"Le noeud secondaire est \xe0 nouveau vu ",(0,a.kt)("inlineCode",{parentName:"p"},"en ligne")," par le cluster :"),(0,a.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,a.kt)(s.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.0.5-9.0.1.el8_4.1-ba59be7122) - partition with quorum\n  * Last updated: Wed Sep 15 16:35:47 2021\n  * Last change:  Wed Sep 15 10:41:50 2021 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\nFull List of Resources:\n  * Clone Set: ms_mysql-clone [ms_mysql] (promotable):\n    * Masters: [ @CENTRAL_MASTER_NAME@ ]\n    * Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: php-clone [php]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: cbd_rrd-clone [cbd_rrd]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Resource Group: centreon:\n    * vip       (ocf::heartbeat:IPaddr2):        Started @CENTRAL_MASTER_NAME@\n    * http      (systemd:httpd):         Started @CENTRAL_MASTER_NAME@\n    * gorgone   (systemd:gorgoned):      Started @CENTRAL_MASTER_NAME@\n    * centreon_central_sync     (systemd:centreon-central-sync):         Started @CENTRAL_MASTER_NAME@\n    * cbd_central_broker        (systemd:cbd-sql):       Started @CENTRAL_MASTER_NAME@\n    * centengine        (systemd:centengine):    Started @CENTRAL_MASTER_NAME@\n    * centreontrapd     (systemd:centreontrapd):         Started @CENTRAL_MASTER_NAME@\n    * snmptrapd (systemd:snmptrapd):     Started @CENTRAL_MASTER_NAME@\n")))),(0,a.kt)("p",null,"V\xe9rifiez \xe9galement que la r\xe9plication MySQL est toujours op\xe9rationnelle en utilisant la commande :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/share/centreon-ha/bin/mysql-check-status.sh\n")),(0,a.kt)("p",null,"La commande doit retourner les informations suivantes :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Connection MASTER Status '@CENTRAL_MASTER_NAME@' [OK]\nConnection SLAVE Status '@CENTRAL_SLAVE_NAME@' [OK]\nSlave Thread Status [OK]\nPosition Status [OK]\n")),(0,a.kt)("h3",{id:"simuler-la-perte-du-noeud-primaire"},"Simuler la perte du noeud primaire"),(0,a.kt)("h3",{id:"traitement-1"},"Traitement"),(0,a.kt)("p",null,"Pour effectuer ce test, ex\xe9cutez les commandes sur le serveur primaire :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -A INPUT -s @IP_SECONDARY_NODE@ -j DROP \niptables -A OUTPUT -d @IP_SECONDARY_NODE@ -j DROP \niptables -A INPUT -s @QDEVICE_IP@ -j DROP \niptables -A OUTPUT -d @QDEVICE_IP@  -j DROP\n")),(0,a.kt)("p",null,"Les ressources sur le noeud primaire doivent s'arr\xeater et doivent d\xe9marrer sur le noeud secondaire. Vous pouvez utiliser la commande ",(0,a.kt)("inlineCode",{parentName:"p"},"crm_mon -fr")," sur le noeud secondaire pour surveiller le d\xe9marrage des ressources :"),(0,a.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,a.kt)(s.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_SLAVE_NAME@ (version 2.0.5-9.0.1.el8_4.1-ba59be7122) - partition with quorum\n  * Last updated: Wed Sep 15 16:35:47 2021\n  * Last change:  Wed Sep 15 10:41:50 2021 by root via crm_attribute on @CENTRAL_SLAVE_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_SLAVE_NAME@ ]\n  * OFFLINE [ @CENTRAL_MASTER_NAME@ ]\nFull List of Resources:\n  * Clone Set: ms_mysql-clone [ms_mysql] (promotable):\n    * Masters: [ @CENTRAL_MASTER_NAME@ ]\n    * Slaves: [ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: php-clone [php]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: cbd_rrd-clone [cbd_rrd]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Resource Group: centreon:\n    * vip       (ocf::heartbeat:IPaddr2):        Started @CENTRAL_SLAVE_NAME@\n    * http      (systemd:httpd):         Started @CENTRAL_SLAVE_NAME@\n    * gorgone   (systemd:gorgoned):      Started @CENTRAL_SLAVE_NAME@\n    * centreon_central_sync     (systemd:centreon-central-sync):         Started @CENTRAL_SLAVE_NAME@\n    * cbd_central_broker        (systemd:cbd-sql):       Started @CENTRAL_SLAVE_NAME@\n    * centengine        (systemd:centengine):    Started @CENTRAL_SLAVE_NAME@\n    * centreontrapd     (systemd:centreontrapd):         Started @CENTRAL_SLAVE_NAME@\n    * snmptrapd (systemd:snmptrapd):     Started @CENTRAL_SLAVE_NAME@\n")))),(0,a.kt)("p",null,"Ce test v\xe9rifie que les ressources seront bascul\xe9es sur le n\u0153ud secondaire si le n\u0153ud primaire est indisponible et permet la continuit\xe9 du service."),(0,a.kt)("h3",{id:"retour-\xe0-la-situation-nominale-2"},"Retour \xe0 la situation nominale"),(0,a.kt)("p",null,"Pour v\xe9rifier les diff\xe9rentes r\xe8gles iptables configur\xe9es sur le n\u0153ud primaire, ex\xe9cutez la commande suivante :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -L\n")),(0,a.kt)("p",null,"La commande doit retourner les informations suivantes :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Chain INPUT (policy ACCEPT)\ntarget     prot opt source               destination\nDROP       all  --  @CENTRAL_SLAVE_NAME@                 anywhere\nDROP       all  --  @QDEVICE_NAME@      anywhere\n\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination\n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination\nDROP       all  --  anywhere             @CENTRAL_SLAVE_NAME@\nDROP       all  --  anywhere             @QDEVICE_NAME@\n")),(0,a.kt)("p",null,"Si vous n'avez pas d'autres r\xe8gles iptables configur\xe9es, vous pouvez ex\xe9cuter la commande suivante pour supprimer les r\xe8gles li\xe9es au test :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -F\n")),(0,a.kt)("p",null,"Sinon, il sera n\xe9cessaire de lister les num\xe9ros de r\xe8gles avec la commande sp\xe9cifique :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -L --line-numbers\n")),(0,a.kt)("p",null,"Et le supprimer avec la commande :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -D INPUT @RULE_NUMBER@;\niptables -D OUTPUT @RULE_NUMBER@\n")),(0,a.kt)("p",null,"En ex\xe9cutant la commande ",(0,a.kt)("inlineCode",{parentName:"p"},"crm_mon")," sur le n\u0153ud secondaire, vous verrez le n\u0153ud primaire monter dans le cluster mais rester en tant que n\u0153ud SLAVE."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.1.2-4.el8_6.3-ada5c3b36e2) - partition with quorum\n  * Last updated: Tue Nov  8 17:27:28 2022\n  * Last change:  Tue Nov  8 17:23:19 2022 by root via crm_attribute on @CENTRAL_SLAVE_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\nFull List of Resources:\n  * Clone Set: ms_mysql-clone [ms_mysql] (promotable):\n    * ms_mysql  (ocf::heartbeat:mariadb-centreon):       Stopped @CENTRAL_MASTER_NAME@ (Monitoring)\n    * Masters: [ @CENTRAL_SLAVE_NAME@ ]\n    * Stopped: [ @CENTRAL_MASTER_NAME@ ]\n  * Clone Set: php-clone [php]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Clone Set: cbd_rrd-clone [cbd_rrd]:\n    * Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n  * Resource Group: centreon:\n    * vip       (ocf::heartbeat:IPaddr2):        Started @CENTRAL_SLAVE_NAME@\n    * http      (systemd:httpd):         Started @CENTRAL_SLAVE_NAME@\n    * gorgone   (systemd:gorgoned):      Started @CENTRAL_SLAVE_NAME@\n    * centreon_central_sync     (systemd:centreon-central-sync):         Started @CENTRAL_SLAVE_NAME@\n    * cbd_central_broker        (systemd:cbd-sql):       Started @CENTRAL_SLAVE_NAME@\n    * centengine        (systemd:centengine):    Started @CENTRAL_SLAVE_NAME@\n    * centreontrapd     (systemd:centreontrapd):         Started @CENTRAL_SLAVE_NAME@\n    * snmptrapd (systemd:snmptrapd):     Started @CENTRAL_SLAVE_NAME@\nMigration Summary:\n  * Node: @CENTRAL_MASTER_NAME@:\n    * ms_mysql: migration-threshold=1000000 fail-count=1000000 last-failure='Tue Nov  8 17:27:25 2\n022'\nFailed Resource Actions:\n  * ms_mysql_start_0 on @CENTRAL_MASTER_NAME@ 'error' (1): call=440, status='complete', exitreason='M\nariaDB slave io has failed (1236): Got fatal error 1236 from master when reading data from binary\nlog: 'Error: connecting slave', last-rc-change='Tue Nov  8 17:27:21 2022', queued=0ms, exec=4060ms\n")),(0,a.kt)("p",null,"Si vous voulez passer au n\u0153ud primaire, vous devez effectuer un basculement.\nDonc, ",(0,a.kt)("strong",{parentName:"p"},"avant de faire cela, vous devez v\xe9rifier le statut du cluster et de la r\xe9plication de la base de donn\xe9es"),"."),(0,a.kt)("p",null,"Tout d'abord, v\xe9rifiez les contraintes :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"pcs constraint\n")),(0,a.kt)("p",null,"La commande doit retourner un r\xe9sultat similaire \xe0 ceci :"),(0,a.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,a.kt)(s.Z,{value:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",label:"RHEL 8 / Oracle Linux 8 / Alma Linux 8",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Location Constraints:\nOrdering Constraints:\nColocation Constraints:\n  ms_mysql-clone with centreon (score:INFINITY) (rsc-role:Master) (with-rsc-role:Started)\n  centreon with ms_mysql-clone (score:INFINITY) (rsc-role:Master) (with-rsc-role:Started)\nTicket Constraints:\n")))),(0,a.kt)("p",null,"Maintenant, v\xe9rifiez le statut de r\xe9plication via la commande suivante :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/share/centreon-ha/bin/mysql-check-status.sh\n")),(0,a.kt)("p",null,"\xc0 ce moment, le cluster est en mode d\xe9grad\xe9 avec deux n\u0153uds esclaves.\nDans ce cas particulier, il retourne les informations suivantes car la ressource ms_mysql est arr\xeat\xe9e sur @CENTRAL_MASTER_NAME@ :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Connection SLAVE Status '@CENTRAL_MASTER_NAME@' [KO]\nError reports:\n    ERROR 2002 (HY000): Can't connect to MySQL server on '@CENTRAL_MASTER_NAME@' (115)\nImpossible de se connecter au serveur '@CENTRAL_MASTER_NAME@'.\nConnection SLAVE Status '@CENTRAL_SLAVE_NAME@' [OK]\nSlave Thread Status [KO]\nError reports:\n    Skip check on '@CENTRAL_MASTER_NAME@'.\n    No slave (maybe because we cannot check a server).\nPosition Status [SKIP]\nError reports:\n    Skip because we can't identify a unique slave.\n")),(0,a.kt)("p",null,'Vous devez donc resynchroniser les bases depuis @CENTRAL_SLAVE_NAME@ vers @CENTRAL_MASTER_NAME@ en lan\xe7ant le script "sync-bigdb" sur le ',(0,a.kt)("strong",{parentName:"p"},"n\u0153ud SLAVE"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"/usr/share/centreon-ha/bin/mysql-sync-bigdb.sh\n")),(0,a.kt)("p",null,"Comme lors de l'ex\xe9cution pr\xe9c\xe9dente de ce script, v\xe9rifiez si le snapshot LVM est correctement supprim\xe9 et l'esclave MySQL red\xe9marr\xe9."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-l"},'```text\n...\nUmount and Delete LVM snapshot\n  Logical volume "dbbackupdatadir" successfully removed.\nStart MySQL Slave\nOK\nStart Replication\nId      User    Host    db      Command Time    State   Info    Progress\n5       centreon-repl   @CENTRAL_SLAVE_NAME@:51850        NULL    Query   0       starting        show processlist  0.000\n6       centreon        localhost       centreon_storage        Sleep   0               NULL    0.000\n7       system user             NULL    Connect 0       Connecting to master    NULL    0.000\n8       system user             NULL    Slave_SQL       0       Slave has read all relay log; waiting for more updates    NULL    0.000\n')),(0,a.kt)("p",null,"Maintenant, la r\xe9plication de la base de donn\xe9es devrait \xeatre OK, v\xe9rifiez-la."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"/usr/share/centreon-ha/bin/mysql-check-status.sh\n")),(0,a.kt)("p",null,"le r\xe9sultat devrait \xeatre :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Connection MASTER Status '@CENTRAL_SLAVE_NAME@' [OK]\nConnection SLAVE Status '@CENTRAL_MASTER_NAME@' [OK]\nSlave Thread Status [OK]\nPosition Status [OK]\n")),(0,a.kt)("p",null,"Maintenant, vous pouvez effectuer un failover pour revenir en situation initiale."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"pcs resource clear centreon\n")),(0,a.kt)("p",null,'Faites un "cleanup" pour effacer les erreurs et red\xe9marrez la ressource ms_mysql sur @CENTRAL_MASTER_NAME@.'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"pcs resource cleanup\n")),(0,a.kt)("p",null,"La situation est stabilis\xe9e, vous pouvez effectuer un failover en d\xe9pla\xe7ant la ressource ",(0,a.kt)("strong",{parentName:"p"},"centreon"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"pcs resource move centreon\n")),(0,a.kt)("p",null,"La ressource ",(0,a.kt)("strong",{parentName:"p"},"centreon")," est maintenant relocalis\xe9e et le cluster est OK, v\xe9rifiez avec ",(0,a.kt)("inlineCode",{parentName:"p"},"crm_mon -fr")," sur n'importe quel n\u0153ud."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Cluster Summary:\n  * Stack: corosync\n  * Current DC: @CENTRAL_MASTER_NAME@ (version 2.1.2-4.el8_6.3-ada5c3b36e2) - partition with quorum\n  * Last updated: Wed Nov  9 10:23:54 2022\n  * Last change:  Wed Nov  9 10:23:26 2022 by root via crm_attribute on @CENTRAL_MASTER_NAME@\n  * 2 nodes configured\n  * 14 resource instances configured\nNode List:\n  * Online: [ @CENTRAL_MASTER_NAME@ centreon-rhel8-sec ]\nFull List of Resources:\n  * Clone Set: ms_mysql-clone [ms_mysql] (promotable):\n    * Masters: [ @CENTRAL_MASTER_NAME@ ]\n    * Slaves: [ centreon-rhel8-sec ]\n  * Clone Set: php-clone [php]:\n    * Started: [ @CENTRAL_MASTER_NAME@ centreon-rhel8-sec ]\n  * Clone Set: cbd_rrd-clone [cbd_rrd]:\n    * Started: [ @CENTRAL_MASTER_NAME@ centreon-rhel8-sec ]\n  * Resource Group: centreon:\n    * vip       (ocf::heartbeat:IPaddr2):        Started @CENTRAL_MASTER_NAME@\n    * http      (systemd:httpd):         Started @CENTRAL_MASTER_NAME@\n    * gorgone   (systemd:gorgoned):      Started @CENTRAL_MASTER_NAME@\n    * centreon_central_sync     (systemd:centreon-central-sync):         Started @CENTRAL_MASTER_NAME@\n    * cbd_central_broker        (systemd:cbd-sql):       Started @CENTRAL_MASTER_NAME@\n    * centengine        (systemd:centengine):    Started @CENTRAL_MASTER_NAME@\n    * centreontrapd     (systemd:centreontrapd):         Started @CENTRAL_MASTER_NAME@\n    * snmptrapd (systemd:snmptrapd):     Started @CENTRAL_MASTER_NAME@\nMigration Summary:\n"))),(0,a.kt)(s.Z,{value:"HA 4 Nodes",label:"HA 4 Nodes",mdxType:"TabItem"},(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Ce document fera r\xe9f\xe9rence aux param\xe8tres qui varient d'une installation \xe0 l'autre (par exemple, les noms et adresses IP des n\u0153uds) via les macros d\xe9finies \xe0 la page suivante : ",(0,a.kt)("strong",{parentName:"p"},"Installation d'un cluster \xe0 4 n\u0153uds"),", section ",(0,a.kt)("strong",{parentName:"p"},"D\xe9finition des noms et adresses IP des serveurs"),".")),(0,a.kt)("h3",{id:"conditions-requises-pour-les-tests-1"},"Conditions requises pour les tests"),(0,a.kt)("p",null,"Pour v\xe9rifier le bon fonctionnement de votre cluster, vous obtiendrez toutes les commandes pour effectuer un test de basculement et simuler des pannes de r\xe9seau."),(0,a.kt)("p",null,"Il est n\xe9cessaire de v\xe9rifier l'\xe9tat du cluster avant d'effectuer les tests d'acceptation. "),(0,a.kt)("h3",{id:"v\xe9rifier-l\xe9tat-du-cluster-1"},"V\xe9rifier l'\xe9tat du cluster"),(0,a.kt)("p",null,"Pour v\xe9rifier l'\xe9tat g\xe9n\xe9ral du cluster, ex\xe9cutez la commande :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"pcs status\n")),(0,a.kt)("p",null,"La commande devrait retourner les informations suivantes :"),(0,a.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,a.kt)(s.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Cluster name: centreon_cluster\nStack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el8_9.1-9acf116022) - partition with quorum\nLast updated: Wed May  4 15:36:20 2022\nLast change: Mon May  2 18:20:27 2022 by root via crm_attribute on @DATABASE_MASTER_NAME@\n\n4 nodes configured\n21 resource instances configured\n\nOnline: [ @DATABASE_MASTER_NAME@ @CENTRAL_MASTER_NAME@ @DATABASE_SLAVE_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\nFull list of resources:\n\n Master/Slave Set: ms_mysql-clone [ms_mysql]\n     Masters: [ @DATABASE_MASTER_NAME@ ]\n     Slaves: [ @DATABASE_SLAVE_NAME@ ]\n     Stopped: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n vip_mysql      (ocf::heartbeat:IPaddr2):       Started @DATABASE_MASTER_NAME@\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_MASTER_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_MASTER_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_MASTER_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_MASTER_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_MASTER_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_MASTER_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_MASTER_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_MASTER_NAME@\n\nDaemon Status:\n  corosync: active/enabled\n  pacemaker: active/enabled\n  pcsd: active/enabled\n")))),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"V\xe9rifiez les erreurs ",(0,a.kt)("inlineCode",{parentName:"p"},"Failed")," dans les ressources et corrigez-les \xe0 l'aide de la page ",(0,a.kt)("strong",{parentName:"p"},"D\xe9panner Centreon-HA"),".")),(0,a.kt)("h3",{id:"v\xe9rifier-les-contraintes-1"},"V\xe9rifier les contraintes"),(0,a.kt)("p",null,"Pour v\xe9rifier qu'il n'y a pas de ",(0,a.kt)("inlineCode",{parentName:"p"},"Contraintes de localisation"),", ex\xe9cutez la commande :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"pcs constraint\n")),(0,a.kt)("p",null,"La commande devrait renvoyer ceci :"),(0,a.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,a.kt)(s.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Location Constraints:\n  Resource: cbd_rrd-clone\n    Disabled on: @DATABASE_MASTER_NAME@ (score:-INFINITY)\n    Disabled on: @DATABASE_SLAVE_NAME@ (score:-INFINITY)\n  Resource: centreon\n    Disabled on: @DATABASE_MASTER_NAME@ (score:-INFINITY)\n    Disabled on: @DATABASE_SLAVE_NAME@ (score:-INFINITY)\n  Resource: ms_mysql-clone\n    Disabled on: @CENTRAL_MASTER_NAME@ (score:-INFINITY)\n    Disabled on: @DATABASE_SLAVE_NAME@ (score:-INFINITY)\n  Resource: php-clone\n    Disabled on: @DATABASE_MASTER_NAME@ (score:-INFINITY)\n    Disabled on: @DATABASE_SLAVE_NAME@ (score:-INFINITY)\nOrdering Constraints:\nColocation Constraints:\n  vip_mysql with ms_mysql-clone (score:INFINITY) (rsc-role:Started) (with-rsc-role:Master)\n  ms_mysql-clone with vip_mysql (score:INFINITY) (rsc-role:Master) (with-rsc-role:Started)\nTicket Constraints:\n")))),(0,a.kt)("h3",{id:"v\xe9rifier-l\xe9tat-de-la-synchronisation-de-la-base-de-donn\xe9es-1"},"V\xe9rifier l'\xe9tat de la synchronisation de la base de donn\xe9es"),(0,a.kt)("p",null,"Pour v\xe9rifier que la synchronisation de la base de donn\xe9es fonctionne, ex\xe9cutez la commande :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/share/centreon-ha/bin/mysql-check-status.sh\n")),(0,a.kt)("p",null,"La commande devrait retourner les informations suivantes :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"Connection MASTER Status '@DATABASE_MASTER_NAME@' [OK]\nConnection SLAVE Status '@DATABASE_SLAVE_NAME@' [OK]\nSlave Thread Status [OK]\nPosition Status [OK]\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Si la synchronisation indique ",(0,a.kt)("inlineCode",{parentName:"p"},"KO"),", vous devez la corriger \xe0 l'aide du ",(0,a.kt)("strong",{parentName:"p"},"Guide d'exploitation du cluster"),".")),(0,a.kt)("h2",{id:"basculement-des-ressources-du-centreon-1"},"Basculement des ressources du Centreon"),(0,a.kt)("h3",{id:"etat-du-cluster-avant-le-failover-1"},"Etat du cluster avant le failover"),(0,a.kt)("p",null,"Avant d'ex\xe9cuter un test de basculement, v\xe9rifiez l'\xe9tat du cluster avec la commande suivante :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"pcs status\n")),(0,a.kt)("p",null,"Le r\xe9sultat attendu est :"),(0,a.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,a.kt)(s.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Cluster name: centreon_cluster\nStack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el8_9.1-9acf116022) - partition with quorum\nLast updated: Wed May  4 15:36:20 2022\nLast change: Mon May  2 18:20:27 2022 by root via crm_attribute on @DATABASE_MASTER_NAME@\n\n4 nodes configured\n21 resource instances configured\n\nOnline: [ @DATABASE_MASTER_NAME@ @CENTRAL_MASTER_NAME@ @DATABASE_SLAVE_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\nFull list of resources:\n\n Master/Slave Set: ms_mysql-clone [ms_mysql]\n     Masters: [ @DATABASE_MASTER_NAME@ ]\n     Slaves: [ @DATABASE_SLAVE_NAME@ ]\n     Stopped: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n vip_mysql      (ocf::heartbeat:IPaddr2):       Started @DATABASE_MASTER_NAME@\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_MASTER_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_MASTER_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_MASTER_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_MASTER_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_MASTER_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_MASTER_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_MASTER_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_MASTER_NAME@\n\nDaemon Status:\n  corosync: active/enabled\n  pacemaker: active/enabled\n  pcsd: active/enabled\n")))),(0,a.kt)("h3",{id:"effectuer-un-basculement-1"},"Effectuer un basculement"),(0,a.kt)("p",null,"Pour d\xe9placer les ressources, ex\xe9cutez la commande :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource move centreon\n")),(0,a.kt)("p",null,"Vous pouvez \xe9galement utiliser la commande ",(0,a.kt)("inlineCode",{parentName:"p"},"crm_mon -fr")," pour observer le basculement pendant qu'il se produit. Il sera n\xe9cessaire d'utiliser Ctrl+c pour quitter la commande."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Avertissement : La commande ",(0,a.kt)("inlineCode",{parentName:"p"},"pcs resource move centreon")," d\xe9finit une contrainte ",(0,a.kt)("inlineCode",{parentName:"p"},"-INFINITY")," sur le noeud h\xe9bergeant la ressource, qui n'est plus autoris\xe9e \xe0 \xeatre ex\xe9cut\xe9e sur ce noeud.")),(0,a.kt)("p",null,"En cons\xe9quence, les ressources se d\xe9placent vers un autre noeud. Suite \xe0 cette manipulation, il est donc n\xe9cessaire d'ex\xe9cuter la commande ",(0,a.kt)("inlineCode",{parentName:"p"},"pcs resource clear centreon")," pour s'assurer que les ressources pourront \xeatre d\xe9plac\xe9es \xe0 nouveau vers ce noeud dans le futur."),(0,a.kt)("p",null,"Pour v\xe9rifier que les ressources ont \xe9t\xe9 d\xe9plac\xe9es vers le second n\u0153ud, ex\xe9cutez la commande : "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"pcs status\n")),(0,a.kt)("p",null,"Le r\xe9sultat attendu est :"),(0,a.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,a.kt)(s.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Cluster name: centreon_cluster\nStack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el8_9.1-9acf116022) - partition with quorum\nLast updated: Wed May  4 15:36:20 2022\nLast change: Mon May  2 18:20:27 2022 by root via crm_attribute on @DATABASE_MASTER_NAME@\n\n4 nodes configured\n21 resource instances configured\n\nOnline: [ @DATABASE_MASTER_NAME@ @CENTRAL_MASTER_NAME@ @DATABASE_SLAVE_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\nFull list of resources:\n\n Master/Slave Set: ms_mysql-clone [ms_mysql]\n     Masters: [ @DATABASE_MASTER_NAME@ ]\n     Slaves: [ @DATABASE_SLAVE_NAME@ ]\n     Stopped: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n vip_mysql      (ocf::heartbeat:IPaddr2):       Started @DATABASE_MASTER_NAME@\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_SLAVE_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_SLAVE_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_SLAVE_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_SLAVE_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_SLAVE_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_SLAVE_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_SLAVE_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_SLAVE_NAME@\n\nDaemon Status:\n  corosync: active/enabled\n  pacemaker: active/enabled\n  pcsd: active/enabled\n")))),(0,a.kt)("p",null,"Une fois le basculement termin\xe9, ex\xe9cutez la commande :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource clear centreon\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Cela permettra de supprimer les contraintes \xe9tablies lors du basculement.")),(0,a.kt)("p",null,"V\xe9rifiez \xe9galement que la r\xe9plication MySQL est toujours op\xe9rationnelle en utilisant la commande :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/share/centreon-ha/bin/mysql-check-status.sh\n")),(0,a.kt)("p",null,"La commande doit retourner les informations suivantes :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Connection MASTER Status '@CENTRAL_MASTER_NAME@' [OK]\nConnection SLAVE Status '@CENTRAL_SLAVE_NAME@' [OK]\nSlave Thread Status [OK]\nPosition Status [OK]\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Si la synchronisation a ",(0,a.kt)("inlineCode",{parentName:"p"},"KO"),", vous devez la corriger \xe0 l'aide du ",(0,a.kt)("strong",{parentName:"p"},"Guide d'exploitation du cluster"),".")),(0,a.kt)("h3",{id:"retour-\xe0-la-situation-nominale-3"},"Retour \xe0 la situation nominale"),(0,a.kt)("p",null,"Pour revenir \xe0 la situation nominale, vous devez lancer le basculement des ressources."),(0,a.kt)("p",null,"Ex\xe9cutez la commande :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"pcs status\n")),(0,a.kt)("p",null,"La sortie devrait \xeatre :"),(0,a.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,a.kt)(s.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Cluster name: centreon_cluster\nStack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el8_9.1-9acf116022) - partition with quorum\nLast updated: Wed May  4 15:36:20 2022\nLast change: Mon May  2 18:20:27 2022 by root via crm_attribute on @DATABASE_MASTER_NAME@\n\n4 nodes configured\n21 resource instances configured\n\nOnline: [ @DATABASE_MASTER_NAME@ @CENTRAL_MASTER_NAME@ @DATABASE_SLAVE_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\nFull list of resources:\n\n Master/Slave Set: ms_mysql-clone [ms_mysql]\n     Masters: [ @DATABASE_MASTER_NAME@ ]\n     Slaves: [ @DATABASE_SLAVE_NAME@ ]\n     Stopped: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n vip_mysql      (ocf::heartbeat:IPaddr2):       Started @DATABASE_MASTER_NAME@\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_SLAVE_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_SLAVE_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_SLAVE_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_SLAVE_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_SLAVE_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_SLAVE_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_SLAVE_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_SLAVE_NAME@\n\nDaemon Status:\n  corosync: active/enabled\n  pacemaker: active/enabled\n  pcsd: active/enabled\n")))),(0,a.kt)("p",null,"Ensuite, ex\xe9cutez la commande de nettoyage des contraintes si vous avez des ",(0,a.kt)("inlineCode",{parentName:"p"},"Contraintes de localisation")," :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource clear centreon\n")),(0,a.kt)("p",null,"Ensuite, ex\xe9cutez la commande de basculement : "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource move centreon\n")),(0,a.kt)("p",null,"Comme pr\xe9c\xe9demment, vous pouvez suivre le basculement avec la commande ",(0,a.kt)("inlineCode",{parentName:"p"},"crm_mon -fr"),"."),(0,a.kt)("p",null,"Enfin, supprimez les contraintes avec la commande :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"pcs resource clear centreon\n")),(0,a.kt)("h2",{id:"simuler-la-perte-du-noeud-secondaire-1"},"Simuler la perte du noeud secondaire"),(0,a.kt)("p",null,"Pour simuler une panne de r\xe9seau qui isolerait le @CENTRAL_SLAVE_NAME@, vous pouvez utiliser ",(0,a.kt)("inlineCode",{parentName:"p"},"iptables")," pour supprimer le trafic depuis et vers le @CENTRAL_SLAVE_NAME@.\nLe @CENTRAL_SLAVE_NAME@ sera compl\xe8tement exclu du cluster. Le @CENTRAL_MASTER_NAME@ garde la majorit\xe9 avec le QDevice."),(0,a.kt)("h3",{id:"traitement-2"},"Traitement"),(0,a.kt)("p",null,"Pour effectuer ce test, lancez les commandes ",(0,a.kt)("inlineCode",{parentName:"p"},"iptables")," sur le @CENTRAL_SLAVE_NAME@. Faites attention \xe0 ne pas utiliser @CENTRAL_SLAVE_IPADDR@ sinon vous perdrez la connexion SSH sur ce noeud."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -A INPUT -s @CENTRAL_MASTER_IPADDR@ -j DROP\niptables -A OUTPUT -d @CENTRAL_MASTER_IPADDR@ -j DROP\niptables -A INPUT -s @DATABASE_MASTER_IPADDR@ -j DROP\niptables -A OUTPUT -d @DATABASE_MASTER_IPADDR@ -j DROP\niptables -A INPUT -s @DATABASE_SLAVE_IPADDR@ -j DROP\niptables -A OUTPUT -d @DATABASE_SLAVE_IPADDR@ -j DROP\niptables -A INPUT -s @QDEVICE_IPADDR@ -j DROP\niptables -A OUTPUT -d @QDEVICE_IPADDR@ -j DROP\n")),(0,a.kt)("p",null,"L'ex\xe9cution de la commande fait qu'aucune ressource active n'est visible sur le n\u0153ud secondaire et que le n\u0153ud primaire est vu comme ",(0,a.kt)("inlineCode",{parentName:"p"},"offline"),".\nLes ressources et le cluster fonctionnent toujours en ex\xe9cutant un ",(0,a.kt)("inlineCode",{parentName:"p"},"pcs status")," sur le noeud primaire."),(0,a.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,a.kt)(s.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Cluster name: centreon_cluster\nStack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el8_9.1-9acf116022) - partition with quorum\nLast updated: Thu May  5 10:34:05 2022\nLast change: Thu May  5 09:09:50 2022 by root via crm_resource on @CENTRAL_MASTER_NAME@\n\n4 nodes configured\n21 resource instances configured\n\nOnline: [ @DATABASE_MASTER_NAME@ @CENTRAL_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\nOFFLINE: [ @CENTRAL_SLAVE_NAME@ ]\n\nFull list of resources:\n\n Master/Slave Set: ms_mysql-clone [ms_mysql]\n     Masters: [ @DATABASE_MASTER_NAME@ ]\n     Slaves: [ @DATABASE_SLAVE_NAME@ ]\n     Stopped: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n vip_mysql      (ocf::heartbeat:IPaddr2):       Started @DATABASE_MASTER_NAME@\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ @CENTRAL_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_MASTER_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_MASTER_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_MASTER_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_MASTER_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_MASTER_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_MASTER_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_MASTER_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_MASTER_NAME@\n\nDaemon Status:\n  corosync: active/enabled\n  pacemaker: active/enabled\n  pcsd: active/enabled\n")))),(0,a.kt)("h3",{id:"retour-\xe0-la-situation-nominale-4"},"Retour \xe0 la situation nominale"),(0,a.kt)("p",null,"Pour v\xe9rifier les diff\xe9rentes r\xe8gles iptables configur\xe9es sur le n\u0153ud primaire, ex\xe9cutez la commande suivante :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -L\n")),(0,a.kt)("p",null,"La commande doit retourner les informations suivantes :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Chain INPUT (policy ACCEPT)\ntarget     prot opt source               destination\nDROP       all  --  @CENTRAL_SLAVE_NAME@                 anywhere\n\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination\n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination\nDROP       all  --  anywhere             @CENTRAL_SLAVE_NAME@\n")),(0,a.kt)("p",null,"Si vous n'avez pas d'autres r\xe8gles iptables configur\xe9es, vous pouvez ex\xe9cuter la commande suivante pour supprimer les r\xe8gles li\xe9es au test :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -F\n")),(0,a.kt)("p",null,"Sinon, il sera n\xe9cessaire de lister les num\xe9ros de r\xe8gles avec la commande sp\xe9cifique :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -L --line-numbers\n")),(0,a.kt)("p",null,"Et le supprimer avec la commande :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -D INPUT @RULE_NUMBER@\niptables -D OUTPUT @RULE_NUMBER@\n")),(0,a.kt)("p",null,"Le noeud secondaire est \xe0 nouveau vu ",(0,a.kt)("inlineCode",{parentName:"p"},"en ligne")," par le cluster :"),(0,a.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,a.kt)(s.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Cluster name: centreon_cluster\nStack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el8_9.1-9acf116022) - partition with quorum\nLast updated: Wed May  4 15:36:20 2022\nLast change: Mon May  2 18:20:27 2022 by root via crm_attribute on @DATABASE_MASTER_NAME@\n\n4 nodes configured\n21 resource instances configured\n\nOnline: [ @DATABASE_MASTER_NAME@ @CENTRAL_MASTER_NAME@ @DATABASE_SLAVE_NAME@ @CENTRAL_SLAVE_NAME@ ]\n\nFull list of resources:\n\n Master/Slave Set: ms_mysql-clone [ms_mysql]\n     Masters: [ @DATABASE_MASTER_NAME@ ]\n     Slaves: [ @DATABASE_SLAVE_NAME@ ]\n     Stopped: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n vip_mysql      (ocf::heartbeat:IPaddr2):       Started @DATABASE_MASTER_NAME@\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_MASTER_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_MASTER_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_MASTER_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_MASTER_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_MASTER_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_MASTER_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_MASTER_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_MASTER_NAME@\n\nDaemon Status:\n  corosync: active/enabled\n  pacemaker: active/enabled\n  pcsd: active/enabled\n")))),(0,a.kt)("p",null,"V\xe9rifiez \xe9galement que la r\xe9plication MySQL est toujours op\xe9rationnelle en utilisant la commande :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/share/centreon-ha/bin/mysql-check-status.sh\n")),(0,a.kt)("p",null,"La commande doit comporter les informations suivantes :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Connection MASTER Status '@DATABASE_MASTER_NAME@' [OK]\nConnection MASTER Status '@DATABASE_SLAVE_NAME@' [OK]\nSlave Thread Status [OK]\nPosition Status [OK]\n")),(0,a.kt)("h3",{id:"simuler-la-perte-du-noeud-primaire-1"},"Simuler la perte du noeud primaire"),(0,a.kt)("h3",{id:"traitement-3"},"Traitement"),(0,a.kt)("p",null,"Pour effectuer ce test, ex\xe9cutez les commandes sur le @CENTRAL_MASTER_NAME@ :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -A INPUT -s @CENTRAL_SLAVE_IPADDR@ -j DROP\niptables -A OUTPUT -d @CENTRAL_SLAVE_IPADDR@ -j DROP\niptables -A INPUT -s @DATABASE_MASTER_IPADDR@ -j DROP\niptables -A OUTPUT -d @DATABASE_MASTER_IPADDR@ -j DROP\niptables -A INPUT -s @DATABASE_SLAVE_IPADDR@ -j DROP\niptables -A OUTPUT -d @DATABASE_SLAVE_IPADDR@ -j DROP\niptables -A INPUT -s @QDEVICE_IPADDR@ -j DROP\niptables -A OUTPUT -d @QDEVICE_IPADDR@ -j DROP\n")),(0,a.kt)("p",null,"Les ressources sur le @CENTRAL_MASTER_NAME@ doivent s'arr\xeater et d\xe9marrer sur le @CENTRAL_SLAVE_NAME@. Vous pouvez utiliser la commande ",(0,a.kt)("inlineCode",{parentName:"p"},"crm_mon -fr")," sur le @CENTRAL_SLAVE_NAME@ pour surveiller le d\xe9marrage des ressources :"),(0,a.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,a.kt)(s.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Stack: corosync\nCurrent DC: @CENTRAL_MASTER_NAME@ (version 1.1.23-1.el8_9.1-9acf116022) - partition with quorum\nLast updated: Thu May  5 11:06:38 2022\nLast change: Thu May  5 09:09:50 2022 by root via crm_resource on @CENTRAL_MASTER_NAME@\n\n4 nodes configured\n21 resource instances configured\n\nOnline: [ @DATABASE_MASTER_NAME@ @DATABASE_SLAVE_NAME@ @CENTRAL_SLAVE_NAME@ ]\nOFFLINE: [ @CENTRAL_MASTER_NAME@ ]\n\nFull list of resources:\n\n Master/Slave Set: ms_mysql-clone [ms_mysql]\n     Masters: [ @DATABASE_MASTER_NAME@ ]\n     Slaves: [ @DATABASE_SLAVE_NAME@ ]\n     Stopped: [ @CENTRAL_MASTER_NAME@ @CENTRAL_SLAVE_NAME@ ]\nvip_mysql       (ocf::heartbeat:IPaddr2):       Started @DATABASE_MASTER_NAME@\n Clone Set: php-clone [php]\n     Started: [ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @CENTRAL_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Clone Set: cbd_rrd-clone [cbd_rrd]\n     Started: [ @CENTRAL_SLAVE_NAME@ ]\n     Stopped: [ @DATABASE_MASTER_NAME@ @CENTRAL_MASTER_NAME@ @DATABASE_SLAVE_NAME@ ]\n Resource Group: centreon\n     vip        (ocf::heartbeat:IPaddr2):       Started @CENTRAL_SLAVE_NAME@\n     http       (systemd:httpd24-httpd):        Started @CENTRAL_SLAVE_NAME@\n     gorgone    (systemd:gorgoned):     Started @CENTRAL_SLAVE_NAME@\n     centreon_central_sync      (systemd:centreon-central-sync):        Started @CENTRAL_SLAVE_NAME@\n     cbd_central_broker (systemd:cbd-sql):      Started @CENTRAL_SLAVE_NAME@\n     centengine (systemd:centengine):   Started @CENTRAL_SLAVE_NAME@\n     centreontrapd      (systemd:centreontrapd):        Started @CENTRAL_SLAVE_NAME@\n     snmptrapd  (systemd:snmptrapd):    Started @CENTRAL_SLAVE_NAME@\n\nMigration Summary:\n* Node @DATABASE_MASTER_NAME@:\n* Node @CENTRAL_SLAVE_NAME@:\n* Node @DATABASE_SLAVE_NAME@:\n")))),(0,a.kt)("p",null,"Ce test v\xe9rifie que les ressources seront bascul\xe9es sur le n\u0153ud secondaire si le n\u0153ud primaire est indisponible et permet la continuit\xe9 du service."),(0,a.kt)("h3",{id:"retour-\xe0-la-situation-nominale-5"},"Retour \xe0 la situation nominale"),(0,a.kt)("p",null,"Pour v\xe9rifier les diff\xe9rentes r\xe8gles iptables configur\xe9es sur le n\u0153ud primaire, ex\xe9cutez la commande suivante :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -L\n")),(0,a.kt)("p",null,"La commande devrait retourner les informations suivantes :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Chain INPUT (policy ACCEPT)\ntarget     prot opt source               destination\nDROP       all  --  @CENTRAL_SLAVE_NAME@  anywhere\nDROP       all  --  @DATABASE_MASTER_NAME@  anywhere\nDROP       all  --  @DATABASE_SLAVE_NAME@  anywhere\nDROP       all  --  @QDEVICE_NAME@  anywhere\n\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination\n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination\nDROP       all  --  anywhere             @CENTRAL_SLAVE_NAME@\nDROP       all  --  anywhere             @DATABASE_MASTER_NAME@\nDROP       all  --  anywhere             @DATABASE_SLAVE_NAME@\nDROP       all  --  anywhere             @QDEVICE_NAME@\n")),(0,a.kt)("p",null,"Si vous n'avez pas d'autres r\xe8gles iptables configur\xe9es, vous pouvez ex\xe9cuter la commande suivante pour supprimer les r\xe8gles li\xe9es au test :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -F\n")),(0,a.kt)("p",null,"Sinon, il sera n\xe9cessaire de lister les num\xe9ros de r\xe8gles avec la commande sp\xe9cifique :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -L --line-numbers\n")),(0,a.kt)("p",null,"Et le supprimer avec la commande :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -D INPUT @RULE_NUMBER@;\niptables -D OUTPUT @RULE_NUMBER@\n")),(0,a.kt)("p",null,"En ex\xe9cutant la commande ",(0,a.kt)("inlineCode",{parentName:"p"},"crm_mon")," sur le second noeud, vous verrez le noeud primaire monter dans le cluster.\nSi vous souhaitez passer au noeud primaire, ex\xe9cutez les ","[commandes de basculement]"," (acceptance-guide.md#return-to-nominal-situation)."))))}N.isMDXComponent=!0}}]);