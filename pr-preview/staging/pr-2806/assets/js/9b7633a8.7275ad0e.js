"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[55163],{5030:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>d,contentTitle:()=>u,default:()=>h,frontMatter:()=>p,metadata:()=>c,toc:()=>m});a(67294);var r=a(3905),n=a(51715),o=a(7626);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})),e}function s(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}const p={id:"cloud-azure-storage-acr",title:"Azure Container Registry"},u=void 0,c={unversionedId:"integrations/plugin-packs/procedures/cloud-azure-storage-acr",id:"integrations/plugin-packs/procedures/cloud-azure-storage-acr",title:"Azure Container Registry",description:"Overview",source:"@site/pp/integrations/plugin-packs/procedures/cloud-azure-storage-acr.md",sourceDirName:"integrations/plugin-packs/procedures",slug:"/integrations/plugin-packs/procedures/cloud-azure-storage-acr",permalink:"/centreon-documentation/pr-preview/staging/pr-2806/pp/integrations/plugin-packs/procedures/cloud-azure-storage-acr",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/pp/integrations/plugin-packs/procedures/cloud-azure-storage-acr.md",tags:[],version:"current",frontMatter:{id:"cloud-azure-storage-acr",title:"Azure Container Registry"},sidebar:"pp",previous:{title:"Azure Classic Storage",permalink:"/centreon-documentation/pr-preview/staging/pr-2806/pp/integrations/plugin-packs/procedures/cloud-azure-classicstorage-storageaccount"},next:{title:"Azure Cosmos DB",permalink:"/centreon-documentation/pr-preview/staging/pr-2806/pp/integrations/plugin-packs/procedures/cloud-azure-database-cosmosdb"}},d={},m=[{value:"Overview",id:"overview",level:2},{value:"Pack Assets",id:"pack-assets",level:2},{value:"Monitored Objects",id:"monitored-objects",level:3},{value:"Discovery rules",id:"discovery-rules",level:3},{value:"Collected metrics",id:"collected-metrics",level:3},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Setup",id:"setup",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Host",id:"host",level:3},{value:"How to check in the CLI that the configuration is OK and what are the main options for ?",id:"how-to-check-in-the-cli-that-the-configuration-is-ok-and-what-are-the-main-options-for-",level:2},{value:"Troubleshooting",id:"troubleshooting",level:3}],g={toc:m},k="wrapper";function h(e){var{components:t}=e,p=s(e,["components"]);return(0,r.kt)(k,l(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),r.forEach((function(t){i(e,t,a[t])}))}return e}({},g,p),{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"overview"},"Overview"),(0,r.kt)("p",null,"Azure Container Registry is a managed, private Docker registry service based on the open-source Docker Registry 2.0. Create and maintain Azure\nContainer Registries to store and manage your private Docker container images and related artifacts."),(0,r.kt)("p",null,"The Centreon Plugin ",(0,r.kt)("em",{parentName:"p"},"Azure Container Registry")," can rely on Azure API or Azure CLI to collect the metrics related to the ",(0,r.kt)("em",{parentName:"p"},"ACR")," service."),(0,r.kt)("h2",{id:"pack-assets"},"Pack Assets"),(0,r.kt)("h3",{id:"monitored-objects"},"Monitored Objects"),(0,r.kt)("p",null,"Available indicators and metrics:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Azure Container Registries",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Storage-usage")))),(0,r.kt)("h3",{id:"discovery-rules"},"Discovery rules"),(0,r.kt)("p",null,"The Centreon Pack ",(0,r.kt)("em",{parentName:"p"},"Azure Container Registry")," includes a Host Discovery provider to automatically discover the Azure instances of a given\nsubscription and add them to the Centreon configuration.\nThis provider is named ",(0,r.kt)("strong",{parentName:"p"},"Microsoft Azure Container Registry"),":"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image",src:a(81867).Z,width:"608",height:"188"})),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"This discovery feature is only compatible with the 'api' custom mode. 'azcli' is not supported.\nMore information about the Host Discovery module is available in the Centreon documentation:\n",(0,r.kt)("a",{parentName:"p",href:"/docs/monitoring/discovery/hosts-discovery"},"Host Discovery"))),(0,r.kt)("h3",{id:"collected-metrics"},"Collected metrics"),(0,r.kt)(n.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"Storage-usage",label:"Storage-usage",mdxType:"TabItem"},(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Metric Name"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Unit"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("em",{parentName:"td"},"instance"),"#azure.containerregistry.storage.used.bytes"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Storage used"),(0,r.kt)("td",{parentName:"tr",align:"left"},"B")))))),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("p",null,"Please find all the prerequisites needed for Centreon to get information from Azure on the ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2806/pp/integrations/plugin-packs/getting-started/how-to-guides/azure-credential-configuration"},"dedicated page"),"."),(0,r.kt)("h2",{id:"setup"},"Setup"),(0,r.kt)(n.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"Online License",label:"Online License",mdxType:"TabItem"},(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Install the Centreon package on every Centreon poller expected to monitor ",(0,r.kt)("em",{parentName:"li"},"Azure Container Registry")," resources:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yum install centreon-plugin-Cloud-Azure-Storage-ContainerRegistry-Api\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"On the Centreon Web interface, install the ",(0,r.kt)("em",{parentName:"li"},"Azure Container Registry")," Pack on the ",(0,r.kt)("strong",{parentName:"li"},"Configuration > Monitoring Connectors Manager")," page."))),(0,r.kt)(o.Z,{value:"Offline License",label:"Offline License",mdxType:"TabItem"},(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Install the Centreon package on every Centreon poller expected to monitor ",(0,r.kt)("em",{parentName:"li"},"Azure Container Registry")," resources:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yum install centreon-plugin-Cloud-Azure-Storage-ContainerRegistry-Api\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Install the Centreon Pack RPM on the Centreon Central server:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yum install centreon-pack-cloud-azure-storage-acr.noarch\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"On the Centreon Web interface, install the ",(0,r.kt)("em",{parentName:"li"},"Azure Container Registry")," Pack on the ",(0,r.kt)("strong",{parentName:"li"},"Configuration > Monitoring Connectors Manager")," page")))),(0,r.kt)("h2",{id:"configuration"},"Configuration"),(0,r.kt)("h3",{id:"host"},"Host"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},'Log into Centreon and add a new Host through "Configuration > Hosts".')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"In the ",(0,r.kt)("em",{parentName:"p"},"IP Address/FQDN")," field, set the following IP address: '127.0.0.1'.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Select the ",(0,r.kt)("em",{parentName:"p"},"Cloud-Azure-Storage-ContainerRegistry-custom")," template to apply to the Host.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Once the template applied, some Macros marked as 'Mandatory' hereafter have to be configured.\nThese mandatory Macros differ regarding the custom mode used."))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Two methods can be used to set the Macros:"),(0,r.kt)("ul",{parentName:"blockquote"},(0,r.kt)("li",{parentName:"ul"},"full ID of the Resource (",(0,r.kt)("inlineCode",{parentName:"li"},"/subscriptions/<subscription_id>/resourceGroups/<resourcegroup_id>/providers/Microsoft.ContainerRegistry/registries/<resource_name>"),")\nin ",(0,r.kt)("em",{parentName:"li"},"AZURERESOURCE")),(0,r.kt)("li",{parentName:"ul"},"Resource Name in ",(0,r.kt)("em",{parentName:"li"},"AZURERESOURCE")," associated with Resource Group (in ",(0,r.kt)("em",{parentName:"li"},"AZURERESOURCEGROUP"),") and Resource Type (in ",(0,r.kt)("em",{parentName:"li"},"AZURERESOURCETYPE"),")"))),(0,r.kt)(n.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"Azure Monitor API",label:"Azure Monitor API",mdxType:"TabItem"},(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Mandatory"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Nom"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"X"),(0,r.kt)("td",{parentName:"tr",align:"left"},"AZURECUSTOMMODE"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Custom mode 'api'")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"X"),(0,r.kt)("td",{parentName:"tr",align:"left"},"AZURESUBSCRIPTION"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Subscription ID")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"X"),(0,r.kt)("td",{parentName:"tr",align:"left"},"AZURETENANT"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Tenant ID")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"X"),(0,r.kt)("td",{parentName:"tr",align:"left"},"AZURECLIENTID"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Client ID")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"X"),(0,r.kt)("td",{parentName:"tr",align:"left"},"AZURECLIENTSECRET"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Client secret")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"X"),(0,r.kt)("td",{parentName:"tr",align:"left"},"AZURERESOURCE"),(0,r.kt)("td",{parentName:"tr",align:"left"},"ID or name of the Container Registry resource")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"}),(0,r.kt)("td",{parentName:"tr",align:"left"},"AZURERESOURCEGROUP"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Associated Resource Group if resource name is used"))))),(0,r.kt)(o.Z,{value:"Azure AZ CLI",label:"Azure AZ CLI",mdxType:"TabItem"},(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Mandatory"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Nom"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"X"),(0,r.kt)("td",{parentName:"tr",align:"left"},"AZURECUSTOMMODE"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Custom mode 'azcli'")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"X"),(0,r.kt)("td",{parentName:"tr",align:"left"},"AZURESUBSCRIPTION"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Subscription ID")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"X"),(0,r.kt)("td",{parentName:"tr",align:"left"},"AZURERESOURCE"),(0,r.kt)("td",{parentName:"tr",align:"left"},"ID or name of the Container Registry resource")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"}),(0,r.kt)("td",{parentName:"tr",align:"left"},"AZURERESOURCEGROUP"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Associated Resource Group if resource name is used")))))),(0,r.kt)("h2",{id:"how-to-check-in-the-cli-that-the-configuration-is-ok-and-what-are-the-main-options-for-"},"How to check in the CLI that the configuration is OK and what are the main options for ?"),(0,r.kt)("p",null,"Once the Plugin is installed, log into your Centreon Poller CLI using the ",(0,r.kt)("strong",{parentName:"p"},"centreon-engine"),"\nuser account (",(0,r.kt)("inlineCode",{parentName:"p"},"su - centreon-engine"),") and test the Plugin by running the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/lib/centreon/plugins/centreon_azure_storage_acr_api.pl \\\n    --plugin=cloud::azure::storage::acr::plugin \\\n    --mode=storage-usage \\\n    --custommode='api' \\\n    --subscription='xxxxxxxxx' \\\n    --tenant='xxxxxxxxx' \\\n    --client-id='xxxxxxxxx' \\\n    --client-secret='xxxxxxxxx' \\\n    --resource='ACR001ABCD' \\\n    --resource-group='RSG1234'\n    --aggregation='Total' \\\n    --timeframe='3600' \\\n    --interval='PT1H' \\\n    --warning-storage-used='80000000000' \\\n    --critical-item-errors='90000000000'\n")),(0,r.kt)("p",null,"Expected command output is shown below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"OK: Instance 'ACR001ABCD' Statistic 'total' Metrics Storage used: 74.86GB |\n'ACR001ABCD~total#azure.containerregistry.storage.used.bytes'=80379853954.00B;0:70000000000;0:90000000000;0;\n")),(0,r.kt)("p",null,"The command above checks the ",(0,r.kt)("em",{parentName:"p"},"storage usage")," of an Azure ",(0,r.kt)("em",{parentName:"p"},"Container Registry")," instance using the 'api' custom-mode\n(",(0,r.kt)("inlineCode",{parentName:"p"},"--plugin=cloud::azure::storage::acr::plugin --mode=storage-usage --custommode=api"),").\nThis instance is identified by its id (",(0,r.kt)("inlineCode",{parentName:"p"},"--resource='ACR001ABCD'"),") and its associated group (",(0,r.kt)("inlineCode",{parentName:"p"},"--resource-group='RSG1234'"),").\nThe authentication parameters to be used with the custom mode are specified in the options (",(0,r.kt)("inlineCode",{parentName:"p"},"--subscription='xxxxxxxxx'\n--tenant='xxxxxxx' --client-id='xxxxxxxx' --client-secret='xxxxxxxxxx'"),")."),(0,r.kt)("p",null,"The fetched values are the total values (",(0,r.kt)("inlineCode",{parentName:"p"},"--aggregation='Total'"),") of a single sample based on a 3600 seconds / 1 hour period\n(",(0,r.kt)("inlineCode",{parentName:"p"},"--timeframe='3600' --interval='PT1H'"),")."),(0,r.kt)("p",null,"This command would trigger a WARNING alarm if the ",(0,r.kt)("em",{parentName:"p"},"storage usage")," is reported as over 80GB (",(0,r.kt)("inlineCode",{parentName:"p"},"--warning-storage-used='80000000000'"),")\nand a CRITICAL alarm over 90GB (",(0,r.kt)("inlineCode",{parentName:"p"},"--critical-item-errors='90000000000'"),")."),(0,r.kt)("p",null,"All the available options for a given mode can be displayed by adding the ",(0,r.kt)("inlineCode",{parentName:"p"},"--help")," parameter to the command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/lib/centreon/plugins/centreon_azure_storage_acr_api.pl \\\n    --plugin=cloud::azure::storage::acr::plugin \\\n    --mode=storage-usage  \\\n    --help\n")),(0,r.kt)("h3",{id:"troubleshooting"},"Troubleshooting"),(0,r.kt)("p",null,"Please find all the troubleshooting documentation for the API-based Plugins in the ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2806/pp/integrations/plugin-packs/getting-started/how-to-guides/troubleshooting-plugins#http-and-api-checks"},"dedicated chapter"),"\nof the Centreon documentation."))}h.isMDXComponent=!0},81867:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/cloud-azure-storage-acr-provider-12fb0b8b76034878c127ba686f3103b9.png"}}]);