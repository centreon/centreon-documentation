"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[7986],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>k});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var u=a.createContext({}),o=function(e){var t=a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=o(e.components);return a.createElement(u.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,u=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=o(n),c=r,k=p["".concat(u,".").concat(c)]||p[c]||m[c]||l;return n?a.createElement(k,i(i({ref:t},d),{},{components:n})):a.createElement(k,i({ref:t},d))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=c;var s={};for(var u in t)hasOwnProperty.call(t,u)&&(s[u]=t[u]);s.originalType=e,s[p]="string"==typeof e?e:r,i[1]=s;for(var o=2;o<l;o++)i[o]=n[o];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},25473:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>u,default:()=>k,frontMatter:()=>s,metadata:()=>o,toc:()=>p});n(67294);var a=n(3905);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const s={id:"cloud-kubernetes-api",title:"Kubernetes API"},u=void 0,o={unversionedId:"integrations/plugin-packs/procedures/cloud-kubernetes-api",id:"integrations/plugin-packs/procedures/cloud-kubernetes-api",title:"Kubernetes API",description:"Vue d'ensemble",source:"@site/i18n/fr/docusaurus-plugin-content-docs-pp/current/integrations/plugin-packs/procedures/cloud-kubernetes-api.md",sourceDirName:"integrations/plugin-packs/procedures",slug:"/integrations/plugin-packs/procedures/cloud-kubernetes-api",permalink:"/centreon-documentation/pr-preview/staging/pr-2551/fr/pp/integrations/plugin-packs/procedures/cloud-kubernetes-api",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/i18n/fr/docusaurus-plugin-content-docs-pp/current/integrations/plugin-packs/procedures/cloud-kubernetes-api.md",tags:[],version:"current",frontMatter:{id:"cloud-kubernetes-api",title:"Kubernetes API"},sidebar:"pp",previous:{title:"IICS Rest API",permalink:"/centreon-documentation/pr-preview/staging/pr-2551/fr/pp/integrations/plugin-packs/procedures/cloud-iics-restapi"},next:{title:"Kubernetes w/ Prometheus",permalink:"/centreon-documentation/pr-preview/staging/pr-2551/fr/pp/integrations/plugin-packs/procedures/cloud-prometheus-kubernetes-api"}},d={},p=[{value:"Vue d&#39;ensemble",id:"vue-densemble",level:2},{value:"Contenu du Pack",id:"contenu-du-pack",level:2},{value:"D\xe9couverte",id:"d\xe9couverte",level:3},{value:"Mod\xe8les",id:"mod\xe8les",level:3},{value:"M\xe9triques et indicateurs supervis\xe9s",id:"m\xe9triques-et-indicateurs-supervis\xe9s",level:2},{value:"Ev\xe9nements du cluster",id:"ev\xe9nements-du-cluster",level:3},{value:"Statut des CronJobs",id:"statut-des-cronjobs",level:3},{value:"Statut des DaemonSets",id:"statut-des-daemonsets",level:3},{value:"Statut des Deployments",id:"statut-des-deployments",level:3},{value:"Statut des Nodes",id:"statut-des-nodes",level:3},{value:"Utilisation des Nodes",id:"utilisation-des-nodes",level:3},{value:"Statut des PersistentVolumes",id:"statut-des-persistentvolumes",level:3},{value:"Statut des Pods",id:"statut-des-pods",level:3},{value:"Statut des ReplicaSets",id:"statut-des-replicasets",level:3},{value:"Statut des ReplicationControllers",id:"statut-des-replicationcontrollers",level:3},{value:"Statut des StatefulSets",id:"statut-des-statefulsets",level:3},{value:"Pr\xe9requis",id:"pr\xe9requis",level:2},{value:"Centreon Plugin",id:"centreon-plugin",level:3},{value:"Kubernetes",id:"kubernetes",level:3},{value:"Cr\xe9er un compte de service",id:"cr\xe9er-un-compte-de-service",level:4},{value:"Utilisation de l&#39;API Rest",id:"utilisation-de-lapi-rest",level:4},{value:"Exposez l&#39;API",id:"exposez-lapi",level:5},{value:"R\xe9cup\xe9rer le jeton du compte de service",id:"r\xe9cup\xe9rer-le-jeton-du-compte-de-service",level:5},{value:"Utilisation de kubectl",id:"utilisation-de-kubectl",level:4},{value:"Installer kubectl",id:"installer-kubectl",level:5},{value:"Cr\xe9er une configuration kubectl",id:"cr\xe9er-une-configuration-kubectl",level:5},{value:"Configuration de la supervision",id:"configuration-de-la-supervision",level:2},{value:"Cr\xe9ation manuelle",id:"cr\xe9ation-manuelle",level:3},{value:"D\xe9couverte automatique",id:"d\xe9couverte-automatique",level:3},{value:"D\xe9couverte d&#39;h\xf4te",id:"d\xe9couverte-dh\xf4te",level:4},{value:"D\xe9couverte de service",id:"d\xe9couverte-de-service",level:4},{value:"D\xe9pannage",id:"d\xe9pannage",level:2}],m={toc:p},c="wrapper";function k(e){var{components:t}=e,s=i(e,["components"]);return(0,a.kt)(c,l(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){r(e,t,n[t])}))}return e}({},m,s),{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"vue-densemble"},"Vue d'ensemble"),(0,a.kt)("p",null,"Kubernetes est un syst\xe8me d'orchestration de conteneurs open source pour\nl'automatisation de d\xe9ploiement, la mise \xe0 l'\xe9chelle et la gestion\nd'applications."),(0,a.kt)("p",null,"Ce Pack vise \xe0 superviser \xe0 la fois la couche d'infrastructure (noeuds) et\nles services du cluster (deployments, daemonsets, etc)."),(0,a.kt)("h2",{id:"contenu-du-pack"},"Contenu du Pack"),(0,a.kt)("p",null,"Le Pack Kubernetes API offre plusieurs choix concernant la fa\xe7on dont\nvous pouvez organiser la supervision du cluster."),(0,a.kt)("p",null,"Il existe principalement trois fa\xe7ons :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Rassemblez toutes les m\xe9triques sur un seul h\xf4te Centreon avec un service\npar unit\xe9 Kubernetes (i.e. deployments, daemonsets, etc) - appliquer\nla proc\xe9dure ",(0,a.kt)("a",{parentName:"li",href:"#creation-manuelle"},"cr\xe9ation manuelle"),","),(0,a.kt)("li",{parentName:"ul"},"Rassemblez toutes les m\xe9triques sur un seul h\xf4te Centreon avec un service\npour chaque instances de chaque unit\xe9 Kubernetes - appliquer les proc\xe9dures\n",(0,a.kt)("a",{parentName:"li",href:"#creation-manuelle"},"cr\xe9ation manuelle")," et\n",(0,a.kt)("a",{parentName:"li",href:"#decouverte-de-service"},"d\xe9couverte de service"),","),(0,a.kt)("li",{parentName:"ul"},"Collectez les m\xe9triques d'infrastructure (noeuds ma\xeetre et noeuds de travail)\navec un h\xf4te Centreon par noeud Kubernetes et conserver les m\xe9triques\nd'orchestration / d'application sur un h\xf4te unique (en utilisant l'un des 2\nsc\xe9narii pr\xe9c\xe9dents) - appliquer la proc\xe9dure\n",(0,a.kt)("a",{parentName:"li",href:"#decouverte-dhote"},"d\xe9couverte d'h\xf4te"),".")),(0,a.kt)("p",null,"Pour tous ces sc\xe9narii, la d\xe9couverte et les mod\xe8les classiques seront\nutilis\xe9es."),(0,a.kt)("p",null,"Il vous suffit de choisir la m\xe9thode qui vous pla\xeet le plus : communiquer avec\nl'API Rest expos\xe9e par le cluster Kubernetes, ou \xe0 l'aide de l'outil CLI\n",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl")," pour communiquer avec le noeud ayant le r\xf4le control plane."),(0,a.kt)("h3",{id:"d\xe9couverte"},"D\xe9couverte"),(0,a.kt)("p",null,"Le Pack Kubernetes API est fourni avec plusieurs r\xe8gles de d\xe9couverte."),(0,a.kt)("p",null,"Voici la liste des ",(0,a.kt)("em",{parentName:"p"},"providers")," Host Discovery :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Provider"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Kubernetes Nodes (RestAPI)"),(0,a.kt)("td",{parentName:"tr",align:null},"D\xe9couvrez les noeuds Kubernetes en interrogeant l'API Rest Kubernetes")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Kubernetes Nodes (Kubectl)"),(0,a.kt)("td",{parentName:"tr",align:null},"D\xe9couvrez les noeuds Kubernetes en interrogeant le cluster Kubernetes avec kubectl")))),(0,a.kt)("p",null,"Les deux ",(0,a.kt)("em",{parentName:"p"},"providers")," rechercheront les noeuds Kubernetes et les lieront \xe0 un\nmod\xe8le d'h\xf4te minimaliste pour superviser l'utilisation des noeuds en termes\nd'allocation de pods, de processeur et de demandes / limites de m\xe9moire. "),(0,a.kt)("p",null,"Parall\xe8lement \xe0 cette d\xe9couverte, des services unitaires peuvent \xeatre cr\xe9\xe9s\ngr\xe2ce aux r\xe8gles de Service Discovery :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"R\xe8gle"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Cloud-Kubernetes-Api-CronJobs-Status"),(0,a.kt)("td",{parentName:"tr",align:null},"D\xe9couvrez les CronJobs Kubernetes pour superviser leur statut")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Cloud-Kubernetes-Api-Daemonsets-Status"),(0,a.kt)("td",{parentName:"tr",align:null},"D\xe9couvrez les DaemonSets Kubernetes pour superviser leur statut")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Cloud-Kubernetes-Api-Deployments-Status"),(0,a.kt)("td",{parentName:"tr",align:null},"D\xe9couvrez les Deployments Kubernetes pour superviser leur statut")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Cloud-Kubernetes-Api-Nodes-Status"),(0,a.kt)("td",{parentName:"tr",align:null},"D\xe9couvrez les Nodes Kubernetes pour superviser leur statut")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Cloud-Kubernetes-Api-Nodes-Usage"),(0,a.kt)("td",{parentName:"tr",align:null},"D\xe9couvrez les Nodes Kubernetes pour superviser leur utilisation")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Cloud-Kubernetes-Api-PersistentVolumes-Status"),(0,a.kt)("td",{parentName:"tr",align:null},"D\xe9couvrez les PersistentVolumes Kubernetes pour superviser leur statut")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Cloud-Kubernetes-Api-Pods-Status"),(0,a.kt)("td",{parentName:"tr",align:null},"D\xe9couvrez les Pods Kubernetes pour superviser leur statut")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Cloud-Kubernetes-Api-ReplicaSets-Status"),(0,a.kt)("td",{parentName:"tr",align:null},"D\xe9couvrez les ReplicaSets Kubernetes pour superviser leur statut")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Cloud-Kubernetes-Api-ReplicationControllers-Status"),(0,a.kt)("td",{parentName:"tr",align:null},"D\xe9couvrez les ReplicationControllers Kubernetes pour superviser leur statut")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Cloud-Kubernetes-Api-StatefulSets-Status"),(0,a.kt)("td",{parentName:"tr",align:null},"D\xe9couvrez les StatefulSets Kubernetes pour superviser leur statut")))),(0,a.kt)("h3",{id:"mod\xe8les"},"Mod\xe8les"),(0,a.kt)("p",null,"Le Pack Kubernetes API apporte 2 mod\xe8les d'h\xf4te diff\xe9rents \xe0 utiliser en\nfonction des sc\xe9narios mentionn\xe9s pr\xe9c\xe9demment :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Mod\xe8le d'h\xf4te tout en un qui rassemblera les contr\xf4les et les m\xe9triques\navec un service par unit\xe9 Kubernetes :"),(0,a.kt)("table",{parentName:"li"},(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Cloud-Kubernetes-Api"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Cluster Events")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"CronJob Status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"DaemonSet Status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Deployment Status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Node Status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Node Usage")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"PersistentVolume Status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Pod Status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"ReplicatSet Status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"ReplicationController Status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"StatefulSet Status"))))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Un mod\xe8le d'h\xf4te minimal qui ne collectera que des m\xe9triques pour les\nnoeuds Kubernetes :"),(0,a.kt)("table",{parentName:"li"},(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Cloud-Kubernetes-Node-Api"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Node Usage")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Node Status")))))),(0,a.kt)("h2",{id:"m\xe9triques-et-indicateurs-supervis\xe9s"},"M\xe9triques et indicateurs supervis\xe9s"),(0,a.kt)("h3",{id:"ev\xe9nements-du-cluster"},"Ev\xe9nements du cluster"),(0,a.kt)("p",null,"Cet indicateur permet de superviser le nombre d'\xe9v\xe9nements se produisant sur\nle cluster, comme le ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get events")," peut fournir :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},'NAMESPACE   LAST SEEN   TYPE      REASON      OBJECT           MESSAGE\ngraphite    26m         Warning   Unhealthy   pod/graphite-0   Liveness probe failed: Get "http://10.244.2.10:8080/": context deadline exceeded (Client.Timeout exceeded while awaiting headers)\n')),(0,a.kt)("p",null,"La sortie r\xe9sultante dans Centreon pourrait ressembler \xe0 :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Event 'Warning' for object 'Pod/graphite-0' with message 'Liveness probe failed: Get \"http://10.244.2.10:8080/\": context deadline exceeded (Client.Timeout exceeded while awaiting headers)', Count: 1, First seen: 26m 21s ago (2021-03-11T12:26:23Z), Last seen: 26m 21s ago (2021-03-11T12:26:23Z)\n")),(0,a.kt)("p",null,"Les m\xe9triques collect\xe9es seront :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"M\xe9trique"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"events.type.warning.count"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"events.type.normal.count"))))),(0,a.kt)("p",null,"Il est alors possible de placer des seuils \xe0 l'aide des variables sp\xe9ciales\nsuivantes :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{type}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{object}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{message}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{count}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{first_seen}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{last_seen}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{name}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{namespace}"))),(0,a.kt)("p",null,"Les valeurs par d\xe9faut sont les suivantes :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Seuil"),(0,a.kt)("th",{parentName:"tr",align:null},"Valeur"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Warning"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"%{type} =~ /warning/i")),(0,a.kt)("td",{parentName:"tr",align:null},"D\xe9clenchera une alerte s'il y a des \xe9v\xe9nements ",(0,a.kt)("inlineCode",{parentName:"td"},"warning"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Critical"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"%{type} =~ /error/i")),(0,a.kt)("td",{parentName:"tr",align:null},"D\xe9clenchera une alerte critique s'il y a des \xe9v\xe9nements ",(0,a.kt)("inlineCode",{parentName:"td"},"error"))))),(0,a.kt)("p",null,"R\xe9f\xe9rez vous \xe0 la\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/tasks/debug-application-cluster/debug-application-introspection/"},"documentation officielle"),"\npour plus d'informations sur les m\xe9triques collect\xe9es et comment affiner vos\nseuils."),(0,a.kt)("h3",{id:"statut-des-cronjobs"},"Statut des CronJobs"),(0,a.kt)("p",null,"Cet indicateur permet de v\xe9rifier que les CronJobs sont ex\xe9cut\xe9s comme ils\nle devraient, comme le ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get cronjobs")," peut fournir :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"NAME    SCHEDULE      SUSPEND   ACTIVE   LAST SCHEDULE   AGE\nhello   */1 * * * *   False     1        6s              2d1h\n")),(0,a.kt)("p",null,"La sortie r\xe9sultante dans Centreon pourrait ressembler \xe0 :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"CronJob 'hello' Jobs Active: 1, Last schedule time: 6s ago (2021-03-11T12:31:00Z)\n")),(0,a.kt)("p",null,"La m\xe9trique collect\xe9e pour chaque CronJobs sera :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"M\xe9trique"),(0,a.kt)("th",{parentName:"tr",align:null},"M\xe9trique Kubernetes"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"cronjob.jobs.active.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"active"))))),(0,a.kt)("p",null,"Si le service collecte des m\xe9triques de plusieurs CronJobs (selon le sc\xe9nario\nchoisi), le nom du CronJob sera ajout\xe9 au nom de la m\xe9trique :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"M\xe9trique"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"hello#cronjob.jobs.active.count"))))),(0,a.kt)("p",null,"Il est alors possible de placer des seuils \xe0 l'aide des variables sp\xe9ciales\nsuivantes :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{active}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{last_schedule}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{name}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{namespace}"))),(0,a.kt)("p",null,"Il n'y a pas de seuils par d\xe9faut. Un exemple int\xe9ressant pourrait \xeatre le\nsuivant: ",(0,a.kt)("inlineCode",{parentName:"p"},"% {last_schedule}> x")," o\xf9 ",(0,a.kt)("inlineCode",{parentName:"p"},"x")," en secondes est la dur\xe9e au-del\xe0 de\nlaquelle le CronJob est consid\xe9r\xe9 comme ne fonctionnant pas comme pr\xe9vu."),(0,a.kt)("p",null,"R\xe9f\xe9rez vous \xe0 la\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/"},"documentation officielle"),"\npour plus d'informations sur les m\xe9triques collect\xe9es et comment affiner vos\nseuils."),(0,a.kt)("h3",{id:"statut-des-daemonsets"},"Statut des DaemonSets"),(0,a.kt)("p",null,"Cet indicateur garantira que les DaemonSets sont dans des limites d\xe9finies\nen regardant le nombre de Pods disponibles et/ou \xe0 jour par rapport au\nnombre souhait\xe9, comme le ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get daemonsets")," peut fournir :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"NAMESPACE     NAME                    DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR                   AGE\nkube-system   kube-flannel-ds-amd64   3         3         3       3            3           beta.kubernetes.io/arch=amd64   624d\nkube-system   kube-proxy              3         3         3       3            3           kubernetes.io/os=linux          624d\n")),(0,a.kt)("p",null,"La sortie r\xe9sultante dans Centreon pourrait ressembler \xe0 :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Daemonset 'kube-flannel-ds-amd64' Pods Desired: 3, Current: 3, Available: 3, Up-to-date: 3, Ready: 3, Misscheduled: 0\nDaemonset 'kube-proxy' Pods Desired: 3, Current: 3, Available: 3, Up-to-date: 3, Ready: 3, Misscheduled: 0\n")),(0,a.kt)("p",null,"Les m\xe9triques collect\xe9es pour chaque Daemonsets sera :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"M\xe9trique"),(0,a.kt)("th",{parentName:"tr",align:null},"M\xe9trique Kubernetes"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"daemonset.pods.desired.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"desiredNumberScheduled"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"daemonset.pods.current.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"currentNumberScheduled"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"daemonset.pods.available.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"numberAvailable"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"daemonset.pods.uptodate.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"updatedNumberScheduled"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"daemonset.pods.ready.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"numberReady"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"daemonset.pods.misscheduled.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"numberMisscheduled"))))),(0,a.kt)("p",null,"Si le service collecte des m\xe9triques de plusieurs DaemonSets (selon le\nsc\xe9nario choisi), le nom du DaemonSet sera ajout\xe9 au nom de la m\xe9trique :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"M\xe9trique"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"kube-proxy#daemonset.pods.desired.count"))))),(0,a.kt)("p",null,"Il est alors possible de placer des seuils \xe0 l'aide des variables sp\xe9ciales\nsuivantes :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{desired}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{current}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{available}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{up_to_date}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{ready}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{misscheduled}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{name}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{namespace}"))),(0,a.kt)("p",null,"Les valeurs par d\xe9faut sont les suivantes :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Sueil"),(0,a.kt)("th",{parentName:"tr",align:null},"Valeur"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Warning"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"%{up_to_date} < %{desired}")),(0,a.kt)("td",{parentName:"tr",align:null},"D\xe9clenchera une alerte si le nombre de Pods \xe0 jour est inf\xe9rieur au nombre d\xe9sir\xe9")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Critical"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"%{available} < %{desired}")),(0,a.kt)("td",{parentName:"tr",align:null},"D\xe9clenchera une alerte critique si le nombre de Pods disponible est inf\xe9rieur au nombre d\xe9sir\xe9")))),(0,a.kt)("p",null,"R\xe9f\xe9rez vous \xe0 la\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/"},"documentation officielle"),"\npour plus d'informations sur les m\xe9triques collect\xe9es et comment affiner vos\nseuils."),(0,a.kt)("h3",{id:"statut-des-deployments"},"Statut des Deployments"),(0,a.kt)("p",null,"Cet indicateur garantira que les Deployments sont dans des limites d\xe9finies\nen examinant le nombre de r\xe9pliques disponibles et/ou \xe0 jour par rapport au\nnombre souhait\xe9, comme le ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get deployments")," peut fournir :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"NAMESPACE              NAME                        READY   UP-TO-DATE   AVAILABLE   AGE\nkube-system            coredns                     2/2     2            2           624d\nkube-system            tiller-deploy               1/1     1            1           624d\nkubernetes-dashboard   dashboard-metrics-scraper   1/1     1            1           37d\nkubernetes-dashboard   kubernetes-dashboard        1/1     1            1           37d\n")),(0,a.kt)("p",null,"La sortie r\xe9sultante dans Centreon pourrait ressembler \xe0 :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Deployment 'coredns' Replicas Desired: 2, Current: 2, Available: 2, Ready: 2, Up-to-date: 2\nDeployment 'tiller-deploy' Replicas Desired: 1, Current: 1, Available: 1, Ready: 1, Up-to-date: 1\nDeployment 'dashboard-metrics-scraper' Replicas Desired: 1, Current: 1, Available: 1, Ready: 1, Up-to-date: 1\nDeployment 'kubernetes-dashboard' Replicas Desired: 1, Current: 1, Available: 1, Ready: 1, Up-to-date: 1\n")),(0,a.kt)("p",null,"Les m\xe9triques collect\xe9es pour chaque Deployments sera :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"M\xe9trique"),(0,a.kt)("th",{parentName:"tr",align:null},"M\xe9trique Kubernetes"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"deployment.replicas.desired.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"replicas")," (dans l'entr\xe9e ",(0,a.kt)("inlineCode",{parentName:"td"},"spec"),")")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"deployment.replicas.current.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"replicas")," (dans l'entr\xe9e ",(0,a.kt)("inlineCode",{parentName:"td"},"status"),")")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"deployment.replicas.available.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"availableReplicas"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"deployment.replicas.ready.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"readyReplicas"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"deployment.replicas.uptodate.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"updatedReplicas"))))),(0,a.kt)("p",null,"Si le service collecte des m\xe9triques de plusieurs Deployments (selon le\nsc\xe9nario choisi), le nom du Deployment sera ajout\xe9 au nom de la m\xe9trique :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"M\xe9trique"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"tiller-deploy#deployment.replicas.desired.count"))))),(0,a.kt)("p",null,"Il est alors possible de placer des seuils \xe0 l'aide des variables sp\xe9ciales\nsuivantes :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{desired}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{current}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{available}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{ready}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{up_to_date}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{name}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{namespace}"))),(0,a.kt)("p",null,"Les valeurs par d\xe9faut sont les suivantes :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Seuil"),(0,a.kt)("th",{parentName:"tr",align:null},"Valeur"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Warning"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"%{up_to_date} < %{desired}")),(0,a.kt)("td",{parentName:"tr",align:null},"D\xe9clenchera une alerte si le nombre de replicas \xe0 jour est inf\xe9rieur au nombre d\xe9sir\xe9")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Critical"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"%{available} < %{desired}")),(0,a.kt)("td",{parentName:"tr",align:null},"D\xe9clenchera une alerte critique si le nombre de replicas disponible est inf\xe9rieur au nombre d\xe9sir\xe9")))),(0,a.kt)("p",null,"R\xe9f\xe9rez vous \xe0 la\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/workloads/controllers/deployment/"},"documentation officielle"),"\npour plus d'informations sur les m\xe9triques collect\xe9es et comment affiner vos\nseuils."),(0,a.kt)("h3",{id:"statut-des-nodes"},"Statut des Nodes"),(0,a.kt)("p",null,"Cet indicateur garantira que les noeuds fonctionnent bien en regardant\nles statuts des conditions, comme le ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl describe nodes")," peut lister :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Conditions:\n  Type             Status  LastHeartbeatTime                 LastTransitionTime                Reason                       Message\n  ----             ------  -----------------                 ------------------                ------                       -------\n  MemoryPressure   False   Thu, 11 Mar 2021 14:20:25 +0100   Tue, 26 Jan 2021 09:38:11 +0100   KubeletHasSufficientMemory   kubelet has sufficient memory available\n  DiskPressure     False   Thu, 11 Mar 2021 14:20:25 +0100   Wed, 17 Feb 2021 09:37:40 +0100   KubeletHasNoDiskPressure     kubelet has no disk pressure\n  PIDPressure      False   Thu, 11 Mar 2021 14:20:25 +0100   Tue, 26 Jan 2021 09:38:11 +0100   KubeletHasSufficientPID      kubelet has sufficient PID available\n  Ready            True    Thu, 11 Mar 2021 14:20:25 +0100   Tue, 26 Jan 2021 17:26:36 +0100   KubeletReady                 kubelet is posting ready status\n")),(0,a.kt)("p",null,"La sortie r\xe9sultante dans Centreon pourrait ressembler \xe0 :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Condition 'DiskPressure' Status is 'False', Reason: 'KubeletHasNoDiskPressure', Message: 'kubelet has no disk pressure'\nCondition 'MemoryPressure' Status is 'False', Reason: 'KubeletHasSufficientMemory', Message: 'kubelet has sufficient memory available'\nCondition 'PIDPressure' Status is 'False', Reason: 'KubeletHasSufficientPID', Message: 'kubelet has sufficient PID available'\nCondition 'Ready' Status is 'True', Reason: 'KubeletReady', Message: 'kubelet is posting ready status'\n")),(0,a.kt)("p",null,"Aucune m\xe9trique n'est collect\xe9e."),(0,a.kt)("p",null,"Il est possible de placer des seuils en utilisant les variables sp\xe9ciales\nsuivantes:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{type}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{status}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{reason}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{message}"))),(0,a.kt)("p",null,"Les valeurs par d\xe9faut sont les suivantes :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Seuil"),(0,a.kt)("th",{parentName:"tr",align:null},"Valeur"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Critical"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("code",null,"(%{type} =~ /Ready/i && %{status} !~ /True/i) ","|","|"," (%{type} =~ /.*Pressure/i && %{status} !~ /False/i)")),(0,a.kt)("td",{parentName:"tr",align:null},"D\xe9clenchera une alerte critique si le status de la condition ",(0,a.kt)("inlineCode",{parentName:"td"},"Ready")," n'est pas ",(0,a.kt)("inlineCode",{parentName:"td"},"True")," ou si le statut des conditions ",(0,a.kt)("inlineCode",{parentName:"td"},"Pressure")," n'est pas ",(0,a.kt)("inlineCode",{parentName:"td"},"False"))))),(0,a.kt)("p",null,"R\xe9f\xe9rez vous \xe0 la\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/architecture/nodes/#condition"},"documentation officielle"),"\npour plus d'informations sur les status et comment affiner vos seuils."),(0,a.kt)("h3",{id:"utilisation-des-nodes"},"Utilisation des Nodes"),(0,a.kt)("p",null,"Cet indicateur rassemblera des m\xe9triques sur l'utilisation des noeuds comme\nl'allocation des Pods, les demandes de CPU et de m\xe9moire faites par ces Pods,\net les limites de CPU et de m\xe9moire autoris\xe9es pour ces m\xeames Pods."),(0,a.kt)("p",null,"En utilisant l'outil de ligne de commande Kubernetes, cela pourrait ressembler\n\xe0 ce qui suit :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Capacit\xe9 des noeuds :"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'kubectl get nodes -o=custom-columns="NODE:.metadata.name,PODS ALLOCATABLE:.status.allocatable.pods,CPU ALLOCATABLE:.status.allocatable.cpu,MEMORY ALLOCATABLE:.status.allocatable.memory"\nNODE          PODS ALLOCATABLE   CPU ALLOCATABLE   MEMORY ALLOCATABLE\nmaster-node   110                2                 3778172Ki\nworker-node   110                2                 3778184Ki\n'))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Pods en cours d'ex\xe9cution :"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'kubectl get pods -o=custom-columns="NODE:.spec.nodeName,POD:.metadata.name,CPU REQUESTS:.spec.containers[*].resources.requests.cpu,CPU LIMITS:.spec.containers[*].resources.limits.cpu,MEMORY REQUESTS:.spec.containers[*].resources.requests.memory,MEMORY LIMITS:.spec.containers[*].resources.limits.memory"\nNODE          POD                                     CPU REQUESTS   CPU LIMITS   MEMORY REQUESTS   MEMORY LIMITS\nworker-node   coredns-74ff55c5b-g4hmt                 100m           <none>       70Mi              170Mi\nmaster-node   etcd-master-node                        100m           <none>       100Mi             <none>\nmaster-node   kube-apiserver-master-node              250m           <none>       <none>            <none>\nmaster-node   kube-controller-manager-master-node     200m           <none>       <none>            <none>\nmaster-node   kube-flannel-ds-amd64-fk59g             100m           100m         50Mi              50Mi\nworker-node   kube-flannel-ds-amd64-jwzms             100m           100m         50Mi              50Mi\nmaster-node   kube-proxy-kkwmb                        <none>         <none>       <none>            <none>\nworker-node   kube-proxy-vprs8                        <none>         <none>       <none>            <none>\nmaster-node   kube-scheduler-master-node              100m           <none>       <none>            <none>\nmaster-node   kubernetes-dashboard-7d75c474bb-7zc5j   <none>         <none>       <none>            <none>\n')))),(0,a.kt)("p",null,"Depuis le tableau de bord Kubernetes, les m\xe9triques se trouvent dans le\nmenu ",(0,a.kt)("inlineCode",{parentName:"p"},"Cluster > Nodes"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Liste depuis ",(0,a.kt)("inlineCode",{parentName:"p"},"Cluser > Nodes"),":"),(0,a.kt)("p",{parentName:"li"},"  ",(0,a.kt)("img",{alt:"Cluster nodes listing",src:n(62070).Z,width:"1920",height:"489"}))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"D\xe9tail de l'allocation pour un noeud :"),(0,a.kt)("p",{parentName:"li"},"  ",(0,a.kt)("img",{alt:"Node allocation detail",src:n(52922).Z,width:"1920",height:"504"})))),(0,a.kt)("p",null,"La sortie r\xe9sultante dans Centreon pourrait ressembler \xe0 :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Node 'master-node' CPU requests: 37.50% (0.75/2), CPU limits: 5.00% (0.1/2), Memory requests: 3.96% (150.00MB/3.70GB), Memory limits: 1.32% (50.00MB/3.70GB), Pods allocation: 7.27% (8/110)\nNode 'worker-node' CPU requests: 35.00% (0.7/2), CPU limits: 115.00% (2.3/2), Memory requests: 31.51% (1.17GB/3.70GB), Memory limits: 115.21% (4.26GB/3.70GB), Pods allocation: 9.09% (10/110)\n")),(0,a.kt)("p",null,"Les m\xe9triques collect\xe9es pour chaque n\u0153ud seront :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"M\xe9trique"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"cpu.requests.percentage"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"cpu.limits.percentage"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"memory.requests.percentage"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"memory.limits.percentage"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"pods.allocation.percentage"))))),(0,a.kt)("p",null,"Si le service collecte des m\xe9triques de plusieurs Nodes (selon le sc\xe9nario\nchoisi), le nom du Node sera ajout\xe9 au nom de la m\xe9trique:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"M\xe9trique"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"worker-node#pods.allocation.percentage"))))),(0,a.kt)("p",null,"Des seuils exprim\xe9s en pourcentage peuvent \xeatre d\xe9finis pour toutes les\nm\xe9triques, pour les alertes et les alertes critiques."),(0,a.kt)("h3",{id:"statut-des-persistentvolumes"},"Statut des PersistentVolumes"),(0,a.kt)("p",null,"Cet indicateur garantira que les PersistentVolumes fonctionnent correctement\nen regardant la phase dans laquelle ils se trouvent, comme le\n",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get pv")," peut fournir :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"NAME                     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM                   STORAGECLASS   REASON   AGE\npv-nfs-kubestorage-001   5Gi        RWO            Retain           Available                                                   630d\npv-nfs-kubestorage-002   5Gi        RWO            Retain           Bound       tick/data-influxdb                              630d\npv-nfs-kubestorage-003   5Gi        RWO            Retain           Released    graphite/graphite-pvc                           630d\n")),(0,a.kt)("p",null,"La sortie r\xe9sultante dans Centreon pourrait ressembler \xe0 :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Persistent Volume 'pv-nfs-kubestorage-001' Phase is 'Available'\nPersistent Volume 'pv-nfs-kubestorage-002' Phase is 'Bound'\nPersistent Volume 'pv-nfs-kubestorage-003' Phase is 'Released'\n")),(0,a.kt)("p",null,"Aucune m\xe9trique n'est collect\xe9e."),(0,a.kt)("p",null,"Il est possible de placer des seuils en utilisant les variables sp\xe9ciales\nsuivantes :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{phase}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{name}"))),(0,a.kt)("p",null,"Les valeurs par d\xe9faut sont les suivantes :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Seuil"),(0,a.kt)("th",{parentName:"tr",align:null},"Valeur"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Critical"),(0,a.kt)("td",{parentName:"tr",align:null},"`%{phase} !~ /Bound"),(0,a.kt)("td",{parentName:"tr",align:null},"Available")))),(0,a.kt)("p",null,"R\xe9f\xe9rez vous \xe0 la\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/storage/persistent-volumes/"},"documentation officielle"),"\npour plus d'informations sur les status et comment affiner vos seuils."),(0,a.kt)("h3",{id:"statut-des-pods"},"Statut des Pods"),(0,a.kt)("p",null,"Cet indicateur garantira que les Pods et leurs conteneurs sont dans des\nlimites d\xe9finies en regardant le nombre de conteneurs pr\xeats par rapport au\nnombre souhait\xe9, comme le ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get pods")," peut fournir :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"NAMESPACE              NAME                                                     READY   STATUS        RESTARTS   AGE\nkube-system            kube-proxy-65zhn                                         1/1     Running       0          37d\nkube-system            kube-proxy-kkwmb                                         1/1     Running       0          37d\nkube-system            kube-proxy-vprs8                                         1/1     Running       0          37d\nkube-system            tiller-deploy-7bf78cdbf7-z5n24                           1/1     Running       5          550d\nkubernetes-dashboard   dashboard-metrics-scraper-79c5968bdc-vncxc               1/1     Running       0          37d\nkubernetes-dashboard   kubernetes-dashboard-7448ffc97b-42rps                    1/1     Running       0          37d\n")),(0,a.kt)("p",null,"La sortie r\xe9sultante dans Centreon pourrait ressembler \xe0 :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"Checking pod 'kube-proxy-65zhn'\n    Containers Ready: 1/1 (100.00%), Status is 'Running', Restarts: 0\n    Container 'kube-proxy' Status is 'running', State is 'ready', Restarts: 0\nChecking pod 'kube-proxy-kkwmb'\n    Containers Ready: 1/1 (100.00%), Status is 'Running', Restarts: 0\n    Container 'kube-proxy' Status is 'running', State is 'ready', Restarts: 0\nChecking pod 'kube-proxy-vprs8'\n    Containers Ready: 1/1 (100.00%), Status is 'Running', Restarts: 0\n    Container 'kube-proxy' Status is 'running', State is 'ready', Restarts: 0\nChecking pod 'tiller-deploy-7bf78cdbf7-z5n24'\n    Containers Ready: 1/1 (100.00%), Status is 'Running', Restarts: 5\n    Container 'tiller' Status is 'running', State is 'ready', Restarts: 5\nChecking pod 'dashboard-metrics-scraper-79c5968bdc-vncxc'\n    Containers Ready: 1/1 (100.00%), Status is 'Running', Restarts: 0\n    Container 'dashboard-metrics-scraper' Status is 'running', State is 'ready', Restarts: 0\nChecking pod 'kubernetes-dashboard-7448ffc97b-42rps'\n    Containers Ready: 1/1 (100.00%), Status is 'Running', Restarts: 0\n    Container 'kubernetes-dashboard' Status is 'running', State is 'ready', Restarts: 0\n")),(0,a.kt)("p",null,"Les m\xe9triques collect\xe9es pour chaque Pods seront :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"M\xe9trique"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"containers.ready.count"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"restarts.total.count"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"containers.restarts.count"))))),(0,a.kt)("p",null,"Si le service collecte des m\xe9triques de plusieurs Pods (en fonction du\nsc\xe9nario choisi), le nom du Pod et le nom du conteneur seront ajout\xe9s au\nnom de la m\xe9trique :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"M\xe9trique"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"coredns-74ff55c5b-g4hmt#containers.ready.count"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"coredns-74ff55c5b-g4hmt#restarts.total.count"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"coredns-74ff55c5b-g4hmt_coredns#containers.restarts.count"))))),(0,a.kt)("p",null,"Il est alors possible de placer des seuils \xe0 l'aide des variables sp\xe9ciales\nsuivantes :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{name}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{status}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{state}")," (containers seulement)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{name}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{namespace}")," (Pods seulement)")),(0,a.kt)("p",null,"Les valeurs par d\xe9faut sont les suivantes :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Seuil"),(0,a.kt)("th",{parentName:"tr",align:null},"Valeur"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Critical (Pod)"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"%{status} !~ /running/i")),(0,a.kt)("td",{parentName:"tr",align:null},"D\xe9clenchera une alerte critique si un Pod n'est pas en statut ",(0,a.kt)("inlineCode",{parentName:"td"},"running"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Critical (conteneur)"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("code",null,"%{status} !~ /running/i ","|","|"," %{state} !~ /^ready$/")),(0,a.kt)("td",{parentName:"tr",align:null},"D\xe9clenchera une alerte critique si un conteneur n'est pas en statut ",(0,a.kt)("inlineCode",{parentName:"td"},"running")," ou en \xe9tat ",(0,a.kt)("inlineCode",{parentName:"td"},"ready"))))),(0,a.kt)("p",null,"R\xe9f\xe9rez vous \xe0 la\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/workloads/pods/"},"documentation officielle"),"\npour plus d'informations sur les m\xe9triques collect\xe9es et comment affiner vos\nseuils."),(0,a.kt)("h3",{id:"statut-des-replicasets"},"Statut des ReplicaSets"),(0,a.kt)("p",null,"Cet indicateur garantira que les ReplicaSets sont dans les limites d\xe9finies\nen regardant le nombre de r\xe9pliques pr\xeates par rapport au nombre souhait\xe9,\ncomme le ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get replicasets")," peut fournir :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"NAMESPACE              NAME                                   DESIRED   CURRENT   READY   AGE\nkube-system            coredns-74ff55c5b                      2         2         2       44d\nkube-system            tiller-deploy-7bf78cdbf7               1         1         1       630d\nkubernetes-dashboard   dashboard-metrics-scraper-79c5968bdc   1         1         1       44d\nkubernetes-dashboard   kubernetes-dashboard-7448ffc97b        1         1         1       44d\n")),(0,a.kt)("p",null,"La sortie r\xe9sultante dans Centreon pourrait ressembler \xe0 :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"ReplicaSet 'coredns-74ff55c5b' Replicas Desired: 2, Current: 2, Ready: 2\nReplicaSet 'tiller-deploy-7bf78cdbf7' Replicas Desired: 1, Current: 1, Ready: 1\nReplicaSet 'dashboard-metrics-scraper-79c5968bdc' Replicas Desired: 1, Current: 1, Ready: 1\nReplicaSet 'kubernetes-dashboard-7448ffc97b' Replicas Desired: 1, Current: 1, Ready: 1\n")),(0,a.kt)("p",null,"Les m\xe9triques collect\xe9es pour chaque ReplicaSets seront :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"M\xe9trique"),(0,a.kt)("th",{parentName:"tr",align:null},"M\xe9trique Kubernetes"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"replicaset.replicas.desired.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"replicas")," (dans l'entr\xe9e ",(0,a.kt)("inlineCode",{parentName:"td"},"spec"),")")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"replicaset.replicas.current.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"replicas")," (dans l'entr\xe9e ",(0,a.kt)("inlineCode",{parentName:"td"},"status"),")")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"replicaset.replicas.ready.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"readyReplicas"))))),(0,a.kt)("p",null,"Si le service collecte des m\xe9triques de plusieurs ReplicaSets (selon le\nsc\xe9nario choisi), le nom du ReplicaSet sera ajout\xe9 au nom de la m\xe9trique :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"M\xe9trique"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"tiller-deploy-7bf78cdbf7#replicaset.replicas.desired.count"))))),(0,a.kt)("p",null,"Il est alors possible de placer des seuils \xe0 l'aide des variables sp\xe9ciales\nsuivantes :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{desired}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{current}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{ready}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{name}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{namespace}"))),(0,a.kt)("p",null,"Les valeurs par d\xe9faut sont les suivantes :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Seuil"),(0,a.kt)("th",{parentName:"tr",align:null},"Valeur"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Critical"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"%{ready} < %{desired}")),(0,a.kt)("td",{parentName:"tr",align:null},"D\xe9clenchera une alerte critique si le nombre de r\xe9plique en status ",(0,a.kt)("inlineCode",{parentName:"td"},"ready")," est inf\xe9rieur au nombre souhait\xe9")))),(0,a.kt)("p",null,"R\xe9f\xe9rez vous \xe0 la\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/"},"documentation officielle"),"\npour plus d'informations sur les m\xe9triques collect\xe9es et comment affiner vos\nseuils."),(0,a.kt)("h3",{id:"statut-des-replicationcontrollers"},"Statut des ReplicationControllers"),(0,a.kt)("p",null,"Cet indicateur garantira que les ReplicationControllers sont dans les limites\nd\xe9finies en regardant le nombre de r\xe9pliques pr\xeates par rapport au nombre\nsouhait\xe9, comme le ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get rc")," peut fournir :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"NAMESPACE   NAME    DESIRED   CURRENT   READY   AGE\nelk         nginx   3         3         3       2d19h\n")),(0,a.kt)("p",null,"La sortie r\xe9sultante dans Centreon pourrait ressembler \xe0 :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"ReplicationController 'nginx' Replicas Desired: 3, Current: 3, Ready: 3\n")),(0,a.kt)("p",null,"Les m\xe9triques collect\xe9es pour chaque ReplicaSets seront :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"M\xe9trique"),(0,a.kt)("th",{parentName:"tr",align:null},"M\xe9trique Kubernetes"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"replicationcontroller.replicas.desired.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"replicas")," (dans l'entr\xe9e ",(0,a.kt)("inlineCode",{parentName:"td"},"spec"),")")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"replicationcontroller.replicas.current.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"replicas")," (dans l'entr\xe9e ",(0,a.kt)("inlineCode",{parentName:"td"},"status"),")")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"replicationcontroller.replicas.ready.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"readyReplicas"))))),(0,a.kt)("p",null,"Si le service collecte des m\xe9triques de plusieurs ReplicationControllers\n(selon le sc\xe9nario choisi), le nom du ReplicationController sera ajout\xe9 au\nnom de la m\xe9trique :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"M\xe9trique"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"nginx#replicationcontroller.replicas.desired.count"))))),(0,a.kt)("p",null,"Il est alors possible de placer des seuils \xe0 l'aide des variables sp\xe9ciales\nsuivantes :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{desired}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{current}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{ready}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{name}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{namespace}"))),(0,a.kt)("p",null,"Les valeurs par d\xe9faut sont les suivantes :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Seuil"),(0,a.kt)("th",{parentName:"tr",align:null},"Valeur"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Critical"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"%{ready} < %{desired}")),(0,a.kt)("td",{parentName:"tr",align:null},"D\xe9clenchera une alerte critique si le nombre de r\xe9plique en status ",(0,a.kt)("inlineCode",{parentName:"td"},"ready")," est inf\xe9rieur au nombre souhait\xe9")))),(0,a.kt)("p",null,"R\xe9f\xe9rez vous \xe0 la\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/workloads/controllers/replicationcontroller/"},"documentation officielle"),"\npour plus d'informations sur les m\xe9triques collect\xe9es et comment affiner vos\nseuils."),(0,a.kt)("h3",{id:"statut-des-statefulsets"},"Statut des StatefulSets"),(0,a.kt)("p",null,"Cet indicateur garantira que les StatefulSets sont dans des limites d\xe9finies\nen regardant le nombre de r\xe9pliques pr\xeates / \xe0 jour par rapport au nombre\nsouhait\xe9, comme le ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get statefulsets")," peut fournir :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"NAMESPACE    NAME                                        READY   AGE\nelk          elasticsearch-master                        2/2     44d\ngraphite     graphite                                    1/1     3d\nprometheus   prometheus-prometheus-operator-prometheus   1/1     619d\n")),(0,a.kt)("p",null,"La sortie r\xe9sultante dans Centreon pourrait ressembler \xe0 :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"StatefulSet 'elasticsearch-master' Replicas Desired: 2, Current: 2, Up-to-date: 2, Ready: 2\nStatefulSet 'graphite' Replicas Desired: 1, Current: 1, Up-to-date: 1, Ready: 1\nStatefulSet 'prometheus-prometheus-operator-prometheus' Replicas Desired: 1, Current: 1, Up-to-date: 1, Ready: 1\n")),(0,a.kt)("p",null,"Les m\xe9triques collect\xe9es pour chaque StatefulSets seront :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"M\xe9trique"),(0,a.kt)("th",{parentName:"tr",align:null},"M\xe9trique Kubernetes"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"statefulset.replicas.desired.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"replicas")," (dans l'entr\xe9e ",(0,a.kt)("inlineCode",{parentName:"td"},"spec"),")")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"statefulset.replicas.current.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"currentReplicas"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"statefulset.replicas.ready.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"readyReplicas"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"statefulset.replicas.uptodate.count")),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"updatedReplicas"))))),(0,a.kt)("p",null,"Si le service collecte des m\xe9triques de plusieurs StatefulSets (selon le\nsc\xe9nario choisi), le nom du StatefulSet sera ajout\xe9 au nom de la m\xe9trique :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"M\xe9trique"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"graphite#statefulset.replicas.desired.count"))))),(0,a.kt)("p",null,"Il est alors possible de placer des seuils \xe0 l'aide des variables sp\xe9ciales\nsuivantes :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{desired}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{current}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{ready}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{up_to_date}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{name}")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"%{namespace}"))),(0,a.kt)("p",null,"Les valeurs par d\xe9faut sont les suivantes :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Seuil"),(0,a.kt)("th",{parentName:"tr",align:null},"Valeur"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Warning"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"%{up_to_date} < %{desired}")),(0,a.kt)("td",{parentName:"tr",align:null},"D\xe9clenchera une alerte si le nombre de r\xe9plique \xe0 jour est inf\xe9rieur au nombre souhait\xe9")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Critical"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"%{ready} < %{desired}")),(0,a.kt)("td",{parentName:"tr",align:null},"D\xe9clenchera une alerte critique si le nombre de r\xe9plique en status ",(0,a.kt)("inlineCode",{parentName:"td"},"ready")," est inf\xe9rieur au nombre souhait\xe9")))),(0,a.kt)("p",null,"R\xe9f\xe9rez vous \xe0 la\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/"},"documentation officielle"),"\npour plus d'informations sur les m\xe9triques collect\xe9es et comment affiner vos\nseuils."),(0,a.kt)("h2",{id:"pr\xe9requis"},"Pr\xe9requis"),(0,a.kt)("h3",{id:"centreon-plugin"},"Centreon Plugin"),(0,a.kt)("p",null,"Installez ce plugin sur chaque Poller n\xe9cessaire :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"yum install centreon-plugin-Cloud-Kubernetes-Api\n")),(0,a.kt)("h3",{id:"kubernetes"},"Kubernetes"),(0,a.kt)("p",null,"Comme mentionn\xe9 dans l'introduction, deux modes de communication sont\ndisponibles:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"l'API Rest expos\xe9e par le cluster Kubernetes,"),(0,a.kt)("li",{parentName:"ul"},"l'outil CLI kubectl pour communiquer avec le ",(0,a.kt)("em",{parentName:"li"},"control plane")," du cluster.")),(0,a.kt)("p",null,"Pour de meilleures performances, nous vous recommandons d'utiliser l'API Rest."),(0,a.kt)("h4",{id:"cr\xe9er-un-compte-de-service"},"Cr\xe9er un compte de service"),(0,a.kt)("p",null,"Les deux versions peuvent utiliser un compte de service avec des droits\nsuffisants pour acc\xe9der \xe0 l'API Kubernetes."),(0,a.kt)("p",null,"Cr\xe9ez un compte de service d\xe9di\xe9 ",(0,a.kt)("inlineCode",{parentName:"p"},"centreon-service-account")," dans l'espace de\nnoms ",(0,a.kt)("inlineCode",{parentName:"p"},"kube-system")," pour acc\xe9der \xe0 l'API:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl create serviceaccount centreon-service-account --namespace kube-system\n")),(0,a.kt)("p",null,"Cr\xe9ez un r\xf4le de cluster ",(0,a.kt)("inlineCode",{parentName:"p"},"api-access")," avec les privil\xe8ges n\xe9cessaires pour le\nPlugin et liez-le au compte de service nouvellement cr\xe9\xe9 :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'cat <<EOF | kubectl create -f -\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: api-access\nrules:\n  - apiGroups:\n      - ""\n      - apps\n      - batch\n    resources:\n      - cronjobs\n      - daemonsets\n      - deployments\n      - events\n      - namespaces\n      - nodes\n      - persistentvolumes\n      - pods\n      - replicasets\n      - replicationcontrollers\n      - statefulsets\n    verbs:\n      - get\n      - list\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: api-access\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: api-access\nsubjects:\n- kind: ServiceAccount\n  name: centreon-service-account\n  namespace: kube-system\nEOF\n')),(0,a.kt)("p",null,"Se r\xe9f\xe9rer \xe0 la documentation officielle pour la\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/reference/access-authn-authz/authentication/#service-account-tokens"},"cr\xe9ation de compte de service"),"\nou pour des informations sur le\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/configuration/secret/"},"concept de secret"),"."),(0,a.kt)("h4",{id:"utilisation-de-lapi-rest"},"Utilisation de l'API Rest"),(0,a.kt)("p",null,"Si vous avez choisi de communiquer avec l'API Rest de votre plate-forme\nKubernetes, les conditions pr\xe9alables suivantes doivent \xeatre remplies :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Exposez l'API avec TLS,"),(0,a.kt)("li",{parentName:"ul"},"R\xe9cup\xe9rez le jeton du compte de service.")),(0,a.kt)("h5",{id:"exposez-lapi"},"Exposez l'API"),(0,a.kt)("p",null,"Comme l'API utilise HTTPS, vous aurez besoin d'un certificat."),(0,a.kt)("p",null,"Vous pouvez cr\xe9er un couple cl\xe9 / certificat sign\xe9 automatiquement avec la\ncommande suivante :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/kubernetesapi.key -out /etc/ssl/certs/kubernetesapi.crt\n")),(0,a.kt)("p",null,"Puis chargez-le en tant que ",(0,a.kt)("inlineCode",{parentName:"p"},"api-certificate")," dans le cluster, \xe0 partir du\nnoeud ma\xeetre :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl create secret tls api-certificate --key /etc/ssl/private/kubernetesapi.key --cert /etc/ssl/certs/kubernetesapi.crt\n")),(0,a.kt)("p",null,"L'entr\xe9e peut maintenant \xeatre cr\xe9\xe9e :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'cat <<EOF | kubectl create -f -\napiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n  name: kubernetesapi-ingress\n  namespace: default\n  annotations:\n    kubernetes.io/ingress.class: "nginx"\n    nginx.ingress.kubernetes.io/backend-protocol: HTTPS\nspec:\n  tls:\n    - hosts:\n      - kubernetesapi.local.domain\n      secretName: api-certificate\n  rules:\n  - host: kubernetesapi.local.domain\n    http:\n      paths:\n      - backend:\n          serviceName: kubernetes\n          servicePort: 443\n        path: /\nEOF\n')),(0,a.kt)("p",null,"Adaptez les entr\xe9es ",(0,a.kt)("em",{parentName:"p"},"host")," \xe0 vos besoins."),(0,a.kt)("p",null,"Se r\xe9f\xe9rer \xe0 la documentation officielle pour la\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/services-networking/ingress/"},"gestion des ingress"),"."),(0,a.kt)("h5",{id:"r\xe9cup\xe9rer-le-jeton-du-compte-de-service"},"R\xe9cup\xe9rer le jeton du compte de service"),(0,a.kt)("p",null,"R\xe9cup\xe9rez le ",(0,a.kt)("em",{parentName:"p"},"secret")," du compte de service pr\xe9c\xe9demment cr\xe9\xe9 :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl get serviceaccount centreon-service-account --namespace kube-system --output jsonpath='{.secrets[].name}'\n")),(0,a.kt)("p",null,"R\xe9cup\xe9rez ensuite le jeton du ",(0,a.kt)("em",{parentName:"p"},"secret")," du compte de service :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl get secrets centreon-service-account-token-xqw7m --namespace kube-system --output jsonpath='{.data.token}' | base64 --decode\n")),(0,a.kt)("p",null,"Ce jeton sera utilis\xe9 ult\xe9rieurement pour la configuration de l'h\xf4te Centreon."),(0,a.kt)("h4",{id:"utilisation-de-kubectl"},"Utilisation de kubectl"),(0,a.kt)("p",null,"Si vous avez choisi de communiquer avec le ",(0,a.kt)("em",{parentName:"p"},"control plane")," du cluster avec\nkubectl, les conditions pr\xe9alables suivantes doivent \xeatre remplies:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Installez l'outil kubectl,"),(0,a.kt)("li",{parentName:"ul"},"Cr\xe9ez une configuration kubectl.")),(0,a.kt)("p",null,"Ces actions sont n\xe9cessaires sur tous les Pollers qui effectueront la\nsurveillance de Kubernetes."),(0,a.kt)("h5",{id:"installer-kubectl"},"Installer kubectl"),(0,a.kt)("p",null,"T\xe9l\xe9chargez la derni\xe8re version avec la commande suivante :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"\n')),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Assurez-vous de t\xe9l\xe9charger une version avec une diff\xe9rence d'au maximum\nune version mineure de votre cluster. Pour t\xe9l\xe9charger une version\nsp\xe9cifique, changez le ",(0,a.kt)("em",{parentName:"p"},"curl")," int\xe9gr\xe9e par la version comme ",(0,a.kt)("inlineCode",{parentName:"p"},"v1.20.0"),".")),(0,a.kt)("p",null,"Installez l'outil dans le r\xe9pertoire des binaires :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl\n")),(0,a.kt)("p",null,"R\xe9f\xe9rez vous \xe0 la\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/"},"documentation officielle"),"\npour plus de d\xe9tails."),(0,a.kt)("h5",{id:"cr\xe9er-une-configuration-kubectl"},"Cr\xe9er une configuration kubectl"),(0,a.kt)("p",null,"Pour acc\xe9der au cluster, kubectl a besoin d'un fichier de configuration\ncontenant toutes les informations n\xe9cessaires."),(0,a.kt)("p",null,"Voici un exemple de cr\xe9ation de fichier de configuration bas\xe9 sur un compte\nde service (cr\xe9\xe9 au ",(0,a.kt)("a",{parentName:"p",href:"#creer-un-compte-de-service"},"chapitre pr\xe9c\xe9dent"),")."),(0,a.kt)("p",null,"Vous devrez remplir les informations suivantes et ex\xe9cuter les commandes\nsur le noeud ma\xeetre:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"ip=<master node ip>\nport=<api port>\naccount=centreon-service-account\nnamespace=kube-system\nclustername=my-kube-cluster\ncontext=my-kube-cluster\nsecret=$(kubectl get serviceaccount $account --namespace $namespace --output jsonpath='{.secrets[].name}')\nca=$(kubectl get secret $secret --namespace $namespace --output jsonpath='{.data.ca\\.crt}')\ntoken=$(kubectl get secret $secret --namespace $namespace --output jsonpath='{.data.token}' | base64 --decode)\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Le nom du compte et l'espace de noms doivent correspondre au compte cr\xe9\xe9\npr\xe9c\xe9demment. Toutes les autres informations doivent \xeatre adapt\xe9es.")),(0,a.kt)("p",null,"Ex\xe9cutez ensuite cette commande pour g\xe9n\xe9rer le fichier de configuration :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"cat <<EOF >> config\napiVersion: v1\nkind: Config\nclusters:\n- name: ${clustername}\n  cluster:\n    certificate-authority-data: ${ca}\n    server: https://${ip}:${port}\ncontexts:\n- name: ${context}\n  context:\n    cluster: ${clustername}\n    namespace: ${namespace}\n    user: ${account}\ncurrent-context: ${context}\nusers:\n- name: ${account}\n  user: ${token}\nEOF\n")),(0,a.kt)("p",null,"Cela cr\xe9era un fichier ",(0,a.kt)("inlineCode",{parentName:"p"},"config"),". Ce fichier doit \xeatre copi\xe9 dans le r\xe9pertoire\nracine de l'utilisateur de l'Engine du Poller, g\xe9n\xe9ralement dans un r\xe9pertoire\n",(0,a.kt)("inlineCode",{parentName:"p"},".kube")," (c'est-\xe0-dire ",(0,a.kt)("inlineCode",{parentName:"p"},"/var/lib/centreon-engine/.kube/config"),")."),(0,a.kt)("p",null,"Ce chemin sera utilis\xe9 ult\xe9rieurement dans la configuration de l'h\xf4te Centreon."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Vous pouvez \xe9galement copier la configuration dans le r\xe9pertoire de\nl'utilisateur Gorgone si vous utilisez Host Discovery.")),(0,a.kt)("p",null,"R\xe9f\xe9rez vous \xe0 la\n",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/"},"documentation officielle"),"\npour plus de d\xe9tails."),(0,a.kt)("h2",{id:"configuration-de-la-supervision"},"Configuration de la supervision"),(0,a.kt)("h3",{id:"cr\xe9ation-manuelle"},"Cr\xe9ation manuelle"),(0,a.kt)("p",null,"Ajoutez un h\xf4te \xe0 partir du menu ",(0,a.kt)("inlineCode",{parentName:"p"},"Configuration> Hosts")," et choisissez un\nmod\xe8le entre ",(0,a.kt)("inlineCode",{parentName:"p"},"Cloud-Kubernetes-Api")," (surveillance globale, sc\xe9narios 1 et 2)\net ",(0,a.kt)("inlineCode",{parentName:"p"},"Cloud-Kubernetes-Node-Api")," (surveillance unitaire, sc\xe9nario 3) dans la\nliste."),(0,a.kt)("p",null,"Dans les deux cas, remplissez les champs suivants :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Champ"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Host name"),(0,a.kt)("td",{parentName:"tr",align:null},"Nom de l'h\xf4te")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Alias"),(0,a.kt)("td",{parentName:"tr",align:null},"Description de l'h\xf4te")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"IP"),(0,a.kt)("td",{parentName:"tr",align:null},"Adresse IP de l'h\xf4te")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Monitored from"),(0,a.kt)("td",{parentName:"tr",align:null},"Poller \xe0 utiliser")))),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"L'adresse IP peut \xeatre soit l'adresse IP de Kubernetes (noeud ma\xeetre),\nsoit l'adresse IP de chaque noeud si vous choisissez le mod\xe8le\n",(0,a.kt)("inlineCode",{parentName:"p"},"Cloud-Kubernetes-Node-Api"),".")),(0,a.kt)("p",null,"Ensuite, d\xe9finissez les valeurs pour chaque macros n\xe9cessaire :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Si vous utiliser l'API Rest :"),(0,a.kt)("table",{parentName:"li"},(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Macro"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"),(0,a.kt)("th",{parentName:"tr",align:null},"Exemple"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"KUBERNETESAPICUSTOMMODE")),(0,a.kt)("td",{parentName:"tr",align:null},"Mode custom du plugin"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"api"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"KUBERNETESAPIHOSTNAME")),(0,a.kt)("td",{parentName:"tr",align:null},"Nom d'h\xf4te ou adresse IP du service d'API du clister"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"kubenetesapi.local.domain"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"KUBERNETESAPIPORT")),(0,a.kt)("td",{parentName:"tr",align:null},"Port de l'API"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"443"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"KUBERNETESAPIPROTO")),(0,a.kt)("td",{parentName:"tr",align:null},"Protocole utilis\xe9 par l'API"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"https"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"KUBERNETESAPITOKEN")),(0,a.kt)("td",{parentName:"tr",align:null},"Jeton r\xe9cup\xe9r\xe9 li\xe9 au compte de service"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"eyJhbG...KEw")))))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Si vous utiliser kubectl :"),(0,a.kt)("table",{parentName:"li"},(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Macro"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"),(0,a.kt)("th",{parentName:"tr",align:null},"Exemple"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"KUBERNETESAPICUSTOMMODE")),(0,a.kt)("td",{parentName:"tr",align:null},"Mode custom du plugin"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"kubectl"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"KUBECTLCONFIGFILE")),(0,a.kt)("td",{parentName:"tr",align:null},"Chemin vers le fichier de configuration"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"~/.kube/config"))))))),(0,a.kt)("p",null,"Ensuite, d\xe9finissez les valeurs pour chaque macros n\xe9cessaire :"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Macro"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"),(0,a.kt)("th",{parentName:"tr",align:null},"Valeur par d\xe9faut"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"PROXYURL")),(0,a.kt)("td",{parentName:"tr",align:null},"URL du proxy (si n\xe9cessaire)"),(0,a.kt)("td",{parentName:"tr",align:null},"aucune")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"TIMEOUT")),(0,a.kt)("td",{parentName:"tr",align:null},"Temps en secondes avant l'expiration de la requ\xeate"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"10"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"EXTRAOPTIONS")),(0,a.kt)("td",{parentName:"tr",align:null},"Options suppl\xe9mentaires (si n\xe9cessaire)"),(0,a.kt)("td",{parentName:"tr",align:null},"aucune")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"KUBERNETESAPINAMESPACE")),(0,a.kt)("td",{parentName:"tr",align:null},"Filtre namespace"),(0,a.kt)("td",{parentName:"tr",align:null},"aucune")))),(0,a.kt)("p",null,"Si vous choisissez ",(0,a.kt)("inlineCode",{parentName:"p"},"Cloud-Kubernetes-Api"),", l'h\xf4te sera ajout\xe9 avec tous les\nservices pour v\xe9rifier chaque unit\xe9 Kubernetes (sc\xe9nario 1)."),(0,a.kt)("p",null,"Cliquez sur le bouton ",(0,a.kt)("strong",{parentName:"p"},"Enregistrer")," et vous \xeates pr\xeat \xe0 pousser la\nconfiguration vers les Engines."),(0,a.kt)("h3",{id:"d\xe9couverte-automatique"},"D\xe9couverte automatique"),(0,a.kt)("h4",{id:"d\xe9couverte-dh\xf4te"},"D\xe9couverte d'h\xf4te"),(0,a.kt)("p",null,"Ajoutez une t\xe2che dans le menu ",(0,a.kt)("inlineCode",{parentName:"p"},"Configuration > D\xe9couverte")," et choisissez\nun ",(0,a.kt)("em",{parentName:"p"},"provider")," entre ",(0,a.kt)("inlineCode",{parentName:"p"},"Kubernetes Nodes (RestAPI)")," et\n",(0,a.kt)("inlineCode",{parentName:"p"},"Kubernetes Nodes (Kubectl)")," dans la liste."),(0,a.kt)("p",null,"D\xe9finissez les informations d'identification pour acc\xe9der \xe0 l'API Kubernetes\nen fonction de la m\xe9thode choisie:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Si vous utilisez l'API Rest: d\xe9finissez le jeton\n",(0,a.kt)("a",{parentName:"li",href:"#recuperer-le-jeton-du-compte-de-service"},"r\xe9cup\xe9rer plus t\xf4t")," \xe0 partir du\ncompte de service,"),(0,a.kt)("li",{parentName:"ul"},"Si vous utilisez kubectl: d\xe9finissez le chemin vers le\n",(0,a.kt)("a",{parentName:"li",href:"#creer-une-configuration-kubectl"},"fichier de configuration cr\xe9\xe9"),"\n(pr\xe9f\xe9rez utiliser le chemin relatif pour le faire fonctionner \xe0 la fois\npour la d\xe9couverte et la supervision, c'est-\xe0-dire ",(0,a.kt)("inlineCode",{parentName:"li"},"~/.kube/config"),").")),(0,a.kt)("p",null,"Pour l'API Rest: le nom d'h\xf4te / l'adresse, le port et le protocole sont\nn\xe9cessaires pour acc\xe9der \xe0 l'API Kubernetes."),(0,a.kt)("p",null,"Par d\xe9faut, la d\xe9couverte ajoutera des h\xf4tes avec un mod\xe8le d'h\xf4te minimal\nqui ne collectera que des m\xe9triques pour l'utilisation des noeuds Kubernetes.\nIl ajoutera ensuite une macro sp\xe9ciale ",(0,a.kt)("inlineCode",{parentName:"p"},"KUBERNETESNODENAME")," avec le nom du\nnoeud comme valeur (sc\xe9nario 3)."),(0,a.kt)("p",null,"S'il est planifi\xe9, la t\xe2che ajoutera automatiquement les nouveaux noeuds\najout\xe9s au cluster."),(0,a.kt)("h4",{id:"d\xe9couverte-de-service"},"D\xe9couverte de service"),(0,a.kt)("p",null,"En plus de la ",(0,a.kt)("a",{parentName:"p",href:"#creation-manuelle"},"cr\xe9ation manuelle"),", il est possible\nd'ajouter un service pour chaque instance de chaque unit\xe9 Kubernetes\n(sc\xe9nario 2). Il est alors recommand\xe9 de d\xe9sactiver les services pr\xe9c\xe9demment\ncr\xe9\xe9s lors de l'ajout d'h\xf4te."),(0,a.kt)("p",null,"Lancez une analyse sur l'h\xf4te ajout\xe9 \xe0 partir du menu\n",(0,a.kt)("inlineCode",{parentName:"p"},"Configuration > Service > Manuelle")," et ajoutez tous les services souhait\xe9s."),(0,a.kt)("p",null,"Si elle est activ\xe9e, la r\xe8gle de d\xe9couverte de service ajoutera\nautomatiquement les nouvelles instances cr\xe9\xe9es dans le cluster."),(0,a.kt)("h2",{id:"d\xe9pannage"},"D\xe9pannage"),(0,a.kt)("p",null,"Voici quelques erreurs courantes et leur description. Vous voudrez souvent\nutiliser l'option ",(0,a.kt)("inlineCode",{parentName:"p"},"--debug")," pour obtenir l'erreur exacte."),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Erreur"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"UNKNOWN: Cannot decode json response: Can't connect to <hostname>:<port> (certificate verify failed)")),(0,a.kt)("td",{parentName:"tr",align:null},"This error may appear if the TLS cetificate in self-signed. Use the option ",(0,a.kt)("inlineCode",{parentName:"td"},'--ssl-opt="SSL_verify_mode => SSL_VERIFY_NONE"')," to omit the certificate validity.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"UNKNOWN: API return error code '401' (add --debug option for detailed message)")),(0,a.kt)("td",{parentName:"tr",align:null},"If adding ",(0,a.kt)("inlineCode",{parentName:"td"},"--debug")," option, API response message says ",(0,a.kt)("inlineCode",{parentName:"td"},"Unauthorized"),". It generally means that the provided token is not valid.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"UNKNOWN: API return error code '403' (add --debug option for detailed message)")),(0,a.kt)("td",{parentName:"tr",align:null},"If adding ",(0,a.kt)("inlineCode",{parentName:"td"},"--debug")," option, API response message says ",(0,a.kt)("inlineCode",{parentName:"td"},'nodes is forbidden: User "system:serviceaccount:<namespace>:<account>" cannot list resource "nodes" in API group "" at the cluster scope'),". It means that the cluster role RBAC bound to the service account does not have the necessary privileges")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"UNKNOWN: CLI return error code '1' (add --debug option for detailed message)")),(0,a.kt)("td",{parentName:"tr",align:null},"If adding ",(0,a.kt)("inlineCode",{parentName:"td"},"--debug")," option, CLI response message says ",(0,a.kt)("inlineCode",{parentName:"td"},"error: stat ~/.kube/config:: no such file or directory"),". The provided configuration file cannot be found.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"UNKNOWN: CLI return error code '1' (add --debug option for detailed message)")),(0,a.kt)("td",{parentName:"tr",align:null},"If adding ",(0,a.kt)("inlineCode",{parentName:"td"},"--debug")," option, CLI response message says ",(0,a.kt)("inlineCode",{parentName:"td"},'error: error loading config file "/root/.kube/config": open /root/.kube/config: permission denied'),". The provided configuration file cannot be read by current user.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"UNKNOWN: CLI return error code '1' (add --debug option for detailed message)")),(0,a.kt)("td",{parentName:"tr",align:null},"If adding ",(0,a.kt)("inlineCode",{parentName:"td"},"--debug")," option, CLI response message says ",(0,a.kt)("inlineCode",{parentName:"td"},'error: error loading config file "/root/.kube/config": v1.Config.AuthInfos: []v1.NamedAuthInfo: v1.NamedAuthInfo.AuthInfo: v1.AuthInfo.ClientKeyData: decode base64: illegal base64...'),". The provided configuration file is not valid.")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"UNKNOWN: CLI return error code '1' (add --debug option for detailed message)")),(0,a.kt)("td",{parentName:"tr",align:null},"If adding ",(0,a.kt)("inlineCode",{parentName:"td"},"--debug")," option, CLI response message says ",(0,a.kt)("inlineCode",{parentName:"td"},"The connection to the server <hostname>:<port> was refused - did you specify the right host or port?"),". The provided configuration file is not valid.")))))}k.isMDXComponent=!0},52922:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/cloud-kubernetes-api-cluster-nodes-detail-ef0a545a1dfd9e156a5451f598548855.png"},62070:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/cloud-kubernetes-api-cluster-nodes-listing-4f09461457985762ae5f1fc9c4b17aa3.png"}}]);