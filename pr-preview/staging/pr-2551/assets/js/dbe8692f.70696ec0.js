"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[36487],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>g});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=r.createContext({}),d=function(e){var t=r.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=d(e.components);return r.createElement(p.Provider,{value:t},e.children)},s="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,l=e.originalType,p=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),s=d(n),c=a,g=s["".concat(p,".").concat(c)]||s[c]||m[c]||l;return n?r.createElement(g,o(o({ref:t},u),{},{components:n})):r.createElement(g,o({ref:t},u))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=n.length,o=new Array(l);o[0]=c;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i[s]="string"==typeof e?e:a,o[1]=i;for(var d=2;d<l;d++)o[d]=n[d];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}c.displayName="MDXCreateElement"},51102:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>p,default:()=>g,frontMatter:()=>i,metadata:()=>d,toc:()=>s});n(67294);var r=n(3905);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const i={id:"developer-widget",title:"How to write a widget"},p=void 0,d={unversionedId:"developer/developer-widget",id:"version-23.10/developer/developer-widget",title:"How to write a widget",description:"Centreon offers a custom view system which allows the user to view one or more widgets on the same page:",source:"@site/versioned_docs/version-23.10/developer/developer-widget.md",sourceDirName:"developer",slug:"/developer/developer-widget",permalink:"/centreon-documentation/pr-preview/staging/pr-2551/docs/developer/developer-widget",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/versioned_docs/version-23.10/developer/developer-widget.md",tags:[],version:"23.10",lastUpdatedAt:1699282580,formattedLastUpdatedAt:"Nov 6, 2023",frontMatter:{id:"developer-widget",title:"How to write a widget"},sidebar:"version-23.10/docs",previous:{title:"How to translate Centreon",permalink:"/centreon-documentation/pr-preview/staging/pr-2551/docs/developer/developer-translate-centreon"},next:{title:"Stream connectors",permalink:"/centreon-documentation/pr-preview/staging/pr-2551/docs/developer/developer-broker-stream-connector"}},u={},s=[{value:"Should I make a widget or a module?",id:"should-i-make-a-widget-or-a-module",level:2},{value:"Directory structure",id:"directory-structure",level:2},{value:"Configuration file",id:"configuration-file",level:2},{value:"Basic tags",id:"basic-tags",level:3},{value:"Parameter attributes",id:"parameter-attributes",level:3},{value:"Code",id:"code",level:3}],m={toc:s},c="wrapper";function g(e){var{components:t}=e,n=o(e,["components"]);return(0,r.kt)(c,l(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){a(e,t,n[t])}))}return e}({},m,n),{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Centreon offers a custom view system which allows the user to view one or more widgets on the same page:\n",(0,r.kt)("strong",{parentName:"p"},"Home > Custom views"),"."),(0,r.kt)("p",null,"You may have specific needs that are not yet covered by our widget catalog and this tutorial will explain to you how to\nwrite your first widget for Centreon."),(0,r.kt)("h2",{id:"should-i-make-a-widget-or-a-module"},"Should I make a widget or a module?"),(0,r.kt)("p",null,"If you are wondering if you should be making a module or a widget, then ask yourself if your project is meant to contain\nmany menus, or is it rather a plain page that is going to display little information? "),(0,r.kt)("p",null,"Of course, you could make a widget that would only work with a certain module."),(0,r.kt)("h2",{id:"directory-structure"},"Directory structure"),(0,r.kt)("p",null,"Widgets work pretty much like Modules. They must be placed in the following directory:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Shell"},"centreon/www/widgets/name-of-your-widget/\n")),(0,r.kt)("p",null,"Your widget must contain one mandatory file named ",(0,r.kt)("strong",{parentName:"p"},"configs.xml")," at its root."),(0,r.kt)("h2",{id:"configuration-file"},"Configuration file"),(0,r.kt)("p",null,"This is the XML configuration file of our Dummy widget:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-XML"},'<configs>\n    <title>Dummy</title>\n    <author>Centreon</author>\n    <email>contact@centreon.com</email>\n    <website>http://www.centreon.com</website>\n    <description>Dummy widget</description>\n    <version>1.0.3</version>\n    <keywords>dummy, widget, centreon</keywords>\n    <screenshot></screenshot>\n    <thumbnail>./widgets/dummy/resources/logoCentreon.png</thumbnail>\n    <url>./widgets/dummy/index.php</url>\n    <autoRefresh></autoRefresh>\n    <preferences>\n        <preference label="text preference" name="text preference" defaultValue="default value" type="text"/>\n        <preference label="boolean preference" name="boolean preference" defaultValue="1" type="boolean"/>\n        <preference label="date" name="date" defaultValue="" type="date"/>\n        <preference label="host preference" name="host preference" defaultValue="" type="host"/>\n        <preference label="list preference" name="list preference" defaultValue="none" type="list">\n            <option value="all" label="all"/>\n            <option value="none" label="none"/>\n        </preference>\n        <preference label="range preference" name="range preference" defaultValue="5" type="range" min="0" max="50" step="5"/>\n        <preference label="host search" name="host search" defaultValue="notlike _Module_%" type="compare"/>\n    </preferences>\n</configs>\n')),(0,r.kt)("p",null,"Now, let's see what these tags refer to."),(0,r.kt)("h3",{id:"basic-tags"},"Basic tags"),(0,r.kt)("p",null,"*"," = Mandatory tag"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Tag name"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"title*"),(0,r.kt)("td",{parentName:"tr",align:null},"Title of your widget")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"author*"),(0,r.kt)("td",{parentName:"tr",align:null},"Your name")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"email"),(0,r.kt)("td",{parentName:"tr",align:null},"Your email address")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"website"),(0,r.kt)("td",{parentName:"tr",align:null},"URL of your project")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"description*"),(0,r.kt)("td",{parentName:"tr",align:null},"Short description of your widget")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"version*"),(0,r.kt)("td",{parentName:"tr",align:null},"Version of your widget. Increment this number whenever you publish a new version.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"keywords"),(0,r.kt)("td",{parentName:"tr",align:null},"A few key words that describe your widget")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"screenshot"),(0,r.kt)("td",{parentName:"tr",align:null},"Screenshot that shows the best side of your widget. Screenshot should be placed within your widget directory.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"thumbnail"),(0,r.kt)("td",{parentName:"tr",align:null},"Logo of your project. Best size is 100px x 25px. Thumbnail should be placed within your widget directory.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"url*"),(0,r.kt)("td",{parentName:"tr",align:null},"Path of the main page of your widget")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"autorefresh"),(0,r.kt)("td",{parentName:"tr",align:null},"This parameter is not implemented yet")))),(0,r.kt)("h3",{id:"parameter-attributes"},"Parameter attributes"),(0,r.kt)("p",null,"*"," = ",(0,r.kt)("em",{parentName:"p"},"Mandatory parameter")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Tag attributes"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"label*"),(0,r.kt)("td",{parentName:"tr",align:null},"Label of the parameter")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"name*"),(0,r.kt)("td",{parentName:"tr",align:null},"Name of the parameter that will be used for retrieving its value")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"defaultValue*"),(0,r.kt)("td",{parentName:"tr",align:null},"Default Value of the parameter")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"requirePermission"),(0,r.kt)("td",{parentName:"tr",align:null},'Value can be "1" or "0". When set to 1, this parameter will not be shown to unauthorized users.')),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"type*"),(0,r.kt)("td",{parentName:"tr",align:null},"Parameter type, must be one of the following: text,boolean,date,list,range,compare,host,hostgroup, hostTemplate,servicegroup,serviceTemplate")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"min*"),(0,r.kt)("td",{parentName:"tr",align:null},"For range type only. It refers to the minimum value of the range parameter")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"max*"),(0,r.kt)("td",{parentName:"tr",align:null},"For range type only. It refers to the maximum value of the range parameter")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"step*"),(0,r.kt)("td",{parentName:"tr",align:null},"For range type only. It refers to the step value of the range parameter")))),(0,r.kt)("h1",{id:"parameter-type"},"Parameter type"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Tag name"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"text"),(0,r.kt)("td",{parentName:"tr",align:null},"Renders a text input element")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"boolean"),(0,r.kt)("td",{parentName:"tr",align:null},"Renders a checkbox")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"date"),(0,r.kt)("td",{parentName:"tr",align:null},"Renders two text input elements. One for the start date, the other one for the end date.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"list"),(0,r.kt)("td",{parentName:"tr",align:null},"Renders a selectbox. The selectbox will be populated with the option tags, which must be defined within the preference tag.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"range"),(0,r.kt)("td",{parentName:"tr",align:null},"Renders a selectbox which will be populated with values depending on the min, max and step definitions.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"compare"),(0,r.kt)("td",{parentName:"tr",align:null},"Renders a selectbox and a text input. Selectbox will contain SQL operands such as:")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"> : greater than")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"< : less than")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},">= : greater or equal")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"<= : less or equal")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"= : equal")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"!= : not equal")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"LIKE : can be used with the wildcard %%")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"NOT LIKE : can be used with the wildcard %%")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"host"),(0,r.kt)("td",{parentName:"tr",align:null},"Renders a selectbox populated with a list of hosts.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hostgroup"),(0,r.kt)("td",{parentName:"tr",align:null},"Renders a selectbox populated with a list of hostgroups.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"hostTemplate"),(0,r.kt)("td",{parentName:"tr",align:null},"Renders a selectbox populated with a list of host templates.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"servicegroup"),(0,r.kt)("td",{parentName:"tr",align:null},"Renders a selectbox populated with a list of servicegroups.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"serviceTemplate"),(0,r.kt)("td",{parentName:"tr",align:null},"Renders a selectbox populated with a list of service templates.")))),(0,r.kt)("p",null,"The preference window would look like this as a result:"),(0,r.kt)("p",null,".. image:: /_static/images/extending/pref_dummy_widget.png\n:align: center"),(0,r.kt)("h3",{id:"code"},"Code"),(0,r.kt)("p",null,'All languages are separated in different files, one file for each language. The file "configs.xml" calls the PHP file\nand the PHP file calls the HTML file, etc.'),(0,r.kt)("p",null,"We use Smarty, which is a template engine for PHP (",(0,r.kt)("a",{parentName:"p",href:"http://smarty.net"},"http://smarty.net"),")."),(0,r.kt)("p",null,"To use Smarty you need to proceed as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-PHP"},"require_once $centreon_path . 'GPL_LIB/Smarty/libs/Smarty.class.php';\n")),(0,r.kt)("p",null,"1.configuration of smarty:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-PHP"},'$path = $centreon_path . "www/widgets/Dummy/src/";\n$template = new Smarty();\n$template = initSmartyTplForPopup($path, $template, "./", $centreon_path);\n')),(0,r.kt)("p",null,"2.creating a PHP template to be use in HTML:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-PHP"},"$template->assign('widgetId', $widgetId);\n$template->assign('autoRefresh', $autoRefresh);\n$template->assign('data', $data);\n")),(0,r.kt)("p",null,"3.affectation of html's file to execute:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-PHP"},"$template->display('dummy.ihtml');\n")),(0,r.kt)("p",null,"This line asks PHP to call the ",(0,r.kt)("strong",{parentName:"p"},"dummy.ihtml")," smarty template to display the results:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-PHP"},"$template->display('dummy.ihtml');\n")),(0,r.kt)("p",null,"To query the databases (",(0,r.kt)("strong",{parentName:"p"},"centreon")," for the configuration and ",(0,r.kt)("strong",{parentName:"p"},"centstorage")," for the real time data),\nyou must initialize the PHP object as described below (using ",(0,r.kt)("strong",{parentName:"p"},"pearDB"),"):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-PHP"},'try {\n    global $pearDB;\n\n    $db_centreon = new CentreonDB("centreon");\n    $db = new CentreonDB("centstorage");\n    $pearDB = $db_centreon;\n\n    $widgetObj = new CentreonWidget($centreon, $db_centreon);\n    $preferences = $widgetObj->getWidgetPreferences($widgetId);\n    $autoRefresh = 0;\n    if (isset($preferences[\'refresh_interval\'])) {\n        $autoRefresh = $preferences[\'refresh_interval\'];\n    }\n} catch (Exception $e) {\n    echo $e->getMessage() . "<br/>";\n    exit;\n}\n')),(0,r.kt)("p",null,"Then query the database using the class methods."))}g.isMDXComponent=!0}}]);