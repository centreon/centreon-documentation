"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[28508],{73704:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>u,contentTitle:()=>m,default:()=>k,frontMatter:()=>p,metadata:()=>c,toc:()=>g});r(67294);var n=r(3905),a=r(51715),o=r(7626);function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}const p={id:"migrate-from-el-to-el",title:"Migrate from an EL-type OS to another EL-type OS (from a Centreon 18.10 or newer)"},m=void 0,c={unversionedId:"migrate/migrate-from-el-to-el",id:"version-23.10/migrate/migrate-from-el-to-el",title:"Migrate from an EL-type OS to another EL-type OS (from a Centreon 18.10 or newer)",description:"Prerequisites",source:"@site/versioned_docs/version-23.10/migrate/migrate-from-el-to-el.md",sourceDirName:"migrate",slug:"/migrate/migrate-from-el-to-el",permalink:"/centreon-documentation/pr-preview/staging/pr-2551/docs/migrate/migrate-from-el-to-el",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/versioned_docs/version-23.10/migrate/migrate-from-el-to-el.md",tags:[],version:"23.10",lastUpdatedAt:1699282580,formattedLastUpdatedAt:"Nov 6, 2023",frontMatter:{id:"migrate-from-el-to-el",title:"Migrate from an EL-type OS to another EL-type OS (from a Centreon 18.10 or newer)"},sidebar:"version-23.10/docs",previous:{title:"Introduction to the migration process",permalink:"/centreon-documentation/pr-preview/staging/pr-2551/docs/migrate/introduction"},next:{title:"Migrate from an EL-type OS to Debian 11",permalink:"/centreon-documentation/pr-preview/staging/pr-2551/docs/migrate/migrate-from-el-to-debian"}},u={},g=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Migrating a central server",id:"migrating-a-central-server",level:2},{value:"Step 1: Install the new server",id:"step-1-install-the-new-server",level:3},{value:"Step 2: Synchronize the data",id:"step-2-synchronize-the-data",level:3},{value:"Step 3: Retrieve the databases",id:"step-3-retrieve-the-databases",level:3},{value:"Step 4: Synchronize the plugins",id:"step-4-synchronize-the-plugins",level:3},{value:"Step 5: Upgrade Centreon",id:"step-5-upgrade-centreon",level:3},{value:"Step 6 (older versions only): Migrate to Gorgone",id:"step-6-older-versions-only-migrate-to-gorgone",level:3},{value:"Step 7: Upgrade the modules",id:"step-7-upgrade-the-modules",level:3},{value:"Migrating a remote server",id:"migrating-a-remote-server",level:2},{value:"Migrating a poller",id:"migrating-a-poller",level:2}],d={toc:g},h="wrapper";function k(e){var{components:t}=e,r=s(e,["components"]);return(0,n.kt)(h,i(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){l(e,t,r[t])}))}return e}({},d,r),{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,n.kt)("p",null,"This procedure only applies if the following conditions are met:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"You wish to migrate from a 64-bit EL-type OS to another supported 64-bit EL-type OS. For instance, if you want to migrate from a CentOS 7 to an Alma 8 or 9."),(0,n.kt)("li",{parentName:"ul"},"Your version of Centreon is 18.10 or newer.")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"If your Centreon platform includes a Centreon redundancy system, please\ncontact ",(0,n.kt)("a",{parentName:"p",href:"https://support.centreon.com"},"Centreon support"),".")),(0,n.kt)("h2",{id:"migrating-a-central-server"},"Migrating a central server"),(0,n.kt)("h3",{id:"step-1-install-the-new-server"},"Step 1: Install the new server"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Install your new OS: check the ",(0,n.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2551/docs/installation/compatibility#operating-systems"},"supported operating systems"),".")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Install a new Centreon central server from ",(0,n.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2551/docs/installation/installation-of-a-central-server/using-packages"},"packages"),", until you\ncomplete the installation process by connecting to the Centreon web interface."),(0,n.kt)("blockquote",{parentName:"li"},(0,n.kt)("p",{parentName:"blockquote"},"Use the same password for the ",(0,n.kt)("strong",{parentName:"p"},"centreon")," user as for the old platform during the web\ninstallation process."))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Perform software and system updates:"))),(0,n.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,n.kt)(o.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"dnf update\n"))),(0,n.kt)(o.Z,{value:"Alma / RHEL / Oracle Linux 9",label:"Alma / RHEL / Oracle Linux 9",mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"dnf update\n"))),(0,n.kt)(o.Z,{value:"Debian 11",label:"Debian 11",mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"apt update\n")))),(0,n.kt)("h3",{id:"step-2-synchronize-the-data"},"Step 2: Synchronize the data"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Connect to your old Centreon server.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Generate a pair of ssh keys for ",(0,n.kt)("strong",{parentName:"p"},"root"),":"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"ssh-keygen -t rsa\n")),(0,n.kt)("p",{parentName:"li"},"By default, the key pair generated will be saved to ",(0,n.kt)("strong",{parentName:"p"},"/root/.ssh/id_rsa.pub")," and ",(0,n.kt)("strong",{parentName:"p"},"/root/.ssh/id_rsa"),".")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Copy ",(0,n.kt)("strong",{parentName:"p"},"root"),"'s public key (",(0,n.kt)("strong",{parentName:"p"},"/root/.ssh/id_rsa.pub"),") into the ",(0,n.kt)("strong",{parentName:"p"},"/root/.ssh/authorized_keys")," file of the new server. If you are not using ",(0,n.kt)("strong",{parentName:"p"},"root")," for the synchronization, make sure that the user you use has writing rights on the target directory.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"From the old server, synchronize the following directories to the new server:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"rsync -avz /etc/centreon root@<IP_NEW_CENTREON>:/etc\nrsync -avz /etc/centreon-broker root@<IP_NEW_CENTREON>:/etc\nrsync -avz /var/log/centreon-engine/archives/ root@<IP_NEW_CENTREON>:/var/log/centreon-engine\nrsync -avz --exclude centcore/ --exclude log/ /var/lib/centreon root@<IP_NEW_CENTREON>:/var/lib\nrsync -avz /usr/share/centreon/www/img/media root@<IP_NEW_CENTREON>:/usr/share/centreon/www/img\n")),(0,n.kt)("p",{parentName:"li"},"If you have given a custom name to your private key file, use the following format (just replace ",(0,n.kt)("strong",{parentName:"p"},"id_rsa_custom")," with your file name, and ",(0,n.kt)("inlineCode",{parentName:"p"},"<command>")," with the commands above):"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},'rsync -avz -e "ssh -i /root/.ssh/id_rsa_custom" <command>\n')),(0,n.kt)("blockquote",{parentName:"li"},(0,n.kt)("p",{parentName:"blockquote"},"Replace ",(0,n.kt)("strong",{parentName:"p"},"<IP_NEW_CENTREON>")," by the IP address of the new Centreon server.")))),(0,n.kt)("h3",{id:"step-3-retrieve-the-databases"},"Step 3: Retrieve the databases"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"On the old server, create a dump of the databases:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"mysqldump -u root -p centreon > /tmp/centreon.sql\nmysqldump -u root -p centreon_storage > /tmp/centreon_storage.sql\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"On the old server, stop MariaDB:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl stop mariadb\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"On the old server, export the dumps to the new Centreon database server (make sure you\nhave enough space for large database dumps):"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"rsync -avz /tmp/centreon.sql root@<IP_NEW_CENTREON>:/tmp/\nrsync -avz /tmp/centreon_storage.sql root@<IP_NEW_CENTREON>:/tmp/\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"On the new database server, drop the original databases and\ncreate them again:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"mysql -u root -p\n")),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-SQL"},"DROP DATABASE centreon;\nDROP DATABASE centreon_storage;\nCREATE DATABASE centreon;\nCREATE DATABASE centreon_storage;\nexit\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"On the new database server, import the previously transferred dumps into the database:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"mysql -u root centreon -p </tmp/centreon.sql\nmysql -u root centreon_storage -p </tmp/centreon_storage.sql\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Upgrade the tables:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"mysql_upgrade\n")),(0,n.kt)("p",{parentName:"li"},"If your database is password-protected, enter:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"mysql_upgrade -u <database_admin_user> -p\n")),(0,n.kt)("p",{parentName:"li"},"Example: if your database_admin_user is ",(0,n.kt)("inlineCode",{parentName:"p"},"root"),", enter:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"mysql_upgrade -u root -p\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Start the MariaDB process on the new server:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl start mariadb\n")))),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"Replace ",(0,n.kt)("strong",{parentName:"p"},"<IP_NEW_CENTREON>")," by the IP address of the new Centreon server.")),(0,n.kt)("h3",{id:"step-4-synchronize-the-plugins"},"Step 4: Synchronize the plugins"),(0,n.kt)("p",null,"If you only use Centreon plugins, reinstall them on the new server:"),(0,n.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,n.kt)(o.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"dnf install centreon-plugin-\\*\n"))),(0,n.kt)(o.Z,{value:"Alma / RHEL / Oracle Linux 9",label:"Alma / RHEL / Oracle Linux 9",mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"dnf install centreon-plugin-\\*\n"))),(0,n.kt)(o.Z,{value:"Debian 11",label:"Debian 11",mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"apt install centreon-plugin-\\*\n")))),(0,n.kt)("p",null,"If you are using custom plugins, synchronize the directories that contain your custom plugins, including any necessary dependencies."),(0,n.kt)("h3",{id:"step-5-upgrade-centreon"},"Step 5: Upgrade Centreon"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"On the new server, force the update by moving the contents of the\n",(0,n.kt)("strong",{parentName:"p"},"/var/lib/centreon/installs/install-22.10.x-YYYYMMDD","_","HHMMSS")," directory to\nthe ",(0,n.kt)("strong",{parentName:"p"},"/usr/share/centreon/www/install")," directory (",(0,n.kt)("strong",{parentName:"p"},"x")," is the target version number for your migrated machine):"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"cd /var/lib/centreon/installs/\nmv install-22.10.x-YYYYMMDD_HHMMSS/ /usr/share/centreon/www/install/\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"If you use the same IP address or same DNS name on the old Centreon webserver and the new one, do a full cache cleanup of your browser to avoid JS issues.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Go to ",(0,n.kt)("inlineCode",{parentName:"p"},"http://<IP_NEW_CENTREON>/centreon")," and perform the upgrade.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"If the password for user ",(0,n.kt)("strong",{parentName:"p"},"centreon")," that you specified when installing the new server is different from the password on the old server, you must follow these steps:"),(0,n.kt)("ol",{parentName:"li"},(0,n.kt)("li",{parentName:"ol"},"Edit the ",(0,n.kt)("strong",{parentName:"li"},"/etc/centreon/centreon.conf.php")," file,"),(0,n.kt)("li",{parentName:"ol"},"Edit the ",(0,n.kt)("strong",{parentName:"li"},"/etc/centreon/conf.pm")," file,"),(0,n.kt)("li",{parentName:"ol"},"Edit the Centreon Broker central configuration using the Centreon web interface and change the password for the ",(0,n.kt)("strong",{parentName:"li"},"unfied-sql")," output,"),(0,n.kt)("li",{parentName:"ol"},"Edit the ",(0,n.kt)("strong",{parentName:"li"},"/etc/centreon/config.d/10-database.yaml")," file."))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"If the IP address of your Centreon server has changed:"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Edit the configuration for all the Centreon Broker modules of your Pollers and change the IP to connect to\nthe Centreon Central server (output IPv4). See the ",(0,n.kt)("a",{parentName:"li",href:"/centreon-documentation/pr-preview/staging/pr-2551/docs/monitoring/monitoring-servers/advanced-configuration#tcp-outputs"},"Advanced\nconfiguration"),"\nchapter for more information."),(0,n.kt)("li",{parentName:"ul"},"The fingerprint of your platform has changed too: ",(0,n.kt)("a",{parentName:"li",href:"mailto:support@centreon.com"},"contact Centreon")," to obtain a new license."))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2551/docs/monitoring/monitoring-servers/deploying-a-configuration"},"Deploy the configuration")," for all your monitoring servers (including the central).")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Restart the following processes:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl restart cbd centengine\nsystemctl restart gorgoned\nsystemctl start snmptrapd centreontrapd\nsystemctl start snmpd\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"If your old Centreon server was monitoring itself, and you have changed the username/password for the database during the migration, update the configuration of all related resources (host, services attached to that host).")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Go to ",(0,n.kt)("strong",{parentName:"p"},"Configuration > Monitoring Connectors Manager"),", then ",(0,n.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2551/docs/monitoring/pluginpacks#updating-one-packall-packs"},"update all the Monitoring Connectors"),"."))),(0,n.kt)("h3",{id:"step-6-older-versions-only-migrate-to-gorgone"},"Step 6 (older versions only): Migrate to Gorgone"),(0,n.kt)("p",null,"If you are migrating from a Centreon version 18.10, 19.04 or 19.10, ",(0,n.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2551/docs/developer/developer-gorgone-migrate-from-centcore"},"migrate from Centcore to Gorgone"),"."),(0,n.kt)("h3",{id:"step-7-upgrade-the-modules"},"Step 7: Upgrade the modules"),(0,n.kt)("p",null,"To upgrade the modules, go to ",(0,n.kt)("strong",{parentName:"p"},"Administration > Extensions > Manager")," and click ",(0,n.kt)("strong",{parentName:"p"},"Update all"),".\nIf you have a MAP server or an MBI server, follow the corresponding migration procedures:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Migration procedure for ",(0,n.kt)("a",{parentName:"li",href:"/centreon-documentation/pr-preview/staging/pr-2551/docs/graph-views/migrate"},"MAP"),","),(0,n.kt)("li",{parentName:"ul"},"Migration procedure for ",(0,n.kt)("a",{parentName:"li",href:"/centreon-documentation/pr-preview/staging/pr-2551/docs/reporting/migrate"},"MBI"),".")),(0,n.kt)("h2",{id:"migrating-a-remote-server"},"Migrating a remote server"),(0,n.kt)("p",null,"To migrate a remote server:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Follow the same procedure as for a central server."),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("a",{parentName:"li",href:"/centreon-documentation/pr-preview/staging/pr-2551/docs/monitoring/monitoring-servers/add-a-remote-server-to-configuration"},"Attach the new remote server")," to your central server.")),(0,n.kt)("h2",{id:"migrating-a-poller"},"Migrating a poller"),(0,n.kt)("p",null,"To migrate a poller:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Follow steps 1 and 4 of the procedure to migrate a central server (i.e. ",(0,n.kt)("a",{parentName:"li",href:"#step-1-install-the-new-server"},"install the new server")," and ",(0,n.kt)("a",{parentName:"li",href:"#step-4-synchronize-the-plugins"},"synchronize the plugins"),")."),(0,n.kt)("li",{parentName:"ol"},"On the central server, go to ",(0,n.kt)("strong",{parentName:"li"},"Configuration > Pollers"),". Select the poller that was migrated and update its IP address (if it has changed)."),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("a",{parentName:"li",href:"/centreon-documentation/pr-preview/staging/pr-2551/docs/monitoring/monitoring-servers/deploying-a-configuration"},"Deploy the configuration"),"."),(0,n.kt)("li",{parentName:"ol"},"If your poller does not work after migrating it (e.g. you cannot deploy the configuration or execute monitoring actions), update the poller's fingerprint, as described in this ",(0,n.kt)("a",{parentName:"li",href:"https://thewatch.centreon.com/troubleshooting-41/poller-does-not-work-after-migration-or-reinstallation-fingerprint-changed-for-target-1177"},"knowledge base article"),".")))}k.isMDXComponent=!0}}]);