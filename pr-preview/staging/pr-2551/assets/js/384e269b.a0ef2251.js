"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[83646],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>g});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),p=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(s.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=p(n),d=a,g=u["".concat(s,".").concat(d)]||u[d]||m[d]||o;return n?r.createElement(g,l(l({ref:t},c),{},{components:n})):r.createElement(g,l({ref:t},c))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,l=new Array(o);l[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[u]="string"==typeof e?e:a,l[1]=i;for(var p=2;p<o;p++)l[p]=n[p];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},82949:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>f,frontMatter:()=>i,metadata:()=>p,toc:()=>u});n(67294);var r=n(3905);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const i={id:"migrate-from-3-4",title:"Migrate from a Centreon 3.4 platform"},s=void 0,p={unversionedId:"migrate/migrate-from-3-4",id:"version-23.10/migrate/migrate-from-3-4",title:"Migrate from a Centreon 3.4 platform",description:"Prerequisites",source:"@site/versioned_docs/version-23.10/migrate/migrate-from-3-4.md",sourceDirName:"migrate",slug:"/migrate/migrate-from-3-4",permalink:"/centreon-documentation/pr-preview/staging/pr-2551/docs/migrate/migrate-from-3-4",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/versioned_docs/version-23.10/migrate/migrate-from-3-4.md",tags:[],version:"23.10",lastUpdatedAt:1699282580,formattedLastUpdatedAt:"Nov 6, 2023",frontMatter:{id:"migrate-from-3-4",title:"Migrate from a Centreon 3.4 platform"},sidebar:"version-23.10/docs",previous:{title:"Migrate from an EL-type OS to Debian 11",permalink:"/centreon-documentation/pr-preview/staging/pr-2551/docs/migrate/migrate-from-el-to-debian"},next:{title:"Nagios Reader to Centreon CLAPI",permalink:"/centreon-documentation/pr-preview/staging/pr-2551/docs/migrate/nagios-to-centreon"}},c={},u=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Migrate",id:"migrate",level:2},{value:"Install the new server",id:"install-the-new-server",level:3},{value:"Synchronize the data",id:"synchronize-the-data",level:3},{value:"Retrieve databases",id:"retrieve-databases",level:3},{value:"Synchronize the plugins",id:"synchronize-the-plugins",level:3},{value:"Upgrade Centreon",id:"upgrade-centreon",level:3},{value:"Upgrade the modules",id:"upgrade-the-modules",level:3}],m=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",t)},d=m("Tabs"),g=m("TabItem"),k={toc:u},h="wrapper";function f(e){var{components:t}=e,n=l(e,["components"]);return(0,r.kt)(h,o(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){a(e,t,n[t])}))}return e}({},k,n),{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("p",null,"The following procedure only applies to migration from a Centreon 3.4 platform\ninstalled on a 64-bit GNU/Linux distribution other than Oracle Linux / RHEL 8.\nHere are the system requirements:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Components"),(0,r.kt)("th",{parentName:"tr",align:null},"Version"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Centreon Web"),(0,r.kt)("td",{parentName:"tr",align:null},"2.8.x")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Centreon Broker"),(0,r.kt)("td",{parentName:"tr",align:null},"3.0.x")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Centreon Engine"),(0,r.kt)("td",{parentName:"tr",align:null},"1.8.x")))),(0,r.kt)("h2",{id:"migrate"},"Migrate"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"If your Centreon platform includes a Centreon redundancy system, please\ncontact ",(0,r.kt)("a",{parentName:"p",href:"https://support.centreon.com"},"Centreon support"),".")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"If you try to migrate a platform using the ",(0,r.kt)("strong",{parentName:"p"},"Centreon Poller Display 1.6.x"),",\nplease refer to the following ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2551/docs/migrate/poller-display-to-remote-server"},"migration\nprocedure"),".")),(0,r.kt)("h3",{id:"install-the-new-server"},"Install the new server"),(0,r.kt)("p",null,"Perform the following actions:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"You will need to install a new Centreon Central server from\n",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2551/docs/installation/installation-of-a-central-server/using-packages"},"packages"),", until you\ncomplete the installation process by connecting to the Centreon Web\ninterface.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Perform software and system updates:"))),(0,r.kt)(d,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(g,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"dnf update\n"))),(0,r.kt)(g,{value:"Alma / RHEL / Oracle Linux 9",label:"Alma / RHEL / Oracle Linux 9",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"dnf update\n"))),(0,r.kt)(g,{value:"Debian 11",label:"Debian 11",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"apt update\n")))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"It is advisable to set the same password for the ",(0,r.kt)("em",{parentName:"p"},"centreon")," user during the web\ninstallation process.")),(0,r.kt)("h3",{id:"synchronize-the-data"},"Synchronize the data"),(0,r.kt)("p",null,"Connect to your old Centreon server and synchronize following directories:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"rsync -avz /etc/centreon root@<IP_NEW_CENTREON>:/etc\nrsync -avz /etc/centreon-broker root@<IP_NEW_CENTREON>:/etc\nrsync -avz /var/log/centreon-engine/archives/ root@<IP_NEW_CENTREON>:/var/log/centreon-engine\nrsync -avz --exclude centcore/ --exclude log/ /var/lib/centreon root@<IP_NEW_CENTREON>:/var/lib\nrsync -avz /var/spool/centreon/.ssh root@<IP_NEW_CENTREON>:/var/spool/centreon\nrsync -avz /usr/share/centreon/www/img/media root@<IP_NEW_CENTREON>:/usr/share/centreon/www/img\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Replace ",(0,r.kt)("strong",{parentName:"p"},"<IP_NEW_CENTREON>")," with the IP of the new Centreon server.")),(0,r.kt)("h3",{id:"retrieve-databases"},"Retrieve databases"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Dump source databases:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"mysqldump -u root -p centreon > /tmp/centreon.sql\nmysqldump -u root -p centreon_storage > /tmp/centreon_storage.sql\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Stop source MariaDB servers:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"}," service mysqld stop\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Export the dumps to the new Centreon 23.04 database server (make sure you\nhave enough space for large databases dumps):"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"rsync -avz /tmp/centreon.sql root@<IP_NEW_CENTREON>:/tmp/\nrsync -avz /tmp/centreon_storage.sql root@<IP_NEW_CENTREON>:/tmp/\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"On the Centreon 23.04 database server, drop the original databases and\ncreate them again:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"mysql -u root -p\n")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-SQL"},"DROP DATABASE centreon;\nDROP DATABASE centreon_storage;\nCREATE DATABASE centreon;\nCREATE DATABASE centreon_storage;\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Import the previously transfered dumps:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"mysql -u root centreon -p </tmp/centreon.sql\nmysql -u root centreon_storage -p </tmp/centreon_storage.sql\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Upgrade the tables:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"mysql_upgrade\n")),(0,r.kt)("p",{parentName:"li"},"If your database is password-protected, enter:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"mysql_upgrade -u <database_admin_user> -p\n")),(0,r.kt)("p",{parentName:"li"},"Example: if your database_admin_user is ",(0,r.kt)("inlineCode",{parentName:"p"},"root"),", enter:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"mysql_upgrade -u root -p\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Start the MariaDB process on the new server:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl start mariadb\n")))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Replace ",(0,r.kt)("strong",{parentName:"p"},"<IP_NEW_CENTREON>")," with the IP of the new Centreon server.")),(0,r.kt)("h3",{id:"synchronize-the-plugins"},"Synchronize the plugins"),(0,r.kt)("p",null,"Synchronizing the monitoring plugins is more complex and depends on your\ninstallation. The main directories to synchronize are:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"/usr/lib/nagios/plugins/"),(0,r.kt)("li",{parentName:"ol"},"/usr/lib/centreon/plugins/")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"To run the plugins, you must first install the required dependencies.")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"If you still have remote Centreon Engine 1.8.1 Pollers whose\nupgrade to 23.04 you want to postpone, be aware that Centreon Web 23.04 resource\n$USER1$ now points to /usr/lib64/nagios/plugins"),(0,r.kt)("p",{parentName:"blockquote"},"This is how to mitigate the issue on the 1.8.1 Pollers:"),(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"mv /usr/lib64/nagios/plugins/* /usr/lib/nagios/plugins/\nrmdir /usr/lib64/nagios/plugins/\nln -s -t /usr/lib64/nagios/ /usr/lib/nagios/plugins/\n")),(0,r.kt)("p",{parentName:"blockquote"},"You now have a symbolic link like this:"),(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"$ ls -alt /usr/lib64/nagios/\nlrwxrwxrwx   1 root root      24  1 nov.  17:59 plugins -> /usr/lib/nagios/plugins/\n-rwxr-xr-x   1 root root 1711288  6 avril  2018 cbmod.so\n"))),(0,r.kt)("p",null,"You can now push poller configuration from Centreon 23.04 whether the remote\nPoller is Centreon Engine 23.04 or 1.8.1."),(0,r.kt)("h3",{id:"upgrade-centreon"},"Upgrade Centreon"),(0,r.kt)("p",null,"On the new server, force the update by moving the contents of the\n",(0,r.kt)("strong",{parentName:"p"},"/var/lib/centreon/installs/install-23.04.0-YYYYMMDD","_","HHMMSS")," directory to\nthe ",(0,r.kt)("strong",{parentName:"p"},"/usr/share/centreon/www/install")," directory:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"cd /var/lib/centreon/installs/\nmv install-23.04.0-YYYYMMDD_HHMMSS/ /usr/share/centreon/www/install/\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"If you use the same IP address or same DNS name for the old Centreon webserver\nand the new one, do a full cache cleanup of your browser to avoid JS issues")),(0,r.kt)("p",null,"Go to ",(0,r.kt)("inlineCode",{parentName:"p"},"http://<IP_NEW_CENTREON>/centreon")," URL and perform the upgrade."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"If you changed the ",(0,r.kt)("em",{parentName:"p"},"centreon")," password during the installation process, you must\nfollow these steps:"),(0,r.kt)("ol",{parentName:"blockquote"},(0,r.kt)("li",{parentName:"ol"},"Edit the /etc/centreon/centreon.conf.php file,"),(0,r.kt)("li",{parentName:"ol"},"Edit the /etc/centreon/conf.pm file,"),(0,r.kt)("li",{parentName:"ol"},"Edit the Centreon Broker central configuration using Centreon web interface\nand change the password for the ",(0,r.kt)("strong",{parentName:"li"},"Perfdata generator")," and ",(0,r.kt)("strong",{parentName:"li"},"Broker SQL\ndatabase")," output,"),(0,r.kt)("li",{parentName:"ol"},"Edit the file /etc/centreon/config.d/10-database.yaml."))),(0,r.kt)("p",null,"If the IP of your Centreon server has changed, edit the configuration for all\nthe Centreon Broker modules of your Pollers and change the IP to connect to\nthe Centreon Central server (output IPv4). See the ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2551/docs/monitoring/monitoring-servers/advanced-configuration#tcp-outputs"},"Advanced\nconfiguration"),"\nchapter for more information."),(0,r.kt)("p",null,"Then ",(0,r.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2551/docs/monitoring/monitoring-servers/deploying-a-configuration"},"generate")," the\nconfiguration of all your pollers and export it."),(0,r.kt)("h3",{id:"upgrade-the-modules"},"Upgrade the modules"),(0,r.kt)("p",null,"Please refer to the documentation of each module to verify compatibility with\nCentreon 23.04 and perform the upgrade."))}f.isMDXComponent=!0}}]);