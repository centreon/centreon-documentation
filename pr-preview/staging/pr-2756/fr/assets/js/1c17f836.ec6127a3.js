"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[2890],{32423:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>p,default:()=>N,frontMatter:()=>s,metadata:()=>m,toc:()=>d});a(67294);var n=a(3905),r=a(51715),l=a(7626);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})),e}function u(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}const s={id:"cloud-azure-compute-aks",title:"Azure Kubernetes Service"},p=void 0,m={unversionedId:"integrations/plugin-packs/procedures/cloud-azure-compute-aks",id:"integrations/plugin-packs/procedures/cloud-azure-compute-aks",title:"Azure Kubernetes Service",description:"Vue d'ensemble",source:"@site/i18n/fr/docusaurus-plugin-content-docs-pp/current/integrations/plugin-packs/procedures/cloud-azure-compute-aks.md",sourceDirName:"integrations/plugin-packs/procedures",slug:"/integrations/plugin-packs/procedures/cloud-azure-compute-aks",permalink:"/centreon-documentation/pr-preview/staging/pr-2756/fr/pp/integrations/plugin-packs/procedures/cloud-azure-compute-aks",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/i18n/fr/docusaurus-plugin-content-docs-pp/current/integrations/plugin-packs/procedures/cloud-azure-compute-aks.md",tags:[],version:"current",frontMatter:{id:"cloud-azure-compute-aks",title:"Azure Kubernetes Service"},sidebar:"pp",previous:{title:"Azure Key Vault",permalink:"/centreon-documentation/pr-preview/staging/pr-2756/fr/pp/integrations/plugin-packs/procedures/cloud-azure-security-keyvault"},next:{title:"Azure Load Balancer",permalink:"/centreon-documentation/pr-preview/staging/pr-2756/fr/pp/integrations/plugin-packs/procedures/cloud-azure-network-loadbalancer"}},c={},d=[{value:"Vue d&#39;ensemble",id:"vue-densemble",level:2},{value:"Contenu du Pack",id:"contenu-du-pack",level:2},{value:"Mod\xe8les",id:"mod\xe8les",level:3},{value:"R\xe8gles de d\xe9couverte",id:"r\xe8gles-de-d\xe9couverte",level:3},{value:"M\xe9triques &amp; statuts collect\xe9s",id:"m\xe9triques--statuts-collect\xe9s",level:3},{value:"Pr\xe9requis",id:"pr\xe9requis",level:2},{value:"Installation",id:"installation",level:2},{value:"Configuration",id:"configuration",level:2},{value:"H\xf4te",id:"h\xf4te",level:3},{value:"Comment puis-je tester le Plugin et que signifient les options des commandes ?",id:"comment-puis-je-tester-le-plugin-et-que-signifient-les-options-des-commandes-",level:2},{value:"Diagnostic des erreurs communes",id:"diagnostic-des-erreurs-communes",level:3}],k={toc:d},g="wrapper";function N(e){var{components:t}=e,s=u(e,["components"]);return(0,n.kt)(g,o(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){i(e,t,a[t])}))}return e}({},k,s),{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h2",{id:"vue-densemble"},"Vue d'ensemble"),(0,n.kt)("p",null,"Azure Kubernetes Service (AKS) simplifie le d\xe9ploiement d\u2019un cluster Kubernetes manag\xe9 en d\xe9l\xe9guant la charge op\xe9rationnelle \xe0 Azure. En tant que service Kubernetes h\xe9berg\xe9, Azure g\xe8re des t\xe2ches critiques telles que l\u2019analyse de l\u2019int\xe9grit\xe9 et la maintenance."),(0,n.kt)("p",null,"Le connecteur de supervision Centreon ",(0,n.kt)("em",{parentName:"p"},"Azure Kubernetes Service")," peut s'appuyer sur l'API d'Azure ou bien Azure CLI pour collecter les m\xe9triques relatives \xe0 AKS."),(0,n.kt)("h2",{id:"contenu-du-pack"},"Contenu du Pack"),(0,n.kt)("h3",{id:"mod\xe8les"},"Mod\xe8les"),(0,n.kt)("p",null,"Le connecteur de supervision Centreon Azure Kubernetes Service apporte un mod\xe8le d'h\xf4te :"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Cloud-Azure-Compute-Aks-custom")),(0,n.kt)("p",null,"Il apporte les Mod\xe8les de Service suivants :"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"Alias"),(0,n.kt)("th",{parentName:"tr",align:"left"},"Service Template"),(0,n.kt)("th",{parentName:"tr",align:"left"},"D\xe9faut"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Allocatable-resources"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Cloud-Azure-Compute-Aks-Allocatable-Resources-Api"),(0,n.kt)("td",{parentName:"tr",align:"left"},"X")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Cpu-Usage"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Cloud-Azure-Compute-Aks-Cpu-Usage-Api"),(0,n.kt)("td",{parentName:"tr",align:"left"},"X")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Health"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Cloud-Azure-Compute-Aks-Health-Api"),(0,n.kt)("td",{parentName:"tr",align:"left"},"X")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Storage"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Cloud-Azure-Compute-Aks-Storage-Api"),(0,n.kt)("td",{parentName:"tr",align:"left"},"X")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Traffic"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Cloud-Azure-Compute-Aks-Traffic-Api"),(0,n.kt)("td",{parentName:"tr",align:"left"},"X")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Unneeded-nodes"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Cloud-Azure-Compute-Aks-Unneeded-Nodes-Api"),(0,n.kt)("td",{parentName:"tr",align:"left"},"X")))),(0,n.kt)("h3",{id:"r\xe8gles-de-d\xe9couverte"},"R\xe8gles de d\xe9couverte"),(0,n.kt)("p",null,"Le connecteur de supervision Centreon ",(0,n.kt)("strong",{parentName:"p"},"Azure Kubernetes Service")," inclut un fournisseur de d\xe9couverte d'H\xf4tes nomm\xe9 ",(0,n.kt)("strong",{parentName:"p"},"Microsoft Azure Kubernetes Services"),". Celui-ci permet de d\xe9couvrir l'ensemble des instances rattach\xe9es \xe0 une ",(0,n.kt)("em",{parentName:"p"},"souscription")," Microsoft Azure donn\xe9e et les ajouter \xe0 la supervision :"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"image",src:a(38461).Z,width:"404",height:"124"})),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"La d\xe9couverte ",(0,n.kt)("strong",{parentName:"p"},"Azure Kubernetes Service")," n'est compatible qu'avec le mode 'api'. Le mode 'azcli' n'est pas support\xe9 dans le cadre de cette utilisation.")),(0,n.kt)("p",null,"Vous trouverez plus d'informations sur la d\xe9couverte d'H\xf4tes et son fonctionnement sur la documentation du module : ",(0,n.kt)("a",{parentName:"p",href:"/docs/monitoring/discovery/hosts-discovery"},"D\xe9couverte des h\xf4tes")),(0,n.kt)("h3",{id:"m\xe9triques--statuts-collect\xe9s"},"M\xe9triques & statuts collect\xe9s"),(0,n.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,n.kt)(l.Z,{value:"Allocatable-resources",label:"Allocatable-resources",mdxType:"TabItem"},(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"Nom"),(0,n.kt)("th",{parentName:"tr",align:"left"},"Unit\xe9"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("em",{parentName:"td"},"instance"),"#aks.node.allocatable.cpu.cores"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Count")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("em",{parentName:"td"},"instance"),"#aks.node.allocatable.memory.bytes"),(0,n.kt)("td",{parentName:"tr",align:"left"},"B"))))),(0,n.kt)(l.Z,{value:"Cpu-Usage",label:"Cpu-Usage",mdxType:"TabItem"},(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"Nom"),(0,n.kt)("th",{parentName:"tr",align:"left"},"Unit\xe9"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("em",{parentName:"td"},"instance"),"#aks.node.cpu.utilization.percentage"),(0,n.kt)("td",{parentName:"tr",align:"left"},"%"))))),(0,n.kt)(l.Z,{value:"Health",label:"Health",mdxType:"TabItem"},(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"Nom"),(0,n.kt)("th",{parentName:"tr",align:"left"},"Unit\xe9"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},"Statut"),(0,n.kt)("td",{parentName:"tr",align:"left"},"String"))))),(0,n.kt)(l.Z,{value:"Storage",label:"Storage",mdxType:"TabItem"},(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"Nom"),(0,n.kt)("th",{parentName:"tr",align:"left"},"Unit\xe9"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("em",{parentName:"td"},"instance"),"#aks.node.disk.usage.percentage"),(0,n.kt)("td",{parentName:"tr",align:"left"},"%")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("em",{parentName:"td"},"instance"),"#aks.node.disk.usage.bytes"),(0,n.kt)("td",{parentName:"tr",align:"left"},"B"))))),(0,n.kt)(l.Z,{value:"Traffic",label:"Traffic",mdxType:"TabItem"},(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"Nom"),(0,n.kt)("th",{parentName:"tr",align:"left"},"Unit\xe9"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("em",{parentName:"td"},"instance"),"#aks.node.traffic.in.bytes"),(0,n.kt)("td",{parentName:"tr",align:"left"},"B")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("em",{parentName:"td"},"instance"),"#aks.node.traffic.out.bytes"),(0,n.kt)("td",{parentName:"tr",align:"left"},"B"))))),(0,n.kt)(l.Z,{value:"Unneeded-nodes",label:"Unneeded-nodes",mdxType:"TabItem"},(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:"left"},"Nom"),(0,n.kt)("th",{parentName:"tr",align:"left"},"Unit\xe9"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:"left"},(0,n.kt)("em",{parentName:"td"},"instance"),"#aks.cluster.autoscaler.unneeded.nodes"),(0,n.kt)("td",{parentName:"tr",align:"left"},"Count")))))),(0,n.kt)("h2",{id:"pr\xe9requis"},"Pr\xe9requis"),(0,n.kt)("p",null,"Deux moyens sont disponibles pour interroger les API de Microsoft Azure :\t"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Azure API ('api')"),(0,n.kt)("li",{parentName:"ul"},"Azure CLI ('azcli')")),(0,n.kt)("p",null,"Centreon pr\xe9conise l'utilisation de la m\xe9thode ",(0,n.kt)("em",{parentName:"p"},"API")," plut\xf4t que la ",(0,n.kt)("em",{parentName:"p"},"CLI"),", cette derni\xe8re \xe9tant significativement moins performante. L'API permet \xe9galement une authentification ",(0,n.kt)("em",{parentName:"p"},"Application")," et ne n\xe9cessite pas de compte de service d\xe9di\xe9."),(0,n.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,n.kt)(l.Z,{value:"Azure Monitor API",label:"Azure Monitor API",mdxType:"TabItem"},(0,n.kt)("p",null,"Pour le custom-mode 'api', r\xe9cup\xe9rez les informations en suivant la proc\xe9dure ci-dessous (en anglais) et notez celles-ci en lieu s\xfbr. Elles seront en effet indispensables lors de la configuration des ressources dans Centreon."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Create an ",(0,n.kt)("em",{parentName:"p"},"application")," in Azure Active Directory:"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Log in to your Azure account."),(0,n.kt)("li",{parentName:"ul"},"Select ",(0,n.kt)("em",{parentName:"li"},"Azure Active directory")," in the left sidebar."),(0,n.kt)("li",{parentName:"ul"},"Click on ",(0,n.kt)("em",{parentName:"li"},"App registrations"),"."),(0,n.kt)("li",{parentName:"ul"},"Click on ",(0,n.kt)("em",{parentName:"li"},"+ Add"),"."),(0,n.kt)("li",{parentName:"ul"},"Enter Centreon as the application name (or any name of your choice), select application type (api) and sign-on-url."),(0,n.kt)("li",{parentName:"ul"},"Click on the ",(0,n.kt)("em",{parentName:"li"},"Create")," button."))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Get ",(0,n.kt)("em",{parentName:"p"},"Subscription ID")),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Log in to your Azure account."),(0,n.kt)("li",{parentName:"ul"},"Select ",(0,n.kt)("em",{parentName:"li"},"Subscriptions")," in the left sidebar."),(0,n.kt)("li",{parentName:"ul"},"Select whichever subscription is needed."),(0,n.kt)("li",{parentName:"ul"},"Click on ",(0,n.kt)("em",{parentName:"li"},"Overview"),"."),(0,n.kt)("li",{parentName:"ul"},"Copy the Subscription ID."))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Get ",(0,n.kt)("em",{parentName:"p"},"Tenant ID")),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Log in to your Azure account."),(0,n.kt)("li",{parentName:"ul"},"Select ",(0,n.kt)("em",{parentName:"li"},"Azure Active directory")," in the left sidebar."),(0,n.kt)("li",{parentName:"ul"},"Click on ",(0,n.kt)("em",{parentName:"li"},"Properties"),"."),(0,n.kt)("li",{parentName:"ul"},"Copy the directory ID."))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Get ",(0,n.kt)("em",{parentName:"p"},"Client ID")),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Log in to your Azure account."),(0,n.kt)("li",{parentName:"ul"},"Select ",(0,n.kt)("em",{parentName:"li"},"Azure Active directory")," in the left sidebar."),(0,n.kt)("li",{parentName:"ul"},"Click on ",(0,n.kt)("em",{parentName:"li"},"Enterprise applications"),"."),(0,n.kt)("li",{parentName:"ul"},"Click on ",(0,n.kt)("em",{parentName:"li"},"All applications"),"."),(0,n.kt)("li",{parentName:"ul"},"Select the application previously created."),(0,n.kt)("li",{parentName:"ul"},"Click on ",(0,n.kt)("em",{parentName:"li"},"Properties"),"."),(0,n.kt)("li",{parentName:"ul"},"Copy the Application ID."))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Get ",(0,n.kt)("em",{parentName:"p"},"Client secret")),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Log in to your Azure account."),(0,n.kt)("li",{parentName:"ul"},"Select ",(0,n.kt)("em",{parentName:"li"},"Azure Active directory")," in the left sidebar."),(0,n.kt)("li",{parentName:"ul"},"Click on ",(0,n.kt)("em",{parentName:"li"},"App registrations"),"."),(0,n.kt)("li",{parentName:"ul"},"Select the application previously created."),(0,n.kt)("li",{parentName:"ul"},"Click on ",(0,n.kt)("em",{parentName:"li"},"All settings"),"."),(0,n.kt)("li",{parentName:"ul"},"Click on ",(0,n.kt)("em",{parentName:"li"},"Keys"),"."),(0,n.kt)("li",{parentName:"ul"},"Enter the key description and select the duration."),(0,n.kt)("li",{parentName:"ul"},"Click on ",(0,n.kt)("em",{parentName:"li"},"Save"),"."),(0,n.kt)("li",{parentName:"ul"},"Copy and store the key value. ",(0,n.kt)("strong",{parentName:"li"},"You won't be able to retrieve it after you leave this page"),".")))),(0,n.kt)("p",null,"Please make sure to assign the ",(0,n.kt)("strong",{parentName:"p"},"Monitoring Reader")," role to the application.")),(0,n.kt)(l.Z,{value:"Azure AZ CLI",label:"Azure AZ CLI",mdxType:"TabItem"},(0,n.kt)("p",null,"Afin d'utiliser le custom-mode 'azcli', installez le binaire associ\xe9 sur tous les Collecteurs Centreon devant superviser des ressources Azure:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"La CLI requiert une version de Python >= 2.7\n(",(0,n.kt)("a",{parentName:"li",href:"https://github.com/Azure/azure-cli/blob/dev/doc/install_linux_prerequisites.md"},"https://github.com/Azure/azure-cli/blob/dev/doc/install_linux_prerequisites.md"),")")),(0,n.kt)("p",null,"Sur un syst\xe8me utilisant le packaging RPM, utilisez les commandes ci-dessous avec l'utilisateur ",(0,n.kt)("strong",{parentName:"p"},"root")," ou un utilisateur avec les droits ",(0,n.kt)("strong",{parentName:"p"},"sudo")," ad\xe9quats:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},'sudo rpm --import https://packages.microsoft.com/keys/microsoft.asc\nsudo echo -e "[azure-cli]\\nname=Azure CLI\\nbaseurl=https://packages.microsoft.com/yumrepos/azure-cli\\nenabled=1\\ngpgcheck=1\\ngpgkey=https://packages.microsoft.com/keys/microsoft.asc" > /etc/yum.repos.d/azure-cli.repo\nsudo yum install azure-cli-2.29.2-1.el7\n')),(0,n.kt)("p",null,"Ensuite, r\xe9alisez les op\xe9rations suivantes avec l'utilisateur ",(0,n.kt)("strong",{parentName:"p"},"centreon-engine")," afin de r\xe9cup\xe9rer le token d'authentification Azure:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"su - centreon-engine\naz login\n")),(0,n.kt)("p",null,"La commande retourne le message ci-dessous contenant un code d'authentification :"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"*To sign in, use a web browser to open the page https://microsoft.com/devicelogin*\n*and enter the code CWT4WQZAD to authenticate.*\n")),(0,n.kt)("p",null,"Rendez-vous sur ",(0,n.kt)("a",{parentName:"p",href:"https://microsoft.com/devicelogin"},"https://microsoft.com/devicelogin")," afin de saisir le code obtenu, puis connectez-vous avec le compte de service d\xe9di\xe9 \xe0 la supervision."),(0,n.kt)("p",null,"Une fois ces actions effectu\xe9es, des informations d'auhtentification de la forme suivante devraient s'afficher dans le terminal du collecteur Centreon: "),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},'    [\n      {\n        "cloudName": "AzureCloud",\n        "id": "0ef83f3a-d83e-2039-d930-309df93acd93d",\n        "isDefault": true,\n        "name": "N/A(tenant level account)",\n        "state": "Enabled",\n        "tenantId": "0ef83f3a-03cd-2039-d930-90fd39ecd048",\n        "user": {\n          "name": "email@mycompany.onmicrosoft.com",\n          "type": "user"\n        }\n      }\n    ]\n')),(0,n.kt)("p",null,"Vous avez d\xe9sormais les informations stock\xe9es localement dans un fichier ",(0,n.kt)("strong",{parentName:"p"},"accessTokens.json")," qui sera utilis\xe9 automatiquement par le Plugin."))),(0,n.kt)("h2",{id:"installation"},"Installation"),(0,n.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,n.kt)(l.Z,{value:"Online License",label:"Online License",mdxType:"TabItem"},(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Installer le Plugin Centreon sur tous les collecteurs Centreon devant superviser des ressources ",(0,n.kt)("strong",{parentName:"li"},"Azure Kubernetes Service"),":")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"yum install centreon-plugin-Cloud-Azure-Compute-Aks-Api\n")),(0,n.kt)("ol",{start:2},(0,n.kt)("li",{parentName:"ol"},"Sur l'interface Web de Centreon, installer le connecteur de supervision ",(0,n.kt)("strong",{parentName:"li"},"Azure Kubernetes Service")," depuis la page ",(0,n.kt)("strong",{parentName:"li"},"Configuration > Packs de plugins"),"."))),(0,n.kt)(l.Z,{value:"Offline License",label:"Offline License",mdxType:"TabItem"},(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Installer le Plugin Centreon sur tous les collecteurs Centreon devant superviser des ressources ",(0,n.kt)("strong",{parentName:"li"},"Azure Kubernetes Service"),":")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"yum install centreon-plugin-Cloud-Azure-Compute-Aks-Api\n")),(0,n.kt)("ol",{start:2},(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Sur le serveur Central Centreon, installer le RPM du Pack ",(0,n.kt)("strong",{parentName:"p"},"Azure Kubernetes Service"),":"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"yum install centreon-pack-cloud-azure-compute-aks\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Sur l'interface Web de Centreon, installer le connecteur de supervision ",(0,n.kt)("strong",{parentName:"p"},"Azure Kubernetes Service")," depuis la page ",(0,n.kt)("strong",{parentName:"p"},"Configuration > Packs de plugins"),"."))))),(0,n.kt)("h2",{id:"configuration"},"Configuration"),(0,n.kt)("h3",{id:"h\xf4te"},"H\xf4te"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Ajoutez un H\xf4te \xe0 Centreon, remplissez le champ ",(0,n.kt)("strong",{parentName:"li"},"Adresse IP/DNS")," avec l'adresse 127.0.0.1. et appliquez-lui le Mod\xe8le d'H\xf4te ",(0,n.kt)("strong",{parentName:"li"},"Cloud-Azure-Compute-Aks-custom"),"."),(0,n.kt)("li",{parentName:"ul"},"Une fois le mod\xe8le appliqu\xe9, les Macros ci-dessous indiqu\xe9es comme requises (",(0,n.kt)("em",{parentName:"li"},"Mandatory"),") doivent \xeatre renseign\xe9es selon le ",(0,n.kt)("em",{parentName:"li"},"custom mode")," utilis\xe9.")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"Deux m\xe9thodes peuvent \xeatre utilis\xe9es lors de l'assignation des Macros :"),(0,n.kt)("ul",{parentName:"blockquote"},(0,n.kt)("li",{parentName:"ul"},"Utilisation de l'ID complet de la ressource (",(0,n.kt)("inlineCode",{parentName:"li"},"/subscriptions/<subscription_id>/resourceGroups/<resourcegroup_id>/providers/Microsoft.ContainerService/ManagedClusters/<resource_name>"),")\nin ",(0,n.kt)("em",{parentName:"li"},"AZURERESOURCE")),(0,n.kt)("li",{parentName:"ul"},"Utilisation du nom de la ressource dans la Macro ",(0,n.kt)("em",{parentName:"li"},"AZURERESOURCE")," associ\xe9e \xe0 la Macro ",(0,n.kt)("em",{parentName:"li"},"AZURERESOURCEGROUP"),"."))),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Mandatory"),(0,n.kt)("th",{parentName:"tr",align:null},"Nom"),(0,n.kt)("th",{parentName:"tr",align:null},"Description"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"X"),(0,n.kt)("td",{parentName:"tr",align:null},"AZURECUSTOMMODE"),(0,n.kt)("td",{parentName:"tr",align:null},"Custom mode 'api'")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"X"),(0,n.kt)("td",{parentName:"tr",align:null},"AZURESUBSCRIPTION"),(0,n.kt)("td",{parentName:"tr",align:null},"Subscription ID")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"X"),(0,n.kt)("td",{parentName:"tr",align:null},"AZURETENANT"),(0,n.kt)("td",{parentName:"tr",align:null},"Tenant ID")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"X"),(0,n.kt)("td",{parentName:"tr",align:null},"AZURECLIENTID"),(0,n.kt)("td",{parentName:"tr",align:null},"Client ID")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"X"),(0,n.kt)("td",{parentName:"tr",align:null},"AZURECLIENTSECRET"),(0,n.kt)("td",{parentName:"tr",align:null},"Client secret")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"X"),(0,n.kt)("td",{parentName:"tr",align:null},"AZURERESOURCE"),(0,n.kt)("td",{parentName:"tr",align:null},"ID or AKS cluster name")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null}),(0,n.kt)("td",{parentName:"tr",align:null},"AZURERESOURCEGROUP"),(0,n.kt)("td",{parentName:"tr",align:null},"Associated Resource Group if resource name is used")))),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Mandatory"),(0,n.kt)("th",{parentName:"tr",align:null},"Nom"),(0,n.kt)("th",{parentName:"tr",align:null},"Description"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"X"),(0,n.kt)("td",{parentName:"tr",align:null},"AZURECUSTOMMODE"),(0,n.kt)("td",{parentName:"tr",align:null},"Custom mode 'azcli'")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"X"),(0,n.kt)("td",{parentName:"tr",align:null},"AZURESUBSCRIPTION"),(0,n.kt)("td",{parentName:"tr",align:null},"Subscription ID")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"X"),(0,n.kt)("td",{parentName:"tr",align:null},"AZURERESOURCE"),(0,n.kt)("td",{parentName:"tr",align:null},"ID or AKS cluster name")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null}),(0,n.kt)("td",{parentName:"tr",align:null},"AZURERESOURCEGROUP"),(0,n.kt)("td",{parentName:"tr",align:null},"Associated Resource Group if resource name is used")))),(0,n.kt)("h2",{id:"comment-puis-je-tester-le-plugin-et-que-signifient-les-options-des-commandes-"},"Comment puis-je tester le Plugin et que signifient les options des commandes ?"),(0,n.kt)("p",null,"Une fois le Plugin install\xe9, vous pouvez tester celui-ci directement en ligne de commande depuis votre collecteur Centreon en vous connectant avec l'utilisateur ",(0,n.kt)("strong",{parentName:"p"},"centreon-engine")," :"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/lib/centreon/plugins//centreon_azure_compute_aks_api.pl \\\n    --plugin=cloud::azure::compute::aks::plugin \\\n    --mode=storage \\\n    --custommode='api' \\\n    --resource='' \\\n    --resource-group='' \\\n    --subscription='' \\\n    --tenant='' \\\n    --client-id='' \\\n    --client-secret='' \\\n    --proxyurl='' \\\n    --filter-metric='' \\\n    --timeframe='900' \\\n    --interval='PT5M' \\\n    --warning-storage-used='' \\\n    --critical-storage-used='' \\\n    --warning-storage-percent='90' \\\n    --critical-storage-percent='95' \\\n    --use-new-perfdata \n")),(0,n.kt)("p",null,"La commande devrait retourner un message de sortie similaire \xe0 :"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"OK:Instance 'CLUSTER90' Statistic 'average' Metrics Storage Percent: 38.54%, Storage Used: 11.17GB | 'CLUSTER90~average#aks.node.disk.usage.percentage'=38.54%;0:90;0:95;0; 'CLUSTER90~average#aks.node.disk.usage.bytes'=11989825262.93B;;;0;\n")),(0,n.kt)("p",null,"Dans cet exemple, une alarme de type WARNING sera d\xe9clench\xe9e si l'espace utilis\xe9 sur le disque est sup\xe9rieur \xe0 90%  (",(0,n.kt)("inlineCode",{parentName:"p"},"--warning-storage-percent='90'"),") et l'alarme sera de type CRITICAL si ce pourcentage est sup\xe9rieur \xe0 95% (",(0,n.kt)("inlineCode",{parentName:"p"},"--critical-storage-percent='95'"),")."),(0,n.kt)("p",null,"La liste de toutes les options compl\xe9mentaires et leur signification peut \xeatre affich\xe9e en ajoutant le param\xe8tre ",(0,n.kt)("inlineCode",{parentName:"p"},"--help")," \xe0 la commande :"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/lib/centreon/plugins//centreon_azure_compute_aks_api.pl \\\n    --plugin=cloud::azure::compute::aks::plugin \\\n    --mode=storage \\\n    --help\n")),(0,n.kt)("p",null,"Tous les modes disponibles peuvent \xeatre affich\xe9s en ajoutant le param\xe8tre",(0,n.kt)("inlineCode",{parentName:"p"},"--list-mode")," \xe0 la commande :"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/lib/centreon/plugins//centreon_azure_compute_aks_api.pl \\\n    --plugin=cloud::azure::compute::aks::plugin \\\n    --list-mode\n")),(0,n.kt)("h3",{id:"diagnostic-des-erreurs-communes"},"Diagnostic des erreurs communes"),(0,n.kt)("p",null,"Rendez-vous sur la ",(0,n.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2756/fr/pp/integrations/plugin-packs/getting-started/how-to-guides/troubleshooting-plugins#http-and-api-checks"},"documentation d\xe9di\xe9e")," des Plugins bas\xe9s sur HTTP/API."))}N.isMDXComponent=!0},38461:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/cloud-azure-compute-aks-provider-b02f0f0692dc67466b0c71d1c8a9bc07.png"}}]);