<!doctype html>
<html lang="fr" dir="ltr" class="docs-wrapper docs-doc-page docs-version-23.10 plugin-docs plugin-id-default docs-doc-id-installation/installation-of-centreon-ha-manual/centreon-ha-2-nodes-installation-manual-failover" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Installation de Centreon-HA 2 n≈ìuds √† basculement manuel | Centreon Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.centreon.com/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/installation/installation-of-centreon-ha-manual/centreon-ha-2-nodes-installation-manual-failover/"><meta data-rh="true" name="docusaurus_locale" content="fr"><meta data-rh="true" name="docsearch:language" content="fr"><meta data-rh="true" name="docusaurus_version" content="23.10"><meta data-rh="true" name="docusaurus_tag" content="docs-default-23.10"><meta data-rh="true" name="docsearch:version" content="23.10"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-23.10"><meta data-rh="true" property="og:title" content="Installation de Centreon-HA 2 n≈ìuds √† basculement manuel | Centreon Documentation"><meta data-rh="true" name="description" content="Conditions pr√©alables"><meta data-rh="true" property="og:description" content="Conditions pr√©alables"><link data-rh="true" rel="icon" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.centreon.com/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/installation/installation-of-centreon-ha-manual/centreon-ha-2-nodes-installation-manual-failover/"><link data-rh="true" rel="alternate" href="https://docs.centreon.com/centreon-documentation/pr-preview/staging/pr-2756/docs/installation/installation-of-centreon-ha-manual/centreon-ha-2-nodes-installation-manual-failover/" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.centreon.com/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/installation/installation-of-centreon-ha-manual/centreon-ha-2-nodes-installation-manual-failover/" hreflang="fr"><link data-rh="true" rel="alternate" href="https://docs.centreon.com/centreon-documentation/pr-preview/staging/pr-2756/docs/installation/installation-of-centreon-ha-manual/centreon-ha-2-nodes-installation-manual-failover/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://3WEC6XPLDB-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-8418698-13","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BGL69N5GPJ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-BGL69N5GPJ",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Centreon Documentation" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/opensearch.xml"><link rel="stylesheet" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/assets/css/styles.5b1707c7.css">
<link rel="preload" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/assets/js/runtime~main.12139a5c.js" as="script">
<link rel="preload" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/assets/js/main.42ea2a6f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(e){}return e}()||function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Aller au contenu principal"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Aller au contenu principal</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Ouvrir/fermer la barre de navigation" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/"><div class="navbar__logo"><img src="/centreon-documentation/pr-preview/staging/pr-2756/fr/img/logo_centreon_dark.png" alt="Logo Centreon Docs" class="themedImage_ToTc themedImage--light_HNdA"><img src="/centreon-documentation/pr-preview/staging/pr-2756/fr/img/logo_centreon.png" alt="Logo Centreon Docs" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/getting-started/welcome/">Centreon OnPrem</a><a class="navbar__item navbar__link" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/pp/integrations/plugin-packs/getting-started/introduction/">Connecteurs de supervision</a></div><div class="navbar__items navbar__items--right"><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Chercher"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Chercher</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/getting-started/welcome/">‚≠ê 23.10</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/installation/installation-of-centreon-ha-manual/centreon-ha-2-nodes-installation-manual-failover/">‚≠ê 23.10</a></li><li><hr class="dropdown-separator"></li><li class="dropdown-archived-versions"><b>Versions archiv√©es</b></li><li><a href="https://archives-docs.centreon.com/21.04/" target="_blank" rel="noopener noreferrer" class="dropdown__link">21.04<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://archives-docs.centreon.com/20.10/" target="_blank" rel="noopener noreferrer" class="dropdown__link">20.10<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://archives-docs.centreon.com/20.04/" target="_blank" rel="noopener noreferrer" class="dropdown__link">20.04<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://docs-older.centreon.com" target="_blank" rel="noopener noreferrer" class="dropdown__link">Older<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>üá´üá∑ Fran√ßais</a><ul class="dropdown__menu"><li><a href="/centreon-documentation/pr-preview/staging/pr-2756/docs/installation/installation-of-centreon-ha-manual/centreon-ha-2-nodes-installation-manual-failover/" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">üá¨üáß English</a></li><li><a href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/installation/installation-of-centreon-ha-manual/centreon-ha-2-nodes-installation-manual-failover/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="fr">üá´üá∑ Fran√ßais</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-label="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Revenez en haut" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/getting-started/welcome/">Getting Started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/installation/introduction/">Installation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/administration/secure-platform/">S√©curiser la plateforme</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/monitoring/about/">Superviser des ressources</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/alerts-notifications/concepts/">G√©rer √©v√®nements et alertes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/monitoring/basic-objects/contacts/">G√©rer les utilisateurs de Centreon</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/metrology/chart-management/">Graphiques de performance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/service-mapping/introduction/">Service Mapping</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/category/graphical-views/">Vues graphiques</a><button aria-label="Toggle the collapsible sidebar category &#x27;Vues graphiques&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/reporting/introduction/">Reporting</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/administration/parameters/centreon-ui/">Administrer</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/update/update-centreon-platform/">Mettre √† jour, monter de version et migrer</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/pp/integrations/plugin-packs/getting-started/introduction/">Connecteurs de supervision</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/integrations/introduction-integrations/">Int√©grations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/mobile/introduction/">Centreon mobile</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/category/developer-resources/">Ressources d√©veloppeur</a><button aria-label="Toggle the collapsible sidebar category &#x27;Ressources d√©veloppeur&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/installation/installation-of-centreon-ha/overview/">Centreon HA</a><button aria-label="Toggle the collapsible sidebar category &#x27;Centreon HA&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/installation/installation-of-centreon-ha/installation-2-nodes/">Installer Centreon HA</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/installation/installation-of-centreon-ha-manual/centreon-ha-2-nodes-installation-manual-failover/">Installer un Centreon HA √† basculement manuel</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/installation/installation-of-centreon-ha-manual/centreon-ha-2-nodes-installation-manual-failover/">Installation de Centreon-HA 2 n≈ìuds √† basculement manuel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/installation/installation-of-centreon-ha-manual/centreon-ha-4-nodes-installation-manual-failover/">Installation de Centreon-HA 4 n≈ìuds √† basculement manuel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/installation/installation-of-centreon-ha-manual/integrating-pollers/">Int√©grer des Pollers dans un cluster Centreon-HA manuel</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/administration/centreon-ha/acceptance-guide/">Faire fonctionner Centreon HA</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/update/update-centreon-ha/">Mettre √† jour Centreon HA</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/upgrade/centreon-ha/upgrade-centreon-ha-from-21-04/">Monter de version Centreon HA</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/health/centreon-agent/">Superviser la plateforme</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/releases/introduction/">Releases</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/security/">S√©curit√©</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/resources/known-issues/">Ressources</a></div></li></ul></nav><button type="button" title="R√©duire le menu lat√©ral" aria-label="R√©duire le menu lat√©ral" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Sur cette page</button></div><div class="theme-doc-markdown markdown"><header><h1>Installation de Centreon-HA 2 n≈ìuds √† basculement manuel</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conditions-pr√©alables">Conditions pr√©alables<a href="#conditions-pr√©alables" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="compr√©hension">Compr√©hension<a href="#compr√©hension" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><p>Avant de suivre cette proc√©dure, il est recommand√© d&#x27;avoir un niveau de connaissance satisfaisant du syst√®me d&#x27;exploitation Linux et de Centreon afin de comprendre ce qui va √™tre fait et de pouvoir se sortir d&#x27;une √©ventuelle erreur.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="installation-de-centreon">Installation de Centreon<a href="#installation-de-centreon" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><p>L&#x27;installation d&#x27;un cluster Centreon-HA ne peut se faire que sur la base d&#x27;une installation fonctionnelle de Centreon. Avant de suivre cette proc√©dure, il est donc imp√©ratif d&#x27;avoir appliqu√© <strong><a href="https://docs.centreon.com/fr/docs/installation/introduction/" target="_blank" rel="noopener noreferrer">cette proc√©dure d&#x27;installation</a></strong> jusqu&#x27;au bout <strong>en r√©servant environ 5Go d&#x27;espace libre</strong> sur le <em>groupe de volumes</em> qui contient les donn√©es MySQL (point de montage <code>/var/lib/mysql</code> par d√©faut).</p><p>La commande <code>vgs</code> devrait retourner un affichage de la forme ci-dessous (en particulier la valeur sous <code>VFree</code>) :</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  VG                    #PV #LV #SN Attr   VSize   VFree </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  centos_centreon-c1      1   5   0 wz--n- &lt;31,00g &lt;5,00g</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Attention :</strong> Si cette condition pr√©alable n&#x27;est pas v√©rifi√©e, il ne sera pas possible de synchroniser les bases de donn√©es comme d√©crit dans ce document.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="d√©finition-des-noms-et-adresses-ip-des-serveurs">D√©finition des noms et adresses IP des serveurs<a href="#d√©finition-des-noms-et-adresses-ip-des-serveurs" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><p>Dans cette proc√©dure, nous ferons r√©f√©rence aux param√®tres qui varient d&#x27;une installation √† l&#x27;autre (noms et adresses IP des noeuds par exemple) via les macros suivantes :</p><ul><li><code>@CENTRAL_MASTER_IPADDR@</code> : Adresse IP du serveur central principal</li><li><code>@CENTRAL_MASTER_NAME@</code> : nom du serveur central principal</li><li><code>@CENTRAL_SLAVE_IPADDR@</code> : adresse IP du serveur central secondaire</li><li><code>@CENTRAL_SLAVE_NAME@</code> : nom du serveur central secondaire</li><li><code>@DB_MASTER_IPADDR@</code> : adresse IP du serveur principal de la base de donn√©es</li><li><code>@DB_MASTER_NAME@</code> : nom du serveur de base de donn√©es principal</li><li><code>@DB_SLAVE_IPADDR@</code> : adresse IP du serveur de base de donn√©es secondaire</li><li><code>@DB_SLAVE_NAME@</code> : nom du serveur de base de donn√©es secondaire</li><li><code>@MYSQL_REPL_USER@</code> : Nom du compte de r√©plication MySQL (sugg√©r√© : centreon-repl)</li><li><code>@MYSQL_REPL_PASSWD@</code> : mot de passe pour ce compte</li><li><code>@MYSQL_CENTREON_USER@</code> : Nom du compte MySQL de Centreon (sugg√©r√© : centreon)</li><li><code>@MYSQL_CENTREON_PASSWD@</code> : mot de passe pour ce compte</li><li><code>@CENTRAL_VIP_IPADDR@</code> : adresse IP virtuelle du cluster</li><li><code>@CENTRAL_VIP_IFNAME@</code> : nom de l&#x27;interface qui portera le VIP</li><li><code>@CENTRAL_VIP_CIDR_NETMASK@</code> : masque de sous-r√©seau exprim√© en nombre de bits sans le &#x27;/&#x27; (exemple : 24)</li><li><code>@CENTRAL_VIP_BROADCAST_IPADDR@</code> : adresse de diffusion (broadcast)</li><li><code>@DB_VIP_IPADDR@</code> : adresse IP virtuelle du cluster, dans le cas d&#x27;un HA √† 2 noeuds, elle est la m√™me que celle du central.</li><li><code>@DB_VIP_IFNAME@</code> : nom de l&#x27;interface qui portera le VIP, dans le cas d&#x27;un HA √† 2 noeuds, c&#x27;est le m√™me que celui du central.</li><li><code>@DB_VIP_CIDR_NETMASK@</code> : masque de sous-r√©seau exprim√© en nombre de bits sans le &#x27;/&#x27; (exemple : 24), dans le cas d&#x27;un HA √† 2 noeuds, il est identique au masque central.</li><li><code>@DB_VIP_BROADCAST_IPADDR@</code> : adresse de diffusion, dans le cas d&#x27;une HA √† 2 noeuds, elle est la m√™me que celle du central.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-de-centreon-broker">Configuration de Centreon-broker<a href="#configuration-de-centreon-broker" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="lien-vers-le-service-cbd">Lien vers le service cbd<a href="#lien-vers-le-service-cbd" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h4><p>Dans une installation Centreon standard, le service <code>cbd</code> pilote deux instances de <code>centreon-broker-daemon</code> :</p><ul><li><code>central-broker-master</code> : √©galement appel√© &quot;central broker&quot; ou &quot;SQL broker&quot;, qui redirige toutes les entr√©es/sorties des pollers vers les bases de donn√©es, vers le broker RRD, etc.</li><li><code>central-rrd-master</code> : le RRD broker qui re√ßoit son flux du SQL broker, et dont la seule fonction est d&#x27;√©crire les fichiers RRD utilis√©s pour afficher les graphes. </li></ul><p>Dans un cluster Centreon-HA, les deux processus de broker seront chacun g√©r√©s par un service s√©par√© qui sera pilot√© par le cluster :</p><ul><li><code>central-broker-master</code> comme ressource <code>cbd_central_broker</code>, li√©e au service <em>systemd</em> <code>cbd-sql</code>.</li><li><code>central-rrd-master</code> comme ressource clone <code>cbd_rrd</code>, li√©e au service standard Centreon <em>systemd</em> <code>cbd</code>.</li></ul><p>Pour que tout fonctionne correctement dans la suite, vous devez maintenant d√©faire le lien entre central-broker-master et le service <code>cbd</code> <strong> en cochant &quot;no&quot; pour le param√®tre &quot;Linked to cbd service &quot;</strong> dans <em>Configuration</em> &gt; <em>Pollers</em> &gt; <em>Configuration broker</em> &gt; <em>central-broker-master</em> dans l&#x27;onglet <em>General</em>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="double-flux-rrd">Double flux RRD<a href="#double-flux-rrd" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h4><p>Plut√¥t que de mettre en place une r√©plication en temps r√©el des fichiers de donn√©es RRD, le choix technique qui a √©t√© fait pour permettre aux graphiques d&#x27;√™tre affich√©s sur n&#x27;importe quel noeud d√®s qu&#x27;il devient &#x27;master&#x27; a √©t√© de dupliquer le flux de sortie de <code>central-broker-master</code> vers <code>central-rrd-master</code>. Ceci est configur√© dans le m√™me menu que dans le paragraphe pr√©c√©dent, mais cette fois dans l&#x27;onglet <em>Output</em> de <em>Configuration &gt; Collectors &gt; Centreon Broker Configuration</em>.</p><ul><li>Modifiez la sortie &quot;IPv4&quot; en rempla√ßant &quot;localhost&quot; par <code>@CENTRAL_MASTER_IPADDR@</code>.</li></ul><table><thead><tr><th>Sortie IPv4</th><th></th></tr></thead><tbody><tr><td>Nom</td><td>centreon-broker-master-rrd</td></tr><tr><td>Port de connexion</td><td>5670</td></tr><tr><td>H√¥te auquel se connecter</td><td><code>@CENTRAL_MASTER_IPADDR@</code></td></tr><tr><td>D√©lai de mise en m√©moire tampon</td><td>0</td></tr><tr><td>Intervalle de r√©essai</td><td>60</td></tr></tbody></table><ul><li>Add a new IPv4 output, similar to the first one and named for example &quot;centreon-broker-slave-rrd&quot; pointing this time to <code>@CENTRAL_SLAVE_IPADDR@</code>.</li></ul><table><thead><tr><th>Sortie IPv4</th><th></th></tr></thead><tbody><tr><td>Nom</td><td>centreon-broker-slave-rrd</td></tr><tr><td>Port de connexion</td><td>5670</td></tr><tr><td>H√¥te auquel se connecter</td><td><code>@CENTRAL_SLAVE_IPADDR@</code></td></tr><tr><td>D√©lai de mise en m√©moire tampon</td><td>0</td></tr><tr><td>Intervalle de r√©essai</td><td>60</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="exporter-la-configuration">Exporter la configuration<a href="#exporter-la-configuration" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h4><p>Une fois les actions des deux paragraphes pr√©c√©dents effectu√©es, la configuration doit √™tre export√©e (3 premi√®res cases pour l&#x27;exportation du poller &quot;Central&quot;) pour qu&#x27;elle soit effective.</p><p>Ces actions doivent √™tre effectu√©es soit sur les deux noeuds, soit uniquement sur <code>@CENTRAL_MASTER_NAME@</code> et ensuite les fichiers de configuration du broker doivent √™tre copi√©s sur <code>@CENTRAL_SLAVE_NAME@</code>.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">rsync</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-a</span><span class="token plain"> /etc/centreon-broker/*json @CENTRAL_SLAVE_IPADDR@:/etc/centreon-broker/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="modification-de-la-commande-cbd-reload">Modification de la commande <code>cbd</code> reload<a href="#modification-de-la-commande-cbd-reload" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><p>Ceci n&#x27;est peut-√™tre pas connu de tous les utilisateurs de Centreon, mais √† chaque fois qu&#x27;un rechargement de la configuration du poller central est effectu√© via l&#x27;interface, le service broker (<code>cbd</code>) est recharg√© (et pas seulement centengine), d&#x27;o√π le param√®tre &quot;Centreon Broker reload command&quot; dans <em>Configuration &gt; Pollers &gt; Central</em>.</p><p>Comme expliqu√© ci-dessus, les processus du broker sont r√©partis entre deux services : <code>cbd</code> pour le courtier RRD, <code>cbd-sql</code> pour le courtier central. Dans le contexte d&#x27;un cluster centreon-ha, le service qui doit √™tre recharg√© lors de l&#x27;exportation de la configuration est <code>cbd-sql</code> et non <code>cbd</code>. Vous devez donc appliquer la valeur <code>service cbd-sql reload</code> au param√®tre &quot;Centreon Broker reload command&quot;.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="synchronisation-des-fichiers-de-configuration-de-centreon-php-perl-gorgone">Synchronisation des fichiers de configuration de Centreon (PHP, Perl, Gorgone)<a href="#synchronisation-des-fichiers-de-configuration-de-centreon-php-perl-gorgone" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">rsync</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-av</span><span class="token plain"> /etc/centreon/* root@@CENTRAL_SLAVE_IPADDR@:/etc/centreon/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pr√©paration-du-syst√®me">Pr√©paration du syst√®me<a href="#pr√©paration-du-syst√®me" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h2><p>Avant de passer √† la configuration proprement dite du cluster, quelques √©tapes pr√©paratoires sont n√©cessaires au niveau du syst√®me d&#x27;exploitation.</p><p><strong>Note :</strong> sauf indication contraire, chacune des √©tapes suivantes doit √™tre effectu√©e <strong>sur les deux noeuds centraux</strong>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="r√©glage-de-la-configuration-du-r√©seau">R√©glage de la configuration du r√©seau<a href="#r√©glage-de-la-configuration-du-r√©seau" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><p>Afin d&#x27;am√©liorer la fiabilit√© du cluster et puisque <em>Centreon HA</em> ne fonctionne que sur IP v4, il est recommand√© d&#x27;appliquer les r√©glages suivants sur tous les serveurs de la plateforme Centreon :</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Alma / RHEL / Oracle Linux 8</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> /etc/sysctl.conf </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv6.conf.all.disable_ipv6 = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv6.conf.default.disable_ipv6 = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv4.tcp_retries2 = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv4.tcp_keepalive_time = 200</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv4.tcp_keepalive_probes = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv4.tcp_keepalive_intvl = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart NetworkManager</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p>Pour √©viter les probl√®mes li√©s √† la gestion des adresses IP fixes et virtuelles, il est n√©cessaire de d√©clarer l&#x27;adresse IP fixe de chaque serveur dans la configuration du r√©seau.</p><p>Pour ce faire, ex√©cutez les commandes suivantes sur chaque n≈ìud :</p><p>Pour le serveur <code>@CENTRAL_MASTER_NAME@</code> :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nmcli con mod @CENTRAL_VIP_IFNAME@ +ipv4.addresses </span><span class="token string" style="color:#e3116c">&quot;@CENTRAL_MASTER_IPADDR@/@CENTRAL_VIP_CIDR_NETMASK@&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmcli con up @CENTRAL_VIP_IFNAME@</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Pour le serveur <code>@CENTRAL_SLAVE_NAME@</code> :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nmcli con mod @CENTRAL_VIP_IFNAME@ +ipv4.addresses </span><span class="token string" style="color:#e3116c">&quot;@CENTRAL_SLAVE_IPADDR@/@CENTRAL_VIP_CIDR_NETMASK@&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmcli con up @CENTRAL_VIP_IFNAME@</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Vous pouvez v√©rifier sur chaque noeud si l&#x27;adresse IP est d√©clar√©e avec cette commande :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /etc/sysconfig/network-scripts/ifcfg-@CENTRAL_VIP_IFNAME@</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Le r√©sultat est le m√™me pour <code>@CENTRAL_MASTER_NAME@</code> :</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEVICE=@CENTRAL_VIP_IFNAME@</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ONBOOT=yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPADDR=@CENTRAL_MASTER_IPADDR@</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PREFIX=23</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="r√©solution-de-noms">R√©solution de noms<a href="#r√©solution-de-noms" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><p>Afin de s&#x27;assurer que le cluster fonctionne correctement m√™me si le service de r√©solution de nom √©choue, il est imp√©ratif que les noeuds se connaissent par le fichier <code>/etc/hosts</code>. Dans le cas d&#x27;un cluster √† 2 noeuds, il n&#x27;est pas n√©cessaire de d√©clarer les h√¥tes <code>@DB_MASTER_NAME@</code> et <code>@DB_MASTER_SLAVE@</code> puisqu&#x27;ils sont les m√™mes que les h√¥tes centraux.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/etc/hosts </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">&quot;EOF&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">@CENTRAL_MASTER_IPADDR@ @CENTRAL_MASTER_NAME@</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">@CENTRAL_SLAVE_IPADDR@ @CENTRAL_SLAVE_NAME@</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Dans la suite de ce document, nous ferons r√©f√©rence au n≈ìud primaire comme √©tant le n≈ìud principal et au n≈ìud secondaire comme √©tant le n≈ìud secondaire. Cette distinction est purement arbitraire, les r√¥les peuvent bien s√ªr √™tre √©chang√©s une fois l&#x27;installation termin√©e.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="installation-des-paquets">Installation des paquets<a href="#installation-des-paquets" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><p>Centreon propose le paquet <code>centreon-ha</code>, qui fournit tous les scripts et d√©pendances n√©cessaires pour faire fonctionner un cluster Centreon.</p><p>Sur tous les :</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Alma Linux 8</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">RHEL 8</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Oracle Linux 8</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dnf config-manager </span><span class="token parameter variable" style="color:#36acaa">--enable</span><span class="token plain"> ha</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> centreon-ha-web</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">subscription-manager repos </span><span class="token parameter variable" style="color:#36acaa">--enable</span><span class="token plain"> rhel-8-for-x86_64-highavailability-rpms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> centreon-ha-web</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dnf config-manager </span><span class="token parameter variable" style="color:#36acaa">--enable</span><span class="token plain"> ol8_addons</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> centreon-ha-web</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="√©change-de-cl√©s-ssh">√âchange de cl√©s SSH<a href="#√©change-de-cl√©s-ssh" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><p>Afin de permettre aux deux serveurs centraux d&#x27;√©changer des fichiers et des commandes, il est n√©cessaire de mettre en place la possibilit√© de se connecter <em>via</em> SSH d&#x27;un serveur √† l&#x27;autre pour les utilisateurs :</p><ul><li><code>mysql</code></li><li><code>centreon</code></li></ul><p>Il y a 2 fa√ßons d&#x27;√©changer des cl√©s SSH :</p><ul><li>En utilisant <code>sh-copy-id</code> : l&#x27;utilisation de cette commande n√©cessite de pouvoir valider l&#x27;authentification avec un mot de passe. Cependant, il n&#x27;est pas souhaitable de d√©finir un mot de passe pour les comptes de service dont nous parlons ici. Si cette m√©thode est quand m√™me utilis√©e, il est recommand√© de supprimer le mot de passe apr√®s l&#x27;√©change, avec les commandes <code>passwd -d centreon</code> et <code>passwd -d mysql</code>.</li><li>En copiant manuellement la cl√© publique dans <code>~/.ssh/authorized_keys</code>. Cette m√©thode est √† privil√©gier, mais n√©cessite, pour fonctionner correctement, que seul le propri√©taire du fichier soit en mesure de le lire.</li></ul><p>C&#x27;est la deuxi√®me m√©thode qui sera propos√©e ci-dessous.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="compte-centreon">Compte centreon<a href="#compte-centreon" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h4><p>Cette proc√©dure doit √™tre appliqu√©e sur les deux noeuds centraux. Pour commencer, passez dans l&#x27;environnement <code>bash</code> de <code>centreon</code> :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">su</span><span class="token plain"> - centreon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh-keygen </span><span class="token parameter variable" style="color:#36acaa">-t</span><span class="token plain"> ed25519 </span><span class="token parameter variable" style="color:#36acaa">-a</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> ~/.ssh/id_ed25519.pub </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tee</span><span class="token plain"> ~/.ssh/authorized_keys</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Apr√®s avoir ex√©cut√© ces commandes sur les deux noeuds, copiez le contenu du fichier qui a √©t√© affich√© par la commande <code>cat</code> et collez-le dans le fichier <code>~/.ssh/authorized_keys</code> <strong>sur l&#x27;autre noeud</strong> puis appliquez les permissions correctes au fichier (toujours en tant que <code>centreon</code>) :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">600</span><span class="token plain"> ~/.ssh/authorized_keys</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>L&#x27;√©change de cl√©s doit ensuite √™tre valid√© par une premi√®re connexion qui acceptera la signature du serveur SSH (toujours sous le nom de <code>centreon</code>) :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> @CENTRAL_MASTER_NAME@</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> @CENTRAL_SLAVE_NAME@</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Ensuite, quittez la session <code>centreon</code> avec <code>exit</code> ou <code>Ctrl-D</code>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="compte-mysql">Compte mysql<a href="#compte-mysql" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h4><p>Pour le compte <code>mysql</code>, la proc√©dure diff√®re quelque peu car cet utilisateur n&#x27;a normalement pas de <em>r√©pertoire personnel</em> ni la possibilit√© d&#x27;ouvrir une session Shell. Cette proc√©dure doit √©galement √™tre appliqu√©e sur les deux noeuds centraux.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl stop mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /home/mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chown</span><span class="token plain"> mysql: /home/mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">usermod</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"> /home/mysql mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">usermod</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-s</span><span class="token plain"> /bin/bash mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">touch</span><span class="token plain"> /var/log/mysqld.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chown</span><span class="token plain"> mysql. /var/log/mysqld.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl start mysql</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Ensuite, passez √† l&#x27;environnement <code>bash</code> de <code>mysql</code> et g√©n√©rez les cl√©s SSH :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">su</span><span class="token plain"> - mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh-keygen </span><span class="token parameter variable" style="color:#36acaa">-t</span><span class="token plain"> ed25519 </span><span class="token parameter variable" style="color:#36acaa">-a</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> ~/.ssh/id_ed25519.pub </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tee</span><span class="token plain"> ~/.ssh/authorized_keys</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Apr√®s avoir ex√©cut√© ces commandes sur les deux noeuds, copiez le contenu du fichier et collez-le dans <code>~/.ssh/authorized_keys</code> <strong>sur l&#x27;autre noeud</strong> et appliquez ensuite les permissions correctes au fichier (toujours en tant que <code>mysql</code>) :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">600</span><span class="token plain"> ~/.ssh/authorized_keys</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>L&#x27;√©change de cl√©s doit ensuite √™tre valid√© par une premi√®re connexion qui acceptera la signature du serveur SSH en tapant &quot;yes&quot; (toujours comme <code>mysql</code>) :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> @DB_MASTER_NAME@</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> @DB_SLAVE_NAME@</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Ensuite, quittez la session <code>mysql</code> avec <code>exit</code> ou <code>Ctrl-D</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-de-la-r√©plication-mysql">Configuration de la r√©plication MySQL<a href="#configuration-de-la-r√©plication-mysql" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h2><p>Pour que les deux noeuds soient interchangeables √† tout moment, les deux bases de donn√©es doivent √™tre r√©pliqu√©es en permanence. Pour ce faire, nous allons mettre en place une r√©plication ma√Ætre-esclave.
Depuis Centreon 22.04, la r√©plication de mariaDB est maintenant bas√©e sur <strong><a href="https://mariadb.com/kb/en/gtid/" target="_blank" rel="noopener noreferrer">GTID</a></strong>.</p><p><strong>Note:</strong> sauf indication contraire, chacune des √©tapes suivantes doit √™tre effectu√©e <strong>sur les deux n≈ìuds de base de donn√©es</strong>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-de-mysql">Configuration de MySQL<a href="#configuration-de-mysql" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><p>Pour commencer, nous devons r√©gler la configuration de MySQL, qui sera concentr√©e dans le fichier unique <code>/etc/my.cnf.d/server.cnf</code>.  Par d√©faut, la section <code>[server]</code> de ce fichier est vide, et c&#x27;est l√† que les lignes suivantes doivent √™tre coll√©es :</p><div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[server]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sql_mode = &#x27;NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server-id=1 # SET TO 1 FOR MASTER AND 2 FOR SLAVE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#read_only</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log-bin=mysql-bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">binlog-do-db=centreon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">binlog-do-db=centreon_storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">innodb_flush_log_at_trx_commit=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sync_binlog=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">binlog_format=MIXED</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">slave_compressed_protocol=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">datadir=/var/lib/mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pid-file=/var/lib/mysql/mysql.pid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">skip-slave-start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log-slave-updates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gtid_strict_mode=ON</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">expire_logs_days=7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ignore-db-dir=lost+found</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Tuning standard Centreon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">innodb_file_per_table=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">open_files_limit=32000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">key_buffer_size=256M</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sort_buffer_size=32M</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">join_buffer_size=4M</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">thread_cache_size=64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">read_buffer_size=512K</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">read_rnd_buffer_size=256K</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_allowed_packet=64M</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Uncomment for 4 Go Ram</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#innodb_buffer_pool_size=512M</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Uncomment for 8 Go Ram</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#innodb_buffer_pool_size=1G</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Important:</strong> la valeur de <code>server-id</code> doit √™tre diff√©rente d&#x27;un serveur √† l&#x27;autre, afin qu&#x27;ils puissent s&#x27;identifier correctement. Les valeurs 1 =&gt; Ma√Ætre et 2 =&gt; Esclave ne sont pas obligatoires mais sont recommand√©es.</p><p><strong>NB:</strong> N&#x27;oubliez pas de d√©commenter (enlever le &#x27;#&#x27; en d√©but de ligne) le param√®tre <code>innodb_buffer_pool_size</code> qui correspond √† votre plateforme.</p><p>Pour que ces modifications soient prises en compte, vous devez red√©marrer le serveur de base de donn√©es :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart mariadb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Assurez-vous que le red√©marrage a r√©ussi avec la commande suivante :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl status mariadb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Avertissement:</strong> Le fichier <code>centreon.cnf</code> ne sera plus pris en compte, si des param√®tres y ont √©t√© personnalis√©s, ils doivent √™tre transf√©r√©s dans <code>server.cnf</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="s√©curisation-de-la-base-de-donn√©es">S√©curisation de la base de donn√©es<a href="#s√©curisation-de-la-base-de-donn√©es" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><p>L&#x27;acc√®s aux bases de donn√©es doit √™tre restreint le plus strictement possible. La commande <code>mysql_secure_installation</code> permet de supprimer les acc√®s non prot√©g√©s par des mots de passe et la base de donn√©es de test. Ex√©cutez cette commande et laissez-vous guider par les choix par d√©faut. Faites attention √† choisir un mot de passe qui n&#x27;appartient √† aucun dictionnaire.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql_secure_installation</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cr√©ation-du-compte-centreon">Cr√©ation du compte centreon<a href="#cr√©ation-du-compte-centreon" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><p>Pour pouvoir administrer les utilisateurs de MySQL, vous devez d&#x27;abord vous connecter en tant que root (avec le mot de passe saisi dans le paragraphe pr√©c√©dent) :</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql </span><span class="token parameter variable" style="color:#36acaa">-p</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Puis collez dans l&#x27;invite MySQL les commandes ci-dessous en changeant les adresses IP et les mots de passe.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">USER</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@MYSQL_CENTREON_USER@&#x27;</span><span class="token variable" style="color:#36acaa">@&#x27;@CENTRAL_SLAVE_IPADDR@&#x27;</span><span class="token plain"> IDENTIFIED </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@MYSQL_CENTREON_PASSWD@&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GRANT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ALL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIVILEGES</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> centreon</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TO</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@MYSQL_CENTREON_USER@&#x27;</span><span class="token variable" style="color:#36acaa">@&#x27;@CENTRAL_SLAVE_IPADDR@&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GRANT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ALL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIVILEGES</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> centreon_storage</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TO</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@MYSQL_CENTREON_USER@&#x27;</span><span class="token variable" style="color:#36acaa">@&#x27;@CENTRAL_SLAVE_IPADDR@&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">USER</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@MYSQL_CENTREON_USER@&#x27;</span><span class="token variable" style="color:#36acaa">@&#x27;@CENTRAL_MASTER_IPADDR@&#x27;</span><span class="token plain"> IDENTIFIED </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@MYSQL_CENTREON_PASSWD@&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GRANT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ALL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIVILEGES</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> centreon</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TO</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@MYSQL_CENTREON_USER@&#x27;</span><span class="token variable" style="color:#36acaa">@&#x27;@CENTRAL_MASTER_IPADDR@&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GRANT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ALL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIVILEGES</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> centreon_storage</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TO</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@MYSQL_CENTREON_USER@&#x27;</span><span class="token variable" style="color:#36acaa">@&#x27;@CENTRAL_MASTER_IPADDR@&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cr√©ation-du-compte-de-r√©plication">Cr√©ation du compte de r√©plication<a href="#cr√©ation-du-compte-de-r√©plication" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><p>Toujours dans le prompt MySQL (voir paragraphe pr√©c√©dent) cr√©ez l&#x27;utilisateur <code>@MYSQL_REPL_USER@</code>, d√©di√© √† la r√©plication, en utilisant les commandes suivantes :</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">USER</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@MYSQL_REPL_USER@&#x27;</span><span class="token variable" style="color:#36acaa">@&#x27;localhost&#x27;</span><span class="token plain"> IDENTIFIED </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@MYSQL_REPL_PASSWD@&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GRANT</span><span class="token plain"> PROCESS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RELOAD</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SHUTDOWN</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SUPER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">REPLICATION</span><span class="token plain"> CLIENT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">REPLICATION</span><span class="token plain"> SLAVE </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TO</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@MYSQL_REPL_USER@&#x27;</span><span class="token variable" style="color:#36acaa">@&#x27;localhost&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">USER</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@MYSQL_REPL_USER@&#x27;</span><span class="token variable" style="color:#36acaa">@&#x27;@CENTRAL_SLAVE_IPADDR@&#x27;</span><span class="token plain"> IDENTIFIED </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@MYSQL_REPL_PASSWD@&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GRANT</span><span class="token plain"> PROCESS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RELOAD</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SHUTDOWN</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SUPER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">REPLICATION</span><span class="token plain"> CLIENT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">REPLICATION</span><span class="token plain"> SLAVE </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TO</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@MYSQL_REPL_USER@&#x27;</span><span class="token variable" style="color:#36acaa">@&#x27;@DB_SLAVE_IPADDR@&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">USER</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@MYSQL_REPL_USER@&#x27;</span><span class="token variable" style="color:#36acaa">@&#x27;@CENTRAL_MASTER_IPADDR@&#x27;</span><span class="token plain"> IDENTIFIED </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@MYSQL_REPL_PASSWD@&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GRANT</span><span class="token plain"> PROCESS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RELOAD</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SHUTDOWN</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SUPER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">REPLICATION</span><span class="token plain"> CLIENT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">REPLICATION</span><span class="token plain"> SLAVE </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TO</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@MYSQL_REPL_USER@&#x27;</span><span class="token variable" style="color:#36acaa">@&#x27;@DB_MASTER_IPADDR@&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-des-variables-denvironnement-pour-les-scripts-mysql">Configuration des variables d&#x27;environnement pour les scripts MySQL<a href="#configuration-des-variables-denvironnement-pour-les-scripts-mysql" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><p>Le fichier <code>/etc/centreon-ha/mysql-resources.sh</code> contient des variables d&#x27;environnement qui doivent √™tre adapt√©es √† l&#x27;installation actuelle en rempla√ßant les macros par la valeur appropri√©e.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">###############################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Database access credentials #</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">###############################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">DBHOSTNAMEMASTER</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;@DB_MASTER_NAME@&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">DBHOSTNAMESLAVE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;@DB_SLAVE_NAME@&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">DBREPLUSER</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;@MYSQL_REPL_USER@&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">DBREPLPASSWORD</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;@MYSQL_REPL_PASSWD@&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">DBROOTUSER</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;@MYSQL_REPL_USER@&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">DBROOTPASSWORD</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;@MYSQL_REPL_PASSWD@&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">CENTREON_DB</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;centreon&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">CENTREON_STORAGE_DB</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;centreon_storage&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">##########################################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Manual failover additional informations #</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">##########################################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">CENTRAL_VIP_IPADDR</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;@CENTRAL_VIP_IPADDR@&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">CENTRAL_VIP_IFNAME</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;@CENTRAL_VIP_IFNAME@&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">CENTRAL_VIP_CIDR_NETMASK</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;@CENTRAL_VIP_CIDR_NETMASK@&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">CENTRAL_VIP_BROADCAST_IPADDR</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;@CENTRAL_VIP_BROADCAST_IPADDR@&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">MYSQL_VIP_IPADDR</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;@DB_VIP_IPADDR@&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">MYSQL_VIP_IFNAME</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;@DB_VIP_IFNAME@&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">MYSQL_VIP_CIDR_NETMASK</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;@DB_VIP_CIDR_NETMASK@&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">MYSQL_VIP_BROADCAST_IPADDR</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;@DB_VIP_BROADCAST_IPADDR@&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Pour s&#x27;assurer que les derni√®res √©tapes ont √©t√© effectu√©es correctement, et que les noms, identifiants et mots de passe corrects ont √©t√© saisis dans le fichier de configuration, ex√©cutez la commande :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/share/centreon-ha/bin/mysql-check-status.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Le r√©sultat attendu est le suivant :</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Connection Status &#x27;@DB_MASTER_NAME@&#x27; [OK]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection Status &#x27;@DB_SLAVE_NAME@&#x27; [OK]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Slave Thread Status [KO]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Error reports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    No slave (maybe because we cannot check a server).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Position Status [SKIP]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!Error reports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Skip because we can&#x27;t identify a unique slave.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Ce qu&#x27;il est important de v√©rifier, c&#x27;est que les deux premiers tests de connexion sont <code>OK</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="passage-en-mode-lecture-seule">Passage en mode lecture seule<a href="#passage-en-mode-lecture-seule" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><p>Maintenant que tout est correctement configur√©, nous devons activer le mode lecture seule sur les deux serveurs en d√©commentant (<em>ie.</em> enlever le <code>#</code> en d√©but de ligne) cette d√©claration dans le fichier <code>/etc/my.cnf.d/server.cnf</code> :</p><ul><li>N≈ìud principal</li></ul><div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[server]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server-id=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">read_only</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log-bin=mysql-bin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>N≈ìud secondaire</li></ul><div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[server]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server-id=2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">read_only</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log-bin=mysql-bin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Ensuite, appliquez ce changement en red√©marrant MySQL sur les deux n≈ìuds :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart mariadb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="autorisation-des-comptes-centreon-et-mysql">Autorisation des comptes centreon et mysql<a href="#autorisation-des-comptes-centreon-et-mysql" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><p>Pour que les scripts s&#x27;ex√©cutent correctement √† travers les connexions ssh via les comptes centreon et mysql, il faut leur donner des droits suppl√©mentaires</p><p>Pour le compte centreon, √©ditez le fichier <code>/etc/sudoers.d/centreon-cluster</code> et ajoutez les lignes suivantes :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CENTREON   ALL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> NOPASSWD: /usr/bin/systemctl reload centreon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CENTREON   ALL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> NOPASSWD: /usr/bin/systemctl restart centreon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CENTREON   ALL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> NOPASSWD: /usr/bin/systemctl stop centreon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CENTREON   ALL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> NOPASSWD: /usr/bin/systemctl start centreon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CENTREON   ALL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> NOPASSWD: /usr/bin/nmcli</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Pour le compte mysql, modifiez le fichier <code>/etc/sudoers.d/centreon-cluster-db</code> et ajoutez la ligne suivante :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MYSQL   ALL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> NOPASSWD: /usr/bin/nmcli</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="synchronisation-des-bases-de-donn√©es-et-d√©marrage-de-la-r√©plication-mysql">Synchronisation des bases de donn√©es et d√©marrage de la r√©plication MySQL<a href="#synchronisation-des-bases-de-donn√©es-et-d√©marrage-de-la-r√©plication-mysql" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><p>Pour synchroniser les bases de donn√©es, arr√™tez le service <code>mysql</code> sur le noeud secondaire pour √©craser ses donn√©es avec celles du serveur principal. </p><p>Vous devez donc ex√©cuter la commande suivante <strong>sur le noeud secondaire</strong> :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl stop mariadb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Dans certains cas, systemd peut √©chouer √† arr√™ter le service <code>mysql</code>, pour en √™tre s√ªr, v√©rifiez que la commande suivante ne renvoie aucune ligne :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-ef</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">d</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Si un processus <code>mysqld</code> est toujours en cours d&#x27;ex√©cution, alors la commande suivante doit √™tre ex√©cut√©e pour l&#x27;arr√™ter (et fournir le mot de passe root mysql lorsqu&#x27;il est demand√©) :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysqladmin </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">shutdown</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Une fois le service arr√™t√© sur le n≈ìud <strong>secondaire</strong>, ex√©cutez le script de synchronisation <strong>depuis le n≈ìud principal</strong> : </p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/share/centreon-ha/bin/mysql-sync-bigdb.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Ce script fait ce qui suit :</p><ul><li>v√©rifier que mysql est arr√™t√© sur le noeud secondaire</li><li>arr√™ter mysql sur le noeud primaire</li><li>monter un snapshot LVM sur le <em>groupe de volumes</em> qui supporte la partition /var/lib/mysql</li><li>D√©marrer mysql sur le n≈ìud primaire</li><li>stocker la position actuelle dans les journaux binaires</li><li>d√©sactivez la variable globale MySQL <code>read_only</code> sur le noeud principal (*c&#x27;est-√†-dire que le noeud principal est maintenant autoris√© √† √©crire dans sa base de donn√©es)</li><li>Synchroniser tous les fichiers de donn√©es (√† l&#x27;exception de la base de donn√©es syst√®me <code>mysql</code>) en √©crasant les fichiers sur le noeud secondaire.</li><li>D√©montage du snapshot LVM</li><li>cr√©er le thread de r√©plication qui maintiendra les donn√©es √† jour sur le noeud secondaire.</li></ul><p>Ce script est tr√®s verbeux, et tout ce qui est affich√© n&#x27;est pas compr√©hensible, mais pour √™tre s√ªr qu&#x27;il a √©t√© ex√©cut√© jusqu&#x27;au bout, assurez-vous que la fin ressemble √† :</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Umount and Delete LVM snapshot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Logical volume &quot;dbbackupdatadir&quot; successfully removed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Start MySQL Slave</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Start Replication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Id  User    Host    db  Command Time    State   Info    Progress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3   @MYSQL_REPL_USER@   @CENTRAL_MASTER_NAME@:33084 NULL    Query   0   init    show processlist    0.000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Si tout s&#x27;est bien pass√©, alors la commande <code>mysql-check-status.sh</code> devrait retourner un r√©sultat sans erreur :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/share/centreon-ha/bin/mysql-check-status.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>R√©sultat attendu :</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Connection Status &#x27;@CENTRAL_MASTER_NAME@&#x27; [OK]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection Status &#x27;@CENTRAL_SLAVE_NAME@&#x27; [OK]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Slave Thread Status [OK]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Position Status [OK]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cr√©ation-du-vip-mysql">Cr√©ation du VIP MySQL<a href="#cr√©ation-du-vip-mysql" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><p>La VIP sera ajout√©e √† la configuration de l&#x27;interface <code>@DB_VIP_IFNAME@</code> sur le noeud ma√Ætre :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nmcli con mod </span><span class="token string" style="color:#e3116c">&quot;@DB_VIP_IFNAME@&quot;</span><span class="token plain"> +ipv4.addresses </span><span class="token string" style="color:#e3116c">&quot;@DB_VIP_IPADDR@/@DB_VIP_CIDR_NETMASK@&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmcli connection up </span><span class="token string" style="color:#e3116c">&quot;@DB_VIP_IFNAME@&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Ex√©cutez ensuite le script suivant <strong>sur l&#x27;un des deux n≈ìuds MySQL</strong> pour v√©rifier si la VIP est correctement mont√©e sur le serveur ma√Ætre MySQL (ce script peut √™tre ex√©cut√© sur l&#x27;un ou l&#x27;autre des deux n≈ìuds, il d√©tectera de lui-m√™me lequel est le ma√Ætre) :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/share/centreon-ha/bin/move-mysql-vip-to-mysql-master.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Le r√©sultat devrait √™tre comme ceci, si non le script d√©place la VIP au bon endroit :</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">The VIP address is already at the right place. Nothing to do.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-du-cluster-centreon">Configuration du cluster Centreon<a href="#configuration-du-cluster-centreon" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h2><p><strong>Note:</strong> sauf indication contraire, chacune des √©tapes suivantes doit √™tre effectu√©e <strong>sur les deux n≈ìuds centraux</strong>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-du-service-de-synchronisation">Configuration du service de synchronisation<a href="#configuration-du-service-de-synchronisation" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><p>Le service <code>centreon-central-sync</code> n√©cessite que nous d√©finissions pour chaque noeud dans <code>/etc/centreon-ha/centreon_central_sync.pm</code> l&#x27;adresse IP de son correspondant :</p><p>Ainsi pour le serveur <code>@CENTRAL_MASTER_NAME@</code> nous devons avoir :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">our %centreon_central_sync_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    peer_addr </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;@CENTRAL_SLAVE_IPADDR@&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Et pour le serveur <code>@CENTRAL_SLAVE_NAME@</code> nous devons avoir :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">our %centreon_central_sync_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    peer_addr </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;@CENTRAL_MASTER_IPADDR@&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="suppression-des-crons">Suppression des crons<a href="#suppression-des-crons" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h2><p>Les t√¢ches cron planifi√©es sont ex√©cut√©es directement par le processus gorgone dans l&#x27;architecture hautement disponible. Cela permet d&#x27;√©viter qu&#x27;elles ne se fassent concurrence sur les n≈ìuds centraux. Il est donc n√©cessaire de les supprimer manuellement :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> /etc/cron.d/centreon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> /etc/cron.d/centstorage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> /etc/cron.d/centreon-auto-disco</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="changement-de-droits">Changement de droits<a href="#changement-de-droits" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h2><p>Les r√©pertoires /var/log/centreon-engine et /tmp/centreon-autodisco sont partag√©s entre plusieurs processus. Il est n√©cessaire de modifier les droits de ces r√©pertoires et fichiers pour assurer le bon fonctionnement de la r√©plication des fichiers et de la d√©couverte automatique des services :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">775</span><span class="token plain"> /var/log/centreon-engine/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /var/log/centreon-engine/archives</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chown</span><span class="token plain"> centreon-engine: /var/log/centreon-engine/archives</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">775</span><span class="token plain"> /var/log/centreon-engine/archives/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">664</span><span class="token plain"> /var/log/centreon-engine/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">664</span><span class="token plain"> /var/log/centreon-engine/archives/*</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /tmp/centreon-autodisco/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chown</span><span class="token plain"> apache: /tmp/centreon-autodisco/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">775</span><span class="token plain"> /tmp/centreon-autodisco/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="arr√™ter-et-d√©sactiver-les-services">Arr√™ter et d√©sactiver les services<a href="#arr√™ter-et-d√©sactiver-les-services" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><p>Les services de l&#x27;application Centreon ne seront plus lanc√©s au d√©marrage du serveur comme c&#x27;est le cas pour une installation standard, les services de clustering s&#x27;en chargeront. Il est donc n√©cessaire d&#x27;arr√™ter et de d√©sactiver ces services.</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Alma / RHEL / Oracle Linux 8</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl stop centengine snmptrapd centreontrapd gorgoned cbd httpd php-fpm centreon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl disable centengine snmptrapd centreontrapd gorgoned cbd httpd php-fpm centreon centreon-central-sync cbd-sql</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="red√©finir-les-r√®gles-de-d√©marrage-des-services">Red√©finir les r√®gles de d√©marrage des services<a href="#red√©finir-les-r√®gles-de-d√©marrage-des-services" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><p>Certains services ne doivent √™tre d√©marr√©s que sur un seul noeud, mais pour d&#x27;autres, il est acceptable ou m√™me souhaitable de les d√©marrer sur les deux noeuds. Nous allons commencer par ces services.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="service-php">Service PHP<a href="#service-php" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h4><p>Le service <code>php-fpm.service</code> n&#x27;a pas besoin d&#x27;√™tre modifi√©, mais doit √™tre activ√© pour qu&#x27;il soit d√©marr√© automatiquement lors du d√©marrage des serveurs centraux.</p><p>Ex√©cutez cette commande <strong>sur les deux noeuds centraux</strong> :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl </span><span class="token builtin class-name">enable</span><span class="token plain"> php-fpm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="service-broker-rrd">Service Broker RRD<a href="#service-broker-rrd" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h4><p>Le processus &quot;broker-rrd&quot; est lanc√© via le <code>cbd.service</code>. Ce dernier est par d√©faut pilot√© par <code>centreon.service</code> mais dans cette configuration, il doit √™tre d√©tach√© en modifiant sa d√©finition sur les deux noeuds centraux :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /usr/lib/systemd/system/cbd.service </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">&quot;EOF&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Description=Centreon Broker watchdog</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">After=syslog.target network.target</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Service]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ExecStart=/usr/sbin/cbwd /etc/centreon-broker/watchdog.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ExecReload=/bin/kill -HUP $MAINPID</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Type=simple</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">User=centreon-broker</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">UMask=0002</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Install]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">WantedBy=multi-user.target</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Ensuite, d√©marrez-le et activez-le :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl start cbd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl </span><span class="token builtin class-name">enable</span><span class="token plain"> cbd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cr√©ation-de-la-vip-centreon">Cr√©ation de la VIP Centreon<a href="#cr√©ation-de-la-vip-centreon" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h4><p>La VIP sera ajout√©e √† la configuration de l&#x27;interface <code>@CENTRAL_VIP_IFNAME@</code> sur le n≈ìud ma√Ætre.
Dans la plupart des cas, la VIP centrale est le m√™me que la VIP de la base de donn√©es pour un cluster √† 2 n≈ìuds et cette action a d√©j√† √©t√© effectu√©e pour la r√©plication.</p><p>Si non, ex√©cutez ces commandes sur <code>@CENTRAL_MASTER_NAME@</code> :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nmcli con mod </span><span class="token string" style="color:#e3116c">&quot;@CENTRAL_VIP_IFNAME@&quot;</span><span class="token plain"> +ipv4.addresses </span><span class="token string" style="color:#e3116c">&quot;@CENTRAL_VIP_IPADDR@/@CENTRAL_VIP_CIDR_NETMASK@&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmcli connection up </span><span class="token string" style="color:#e3116c">&quot;@CENTRAL_VIP_IFNAME@&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="service-httpd">Service httpd<a href="#service-httpd" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h4><p>Le service <code>httpd.service</code> est par d√©faut ind√©pendant de <code>centreon.service</code> mais dans cette configuration, il faut l&#x27;y rattacher en modifiant sa d√©finition sur les deux noeuds centraux :</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Alma / RHEL / Oracle Linux 8</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /usr/lib/systemd/system/httpd.service </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">&quot;EOF&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Description=The Apache HTTP Server</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">PartOf=centreon.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ReloadPropagatedFrom=centreon.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">After=centreon.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Service]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Type=notify</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Environment=LANG=C</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ExecStart=/usr/sbin/httpd $OPTIONS -DFOREGROUND</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ExecReload=/usr/sbin/httpd $OPTIONS -k graceful</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ExecStop=/usr/sbin/httpd $OPTIONS -k graceful-stop</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"># Send SIGWINCH for graceful stop</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">KillSignal=SIGCONT</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">KillMode=mixed</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">PrivateTmp=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Install]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">WantedBy=centreon.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="service-gorgone">Service Gorgone<a href="#service-gorgone" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h4><p>Le service <code>gorgoned.service</code> est par d√©faut ind√©pendant de <code>centreon.service</code> mais dans cette configuration, il doit lui √™tre rattach√© en modifiant sa d√©finition sur les deux noeuds centraux :</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Alma / RHEL / Oracle Linux 8</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /etc/systemd/system/gorgoned.service </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">&quot;EOF&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Description=Centreon Gorgone</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">PartOf=centreon.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">After=httpd.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ReloadPropagatedFrom=centreon.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Service]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EnvironmentFile=/etc/sysconfig/gorgoned</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ExecStart=/usr/bin/perl /usr/bin/gorgoned $OPTIONS</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Type=simple</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">User=centreon-gorgone</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Install]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">WantedBy=centreon.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="service-centreon-central-sync">Service centreon-central-sync<a href="#service-centreon-central-sync" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h4><p>Ce service est sp√©cifique √† <em>Centreon HA</em>. Sa fonction est de r√©pliquer les changements de configuration, d&#x27;ajouter des images via l&#x27;interface, etc.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /usr/lib/systemd/system/centreon-central-sync.service </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">&quot;EOF&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Description=Centreon Central Sync (failover only)</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">PartOf=centreon.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ReloadPropagatedFrom=centreon.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">After=gorgoned.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Service]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EnvironmentFile=/etc/sysconfig/centreon_central_sync</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ExecStart=/usr/share/centreon-ha/bin/centreon_central_sync $OPTIONS</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ExecReload=/bin/kill -HUP $MAINPID</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Type=simple</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">User=centreon</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Install]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">WantedBy=centreon.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="service-broker-sql">Service Broker SQL<a href="#service-broker-sql" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /usr/lib/systemd/system/cbd-sql.service </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">&quot;EOF&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Description=Centreon SQL Broker service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">PartOf=centreon.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ReloadPropagatedFrom=centreon.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">After=centreon-central-sync.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Service]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EnvironmentFile=/etc/sysconfig/cbd_sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ExecStart=/usr/sbin/cbd $OPTIONS</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ExecReload=/bin/kill -HUP $MAINPID</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Type=simple</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">User=centreon-broker</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">UMask=0002</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Install]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">WantedBy=centreon.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="service-centengine">Service centengine<a href="#service-centengine" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /usr/lib/systemd/system/centengine.service </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">&quot;EOF&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Description=Centreon Engine</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">PartOf=centreon.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ReloadPropagatedFrom=centreon.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">After=cbd-sql.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Service]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ExecStart=/usr/sbin/centengine /etc/centreon-engine/centengine.cfg</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ExecReload=/bin/kill -HUP $MAINPID</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Type=simple</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">User=centreon-engine</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Install]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">WantedBy=centreon.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="service-centreontrapd">Service centreontrapd<a href="#service-centreontrapd" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /usr/lib/systemd/system/centreontrapd.service </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">&quot;EOF&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Description=Centreon Trapd Daemon is a Centreon program that manage traps</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">PartOf=centreon.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">After=centreon.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ReloadPropagatedFrom=centreon.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Service]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EnvironmentFile=/etc/sysconfig/centreontrapd</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ExecStart=/usr/share/centreon/bin/centreontrapd $OPTIONS</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ExecReload=/bin/kill -HUP $MAINPID</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Type=simple</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">User=centreon</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Install]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">WantedBy=centreon.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="service-snmptrapd">Service snmptrapd<a href="#service-snmptrapd" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /usr/lib/systemd/system/snmptrapd.service </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">&quot;EOF&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Description=Simple Network Management Protocol (SNMP) Trap Daemon.</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">PartOf=centreon.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">After=centreontrapd.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Service]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Type=notify</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Environment=OPTIONS=&quot;-Lsd&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EnvironmentFile=-/etc/sysconfig/snmptrapd</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ExecStart=/usr/sbin/snmptrapd $OPTIONS -f</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ExecReload=/bin/kill -HUP $MAINPID</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Install]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">WantedBy=centreon.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="lancement-initial-de-tous-les-services">Lancement initial de tous les services<a href="#lancement-initial-de-tous-les-services" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="installation-de-ladresse-ip-virtuelle-centreon">Installation de l&#x27;adresse IP virtuelle Centreon<a href="#installation-de-ladresse-ip-virtuelle-centreon" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h4><p>Normalement, la VIP a d√©j√† √©t√© mont√©e pr√©c√©demment. V√©rifiez que c&#x27;est le cas sur le serveur primaire d√©fini ci-dessus (normalement <code>@CENTRAL_MASTER_NAME@</code>)</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ip</span><span class="token plain"> a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Vous devriez voir l&#x27;IP virtuelle <code>@CENTRAL_VIP_IPADDR@</code> attach√©e √† l&#x27;interface <code>@CENTRAL_VIP_IFNAME@</code> appara√Ætre dans le retour de la commande <code>ip a</code>.</p><p>Si ce n&#x27;est pas le cas, l&#x27;adresse IP virtuelle doit √™tre mont√©e, par exemple sur <code>@CENTRAL_MASTER_NAME@</code> :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nmcli con mod </span><span class="token string" style="color:#e3116c">&quot;@CENTRAL_VIP_IFNAME@&quot;</span><span class="token plain"> +ipv4.addresses </span><span class="token string" style="color:#e3116c">&quot;@CENTRAL_VIP_IPADDR@/@CENTRAL_VIP_CIDR_NETMASK@&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmcli con up </span><span class="token string" style="color:#e3116c">&quot;@CENTRAL_VIP_IFNAME@&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="prise-en-compte-des-modifications-apport√©es-aux-services">Prise en compte des modifications apport√©es aux services<a href="#prise-en-compte-des-modifications-apport√©es-aux-services" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h4><p>Afin de prendre en compte toutes les modifications pr√©c√©dentes, et d&#x27;activer les services (pour que le d√©marrage du service <code>centreon.service</code> les lance tous) il est n√©cessaire de lancer ces commandes sur les deux noeuds centraux :</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Alma / RHEL / Oracle Linux 8</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl daemon-reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl </span><span class="token builtin class-name">enable</span><span class="token plain"> cbd httpd gorgoned centreon-central-sync cbd-sql centengine centreontrapd snmptrapd mariadb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p>Et enfin les d√©marrer tous via le <code>centreon.service</code> sur le noeud o√π la VIP a √©t√© mont√©e :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl start centreon</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>V√©rifiez ensuite l&#x27;√©tat de tous les services :</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Alma / RHEL / Oracle Linux 8</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl status cbd httpd gorgoned centreon-central-sync cbd-sql centengine centreontrapd snmptrapd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p>Apr√®s cette √©tape, toutes les ressources doivent √™tre actives au m√™me endroit, et la plateforme doit √™tre fonctionnelle et redondante. Si ce n&#x27;est pas le cas, consultez le guide de d√©pannage dans le paragraphe suivant.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="op√©ration-ha-manuelle-standard">Op√©ration HA manuelle standard<a href="#op√©ration-ha-manuelle-standard" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="basculer-les-services-centreon-dun-n≈ìud-√†-lautre">Basculer les services Centreon d&#x27;un n≈ìud √† l&#x27;autre<a href="#basculer-les-services-centreon-dun-n≈ìud-√†-lautre" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><p>Ce script peut √™tre ex√©cut√© depuis n&#x27;importe quel n≈ìud Centreon, mais vous devez (pour l&#x27;instant) sp√©cifier le n≈ìud cible. Par exemple pour changer le noeud actif de <code>@CENTRAL_MASTER_NAME@</code> √† <code>@CENTRAL_SLAVE_NAME@</code> :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/share/centreon-ha/bin/set-centreon-master.sh @CENTRAL_SLAVE_NAME@</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Le r√©sultat attendu est le suivant :</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Stopping centreon.service on @CENTRAL_MASTER_NAME@...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Unmounting VIP on @CENTRAL_MASTER_NAME@...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Adding vip to @CENTRAL_SLAVE_NAME@...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting centreon.service on @CENTRAL_SLAVE_NAME@...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Si nous essayons de passer au n≈ìud qui est d√©j√† actif, nous obtiendrons :</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Host @CENTRAL_MASTER_NAME@ is already the current master :-)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="inverser-les-r√¥les-slavemaster-de-mysql">Inverser les r√¥les SLAVE/MASTER de MySQL<a href="#inverser-les-r√¥les-slavemaster-de-mysql" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><p>Cette fois, nous ne sp√©cifions pas le nom du serveur cible :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/share/centreon-ha/bin/mysql-switch-slave-master.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Le r√©sultat attendu est le suivant :</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Locking master database on @DB_SLAVE_NAME@</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Waiting Relay log bin to finish proceed (TIMEOUT = 60sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Removing slave thread on @DB_MASTER_NAME@</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Recording binlog file and position from @DB_MASTER_NAME@</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Unlocking databases on @DB_MASTER_NAME@</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Setting and starting slave thread on @DB_SLAVE_NAME@</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">We have to move the VIP address</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="v√©rification-de-la-synchronisation-des-bases-de-donn√©es">V√©rification de la synchronisation des bases de donn√©es<a href="#v√©rification-de-la-synchronisation-des-bases-de-donn√©es" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h3><p>L&#x27;√©tat de la r√©plication MySQL peut √™tre v√©rifi√© √† tout moment avec la commande <code>mysql-check-status.sh</code> :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/share/centreon-ha/bin/mysql-check-status.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>R√©sultat attendu :</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Connection Status </span><span class="token string" style="color:#e3116c">&#x27;@CENTRAL_MASTER_NAME@&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">OK</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection Status </span><span class="token string" style="color:#e3116c">&#x27;@CENTRAL_SLAVE_NAME@&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">OK</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Slave Thread Status </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">OK</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Position Status </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">OK</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="int√©grer-des-collecteurs">Int√©grer des collecteurs<a href="#int√©grer-des-collecteurs" class="hash-link" aria-label="Lien direct vers le titre" title="Lien direct vers le titre">‚Äã</a></h2><p>Il ne reste maintenant plus qu&#x27;√† <a href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/installation/installation-of-centreon-ha-manual/integrating-pollers/">int√©grer les collecteurs</a> et commencer √† superviser !</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/centreon/centreon-documentation/edit/staging/i18n/fr/docusaurus-plugin-content-docs/version-23.10/installation/installation-of-centreon-ha-manual/installation-2-nodes.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>√âditer cette page</a></div><div class="col"><svg id="feedback" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 24 24" xml:space="preserve" fill="none" style="height:24px;width:24px;vertical-align:text-top;margin-right:4px"><rect y="0" class="st0" width="24" height="24"></rect><rect x="2" y="2" class="st0" width="20" height="20"></rect><path fill="none" stroke="currentColor" stroke-miterlimit="10" d="M16.14,9.08c0,3.09-2.76,5.6-6.16,5.6c-1.11,0-5.45,0-5.45,0s1.36-1.38,0.93-1.79c-1.02-1-1.64-2.34-1.64-3.81 c0-3.09,2.76-5.6,6.16-5.6S16.14,5.99,16.14,9.08z"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" d="M8.61,16.28c0.76,2.31,3.12,4,5.91,4c1.11,0,5.45,0,5.45,0s-1.36-1.38-0.93-1.79c1.02-1,1.64-2.34,1.64-3.81 c0-2-1.15-3.75-2.88-4.74"></path><line fill="none" stroke="currentColor" stroke-linecap="round" x1="6.78" y1="6.86" x2="13.55" y2="6.86"></line><line fill="none" stroke="currentColor" stroke-linecap="round" x1="6.78" y1="8.74" x2="13.55" y2="8.74"></line><line fill="none" stroke="currentColor" stroke-linecap="round" x1="6.78" y1="10.62" x2="13.55" y2="10.62"></line></svg><a rel="noreferrer noopener" href="https://docs.google.com/forms/d/e/1FAIpQLSdeKkEHWbxn4ZweR1M4OEMzP_QoqKmjl6t4iC_yKeX2CFjzAw/viewform?usp=pp_url&amp;entry.371845164=docs.centreon.com/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/installation/installation-of-centreon-ha-manual/centreon-ha-2-nodes-installation-manual-failover/" target="_blank">Envoyer du feedback sur cette page</a></div><div class="col lastUpdated_VsjB"><span class="theme-last-updated">Derni√®re mise √† jour<!-- --> le <b><time datetime="2023-11-13T17:43:56.000Z">13 nov. 2023</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Pagination des documents"><a class="pagination-nav__link pagination-nav__link--prev" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/installation/installation-of-centreon-ha/integrating-pollers/"><div class="pagination-nav__sublabel">Pr√©c√©dent</div><div class="pagination-nav__label">Int√©grer des pollers dans un cluster Centreon-HA</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/centreon-documentation/pr-preview/staging/pr-2756/fr/docs/installation/installation-of-centreon-ha-manual/centreon-ha-4-nodes-installation-manual-failover/"><div class="pagination-nav__sublabel">Suivant</div><div class="pagination-nav__label">Installation de Centreon-HA 4 n≈ìuds √† basculement manuel</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#conditions-pr√©alables" class="table-of-contents__link toc-highlight">Conditions pr√©alables</a><ul><li><a href="#compr√©hension" class="table-of-contents__link toc-highlight">Compr√©hension</a></li><li><a href="#installation-de-centreon" class="table-of-contents__link toc-highlight">Installation de Centreon</a></li><li><a href="#d√©finition-des-noms-et-adresses-ip-des-serveurs" class="table-of-contents__link toc-highlight">D√©finition des noms et adresses IP des serveurs</a></li><li><a href="#configuration-de-centreon-broker" class="table-of-contents__link toc-highlight">Configuration de Centreon-broker</a></li><li><a href="#modification-de-la-commande-cbd-reload" class="table-of-contents__link toc-highlight">Modification de la commande <code>cbd</code> reload</a></li><li><a href="#synchronisation-des-fichiers-de-configuration-de-centreon-php-perl-gorgone" class="table-of-contents__link toc-highlight">Synchronisation des fichiers de configuration de Centreon (PHP, Perl, Gorgone)</a></li></ul></li><li><a href="#pr√©paration-du-syst√®me" class="table-of-contents__link toc-highlight">Pr√©paration du syst√®me</a><ul><li><a href="#r√©glage-de-la-configuration-du-r√©seau" class="table-of-contents__link toc-highlight">R√©glage de la configuration du r√©seau</a></li><li><a href="#r√©solution-de-noms" class="table-of-contents__link toc-highlight">R√©solution de noms</a></li><li><a href="#installation-des-paquets" class="table-of-contents__link toc-highlight">Installation des paquets</a></li><li><a href="#√©change-de-cl√©s-ssh" class="table-of-contents__link toc-highlight">√âchange de cl√©s SSH</a></li></ul></li><li><a href="#configuration-de-la-r√©plication-mysql" class="table-of-contents__link toc-highlight">Configuration de la r√©plication MySQL</a><ul><li><a href="#configuration-de-mysql" class="table-of-contents__link toc-highlight">Configuration de MySQL</a></li><li><a href="#s√©curisation-de-la-base-de-donn√©es" class="table-of-contents__link toc-highlight">S√©curisation de la base de donn√©es</a></li><li><a href="#cr√©ation-du-compte-centreon" class="table-of-contents__link toc-highlight">Cr√©ation du compte centreon</a></li><li><a href="#cr√©ation-du-compte-de-r√©plication" class="table-of-contents__link toc-highlight">Cr√©ation du compte de r√©plication</a></li><li><a href="#configuration-des-variables-denvironnement-pour-les-scripts-mysql" class="table-of-contents__link toc-highlight">Configuration des variables d&#39;environnement pour les scripts MySQL</a></li><li><a href="#passage-en-mode-lecture-seule" class="table-of-contents__link toc-highlight">Passage en mode lecture seule</a></li><li><a href="#autorisation-des-comptes-centreon-et-mysql" class="table-of-contents__link toc-highlight">Autorisation des comptes centreon et mysql</a></li><li><a href="#synchronisation-des-bases-de-donn√©es-et-d√©marrage-de-la-r√©plication-mysql" class="table-of-contents__link toc-highlight">Synchronisation des bases de donn√©es et d√©marrage de la r√©plication MySQL</a></li><li><a href="#cr√©ation-du-vip-mysql" class="table-of-contents__link toc-highlight">Cr√©ation du VIP MySQL</a></li></ul></li><li><a href="#configuration-du-cluster-centreon" class="table-of-contents__link toc-highlight">Configuration du cluster Centreon</a><ul><li><a href="#configuration-du-service-de-synchronisation" class="table-of-contents__link toc-highlight">Configuration du service de synchronisation</a></li></ul></li><li><a href="#suppression-des-crons" class="table-of-contents__link toc-highlight">Suppression des crons</a></li><li><a href="#changement-de-droits" class="table-of-contents__link toc-highlight">Changement de droits</a><ul><li><a href="#arr√™ter-et-d√©sactiver-les-services" class="table-of-contents__link toc-highlight">Arr√™ter et d√©sactiver les services</a></li><li><a href="#red√©finir-les-r√®gles-de-d√©marrage-des-services" class="table-of-contents__link toc-highlight">Red√©finir les r√®gles de d√©marrage des services</a></li><li><a href="#lancement-initial-de-tous-les-services" class="table-of-contents__link toc-highlight">Lancement initial de tous les services</a></li><li><a href="#op√©ration-ha-manuelle-standard" class="table-of-contents__link toc-highlight">Op√©ration HA manuelle standard</a></li><li><a href="#basculer-les-services-centreon-dun-n≈ìud-√†-lautre" class="table-of-contents__link toc-highlight">Basculer les services Centreon d&#39;un n≈ìud √† l&#39;autre</a></li><li><a href="#inverser-les-r√¥les-slavemaster-de-mysql" class="table-of-contents__link toc-highlight">Inverser les r√¥les SLAVE/MASTER de MySQL</a></li><li><a href="#v√©rification-de-la-synchronisation-des-bases-de-donn√©es" class="table-of-contents__link toc-highlight">V√©rification de la synchronisation des bases de donn√©es</a></li></ul></li><li><a href="#int√©grer-des-collecteurs" class="table-of-contents__link toc-highlight">Int√©grer des collecteurs</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.centreon.com/en/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Site Corporate<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.centreon.com/en/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://download.centreon.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Download<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/centreon-documentation/pr-preview/staging/pr-2756/fr/img/logo_centreon.png" alt="Centreon Open Source Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/centreon-documentation/pr-preview/staging/pr-2756/fr/img/logo_centreon.png" alt="Centreon Open Source Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></div><div class="footer__copyright">Copyright ¬© 2005 - 2023 Centreon</div></div></div></footer></div>
<script src="/centreon-documentation/pr-preview/staging/pr-2756/fr/assets/js/runtime~main.12139a5c.js"></script>
<script src="/centreon-documentation/pr-preview/staging/pr-2756/fr/assets/js/main.42ea2a6f.js"></script>
</body>
</html>