"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[91718],{80590:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>m,contentTitle:()=>c,default:()=>g,frontMatter:()=>p,metadata:()=>u,toc:()=>d});n(67294);var r=n(3905),a=n(51715),o=n(7626);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const p={id:"virtualization-vmware2-vcenter-5",title:"VMware vCenter v5"},c=void 0,u={unversionedId:"integrations/plugin-packs/procedures/virtualization-vmware2-vcenter-5",id:"integrations/plugin-packs/procedures/virtualization-vmware2-vcenter-5",title:"VMware vCenter v5",description:"Overview",source:"@site/pp/integrations/plugin-packs/procedures/virtualization-vmware2-vcenter-5.md",sourceDirName:"integrations/plugin-packs/procedures",slug:"/integrations/plugin-packs/procedures/virtualization-vmware2-vcenter-5",permalink:"/centreon-documentation/pr-preview/staging/pr-2756/pp/integrations/plugin-packs/procedures/virtualization-vmware2-vcenter-5",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/pp/integrations/plugin-packs/procedures/virtualization-vmware2-vcenter-5.md",tags:[],version:"current",frontMatter:{id:"virtualization-vmware2-vcenter-5",title:"VMware vCenter v5"},sidebar:"pp",previous:{title:"VMware vCenter v4",permalink:"/centreon-documentation/pr-preview/staging/pr-2756/pp/integrations/plugin-packs/procedures/virtualization-vmware2-vcenter-4"},next:{title:"VMware vCenter v6",permalink:"/centreon-documentation/pr-preview/staging/pr-2756/pp/integrations/plugin-packs/procedures/virtualization-vmware2-vcenter-6"}},m={},d=[{value:"Overview",id:"overview",level:2},{value:"Monitoring Connector Assets",id:"monitoring-connector-assets",level:2},{value:"Monitored Objects",id:"monitored-objects",level:3},{value:"Collected Metrics",id:"collected-metrics",level:3},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Centreon VMWare Connector",id:"centreon-vmware-connector",level:3},{value:"Network flows",id:"network-flows",level:3},{value:"Installation",id:"installation",level:2},{value:"Configuration",id:"configuration",level:2},{value:"FAQ",id:"faq",level:2},{value:"How do I run my plugin through the CLI and what do the main parameters stand for ?",id:"how-do-i-run-my-plugin-through-the-cli-and-what-do-the-main-parameters-stand-for-",level:3},{value:"Why do I get the following error:",id:"why-do-i-get-the-following-error",level:3},{value:"UNKNOWN: Unknown container name &#39;default&#39; |",id:"unknown-unknown-container-name-default-",level:4},{value:"UNKNOWN: Cannot get response (timeout received)",id:"unknown-cannot-get-response-timeout-received",level:4},{value:"UNKNOWN: Container connection problem |",id:"unknown-container-connection-problem-",level:4}],k={toc:d},h="wrapper";function g(e){var{components:t}=e,n=s(e,["components"]);return(0,r.kt)(h,i(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){l(e,t,n[t])}))}return e}({},k,n),{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"overview"},"Overview"),(0,r.kt)("p",null,"VMware is an software compagny based in USA. VMware provides cloud computing and virtualization software and services."),(0,r.kt)("p",null,"The Centreon Plugin and Monitoring Connectors rely on the Centreon VMWare Connector to request the VCenter SDK."),(0,r.kt)("h2",{id:"monitoring-connector-assets"},"Monitoring Connector Assets"),(0,r.kt)("h3",{id:"monitored-objects"},"Monitored Objects"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Snapshots"),(0,r.kt)("li",{parentName:"ul"},"VM-tools")),(0,r.kt)("h3",{id:"collected-metrics"},"Collected Metrics"),(0,r.kt)("p",null,'This pack uses "VMware vCenter" pack to extend monitored indicators (virtualization-vmware2-vcenter-generic).'),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"Vm-Snapshot-Global",label:"Vm-Snapshot-Global",mdxType:"TabItem"},(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Metric name"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Unit"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"num_warning"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Number of snapshots older than 3 days (default treshold)"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Count")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"num_critical"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Number of snapshots older than 5 days (default threshold)"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Count"))))),(0,r.kt)(o.Z,{value:"Vm-Tools-Global",label:"Vm-Tools-Global",mdxType:"TabItem"},(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Metric name"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Unit"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"not_updated"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Number of VMs with VM-Tools not updated (default threshold)"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Count")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"not_running"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Number of VMs with VM-Tools not running (default threshold)"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Count")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"not_installed"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Number of VMs with VM-Tools not installed (default threshold)"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Count")))))),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("h3",{id:"centreon-vmware-connector"},"Centreon VMWare Connector"),(0,r.kt)("p",null,"For the VMWare monitoring, Centreon use daemon to connect and request the Vcenter."),(0,r.kt)("p",null,"Install this daemon on each needed poller:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"yum install centreon-plugin-Virtualization-VMWare-daemon\n")),(0,r.kt)("p",null,'To configure the access to your infrastructure, edit the\n"/etc/centreon/centreon',"_",'vmware.pm" configuration file:'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-perl"},"%centreon_vmware_config = (\n    vsphere_server => {\n        default => {\n            url => 'https://<ip_hostname>/sdk',\n            username => '<username>',\n            password => '<password>'\n        }\n    }\n);\n\n1;\n")),(0,r.kt)("p",null,"Make sure to replace variables with needed information:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"ip","_","hostname"),": IP address or hostname of the vCenter or ESX (if standalone),"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"username"),': username with at least "read only" access to the vCenter or ESX (you can use domain user),'),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"password"),": password of the username.")),(0,r.kt)("p",null,"You can configure multiple vCenter or ESXi connections using this\nstructure:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-perl"},"%centreon_vmware_config = (\n    vsphere_server => {\n        'my_first_vcenter' => {\n            url => 'https://<ip_hostname>/sdk',\n            username => '<username>',\n            password => '<password>'\n        },\n        'my_other_vcenter' => {\n            url => 'https://<ip_hostname>/sdk',\n            username => '<DOMAIN>\\<username>',\n            password => '<password>'\n        },\n    },\n    port => 5700\n);\n\n1;\n")),(0,r.kt)("p",null,"Each entry is called a ",(0,r.kt)("strong",{parentName:"p"},"container"),"."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},'You can also define the "port" attribute to change listening port.')),(0,r.kt)("p",null,"Then start the daemon and make sure it is configured to start at server boot:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl start centreon_vmware\nsystemctl enable centreon_vmware\n")),(0,r.kt)("p",null,'Make sure that the daemon configuration works fine by looking for errors in\n"/var/log/centreon/centreon',"_",'vmware.log".'),(0,r.kt)("h3",{id:"network-flows"},"Network flows"),(0,r.kt)("p",null,"The Poller with the Centreon VMware Connector installed need to access in TCP/443 HTTPS to the Vcenter."),(0,r.kt)("p",null,"The Pollers that request the Centreon VMWare Connector host need to access in TCP/5700 to the Centreon VMWare Connector host."),(0,r.kt)("h2",{id:"installation"},"Installation"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"Online License",label:"Online License",mdxType:"TabItem"},(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Install the VMWare Connector Centreon Plugin on every poller expected to monitor VMWare infrastructures:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yum install centreon-plugin-Virtualization-Vmware2-Connector-Plugin\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Install the 'Vmware vCenter v5' Centreon Monitoring Connector on the ",(0,r.kt)("strong",{parentName:"li"},"Configuration > Monitoring Connectors Manager")," page "))),(0,r.kt)(o.Z,{value:"Offline License",label:"Offline License",mdxType:"TabItem"},(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Install the VMWare Connector Centreon Plugin on every poller expected to monitor the VMWare Infrastructures:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yum install centreon-plugin-Virtualization-Vmware2-Connector-Plugin\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Install the Centreon Monitoring Connector RPM: ")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yum install centreon-pack-virtualization-vmware2-vcenter-5.noarch\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Install the 'Vmware  vCenter v5' Centreon Monitoring Connector on the ",(0,r.kt)("strong",{parentName:"li"},"Configuration > Monitoring Connectors Manager")," page ")))),(0,r.kt)("h2",{id:"configuration"},"Configuration"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},'Log into Centreon and add a new Host through "Configuration > Hosts".'),(0,r.kt)("li",{parentName:"ul"},'Apply the relevant Host Template "Virt-VMWare2-VCenter-5-custom", and configure the mandatory Macros:')),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Mandatory"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Name"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"X"),(0,r.kt)("td",{parentName:"tr",align:"left"},"CENTREONVMWARECONTAINER"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Name of your container in the file centreon_vmware.pm")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"X"),(0,r.kt)("td",{parentName:"tr",align:"left"},"CENTREONVMWAREHOST"),(0,r.kt)("td",{parentName:"tr",align:"left"},"The Centreon server that launches the connection")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},"X"),(0,r.kt)("td",{parentName:"tr",align:"left"},"CENTREONVMWAREPORT"),(0,r.kt)("td",{parentName:"tr",align:"left"},"By default: 5700")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"}),(0,r.kt)("td",{parentName:"tr",align:"left"},"CENTREONVMWAREEXTRAOPTIONS"),(0,r.kt)("td",{parentName:"tr",align:"left"},"Customize it with your own if needed")))),(0,r.kt)("h2",{id:"faq"},"FAQ"),(0,r.kt)("h3",{id:"how-do-i-run-my-plugin-through-the-cli-and-what-do-the-main-parameters-stand-for-"},"How do I run my plugin through the CLI and what do the main parameters stand for ?"),(0,r.kt)("p",null,"Once you've installed the plugin, you can test it logging with centreon-engine user:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/lib/centreon/plugins//centreon_vmware_connector_client.pl \\\n    --plugin=apps::vmware::connector::plugin \\\n    --mode=snapshot-vm \\\n    --custommode=connector \\\n    --connector-hostname='localhost' \\\n    --connector-port='5700' \\\n    --container='vcenter01' \\\n    --vm-hostname='.*' \\\n    --filter \\\n    --filter-uuid='' \\\n    --warning='259200' \\\n    --critical='432000' \\\n    --disconnect-status='ok' \\\n    --nopoweredon-skip \\\n    --check-consolidation \\\n    --verbose\n")),(0,r.kt)("p",null,"Expected command output is shown below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"CRITICAL: Snapshots for VM older than 432000 seconds: [TLS-LIN-001] | 'num_warning'=0;;;0; 'num_critical'=1;;;0;\n'TLS-LIN-001' snapshot create time: 2020-07-20T12:19:16.246902Z [only base os image]\n")),(0,r.kt)("p",null,"This command above checks the virtual machine snapshots (",(0,r.kt)("inlineCode",{parentName:"p"},"--plugin=apps::vmware::connector::plugin --mode=snapshot-vm"),").\nIt connects to the VMWare daemon on ",(0,r.kt)("strong",{parentName:"p"},"localhost")," (",(0,r.kt)("inlineCode",{parentName:"p"},"--connector-hostname='localhost'"),") on the port ",(0,r.kt)("strong",{parentName:"p"},"5700")," (",(0,r.kt)("inlineCode",{parentName:"p"},"--connector-port='5700'"),").\nThen the command requests the container ",(0,r.kt)("strong",{parentName:"p"},"vcenter01")," (",(0,r.kt)("inlineCode",{parentName:"p"},"--container='vcenter01'"),")."),(0,r.kt)("p",null,"It will trigger a WARNING alarm if the age of the snapshot is older than 3 days / 259200s (",(0,r.kt)("inlineCode",{parentName:"p"},"--warning='259200'"),")\nand a CRITICAL alarm if the snapshot is older than 5 days / 432000s (",(0,r.kt)("inlineCode",{parentName:"p"},"--critical='432000'"),")."),(0,r.kt)("p",null,"All available modes with the plugin can be displayed with: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/lib/centreon/plugins/./centreon_vmware_connector_client.pl \\\n    --plugin=apps::vmware::connector::plugin \\\n    --list-mode\n")),(0,r.kt)("p",null,"The available options for a mode can be displayed using the ",(0,r.kt)("inlineCode",{parentName:"p"},"--help")," parameter: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"/usr/lib/centreon/plugins/./centreon_vmware_connector_client.pl \\\n    --plugin=apps::vmware::connector::plugin \\\n    --mode=snapshot-vm  \\\n    --help\n")),(0,r.kt)("h3",{id:"why-do-i-get-the-following-error"},"Why do I get the following error:"),(0,r.kt)("h4",{id:"unknown-unknown-container-name-default-"},"UNKNOWN: Unknown container name 'default' |"),(0,r.kt)("p",null,"This error message means that the container invoked in the command doesn't exist in your VMWare connector configuration.\nCheck your macro ",(0,r.kt)("strong",{parentName:"p"},"CENTREONVMWARECONTAINER")," on your host or check the file ",(0,r.kt)("em",{parentName:"p"},"/etc/centreon/centreon_vmware.pm")),(0,r.kt)("h4",{id:"unknown-cannot-get-response-timeout-received"},"UNKNOWN: Cannot get response (timeout received)"),(0,r.kt)("p",null,"This error message means that the Plugin didn't get a response off the VMWare Daemon.\nCheck your connection parameters and the macros ",(0,r.kt)("strong",{parentName:"p"},"CENTREONVMWAREHOST")," and ",(0,r.kt)("strong",{parentName:"p"},"CENTREONVMWAREPORT"),"."),(0,r.kt)("h4",{id:"unknown-container-connection-problem-"},"UNKNOWN: Container connection problem |"),(0,r.kt)("p",null,"This error message means that you have a issue with the credentials provided for your Container.\nCheck your credentials in ",(0,r.kt)("em",{parentName:"p"},"/etc/centreon/centreon_vmware.pm"),".\nYou can also take a look into the log for more information: ",(0,r.kt)("em",{parentName:"p"},"/var/log/centreon/centreon_vmware.log")))}g.isMDXComponent=!0}}]);