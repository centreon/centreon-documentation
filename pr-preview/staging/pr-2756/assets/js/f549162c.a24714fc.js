"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[80386],{9406:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>p,metadata:()=>u,toc:()=>m});n(67294);var a=n(3905),r=n(51715),o=n(7626);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const p={id:"advanced-configuration",title:"Advanced configuration"},c=void 0,u={unversionedId:"graph-views/advanced-configuration",id:"version-23.10/graph-views/advanced-configuration",title:"Advanced configuration",description:"This chapter describes advanced procedures for configuring your Centreon MAP",source:"@site/versioned_docs/version-23.10/graph-views/advanced-configuration.md",sourceDirName:"graph-views",slug:"/graph-views/advanced-configuration",permalink:"/centreon-documentation/pr-preview/staging/pr-2756/docs/graph-views/advanced-configuration",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/staging/versioned_docs/version-23.10/graph-views/advanced-configuration.md",tags:[],version:"23.10",lastUpdatedAt:1699897436,formattedLastUpdatedAt:"Nov 13, 2023",frontMatter:{id:"advanced-configuration",title:"Advanced configuration"},sidebar:"version-23.10/docs",previous:{title:"Configure",permalink:"/centreon-documentation/pr-preview/staging/pr-2756/docs/graph-views/configuration"},next:{title:"Create a standard view",permalink:"/centreon-documentation/pr-preview/staging/pr-2756/docs/graph-views/create-standard-view"}},d={},m=[{value:"Monitoring your Centreon MAP server after installation",id:"monitoring-your-centreon-map-server-after-installation",level:2},{value:"Install the Packs",id:"install-the-packs",level:3},{value:"Install the Plugins",id:"install-the-plugins",level:3},{value:"Configure your services",id:"configure-your-services",level:3},{value:"Centreon MAP configuration files",id:"centreon-map-configuration-files",level:2},{value:"Backup of Centreon MAP server",id:"backup-of-centreon-map-server",level:2},{value:"Saved items",id:"saved-items",level:3},{value:"How it works?",id:"how-it-works",level:3},{value:"Backup parameters",id:"backup-parameters",level:3},{value:"Restore data from Centreon MAP server",id:"restore-data-from-centreon-map-server",level:3},{value:"Extracting backup",id:"extracting-backup",level:3},{value:"Restoring configuration files",id:"restoring-configuration-files",level:3},{value:"Restoring database",id:"restoring-database",level:3},{value:"Change Centreon MAP server port",id:"change-centreon-map-server-port",level:2},{value:"Define port below 1024",id:"define-port-below-1024",level:2}],k={toc:m},g="wrapper";function h(e){var{components:t}=e,p=s(e,["components"]);return(0,a.kt)(g,i(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){l(e,t,n[t])}))}return e}({},k,p),{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"This chapter describes advanced procedures for configuring your Centreon MAP\nsystem."),(0,a.kt)("h2",{id:"monitoring-your-centreon-map-server-after-installation"},"Monitoring your Centreon MAP server after installation"),(0,a.kt)("p",null,"Centreon provides a Monitoring Connector and a plugin to monitor your Centreon MAP\nserver."),(0,a.kt)("h3",{id:"install-the-packs"},"Install the Packs"),(0,a.kt)("p",null,"On the Central server, install the required Packs with the following commands:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"yum install centreon-pack-operatingsystems-linux-snmp centreon-pack-applications-jvm-actuator\n")),(0,a.kt)("p",null,"From the Monitoring Connectors Manager, install the Packs."),(0,a.kt)("h3",{id:"install-the-plugins"},"Install the Plugins"),(0,a.kt)("p",null,"Use SSH to access the Poller that will be monitoring your Centreon MAP server."),(0,a.kt)("p",null,"Install all the required plugins with the following commands:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"yum install centreon-plugin-Operatingsystems-Linux-Snmp centreon-plugin-Applications-Jvm-Actuator\n")),(0,a.kt)("h3",{id:"configure-your-services"},"Configure your services"),(0,a.kt)("p",null,"Access your Centreon Web interface. Go to ",(0,a.kt)("strong",{parentName:"p"},"Configuration > Host > Add"),"."),(0,a.kt)("p",null,"Fill in the basic information about your host and add the following host\ntemplates:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"OS-Linux-SNMP-custom"),(0,a.kt)("li",{parentName:"ul"},"App-Jvm-actuator-custom")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image",src:n(67222).Z,width:"919",height:"75"}),"\n",(0,a.kt)("img",{alt:"image",src:n(74154).Z,width:"475",height:"501"})),(0,a.kt)("p",null,"To monitor centreon-map JVM, please use following macro values:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:"left"},"Name"),(0,a.kt)("th",{parentName:"tr",align:"left"},"Value"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"ACTUATORCUSTOMMODE"),(0,a.kt)("td",{parentName:"tr",align:"left"},(0,a.kt)("inlineCode",{parentName:"td"},"centreonmap"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"ACTUATORAPIURLPATH"),(0,a.kt)("td",{parentName:"tr",align:"left"},(0,a.kt)("inlineCode",{parentName:"td"},"/centreon-studio/api/beta"))),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"ACTUATORAPIUSERNAME"),(0,a.kt)("td",{parentName:"tr",align:"left"},"Api username must be set")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"ACTUATORAPIPASSWORD"),(0,a.kt)("td",{parentName:"tr",align:"left"},"Api password must be set")))),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},'Remember to check the "Create Services linked to the Template too" checkbox.')),(0,a.kt)("p",null,"You can now export your configuration, and your Centreon MAP server will be\nmonitored."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"image",src:n(18885).Z,width:"1857",height:"560"})),(0,a.kt)("p",null,"You can also simply check by accessing the following URL, which tells you\nwhether or not the server is up:"),(0,a.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,a.kt)(o.Z,{value:"HTTP",label:"HTTP",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"http://<MAP_IP>:8080/centreon-studio/api/beta/actuator/health.\n"))),(0,a.kt)(o.Z,{value:"HTTPS",label:"HTTPS",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"https://<MAP_IP>:8443/centreon-studio/api/beta/actuator/health.\n")))),(0,a.kt)("h2",{id:"centreon-map-configuration-files"},"Centreon MAP configuration files"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"We advise you against editing the configuration files manually unless you are\nan experienced user.")),(0,a.kt)("p",null,"The four configuration files are located in ",(0,a.kt)("em",{parentName:"p"},"/etc/centreon-studio/"),". Their\ntemplates can be found in ",(0,a.kt)("em",{parentName:"p"},"/etc/centreon-studio/templates/"),"."),(0,a.kt)("p",null,"The configuration script replaces the macros in these templates and copies them\nto the folder /etc/centreon-studio."),(0,a.kt)("p",null,"If these files are modified, the server must be restarted with the command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl restart centreon-map\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Do not delete any variables in these files! This may cause the server to\nmalfunction or not to start up.")),(0,a.kt)("h2",{id:"backup-of-centreon-map-server"},"Backup of Centreon MAP server"),(0,a.kt)("h3",{id:"saved-items"},"Saved items"),(0,a.kt)("p",null,"The saved items are:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Saving configuration files (",(0,a.kt)("strong",{parentName:"li"},"/etc/centreon-studio"),")"),(0,a.kt)("li",{parentName:"ul"},"Saving database ",(0,a.kt)("strong",{parentName:"li"},"centreon","_","studio"))),(0,a.kt)("h3",{id:"how-it-works"},"How it works?"),(0,a.kt)("p",null,"The backup script is executed on a daily basis (2AM) with a cron job located in\n",(0,a.kt)("strong",{parentName:"p"},"/etc/cron.d/centreon-map-server-backup"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},'#\n# Cron to backup Centreon MAP server\n#\nPATH=/sbin:/bin:/usr/sbin:/usr/bin\n\n# rewrite file with new cron line\nCRONTAB_EXEC_USER=""\n\n0 2 * * * root bash /usr/share/centreon-map-server/bin/centreon-map-server-backup.sh >> /var/log/centreon-studio/backup.log 2>&1\n')),(0,a.kt)("p",null,"The backup ",(0,a.kt)("strong",{parentName:"p"},"centreon-map-server-yyyy-mm-dd.tar.gz")," is stored in\n",(0,a.kt)("strong",{parentName:"p"},"BACKUP","_","DIR"),", which is defined in the configuration file."),(0,a.kt)("h3",{id:"backup-parameters"},"Backup parameters"),(0,a.kt)("p",null,"The backup parameters are stored in ",(0,a.kt)("strong",{parentName:"p"},"/etc/centreon-studio/backup.conf")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"ENABLE: enable/disable backup mechanism (default value: 0)"),(0,a.kt)("li",{parentName:"ul"},"BACKUP","_","DIR: where the backup is stored (default value: /var/backup)"),(0,a.kt)("li",{parentName:"ul"},"RETENTION","_","AGE: backup retention in days (default value: 8)")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("strong",{parentName:"p"},"We recommend exporting backups to another resource in order to secure them."))),(0,a.kt)("h3",{id:"restore-data-from-centreon-map-server"},"Restore data from Centreon MAP server"),(0,a.kt)("p",null,"The restoration process is divided into several steps:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Extracting backup"),(0,a.kt)("li",{parentName:"ul"},"Restoring configuration files"),(0,a.kt)("li",{parentName:"ul"},"Restoring database")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("strong",{parentName:"p"},"We assume that you have followed the Centreon MAP server installation\nprocedure to obtain a fresh install."))),(0,a.kt)("h3",{id:"extracting-backup"},"Extracting backup"),(0,a.kt)("p",null,"Obtain the last ",(0,a.kt)("strong",{parentName:"p"},"centreon-map-server-yyyy-mm-dd.tar.gz")," backup and extract it\ninto the ",(0,a.kt)("strong",{parentName:"p"},"/tmp")," directory:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"cd /tmp\ntar xzf centreon-map-server-yyyy-mm-dd.tar.gz\n")),(0,a.kt)("h3",{id:"restoring-configuration-files"},"Restoring configuration files"),(0,a.kt)("p",null,"To restore configuration files, run the following command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"cp -R etc/centreon-studio/* /etc/centreon-studio/\n")),(0,a.kt)("h3",{id:"restoring-database"},"Restoring database"),(0,a.kt)("p",null,"To restore the ",(0,a.kt)("strong",{parentName:"p"},"centreon","_","studio")," database, run the following command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl stop centreon-map\nmysql -h <db_host> -u <db_user> -p<db_password> <db_name> < centreon-map-server.dump\nsystemctl start centreon-map\n")),(0,a.kt)("h2",{id:"change-centreon-map-server-port"},"Change Centreon MAP server port"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Mistakes when editing configuration files can lead to malfunctions of the software. We recommend that you make a backup of the file before editing it and that you only change the settings advised by Centreon.")),(0,a.kt)("p",null,"By default, the Centreon MAP server is listening and sending information\nthrough the port 8080. If you set the SSL (see ",(0,a.kt)("a",{parentName:"p",href:"/centreon-documentation/pr-preview/staging/pr-2756/docs/graph-views/secure-your-map-platform#configure-httpstls-on-the-web-server"},"HTTPS/TLS\nConfiguration"),",\nuse the port 8443."),(0,a.kt)("p",null,"You can change this port (e.g., if you have a firewall on your network\nblocking these ports)."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},'If the new port is below 1024, use the procedure below, "Define\nport below 1024", instead.')),(0,a.kt)("p",null,"On your Centreon MAP server, stop the Centreon MAP server:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl stop centreon-map\n")),(0,a.kt)("p",null,"Edit the studio-config.properties settings file located in\n/etc/centreon-studio:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"vi /etc/centreon-studio/studio-config.properties\n")),(0,a.kt)("p",null,"Add the following line at the MAP SERVER section"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-text"},"centreon-map.port=XXXX\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Replace ",(0,a.kt)("em",{parentName:"p"},"XXXX")," with the port you want.")),(0,a.kt)("p",null,"Then restart the Centreon MAP server:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl start centreon-map\n")),(0,a.kt)("p",null,"Wait for the Centreon MAP service to start completely (~30 sec to 1 minute)."),(0,a.kt)("p",null,"Test that your server is up and accessible on the new port you defined by\nentering the following URL in your web browser:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"http://<MAP_IP>:<NEW_PORT>/centreon-studio/api/beta/actuator/health\n")),(0,a.kt)("h2",{id:"define-port-below-1024"},"Define port below 1024"),(0,a.kt)("p",null,"You may want to set up your server to listen and send data through ports below\n1024, such as port 80 or 443 (as these ports are rarely blocked by a firewall)."),(0,a.kt)("p",null,"If you want to set a port below 1024, the method is different, since all ports\nunder 1024 are restricted and only accessible through special applications."),(0,a.kt)("p",null,'There are a few workarounds for this issue. One method is "port\nforwarding" through the firewall.'),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"For this example, set the MAP server to listen and send data through port 80.\nReplace each occurrence of ",(0,a.kt)("em",{parentName:"p"},"80")," with the port you want to use.")),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Check your firewall."),(0,a.kt)("p",{parentName:"li"},"On your MAP server, run the following command to check that the firewall is\nrunning:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl status iptables\n")),(0,a.kt)("p",{parentName:"li"},"If your firewall is running, you will see the following output:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"Table: raw\nChain PREROUTING (policy ACCEPT)\nnum  target     prot opt source               destination\n\nChain OUTPUT (policy ACCEPT)\nnum  target     prot opt source               destination\n\nTable: mangle\nChain PREROUTING (policy ACCEPT)\nnum  target     prot opt source               destination\n...\n...\n...\n")),(0,a.kt)("p",{parentName:"li"},"If your firewall is stopped, you will see the following output:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"iptables: Firewall is not running.\n")),(0,a.kt)("p",{parentName:"li"},"Start the firewall:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl start iptables\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Enable a connection on the port for MAP for listening and sending."),(0,a.kt)("p",{parentName:"li"},"Execute the following lines on your console:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"/sbin/iptables -A OUTPUT -p tcp --dport 80 -j ACCEPT\n/sbin/iptables -A INPUT -p tcp --dport 80 -j ACCEPT\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Add port forwarding."),(0,a.kt)("p",{parentName:"li"},"Execute the following line on your console:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 8080\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Restart and save."),(0,a.kt)("p",{parentName:"li"},"Restart your firewall:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl restart iptables\n")),(0,a.kt)("p",{parentName:"li"},"Save this configuration so it will be applied each time you reboot your server:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"/sbin/iptables save\n")))),(0,a.kt)("p",null,"Your Centreon MAP server is now accessible on port 80. Check this by entering\nthe following URL in your browser:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"http://<MAP_IP>/centreon-studio/api/beta/actuator/health\n")),(0,a.kt)("p",null,"You should see the server's state:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{"status":"UP"}\n')),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Remember to update both your desktop client configuration and your web\ninterface configuration.")))}h.isMDXComponent=!0},67222:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/jvm1-ed038bc688b8881df88356c9aef700e4.png"},74154:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/jvm2-41eeea49bfc2d425860aad786578aabd.png"},18885:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/jvm3-e29fa3aae58529ff88fa14fceb1fe0c0.png"}}]);