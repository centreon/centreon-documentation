"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[83646],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>d});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),p=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=p(e.components);return r.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),m=p(n),d=a,g=m["".concat(s,".").concat(d)]||m[d]||c[d]||o;return n?r.createElement(g,l(l({ref:t},u),{},{components:n})):r.createElement(g,l({ref:t},u))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,l=new Array(o);l[0]=m;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var p=2;p<o;p++)l[p]=n[p];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},7626:(e,t,n)=>{n.d(t,{Z:()=>i});var r=n(67294),a=n(86010);const o="tabItem_Ymn6";function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},l.apply(this,arguments)}function i({children:e,hidden:t,className:n}){return r.createElement("div",l({role:"tabpanel",className:(0,a.Z)(o,n)},{hidden:t}),e)}},67709:(e,t,n)=>{n.d(t,{Z:()=>d});var r=n(67294),a=n(86010),o=n(90980),l=n(35715),i=n(8854),s=n(8241);const p="tabList__CuJ",u="tabItem_LNqP";function c(){return c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},c.apply(this,arguments)}function m(e){var t;const{lazy:n,block:o,defaultValue:m,values:d,groupId:g,className:h}=e,k=r.Children.map(e.children,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),f=null!=d?d:k.map((({props:{value:e,label:t,attributes:n}})=>({value:e,label:t,attributes:n}))),b=(0,l.l)(f,((e,t)=>e.value===t.value));if(b.length>0)throw new Error(`Docusaurus error: Duplicate values "${b.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);var v;const N=null===m?m:null!==(v=null!=m?m:null===(t=k.find((e=>e.props.default)))||void 0===t?void 0:t.props.value)&&void 0!==v?v:k[0].props.value;if(null!==N&&!f.some((e=>e.value===N)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${N}" but none of its children has the corresponding value. Available values are: ${f.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:y,setTabGroupChoices:w}=(0,i.U)(),[E,O]=(0,r.useState)(N),C=[],{blockElementScrollPositionUntilNextRender:P}=(0,s.o5)();if(null!=g){const e=y[g];null!=e&&e!==E&&f.some((t=>t.value===e))&&O(e)}const _=e=>{const t=e.currentTarget,n=C.indexOf(t),r=f[n].value;r!==E&&(P(t),O(r),null!=g&&w(g,String(r)))},T=e=>{let t=null;switch(e.key){case"ArrowRight":{const r=C.indexOf(e.currentTarget)+1;var n;t=null!==(n=C[r])&&void 0!==n?n:C[0];break}case"ArrowLeft":{const n=C.indexOf(e.currentTarget)-1;var r;t=null!==(r=C[n])&&void 0!==r?r:C[C.length-1];break}}null==t||t.focus()};return r.createElement("div",{className:(0,a.Z)("tabs-container",p)},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.Z)("tabs",{"tabs--block":o},h)},f.map((({value:e,label:t,attributes:n})=>r.createElement("li",c({role:"tab",tabIndex:E===e?0:-1,"aria-selected":E===e,key:e,ref:e=>C.push(e),onKeyDown:T,onFocus:_,onClick:_},n,{className:(0,a.Z)("tabs__item",u,null==n?void 0:n.className,{"tabs__item--active":E===e})}),null!=t?t:e)))),n?(0,r.cloneElement)(k.filter((e=>e.props.value===E))[0],{className:"margin-top--md"}):r.createElement("div",{className:"margin-top--md"},k.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==E})))))}function d(e){const t=(0,o.Z)();return r.createElement(m,c({key:String(t)},e))}},82949:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>p,default:()=>g,frontMatter:()=>s,metadata:()=>u,toc:()=>m});n(67294);var r=n(3905),a=n(67709),o=n(7626);function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},l.apply(this,arguments)}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const s={id:"migrate-from-3-4",title:"Migrate from a Centreon 3.4 platform"},p=void 0,u={unversionedId:"migrate/migrate-from-3-4",id:"version-23.10/migrate/migrate-from-3-4",title:"Migrate from a Centreon 3.4 platform",description:"Prerequisites",source:"@site/versioned_docs/version-23.10/migrate/migrate-from-3-4.md",sourceDirName:"migrate",slug:"/migrate/migrate-from-3-4",permalink:"/centreon-documentation/pr-preview/pr-2832/docs/migrate/migrate-from-3-4",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/next/versioned_docs/version-23.10/migrate/migrate-from-3-4.md",tags:[],version:"23.10",lastUpdatedAt:1700565273,formattedLastUpdatedAt:"Nov 21, 2023",frontMatter:{id:"migrate-from-3-4",title:"Migrate from a Centreon 3.4 platform"},sidebar:"version-23.10/docs",previous:{title:"Migrate from an EL-type OS to Debian 11",permalink:"/centreon-documentation/pr-preview/pr-2832/docs/migrate/migrate-from-el-to-debian"},next:{title:"Nagios Reader to Centreon CLAPI",permalink:"/centreon-documentation/pr-preview/pr-2832/docs/migrate/nagios-to-centreon"}},c={},m=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Migrate",id:"migrate",level:2},{value:"Install the new server",id:"install-the-new-server",level:3},{value:"Synchronize the data",id:"synchronize-the-data",level:3},{value:"Retrieve databases",id:"retrieve-databases",level:3},{value:"Synchronize the plugins",id:"synchronize-the-plugins",level:3},{value:"Upgrade Centreon",id:"upgrade-centreon",level:3},{value:"Upgrade the modules",id:"upgrade-the-modules",level:3}],d={toc:m};function g(e){var{components:t}=e,n=i(e,["components"]);return(0,r.kt)("wrapper",l({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",l({},{id:"prerequisites"}),"Prerequisites"),(0,r.kt)("p",null,"The following procedure only applies to migration from a Centreon 3.4 platform\ninstalled on a 64-bit GNU/Linux distribution other than Oracle Linux / RHEL 8.\nHere are the system requirements:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",l({parentName:"tr"},{align:null}),"Components"),(0,r.kt)("th",l({parentName:"tr"},{align:null}),"Version"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",l({parentName:"tr"},{align:null}),"Centreon Web"),(0,r.kt)("td",l({parentName:"tr"},{align:null}),"2.8.x")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",l({parentName:"tr"},{align:null}),"Centreon Broker"),(0,r.kt)("td",l({parentName:"tr"},{align:null}),"3.0.x")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",l({parentName:"tr"},{align:null}),"Centreon Engine"),(0,r.kt)("td",l({parentName:"tr"},{align:null}),"1.8.x")))),(0,r.kt)("h2",l({},{id:"migrate"}),"Migrate"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"If your Centreon platform includes a Centreon redundancy system, please\ncontact ",(0,r.kt)("a",l({parentName:"p"},{href:"https://support.centreon.com"}),"Centreon support"),".")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"If you try to migrate a platform using the ",(0,r.kt)("strong",{parentName:"p"},"Centreon Poller Display 1.6.x"),",\nplease refer to the following ",(0,r.kt)("a",l({parentName:"p"},{href:"/centreon-documentation/pr-preview/pr-2832/docs/migrate/poller-display-to-remote-server"}),"migration\nprocedure"),".")),(0,r.kt)("h3",l({},{id:"install-the-new-server"}),"Install the new server"),(0,r.kt)("p",null,"Perform the following actions:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"You will need to install a new Centreon Central server from\n",(0,r.kt)("a",l({parentName:"p"},{href:"/centreon-documentation/pr-preview/pr-2832/docs/installation/installation-of-a-central-server/using-packages"}),"packages"),", until you\ncomplete the installation process by connecting to the Centreon Web\ninterface.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Perform software and system updates:"))),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"dnf update\n"))),(0,r.kt)(o.Z,{value:"Alma / RHEL / Oracle Linux 9",label:"Alma / RHEL / Oracle Linux 9",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"dnf update\n"))),(0,r.kt)(o.Z,{value:"Debian 11",label:"Debian 11",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"apt update\n")))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"It is advisable to set the same password for the ",(0,r.kt)("em",{parentName:"p"},"centreon")," user during the web\ninstallation process.")),(0,r.kt)("h3",l({},{id:"synchronize-the-data"}),"Synchronize the data"),(0,r.kt)("p",null,"Connect to your old Centreon server and synchronize following directories:"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"rsync -avz /etc/centreon root@<IP_NEW_CENTREON>:/etc\nrsync -avz /etc/centreon-broker root@<IP_NEW_CENTREON>:/etc\nrsync -avz /var/log/centreon-engine/archives/ root@<IP_NEW_CENTREON>:/var/log/centreon-engine\nrsync -avz --exclude centcore/ --exclude log/ /var/lib/centreon root@<IP_NEW_CENTREON>:/var/lib\nrsync -avz /var/spool/centreon/.ssh root@<IP_NEW_CENTREON>:/var/spool/centreon\nrsync -avz /usr/share/centreon/www/img/media root@<IP_NEW_CENTREON>:/usr/share/centreon/www/img\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Replace ",(0,r.kt)("strong",{parentName:"p"},"<IP_NEW_CENTREON>")," by the IP or the new Centreon server.")),(0,r.kt)("h3",l({},{id:"retrieve-databases"}),"Retrieve databases"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Dump source databases:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"mysqldump -u root -p centreon > /tmp/centreon.sql\nmysqldump -u root -p centreon_storage > /tmp/centreon_storage.sql\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Stop source MariaDB servers:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"})," service mysqld stop\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Export the dumps to the new Centreon 23.04 database server (make sure you\nhave enough space for large databases dumps):"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"rsync -avz /tmp/centreon.sql root@<IP_NEW_CENTREON>:/tmp/\nrsync -avz /tmp/centreon_storage.sql root@<IP_NEW_CENTREON>:/tmp/\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"On the Centreon 23.04 database server, drop the original databases and\ncreate them again:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"mysql -u root -p\n")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",l({parentName:"pre"},{className:"language-SQL"}),"DROP DATABASE centreon;\nDROP DATABASE centreon_storage;\nCREATE DATABASE centreon;\nCREATE DATABASE centreon_storage;\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Import the previously transfered dumps:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"mysql -u root centreon -p </tmp/centreon.sql\nmysql -u root centreon_storage -p </tmp/centreon_storage.sql\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Upgrade the tables:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"mysql_upgrade\n")),(0,r.kt)("p",{parentName:"li"},"If your database is password-protected, enter:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"mysql_upgrade -u <database_admin_user> -p\n")),(0,r.kt)("p",{parentName:"li"},"Example: if your database_admin_user is ",(0,r.kt)("inlineCode",{parentName:"p"},"root"),", enter:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",l({parentName:"pre"},{}),"mysql_upgrade -u root -p\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Start the mariadb process on the new server:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"systemctl start mariadb\n")))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Replace ",(0,r.kt)("strong",{parentName:"p"},"<IP_NEW_CENTREON>")," by the IP or the new Centreon server.")),(0,r.kt)("h3",l({},{id:"synchronize-the-plugins"}),"Synchronize the plugins"),(0,r.kt)("p",null,"Synchronizing the monitoring plugins is more complex and depends on your\ninstallation. The main directories to synchronize are:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"/usr/lib/nagios/plugins/"),(0,r.kt)("li",{parentName:"ol"},"/usr/lib/centreon/plugins/")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"To run the plugins, you must first install the required dependencies.")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"If you still have distant Centreon Engine 1.8.1 Pollers that you want to\npostpone the upgrade to 23.04, be aware that Centreon Web 23.04 resource\n$USER1$ actually points to /usr/lib64/nagios/plugins"),(0,r.kt)("p",{parentName:"blockquote"},"On the 1.8.1 Pollers to mitigate the issue:"),(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"mv /usr/lib64/nagios/plugins/* /usr/lib/nagios/plugins/\nrmdir /usr/lib64/nagios/plugins/\nln -s -t /usr/lib64/nagios/ /usr/lib/nagios/plugins/\n")),(0,r.kt)("p",{parentName:"blockquote"},"You now have a symbolic link as:"),(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"$ ls -alt /usr/lib64/nagios/\nlrwxrwxrwx   1 root root      24  1 nov.  17:59 plugins -> /usr/lib/nagios/plugins/\n-rwxr-xr-x   1 root root 1711288  6 avril  2018 cbmod.so\n"))),(0,r.kt)("p",null,"You can now push poller configuration from Centreon 23.04 whether the distant\nPoller is Centreon Engine 23.04 or 1.8.1."),(0,r.kt)("h3",l({},{id:"upgrade-centreon"}),"Upgrade Centreon"),(0,r.kt)("p",null,"On the new server, force the update by moving the contents of the\n",(0,r.kt)("strong",{parentName:"p"},"/var/lib/centreon/installs/install-23.04.0-YYYYMMDD","_","HHMMSS")," directory to\nthe ",(0,r.kt)("strong",{parentName:"p"},"/usr/share/centreon/www/install")," directory:"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"cd /var/lib/centreon/installs/\nmv install-23.04.0-YYYYMMDD_HHMMSS/ /usr/share/centreon/www/install/\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"If you use the same IP address or same DNS name between old Centreon webserver\nand the new one, do a full cache cleanup of your browser to avoid JS issues")),(0,r.kt)("p",null,"Go to ",(0,r.kt)("inlineCode",{parentName:"p"},"http://<IP_NEW_CENTREON>/centreon")," URL and perform the upgrade."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"If you changed the ",(0,r.kt)("em",{parentName:"p"},"centreon")," password during the installation process you must\nfollow these steps:"),(0,r.kt)("ol",{parentName:"blockquote"},(0,r.kt)("li",{parentName:"ol"},"Edit the /etc/centreon/centreon.conf.php file,"),(0,r.kt)("li",{parentName:"ol"},"Edit the /etc/centreon/conf.pm file,"),(0,r.kt)("li",{parentName:"ol"},"Edit the Centreon Broker central configuration using Centreon web interface\nand change the password for the ",(0,r.kt)("strong",{parentName:"li"},"Perfdata generator")," and ",(0,r.kt)("strong",{parentName:"li"},"Broker SQL\ndatabase")," output,"),(0,r.kt)("li",{parentName:"ol"},"Edit the /etc/centreon/config.d/10-database.yaml file."))),(0,r.kt)("p",null,"If the IP of your Centreon server has changed, edit the configuration for all\nthe Centreon Broker modules of your Pollers and change the IP to connect to\nthe Centreon Central server (output IPv4). See the ",(0,r.kt)("a",l({parentName:"p"},{href:"/centreon-documentation/pr-preview/pr-2832/docs/monitoring/monitoring-servers/advanced-configuration#tcp-outputs"}),"Advanced\nconfiguration"),"\nchapter for more information."),(0,r.kt)("p",null,"Then ",(0,r.kt)("a",l({parentName:"p"},{href:"/centreon-documentation/pr-preview/pr-2832/docs/monitoring/monitoring-servers/deploying-a-configuration"}),"generate")," the\nconfiguration of all your pollers and export it."),(0,r.kt)("h3",l({},{id:"upgrade-the-modules"}),"Upgrade the modules"),(0,r.kt)("p",null,"Please refer to the documentation of each module to verify compatibility with\nCentreon 23.04 and perform the upgrade."))}g.isMDXComponent=!0}}]);