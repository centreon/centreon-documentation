"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[38969],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>m});var r=a(67294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function p(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=r.createContext({}),i=function(e){var t=r.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},u=function(e){var t=i(e.components);return r.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,s=e.parentName,u=p(e,["components","mdxType","originalType","parentName"]),d=i(a),m=n,h=d["".concat(s,".").concat(m)]||d[m]||c[m]||o;return a?r.createElement(h,l(l({ref:t},u),{},{components:a})):r.createElement(h,l({ref:t},u))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,l=new Array(o);l[0]=d;var p={};for(var s in t)hasOwnProperty.call(t,s)&&(p[s]=t[s]);p.originalType=e,p.mdxType="string"==typeof e?e:n,l[1]=p;for(var i=2;i<o;i++)l[i]=a[i];return r.createElement.apply(null,l)}return r.createElement.apply(null,a)}d.displayName="MDXCreateElement"},7626:(e,t,a)=>{a.d(t,{Z:()=>p});var r=a(67294),n=a(86010);const o="tabItem_Ymn6";function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},l.apply(this,arguments)}function p({children:e,hidden:t,className:a}){return r.createElement("div",l({role:"tabpanel",className:(0,n.Z)(o,a)},{hidden:t}),e)}},67709:(e,t,a)=>{a.d(t,{Z:()=>m});var r=a(67294),n=a(86010),o=a(90980),l=a(35715),p=a(8854),s=a(8241);const i="tabList__CuJ",u="tabItem_LNqP";function c(){return c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},c.apply(this,arguments)}function d(e){var t;const{lazy:a,block:o,defaultValue:d,values:m,groupId:h,className:g}=e,k=r.Children.map(e.children,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),f=null!=m?m:k.map((({props:{value:e,label:t,attributes:a}})=>({value:e,label:t,attributes:a}))),b=(0,l.l)(f,((e,t)=>e.value===t.value));if(b.length>0)throw new Error(`Docusaurus error: Duplicate values "${b.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);var v;const y=null===d?d:null!==(v=null!=d?d:null===(t=k.find((e=>e.props.default)))||void 0===t?void 0:t.props.value)&&void 0!==v?v:k[0].props.value;if(null!==y&&!f.some((e=>e.value===y)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${y}" but none of its children has the corresponding value. Available values are: ${f.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:N,setTabGroupChoices:w}=(0,p.U)(),[x,O]=(0,r.useState)(y),T=[],{blockElementScrollPositionUntilNextRender:D}=(0,s.o5)();if(null!=h){const e=N[h];null!=e&&e!==x&&f.some((t=>t.value===e))&&O(e)}const C=e=>{const t=e.currentTarget,a=T.indexOf(t),r=f[a].value;r!==x&&(D(t),O(r),null!=h&&w(h,String(r)))},M=e=>{let t=null;switch(e.key){case"ArrowRight":{const r=T.indexOf(e.currentTarget)+1;var a;t=null!==(a=T[r])&&void 0!==a?a:T[0];break}case"ArrowLeft":{const a=T.indexOf(e.currentTarget)-1;var r;t=null!==(r=T[a])&&void 0!==r?r:T[T.length-1];break}}null==t||t.focus()};return r.createElement("div",{className:(0,n.Z)("tabs-container",i)},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,n.Z)("tabs",{"tabs--block":o},g)},f.map((({value:e,label:t,attributes:a})=>r.createElement("li",c({role:"tab",tabIndex:x===e?0:-1,"aria-selected":x===e,key:e,ref:e=>T.push(e),onKeyDown:M,onFocus:C,onClick:C},a,{className:(0,n.Z)("tabs__item",u,null==a?void 0:a.className,{"tabs__item--active":x===e})}),null!=t?t:e)))),a?(0,r.cloneElement)(k.filter((e=>e.props.value===x))[0],{className:"margin-top--md"}):r.createElement("div",{className:"margin-top--md"},k.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==x})))))}function m(e){const t=(0,o.Z)();return r.createElement(d,c({key:String(t)},e))}},4118:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>s,metadata:()=>u,toc:()=>d});a(67294);var r=a(3905),n=a(67709),o=a(7626);function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},l.apply(this,arguments)}function p(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}const s={id:"upgrade-from-20-10",title:"Upgrade from Centreon 20.10"},i=void 0,u={unversionedId:"upgrade/upgrade-from-20-10",id:"version-23.10/upgrade/upgrade-from-20-10",title:"Upgrade from Centreon 20.10",description:"This chapter describes how to upgrade your Centreon platform from version 20.10",source:"@site/versioned_docs/version-23.10/upgrade/upgrade-from-20-10.md",sourceDirName:"upgrade",slug:"/upgrade/upgrade-from-20-10",permalink:"/centreon-documentation/pr-preview/pr-2832/docs/upgrade/upgrade-from-20-10",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/next/versioned_docs/version-23.10/upgrade/upgrade-from-20-10.md",tags:[],version:"23.10",lastUpdatedAt:1700565273,formattedLastUpdatedAt:"Nov 21, 2023",frontMatter:{id:"upgrade-from-20-10",title:"Upgrade from Centreon 20.10"},sidebar:"version-23.10/docs",previous:{title:"Upgrade from Centreon 21.04",permalink:"/centreon-documentation/pr-preview/pr-2832/docs/upgrade/upgrade-from-21-04"},next:{title:"Upgrading MariaDB",permalink:"/centreon-documentation/pr-preview/pr-2832/docs/upgrade/upgrade-mariadb"}},c={},d=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Perform a backup",id:"perform-a-backup",level:3},{value:"Update the RPM signing key",id:"update-the-rpm-signing-key",level:3},{value:"Upgrade the Centreon Central server",id:"upgrade-the-centreon-central-server",level:2},{value:"Install the new repositories",id:"install-the-new-repositories",level:3},{value:"Install the MariaDB repository",id:"install-the-mariadb-repository",level:3},{value:"Upgrade PHP",id:"upgrade-php",level:3},{value:"Upgrade the Centreon solution",id:"upgrade-the-centreon-solution",level:3},{value:"Update your customized Apache configuration",id:"update-your-customized-apache-configuration",level:3},{value:"Customized Apache configuration: enable text compression",id:"customized-apache-configuration-enable-text-compression",level:4},{value:"Upgrade the MariaDB server",id:"upgrade-the-mariadb-server",level:3},{value:"Update the Centreon repository",id:"update-the-centreon-repository",level:4},{value:"Upgrading MariaDB",id:"upgrading-mariadb",level:4},{value:"Enable MariaDB on startup",id:"enable-mariadb-on-startup",level:4},{value:"Finalizing the upgrade",id:"finalizing-the-upgrade",level:3},{value:"Post-upgrade actions",id:"post-upgrade-actions",level:3},{value:"Upgrade the Remote Servers",id:"upgrade-the-remote-servers",level:2},{value:"Upgrade the Pollers",id:"upgrade-the-pollers",level:2},{value:"Update the Centreon repository",id:"update-the-centreon-repository-1",level:3},{value:"Upgrade the Centreon solution",id:"upgrade-the-centreon-solution-1",level:3}],m={toc:d};function h(e){var{components:t}=e,s=p(e,["components"]);return(0,r.kt)("wrapper",l({},m,s,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This chapter describes how to upgrade your Centreon platform from version 20.10\nto version 23.04."),(0,r.kt)("p",null,"You cannot simply upgrade Centreon from a version earlier than 20.10 to version 23.04, as CentOS 7 is no longer supported: you need to ",(0,r.kt)("a",l({parentName:"p"},{href:"/centreon-documentation/pr-preview/pr-2832/docs/migrate/introduction"}),"migrate your platform to a supported OS"),"."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"When you upgrade your central server, make sure you also upgrade all your remote servers and your pollers. All servers in your architecture must have the same version of Centreon. In addition, all servers must use the same ",(0,r.kt)("a",l({parentName:"p"},{href:"/centreon-documentation/pr-preview/pr-2832/docs/developer/developer-broker-bbdo#switching-versions-of-bbdo"}),"version of the BBDO protocol"),".")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"If you want to migrate your Centreon server to Oracle Linux / RHEL 8 or 9\nyou need to follow the ",(0,r.kt)("a",l({parentName:"p"},{href:"/centreon-documentation/pr-preview/pr-2832/docs/migrate/migrate-from-el-to-el"}),"migration procedure"))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"To perform this procedure, your MariaDB version must be >= 10.3.22.\nIf not, please follow ",(0,r.kt)("a",l({parentName:"p"},{href:"/centreon-documentation/pr-preview/pr-2832/docs/upgrade/upgrade-mariadb"}),"this"),"\nprocedure in order to update MariaDB before you can continue with the upgrade\nfrom version 20.10 to version 21.04 as described by this document.")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Warning, following the correction of a problem relating to the database schema, it will be necessary to stop the\ninsertion of the data collected into the database during the update. These will be stored in temporary files and then\ninstalled at the end of the update process.")),(0,r.kt)("h2",l({},{id:"prerequisites"}),"Prerequisites"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"When you run a command, check its output. If you get an error message, stop the procedure and fix the issue.")),(0,r.kt)("h3",l({},{id:"perform-a-backup"}),"Perform a backup"),(0,r.kt)("p",null,"Be sure that you have fully backed up your environment for the following\nservers:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Central server"),(0,r.kt)("li",{parentName:"ul"},"Database server")),(0,r.kt)("h3",l({},{id:"update-the-rpm-signing-key"}),"Update the RPM signing key"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"For security reasons, the keys used to sign Centreon RPMs are rotated regularly. The last change occurred on October 14, 2021. When upgrading from an older version, you need to go through the ",(0,r.kt)("a",l({parentName:"p"},{href:"/centreon-documentation/pr-preview/pr-2832/docs/security/key-rotation#existing-installation"}),"key rotation procedure"),", to remove the old key and install the new one.")),(0,r.kt)("h2",l({},{id:"upgrade-the-centreon-central-server"}),"Upgrade the Centreon Central server"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Since 21.04, Centreon uses ",(0,r.kt)("strong",{parentName:"p"},"MariaDB 10.5"),"."),(0,r.kt)("p",{parentName:"blockquote"},"This upgrade process will only upgrade Centreon components first."),(0,r.kt)("p",{parentName:"blockquote"},"MariaDB will be upgraded afterwards.")),(0,r.kt)("h3",l({},{id:"install-the-new-repositories"}),"Install the new repositories"),(0,r.kt)(n.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Update your Centreon 20.10 to the latest minor version.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Remove the ",(0,r.kt)("strong",{parentName:"p"},"centreon.repo")," file:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"rm /etc/yum.repos.d/centreon.repo\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Install the new repository:"))),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"dnf config-manager --add-repo https://packages.centreon.com/rpm-standard/23.04/el8/centreon-23.04.repo\n")))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"If you have an ",(0,r.kt)("a",l({parentName:"p"},{href:"/centreon-documentation/pr-preview/pr-2832/docs/administration/licenses#types-of-licenses"}),"offline license"),", also remove the old Monitoring Connectors repository, then install the new one."),(0,r.kt)("p",{parentName:"blockquote"},"If you have a Business edition, do the same with the Business repository."),(0,r.kt)("p",{parentName:"blockquote"},"You can find the address of these repositories on the ",(0,r.kt)("a",l({parentName:"p"},{href:"https://support.centreon.com/hc/en-us/categories/10341239833105-Repositories"}),"support portal"),".")),(0,r.kt)("h3",l({},{id:"install-the-mariadb-repository"}),"Install the MariaDB repository"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"cd /tmp\ncurl -JO https://downloads.mariadb.com/MariaDB/mariadb_repo_setup\nbash ./mariadb_repo_setup\nsed -ri 's/1[0-1]\\.[0-9]+/10.5/' /etc/yum.repos.d/mariadb.repo\nrm -f ./mariadb_repo_setup\n")),(0,r.kt)("h3",l({},{id:"upgrade-php"}),"Upgrade PHP"),(0,r.kt)("p",null,"Centreon 23.04 uses PHP in version 8.1."),(0,r.kt)(n.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"RHEL 8",label:"RHEL 8",mdxType:"TabItem"},(0,r.kt)("p",null,"First, you need to install the ",(0,r.kt)("strong",{parentName:"p"},"remi")," repository:"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"dnf install -y dnf-plugins-core\ndnf install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm\ndnf install -y https://rpms.remirepo.net/enterprise/remi-release-8.rpm\nsudo subscription-manager repos --enable codeready-builder-for-rhel-8-x86_64-rpms\n")),(0,r.kt)("p",null,"Then, you need to change the PHP stream from version 7.3 to 8.1 by executing the following commands and answering ",(0,r.kt)("strong",{parentName:"p"},"y"),"\nto confirm:"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"dnf module reset php\n")),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"dnf module install php:remi-8.1\n"))),(0,r.kt)(o.Z,{value:"Alma / Oracle Linux 8",label:"Alma / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("p",null,"First, you need to install the ",(0,r.kt)("strong",{parentName:"p"},"remi")," repository:"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"dnf install -y dnf-plugins-core\ndnf install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm\ndnf install -y https://rpms.remirepo.net/enterprise/remi-release-8.rpm\n")),(0,r.kt)("p",null,"Then, you need to change the PHP stream from version 7.3 to 8.1 by executing the following commands and answering ",(0,r.kt)("strong",{parentName:"p"},"y"),"\nto confirm:"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"dnf module reset php\n")),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"dnf module install php:remi-8.1\n")))),(0,r.kt)("h3",l({},{id:"upgrade-the-centreon-solution"}),"Upgrade the Centreon solution"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Make sure all users are logged out from the Centreon web interface\nbefore starting the upgrade procedure.")),(0,r.kt)("p",null,"If you have installed Business extensions, update the Business repository to version 23.04.\nVisit the ",(0,r.kt)("a",l({parentName:"p"},{href:"https://support.centreon.com/hc/en-us/categories/10341239833105-Repositories"}),"support portal")," to get its address."),(0,r.kt)("p",null,"Stop the Centreon Broker process:"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"systemctl stop cbd\n")),(0,r.kt)("p",null,"Delete existing retention files:"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"rm /var/lib/centreon-broker/* -f\n")),(0,r.kt)("p",null,"Clean the cache:"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"dnf clean all --enablerepo=*\n")),(0,r.kt)("p",null,"Then upgrade all the components with the following command:"),(0,r.kt)(n.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"dnf update centreon\\* php-pecl-gnupg\n")))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Accept new GPG keys from the repositories as needed.")),(0,r.kt)(n.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("p",null,"Execute the following commands:"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"systemctl enable php-fpm\nsystemctl restart php-fpm\n")))),(0,r.kt)("h3",l({},{id:"update-your-customized-apache-configuration"}),"Update your customized Apache configuration"),(0,r.kt)("p",null,"This section only applies if you customized your Apache configuration."),(0,r.kt)(n.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"RHEL / Oracle Linux 8",label:"RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("p",null,"When upgrading your platform, the Apache configuration file is not upgraded automatically: the new configuration file brought by the rpm does not replace the old file. You must copy the changes manually to your customized configuration file."),(0,r.kt)("p",null,"Run a diff between the old and the new Apache configuration files:"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"diff -u /etc/httpd/conf.d/10-centreon.conf /etc/httpd/conf.d/10-centreon.conf.rpmnew\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"10-centreon.conf")," (post upgrade): this file contains the custom configuration. It does not contain anthing new brought by the upgrade."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"10-centreon.conf.rpmnew")," (post upgrade): this file is provided by the rpm; it does not contain any custom configuration.")),(0,r.kt)("p",null,"For each difference between the files, assess whether you should copy it from ",(0,r.kt)("strong",{parentName:"p"},"10-centreon.conf.rpmnew")," to ",(0,r.kt)("strong",{parentName:"p"},"10-centreon.conf"),"."),(0,r.kt)("p",null,"In particular, make sure your customized Apache configuration contains the following directive (with ",(0,r.kt)("strong",{parentName:"p"},"authentication"),")."),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{}),'<LocationMatch ^\\${base_uri}/?(authentication|api/(latest|beta|v[0-9]+|v[0-9]+\\.[0-9]+))/.*$>\n    ProxyPassMatch "fcgi://127.0.0.1:9042${install_dir}/api/index.php/$1"\n</LocationMatch>\n')),(0,r.kt)("p",null,"Check that Apache is configured properly by running the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"apachectl configtest\n")),(0,r.kt)("p",null,"The expected result is the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"Syntax OK\n")),(0,r.kt)("p",null,"Restart the Apache and PHP processes to take in account the new configuration:"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"systemctl restart php-fpm httpd\n")),(0,r.kt)("p",null,"Then check its status:"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"systemctl status httpd\n")),(0,r.kt)("p",null,"If everything is ok, you should have:"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),'\u25cf httpd.service - The Apache HTTP Server\n   Loaded: loaded (/usr/lib/systemd/system/httpd.service; enabled; vendor preset: disabled)\n  Drop-In: /usr/lib/systemd/system/httpd.service.d\n           \u2514\u2500php-fpm.conf\n   Active: active (running) since Tue 2020-10-27 12:49:42 GMT; 2h 35min ago\n     Docs: man:httpd.service(8)\n Main PID: 1483 (httpd)\n   Status: "Total requests: 446; Idle/Busy workers 100/0;Requests/sec: 0.0479; Bytes served/sec: 443 B/sec"\n    Tasks: 278 (limit: 5032)\n   Memory: 39.6M\n   CGroup: /system.slice/httpd.service\n           \u251c\u25001483 /usr/sbin/httpd -DFOREGROUND\n           \u251c\u25001484 /usr/sbin/httpd -DFOREGROUND\n           \u251c\u25001485 /usr/sbin/httpd -DFOREGROUND\n           \u251c\u25001486 /usr/sbin/httpd -DFOREGROUND\n           \u251c\u25001487 /usr/sbin/httpd -DFOREGROUND\n           \u2514\u25001887 /usr/sbin/httpd -DFOREGROUND\n')))),(0,r.kt)("h4",l({},{id:"customized-apache-configuration-enable-text-compression"}),"Customized Apache configuration: enable text compression"),(0,r.kt)("p",null,"In order to improve page loading speed, you can activate text compression on the Apache server. It requires the ",(0,r.kt)("strong",{parentName:"p"},"brotli")," package to work. This is optional but it provides a better user experience."),(0,r.kt)("p",null,"Add the following code to your Apache configuration file, in both the ",(0,r.kt)("inlineCode",{parentName:"p"},"<VirtualHost *:80>")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"<VirtualHost *:443>")," elements:"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"<IfModule mod_brotli.c>\n    AddOutputFilterByType BROTLI_COMPRESS text/html text/plain text/xml text/css text/javascript application/javascript application/json\n</IfModule>\nAddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json\n")),(0,r.kt)("h3",l({},{id:"upgrade-the-mariadb-server"}),"Upgrade the MariaDB server"),(0,r.kt)("p",null,"The MariaDB components can now be upgraded."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Refer to the official MariaDB documentation to know more about this process:"),(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("a",l({parentName:"p"},{href:"https://mariadb.com/kb/en/upgrading-between-major-mariadb-versions/"}),"https://mariadb.com/kb/en/upgrading-between-major-mariadb-versions/"))),(0,r.kt)("h4",l({},{id:"update-the-centreon-repository"}),"Update the Centreon repository"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"This step is required ONLY when your environment features an architecture with\na dedicated remote DBMS. If your environment features Centreon Central and\nMariaDB together on the same server, you SHOULD simply skip this step.")),(0,r.kt)("p",null,"Run the following command on the dedicated DBMS server:"),(0,r.kt)(n.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"dnf config-manager --add-repo https://packages.centreon.com/rpm-standard/23.04/el8/centreon-23.04.repo\n")))),(0,r.kt)("h4",l({},{id:"upgrading-mariadb"}),"Upgrading MariaDB"),(0,r.kt)("p",null,"You have to uninstall then reinstall MariaDB to upgrade between major versions (i.e. to switch from version 10.3 to version 10.5)."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Stop the mariadb service:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"systemctl stop mariadb\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Uninstall the current version:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"rpm --erase --nodeps --verbose MariaDB-server MariaDB-client MariaDB-shared MariaDB-compat MariaDB-common\n")),(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("p",{parentName:"blockquote"},"During this uninstallation step, you may encounter an error because one or several MariaDB packages are missing. In that case, you have to execute the uninstallation command without including the missing package.")),(0,r.kt)("p",{parentName:"li"},"  For instance, you get the following error message:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"package MariaDB-compat is not installed\n")),(0,r.kt)("p",{parentName:"li"},"  As ",(0,r.kt)("strong",{parentName:"p"},"MariaDB-compat")," is the missing package, please execute the same command without quoting ",(0,r.kt)("strong",{parentName:"p"},"MariaDB-compat"),":"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"rpm --erase --nodeps --verbose MariaDB-server MariaDB-client MariaDB-shared MariaDB-common\n")),(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("p",{parentName:"blockquote"},"Make sure you have ",(0,r.kt)("a",l({parentName:"p"},{href:"/centreon-documentation/pr-preview/pr-2832/docs/upgrade/upgrade-from-20-10#install-the-mariadb-repository"}),"installed the official MariaDB repository")," before you continue the procedure."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Install the 10.5 version:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"dnf install MariaDB-server-10.5\\* MariaDB-client-10.5\\* MariaDB-shared-10.5\\* MariaDB-common-10.5\\*\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Start the mariadb service:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"systemctl start mariadb\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Launch the MariaDB upgrade process:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"mysql_upgrade\n")),(0,r.kt)("p",{parentName:"li"},"If your database is password-protected, enter:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"mysql_upgrade -u <database_admin_user> -p\n")),(0,r.kt)("p",{parentName:"li"},"Example: if your database_admin_user is ",(0,r.kt)("inlineCode",{parentName:"p"},"root"),", enter:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",l({parentName:"pre"},{}),"mysql_upgrade -u root -p\n")),(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("p",{parentName:"blockquote"},"Refer to the ",(0,r.kt)("a",l({parentName:"p"},{href:"https://mariadb.com/kb/en/mysql_upgrade/"}),"official documentation"),"\nfor more information or if errors occur during this last step.")))),(0,r.kt)("h4",l({},{id:"enable-mariadb-on-startup"}),"Enable MariaDB on startup"),(0,r.kt)("p",null,"Execute the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"systemctl enable mariadb\n")),(0,r.kt)("h3",l({},{id:"finalizing-the-upgrade"}),"Finalizing the upgrade"),(0,r.kt)(n.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("p",null,"Before starting the web upgrade process, reload the Apache server with the\nfollowing command:"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"systemctl reload httpd\n")))),(0,r.kt)("p",null,"Then log on to the Centreon web interface to continue the upgrade process:"),(0,r.kt)("p",null,"Click on ",(0,r.kt)("strong",{parentName:"p"},"Next"),":"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image",src:a(81137).Z,width:"650",height:"300"})),(0,r.kt)("p",null,"Click on ",(0,r.kt)("strong",{parentName:"p"},"Next"),":"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image",src:a(79778).Z,width:"650",height:"300"})),(0,r.kt)("p",null,"The release notes describe the main changes. Click on ",(0,r.kt)("strong",{parentName:"p"},"Next"),":"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image",src:a(91003).Z,width:"650",height:"300"})),(0,r.kt)("p",null,"This process performs the various upgrades. Click on ",(0,r.kt)("strong",{parentName:"p"},"Next"),":"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image",src:a(36221).Z,width:"650",height:"300"})),(0,r.kt)("p",null,"Your Centreon server is now up to date. Click on ",(0,r.kt)("strong",{parentName:"p"},"Finish")," to access the login\npage:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image",src:a(41978).Z,width:"650",height:"300"})),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"As the interface layout has changed in version 23.04, you need to clear your browser cache to display the new theme.")),(0,r.kt)("p",null,"If the Centreon BAM module is installed, refer to the\n",(0,r.kt)("a",l({parentName:"p"},{href:"/centreon-documentation/pr-preview/pr-2832/docs/service-mapping/upgrade"}),"upgrade procedure"),"."),(0,r.kt)("h3",l({},{id:"post-upgrade-actions"}),"Post-upgrade actions"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Upgrade extensions. From ",(0,r.kt)("strong",{parentName:"p"},"Administration > Extensions > Manager"),", upgrade all extensions, starting\nwith the following:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"License Manager,")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Monitoring Connectors Manager,")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Auto Discovery."),(0,r.kt)("p",{parentName:"li"},"Then you can upgrade all other commercial extensions.")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",l({parentName:"p"},{href:"/centreon-documentation/pr-preview/pr-2832/docs/monitoring/monitoring-servers/deploying-a-configuration"}),"Deploy the configuration"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Restart the processes:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"systemctl restart cbd centengine centreontrapd gorgoned\n")))),(0,r.kt)("h2",l({},{id:"upgrade-the-remote-servers"}),"Upgrade the Remote Servers"),(0,r.kt)("p",null,"This procedure is the same as for upgrading a Centreon Central server."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"At the end of the update, configuration should be deployed from the Central server.")),(0,r.kt)("h2",l({},{id:"upgrade-the-pollers"}),"Upgrade the Pollers"),(0,r.kt)("h3",l({},{id:"update-the-centreon-repository-1"}),"Update the Centreon repository"),(0,r.kt)("p",null,"Run the following command:"),(0,r.kt)(n.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"dnf config-manager --add-repo https://packages.centreon.com/rpm-standard/23.04/el8/centreon-23.04.repo\n")))),(0,r.kt)("h3",l({},{id:"upgrade-the-centreon-solution-1"}),"Upgrade the Centreon solution"),(0,r.kt)("p",null,"Clean the cache:"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"dnf clean all --enablerepo=*\n")),(0,r.kt)("p",null,"Upgrade all the components with the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"dnf update centreon\\*\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Accept new GPG keys from the repositories as needed.")),(0,r.kt)("p",null,"Start and enable ",(0,r.kt)("strong",{parentName:"p"},"gorgoned"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"systemctl start gorgoned\nsystemctl enable gorgoned\n")),(0,r.kt)("p",null,"Restart ",(0,r.kt)("strong",{parentName:"p"},"centengine"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"systemctl restart centengine\n")))}h.isMDXComponent=!0},81137:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/web_update_1-229784d5ed7986045c49b65b99ce38cd.png"},79778:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/web_update_2-f12be23b17ba9e83853cbdbaaea65402.png"},91003:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/web_update_3-d505e49a3b4f60dfd887ff45ddbf006b.png"},36221:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/web_update_4-97901eb976096c68fb2bd9d37c4de9bc.png"},41978:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/web_update_5-01f8c54614c006d7c1bf9e03799c1b81.png"}}]);