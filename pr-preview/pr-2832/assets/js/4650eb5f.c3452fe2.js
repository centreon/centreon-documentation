"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[3296],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=u(n),m=a,h=d["".concat(s,".").concat(m)]||d[m]||p[m]||o;return n?r.createElement(h,l(l({ref:t},c),{},{components:n})):r.createElement(h,l({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,l=new Array(o);l[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var u=2;u<o;u++)l[u]=n[u];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},7626:(e,t,n)=>{n.d(t,{Z:()=>i});var r=n(67294),a=n(86010);const o="tabItem_Ymn6";function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},l.apply(this,arguments)}function i({children:e,hidden:t,className:n}){return r.createElement("div",l({role:"tabpanel",className:(0,a.Z)(o,n)},{hidden:t}),e)}},67709:(e,t,n)=>{n.d(t,{Z:()=>m});var r=n(67294),a=n(86010),o=n(90980),l=n(35715),i=n(8854),s=n(8241);const u="tabList__CuJ",c="tabItem_LNqP";function p(){return p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},p.apply(this,arguments)}function d(e){var t;const{lazy:n,block:o,defaultValue:d,values:m,groupId:h,className:g}=e,v=r.Children.map(e.children,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),f=null!=m?m:v.map((({props:{value:e,label:t,attributes:n}})=>({value:e,label:t,attributes:n}))),b=(0,l.l)(f,((e,t)=>e.value===t.value));if(b.length>0)throw new Error(`Docusaurus error: Duplicate values "${b.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);var k;const y=null===d?d:null!==(k=null!=d?d:null===(t=v.find((e=>e.props.default)))||void 0===t?void 0:t.props.value)&&void 0!==k?k:v[0].props.value;if(null!==y&&!f.some((e=>e.value===y)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${y}" but none of its children has the corresponding value. Available values are: ${f.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:w,setTabGroupChoices:N}=(0,i.U)(),[O,C]=(0,r.useState)(y),x=[],{blockElementScrollPositionUntilNextRender:E}=(0,s.o5)();if(null!=h){const e=w[h];null!=e&&e!==O&&f.some((t=>t.value===e))&&C(e)}const j=e=>{const t=e.currentTarget,n=x.indexOf(t),r=f[n].value;r!==O&&(E(t),C(r),null!=h&&N(h,String(r)))},T=e=>{let t=null;switch(e.key){case"ArrowRight":{const r=x.indexOf(e.currentTarget)+1;var n;t=null!==(n=x[r])&&void 0!==n?n:x[0];break}case"ArrowLeft":{const n=x.indexOf(e.currentTarget)-1;var r;t=null!==(r=x[n])&&void 0!==r?r:x[x.length-1];break}}null==t||t.focus()};return r.createElement("div",{className:(0,a.Z)("tabs-container",u)},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.Z)("tabs",{"tabs--block":o},g)},f.map((({value:e,label:t,attributes:n})=>r.createElement("li",p({role:"tab",tabIndex:O===e?0:-1,"aria-selected":O===e,key:e,ref:e=>x.push(e),onKeyDown:T,onFocus:j,onClick:j},n,{className:(0,a.Z)("tabs__item",c,null==n?void 0:n.className,{"tabs__item--active":O===e})}),null!=t?t:e)))),n?(0,r.cloneElement)(v.filter((e=>e.props.value===O))[0],{className:"margin-top--md"}):r.createElement("div",{className:"margin-top--md"},v.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==O})))))}function m(e){const t=(0,o.Z)();return r.createElement(d,p({key:String(t)},e))}},44190:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>u,default:()=>h,frontMatter:()=>s,metadata:()=>c,toc:()=>d});n(67294);var r=n(3905),a=n(67709),o=n(7626);function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},l.apply(this,arguments)}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const s={id:"update-centreon-ha",title:"Updating Centreon-HA platform"},u=void 0,c={unversionedId:"update/update-centreon-ha",id:"version-23.10/update/update-centreon-ha",title:"Updating Centreon-HA platform",description:"This procedure is intended to be used to perform minor updates of Centreon, when the Engine/Broker compatibility is assured between the old and the new version. No service downtime is necessary in this case, only a short outage of the Web UI login screen.",source:"@site/versioned_docs/version-23.10/update/update-centreon-ha.md",sourceDirName:"update",slug:"/update/update-centreon-ha",permalink:"/centreon-documentation/pr-preview/pr-2832/docs/update/update-centreon-ha",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/next/versioned_docs/version-23.10/update/update-centreon-ha.md",tags:[],version:"23.10",lastUpdatedAt:1700565273,formattedLastUpdatedAt:"Nov 21, 2023",frontMatter:{id:"update-centreon-ha",title:"Updating Centreon-HA platform"},sidebar:"version-23.10/docs",previous:{title:"Troubleshooting HA",permalink:"/centreon-documentation/pr-preview/pr-2832/docs/administration/centreon-ha/troubleshooting-guide"},next:{title:"Upgrade Centreon HA from Centreon 21.04",permalink:"/centreon-documentation/pr-preview/pr-2832/docs/upgrade/centreon-ha/upgrade-centreon-ha-from-21-04"}},p={},d=[{value:"Suspend cluster resources management",id:"suspend-cluster-resources-management",level:2},{value:"Update process from the WUI",id:"update-process-from-the-wui",level:2},{value:"Centreon-Web update",id:"centreon-web-update",level:3},{value:"Removing cron jobs",id:"removing-cron-jobs",level:3},{value:"Updating Centreon extensions",id:"updating-centreon-extensions",level:3},{value:"Updating the Monitoring Connectors",id:"updating-the-monitoring-connectors",level:3},{value:"Updating the pollers",id:"updating-the-pollers",level:3},{value:"Exporting Engine/Broker configuration",id:"exporting-enginebroker-configuration",level:3},{value:"Resuming the cluster resources management",id:"resuming-the-cluster-resources-management",level:2},{value:"Verifying the platform stability",id:"verifying-the-platform-stability",level:2}],m={toc:d};function h(e){var{components:t}=e,n=i(e,["components"]);return(0,r.kt)("wrapper",l({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This procedure is intended to be used to perform minor updates of Centreon, when the Engine/Broker compatibility is assured between the old and the new version. No service downtime is necessary in this case, only a short outage of the Web UI login screen."),(0,r.kt)("h2",l({},{id:"suspend-cluster-resources-management"}),"Suspend cluster resources management"),(0,r.kt)("p",null,"In order to avoid a failover of the cluster during the update, it is necessary to unmanage all Centreon resources, as well as MariaDB."),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-bash"}),"pcs resource unmanage centreon\npcs resource unmanage ms_mysql\n")),(0,r.kt)("h2",l({},{id:"update-process-from-the-wui"}),"Update process from the WUI"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Please, make sure all users logged out from the Centreon web interface\nbefore starting the upgrade procedure.")),(0,r.kt)("h3",l({},{id:"centreon-web-update"}),"Centreon-Web update"),(0,r.kt)("p",null,"Update your cluster by running the following command on each node:"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-bash"}),"dnf update\n")))),(0,r.kt)("p",null,"And then you should be able to finalize the update ",(0,r.kt)("em",{parentName:"p"},"via")," the web UI. You might have to log off your session or to refresh the login page to access the update process."),(0,r.kt)("p",null,'On the slave central node, just move the "install" dir to avoid getting the "update" screen in the WUI in the event of a further exchange of roles.'),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-bash"}),"mv /usr/share/centreon/www/install /var/lib/centreon/installs/install-update-YYYY-MM-DD\nsudo -u apache /usr/share/centreon/bin/console cache:clear\n")),(0,r.kt)("h3",l({},{id:"removing-cron-jobs"}),"Removing cron jobs"),(0,r.kt)("p",null,"The RPM upgrade puts cron job back in place. Remove them to avoid concurrent executions: "),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-bash"}),"rm /etc/cron.d/centreon\nrm /etc/cron.d/centstorage\nrm /etc/cron.d/centreon-auto-disco\n")),(0,r.kt)("h3",l({},{id:"updating-centreon-extensions"}),"Updating Centreon extensions"),(0,r.kt)("p",null,"The Centreon extensions are also to be updated ",(0,r.kt)("em",{parentName:"p"},"via"),' the WUI, from the "Administration > Extensions > Manager" menu by clicking the "Update all" button.'),(0,r.kt)("h3",l({},{id:"updating-the-monitoring-connectors"}),"Updating the Monitoring Connectors"),(0,r.kt)("p",null,"In order to maintain compatibility between the ",(0,r.kt)("a",l({parentName:"p"},{href:"/centreon-documentation/pr-preview/pr-2832/docs/monitoring/pluginpacks"}),"Monitoring Connectors")," and the installed plugins (that have just been updated by the ",(0,r.kt)("inlineCode",{parentName:"p"},"yum update")," command on the central server), the Monitoring Connectors must be updated in the WUI too from the ",(0,r.kt)("strong",{parentName:"p"},"Configuration > Monitoring Connectors Manager")," menu."),(0,r.kt)("h3",l({},{id:"updating-the-pollers"}),"Updating the pollers"),(0,r.kt)("p",null,"It is recommended to update the pollers as well, ",(0,r.kt)("strong",{parentName:"p"},"especially if ",(0,r.kt)("inlineCode",{parentName:"strong"},"centreon-engine")," and/or ",(0,r.kt)("inlineCode",{parentName:"strong"},"centreon-broker")," packages have been updated"),":"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-bash"}),"dnf update\n")))),(0,r.kt)("h3",l({},{id:"exporting-enginebroker-configuration"}),"Exporting Engine/Broker configuration"),(0,r.kt)("p",null,'Generate and export new Engine/Broker configuration files for all pollers (central included) in "Configuration -> Pollers" with these options checked:'),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Generate Configuration Files"),(0,r.kt)("li",{parentName:"ul"},"Run monitoring engine debug (-v)"),(0,r.kt)("li",{parentName:"ul"},"Move Export Files")),(0,r.kt)("p",null,"Then restart them ",(0,r.kt)("strong",{parentName:"p"},"one at a time")," from the same menu and make sure to select the ",(0,r.kt)("strong",{parentName:"p"},'"restart" method, not "reload"'),", if the ",(0,r.kt)("inlineCode",{parentName:"p"},"centreon-engine")," and/or ",(0,r.kt)("inlineCode",{parentName:"p"},"centreon-broker")," packages have been updated."),(0,r.kt)("p",null,"In addition, the ",(0,r.kt)("inlineCode",{parentName:"p"},"cbd-sql")," service must be restarted ",(0,r.kt)("strong",{parentName:"p"},"on the central master server"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-bash"}),"service cbd-sql restart\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"cbd")," service must also be restarted on ",(0,r.kt)("a",l({parentName:"p"},{href:"/centreon-documentation/pr-preview/pr-2832/docs/installation/architectures#description"}),"Centreon Remote Servers")," as well:"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-bash"}),"service cbd restart\n")),(0,r.kt)("p",null,"At this point everything should be working properly."),(0,r.kt)("h2",l({},{id:"resuming-the-cluster-resources-management"}),"Resuming the cluster resources management"),(0,r.kt)("p",null,"Now that the update is finished, the resources can be managed again:"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-bash"}),"pcs resource manage centreon\npcs resource manage ms_mysql\n")),(0,r.kt)("h2",l({},{id:"verifying-the-platform-stability"}),"Verifying the platform stability"),(0,r.kt)("p",null,"You should now check that eveything works fine:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Access to the web UI menus."),(0,r.kt)("li",{parentName:"ul"},"Poller configuration generation + reload and restart method."),(0,r.kt)("li",{parentName:"ul"},"Schedule immediate check (Central + Pollers) and acknowledge, downtime etc."),(0,r.kt)("li",{parentName:"ul"},"Move resources or reboot master server and check again that everything is fine.")))}h.isMDXComponent=!0}}]);