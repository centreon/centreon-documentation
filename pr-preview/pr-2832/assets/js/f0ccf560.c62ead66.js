"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[56090],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>d});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),c=p(a),d=r,k=c["".concat(s,".").concat(d)]||c[d]||m[d]||i;return a?n.createElement(k,l(l({ref:t},u),{},{components:a})):n.createElement(k,l({ref:t},u))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,l=new Array(i);l[0]=c;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var p=2;p<i;p++)l[p]=a[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},60228:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>m,contentTitle:()=>p,default:()=>k,frontMatter:()=>s,metadata:()=>u,toc:()=>c});a(67294);var n=a(3905),r=a(67709),i=a(7626);function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},l.apply(this,arguments)}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}const s={id:"cloud-azure-management-insightsmetrics",title:"Azure InsightsMetrics"},p=void 0,u={unversionedId:"integrations/plugin-packs/procedures/cloud-azure-management-insightsmetrics",id:"integrations/plugin-packs/procedures/cloud-azure-management-insightsmetrics",title:"Azure InsightsMetrics",description:"Overview",source:"@site/pp/integrations/plugin-packs/procedures/cloud-azure-management-insightsmetrics.md",sourceDirName:"integrations/plugin-packs/procedures",slug:"/integrations/plugin-packs/procedures/cloud-azure-management-insightsmetrics",permalink:"/centreon-documentation/pr-preview/pr-2832/pp/integrations/plugin-packs/procedures/cloud-azure-management-insightsmetrics",draft:!1,tags:[],version:"current",frontMatter:{id:"cloud-azure-management-insightsmetrics",title:"Azure InsightsMetrics"},sidebar:"pp",previous:{title:"Azure Front Door",permalink:"/centreon-documentation/pr-preview/pr-2832/pp/integrations/plugin-packs/procedures/cloud-azure-network-frontdoor"},next:{title:"Azure Key Vault",permalink:"/centreon-documentation/pr-preview/pr-2832/pp/integrations/plugin-packs/procedures/cloud-azure-security-keyvault"}},m={},c=[{value:"Overview",id:"overview",level:2},{value:"Pack Assets",id:"pack-assets",level:2},{value:"Monitored Objects",id:"monitored-objects",level:3},{value:"Collected metrics &amp; status",id:"collected-metrics--status",level:3},{value:"Discovery rules",id:"discovery-rules",level:3},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Azure credentials",id:"azure-credentials",level:3},{value:"Setup",id:"setup",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Host",id:"host",level:3},{value:"How to check in the CLI that the configuration is OK and what are the main options for ?",id:"how-to-check-in-the-cli-that-the-configuration-is-ok-and-what-are-the-main-options-for-",level:2},{value:"Troubleshooting",id:"troubleshooting",level:3}],d={toc:c};function k(e){var{components:t}=e,a=o(e,["components"]);return(0,n.kt)("wrapper",l({},d,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h2",l({},{id:"overview"}),"Overview"),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"This Pack is in an experimental state (version 2.x.X).")),(0,n.kt)("p",null,"The Centreon Pack ",(0,n.kt)("em",{parentName:"p"},"Azure InsightsMetrics")," aims to monitor additional indicators that are not available on the Azure Monitor feature.\nFor this, it runs KustoQL based queries on the InsightsMetrics database reachable through the Azure LogAnalytics API.\nFor example, using this Pack will allow you to monitor system indicators of Azure Virtual Machines resources (CPU, memory, disks...)."),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"The associated Plugin is only compatible with the 'api' ",(0,n.kt)("em",{parentName:"p"},"custom-mode"),". 'azcli' is not supported for this usage.")),(0,n.kt)("h2",l({},{id:"pack-assets"}),"Pack Assets"),(0,n.kt)("h3",l({},{id:"monitored-objects"}),"Monitored Objects"),(0,n.kt)("p",null,"Available indicators and metrics:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Azure Virtual Machines",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"CPU"),(0,n.kt)("li",{parentName:"ul"},"Memory"),(0,n.kt)("li",{parentName:"ul"},"Logical-Disks")))),(0,n.kt)("h3",l({},{id:"collected-metrics--status"}),"Collected metrics & status"),(0,n.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,n.kt)(i.Z,{value:"Cpu",label:"Cpu",mdxType:"TabItem"},(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",l({parentName:"tr"},{align:"left"}),"Metric Name"),(0,n.kt)("th",l({parentName:"tr"},{align:"left"}),"Description"),(0,n.kt)("th",l({parentName:"tr"},{align:"left"}),"Unit"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),(0,n.kt)("em",{parentName:"td"},"instance"),"#azure.insights.cpu.average.utilization.percentage"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"Average utilization percentage"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"%")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),(0,n.kt)("em",{parentName:"td"},"instance","~","ID"),"#azure.insights.cpu.core.utilization.percentage"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"Current utilization per core"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"%"))))),(0,n.kt)(i.Z,{value:"Logical-Disks",label:"Logical-Disks",mdxType:"TabItem"},(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",l({parentName:"tr"},{align:"left"}),"Metric Name"),(0,n.kt)("th",l({parentName:"tr"},{align:"left"}),"Description"),(0,n.kt)("th",l({parentName:"tr"},{align:"left"}),"Unit"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),(0,n.kt)("em",{parentName:"td"},"instance","~","mount_point"),"#azure.insights.logicaldisk.used.bytes"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"Logical Disk current usage"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"B")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),(0,n.kt)("em",{parentName:"td"},"instance","~","mount_point"),"#azure.insights.logicaldisk.used.percentage"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"Logical Disk current usage percentage"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"%")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),(0,n.kt)("em",{parentName:"td"},"instance","~","mount_point"),"#azure.insights.logicaldisk.free.percentage"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"Logical Disk current free percentage"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"%")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),(0,n.kt)("em",{parentName:"td"},"instance","~","mount_point"),"#azure.insights.logicaldisks.io.readspersecond"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"Logical Disk current IO/s reads rate"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"count/s")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),(0,n.kt)("em",{parentName:"td"},"instance","~","mount_point"),"#azure.insights.logicaldisks.io.readbytespersecond"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"Logical Disk current IO B/s reads rate"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"B/s")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),(0,n.kt)("em",{parentName:"td"},"instance","~","mount_point"),"#azure.insights.logicaldisks.io.writespersecond"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"Logical Disk current IO writes rate"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"count/s")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),(0,n.kt)("em",{parentName:"td"},"instance","~","mount_point"),"#azure.insights.logicaldisks.io.transferspersecond"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"Logical Disk current IO transfers rate"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"count/s"))))),(0,n.kt)(i.Z,{value:"Memory",label:"Memory",mdxType:"TabItem"},(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",l({parentName:"tr"},{align:"left"}),"Metric Name"),(0,n.kt)("th",l({parentName:"tr"},{align:"left"}),"Description"),(0,n.kt)("th",l({parentName:"tr"},{align:"left"}),"Unit"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),(0,n.kt)("em",{parentName:"td"},"instance"),"#azure.insights.memory.usage.bytes"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"Current memory usage"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"B")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),(0,n.kt)("em",{parentName:"td"},"instance"),"#azure.insights.memory.usage.percentage"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"Current memory usage percentage"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"%")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),(0,n.kt)("em",{parentName:"td"},"instance"),"#azure.insights.memory.usage.percentage"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"Current memory usage percentage"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"%")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),(0,n.kt)("em",{parentName:"td"},"instance"),"#azure.insights.memory.available.percentage"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"Current memory available percentage"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"%")))))),(0,n.kt)("h3",l({},{id:"discovery-rules"}),"Discovery rules"),(0,n.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,n.kt)(i.Z,{value:"Services",label:"Services",mdxType:"TabItem"},(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",l({parentName:"tr"},{align:"left"}),"Rule name"),(0,n.kt)("th",l({parentName:"tr"},{align:"left"}),"Description"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"Cloud-Azure-Management-InsightsMetrics-Api-VirtualMachine-Logical-Disks-Name"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"Discover logical disks associated to Azure Virtual Machines")))))),(0,n.kt)("h2",l({},{id:"prerequisites"}),"Prerequisites"),(0,n.kt)("h3",l({},{id:"azure-credentials"}),"Azure credentials"),(0,n.kt)("p",null,"To use the 'api' custom mode, make sure to obtain the required information using the\nhow-to below. Keep it safe until including it in the Autodiscovery job settings form."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Create an ",(0,n.kt)("em",{parentName:"p"},"application")," in Azure Active Directory:"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Log in to your Azure account."),(0,n.kt)("li",{parentName:"ul"},"Select ",(0,n.kt)("em",{parentName:"li"},"Azure Active directory")," in the left sidebar."),(0,n.kt)("li",{parentName:"ul"},"Click on ",(0,n.kt)("em",{parentName:"li"},"App registrations"),"."),(0,n.kt)("li",{parentName:"ul"},"Click on ",(0,n.kt)("em",{parentName:"li"},"+ Add"),"."),(0,n.kt)("li",{parentName:"ul"},"Enter Centreon as the application name (or any name of your choice), select application type(api) and sign-on-url."),(0,n.kt)("li",{parentName:"ul"},"Click on the ",(0,n.kt)("em",{parentName:"li"},"Create")," button."))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Get ",(0,n.kt)("em",{parentName:"p"},"Subscription ID")),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Log in to your Azure account."),(0,n.kt)("li",{parentName:"ul"},"Select ",(0,n.kt)("em",{parentName:"li"},"Subscriptions")," in the left sidebar."),(0,n.kt)("li",{parentName:"ul"},"Select whichever subscription is needed."),(0,n.kt)("li",{parentName:"ul"},"Click on ",(0,n.kt)("em",{parentName:"li"},"Overview"),"."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Copy the Subscription ID.")))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Get ",(0,n.kt)("em",{parentName:"p"},"Tenant ID")),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Log in to your Azure account."),(0,n.kt)("li",{parentName:"ul"},"Select ",(0,n.kt)("em",{parentName:"li"},"Azure Active directory")," in the left sidebar."),(0,n.kt)("li",{parentName:"ul"},"Click on ",(0,n.kt)("em",{parentName:"li"},"Properties"),"."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Copy the directory ID.")))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Get ",(0,n.kt)("em",{parentName:"p"},"Client ID")),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Log in to your Azure account."),(0,n.kt)("li",{parentName:"ul"},"Select ",(0,n.kt)("em",{parentName:"li"},"Azure Active directory")," in the left sidebar."),(0,n.kt)("li",{parentName:"ul"},"Click on ",(0,n.kt)("em",{parentName:"li"},"Enterprise applications"),"."),(0,n.kt)("li",{parentName:"ul"},"Click on ",(0,n.kt)("em",{parentName:"li"},"All applications"),"."),(0,n.kt)("li",{parentName:"ul"},"Select the application previously created."),(0,n.kt)("li",{parentName:"ul"},"Click on ",(0,n.kt)("em",{parentName:"li"},"Properties"),"."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Copy the Application ID.")))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Get ",(0,n.kt)("em",{parentName:"p"},"Client secret")),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Log in to your Azure account."),(0,n.kt)("li",{parentName:"ul"},"Select ",(0,n.kt)("em",{parentName:"li"},"Azure Active directory")," in the left sidebar."),(0,n.kt)("li",{parentName:"ul"},"Click on ",(0,n.kt)("em",{parentName:"li"},"App registrations"),"."),(0,n.kt)("li",{parentName:"ul"},"Select the application previously created."),(0,n.kt)("li",{parentName:"ul"},"Click on ",(0,n.kt)("em",{parentName:"li"},"All settings"),"."),(0,n.kt)("li",{parentName:"ul"},"Click on ",(0,n.kt)("em",{parentName:"li"},"Keys"),"."),(0,n.kt)("li",{parentName:"ul"},"Enter the key description and select the duration."),(0,n.kt)("li",{parentName:"ul"},"Click on ",(0,n.kt)("em",{parentName:"li"},"Save"),"."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Copy and store the key value. You won't be able to retrieve it after you leave this page."))))),(0,n.kt)("h2",l({},{id:"setup"}),"Setup"),(0,n.kt)(r.Z,{groupId:"sync",mdxType:"Tabs"},(0,n.kt)(i.Z,{value:"Online License",label:"Online License",mdxType:"TabItem"},(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Install the Centreon Plugin on every Centreon Poller expected to monitor Azure resources based on InsightsMetrics:")),(0,n.kt)("pre",null,(0,n.kt)("code",l({parentName:"pre"},{className:"language-bash"}),"yum install centreon-plugin-Cloud-Azure-Management-InsightsMetrics-Api\n")),(0,n.kt)("ol",l({},{start:2}),(0,n.kt)("li",{parentName:"ol"},"On the Centreon Web interface, install the ",(0,n.kt)("em",{parentName:"li"},"Azure InsightsMetrics")," Centreon Pack on the ",(0,n.kt)("strong",{parentName:"li"},"Configuration > Plugin Packs > Manager")," page."))),(0,n.kt)(i.Z,{value:"Offline License",label:"Offline License",mdxType:"TabItem"},(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Install the Centreon Plugin on every Centreon Poller expected to monitor Azure resources based on InsightsMetrics:")),(0,n.kt)("pre",null,(0,n.kt)("code",l({parentName:"pre"},{className:"language-bash"}),"yum install centreon-plugin-Cloud-Azure-Management-InsightsMetrics-Api\n")),(0,n.kt)("ol",l({},{start:2}),(0,n.kt)("li",{parentName:"ol"},"Install the Centreon Pack RPM on the Centreon Central server:")),(0,n.kt)("pre",null,(0,n.kt)("code",l({parentName:"pre"},{className:"language-bash"}),"yum install centreon-pack-cloud-azure-management-insightsmetrics.noarch\n")),(0,n.kt)("ol",l({},{start:3}),(0,n.kt)("li",{parentName:"ol"},"On the Centreon Web interface, install the ",(0,n.kt)("em",{parentName:"li"},"Azure InsightsMetrics")," Centreon Pack on the ",(0,n.kt)("strong",{parentName:"li"},"Configuration > Plugin Packs > Manager")," page.")))),(0,n.kt)("h2",l({},{id:"configuration"}),"Configuration"),(0,n.kt)("h3",l({},{id:"host"}),"Host"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Log into Centreon and add a new Host through ",(0,n.kt)("strong",{parentName:"p"},"Configuration > Hosts"),".")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"In the ",(0,n.kt)("em",{parentName:"p"},"IP Address/FQDN")," field, set the following IP address: '127.0.0.1'.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Select the appropriate ",(0,n.kt)("em",{parentName:"p"},"Cloud-Azure-Management-InsightsMetrics-XXX-custom")," template to apply to the Host\n(for example, choose ",(0,n.kt)("em",{parentName:"p"},"Cloud-Azure-Management-InsightsMetrics-VirtualMachine-custom")," for an Azure VM resource).")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"Once the template applied, some Macros marked as 'Mandatory' hereafter have to be configured."))),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",l({parentName:"tr"},{align:"left"}),"Mandatory"),(0,n.kt)("th",l({parentName:"tr"},{align:"left"}),"Nom"),(0,n.kt)("th",l({parentName:"tr"},{align:"left"}),"Description"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"X"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"AZURECUSTOMMODE"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"Custom mode 'api'")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"X"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"AZURELOGANALYTICSENDPOINT"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"LogAnalytics endpoint (default: ",(0,n.kt)("inlineCode",{parentName:"td"},"https://api.loganalytics.io"),")")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"X"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"AZURESUBSCRIPTION"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"Subscription ID")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"X"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"AZUREWORKSPACEID"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"LogAnalytics workspace ID")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"X"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"AZURETENANT"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"Tenant ID")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"X"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"AZURECLIENTID"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"Client ID")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"X"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"AZURECLIENTSECRET"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"Client secret")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"X"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"AZURERESOURCE"),(0,n.kt)("td",l({parentName:"tr"},{align:"left"}),"full ID of the resource to monitor")))),(0,n.kt)("h2",l({},{id:"how-to-check-in-the-cli-that-the-configuration-is-ok-and-what-are-the-main-options-for-"}),"How to check in the CLI that the configuration is OK and what are the main options for ?"),(0,n.kt)("p",null,"Once the Plugin installed, log into your Centreon Poller CLI using the ",(0,n.kt)("em",{parentName:"p"},"centreon-engine"),"\nuser account and test the Plugin by running the following command:"),(0,n.kt)("pre",null,(0,n.kt)("code",l({parentName:"pre"},{className:"language-bash"}),"/usr/lib/centreon/plugins//centreon_azure_management_insightsmetrics_api.pl \\\n    --plugin=cloud::azure::management::insightsmetrics::plugin \\\n    --mode=cpu --custommode='api' --management-endpoint='https://api.loganalytics.io' \\\n    --subscription='xxxxxxxxx' --tenant='xxxxxxx' --client-id='xxxxxxxx' --client-secret='xxxxxxxxxx' \\\n    --workspace-id='xxxxxxxxxxxxxxx' \\\n    --filter-resourceid='/subscriptions/XXXX/resourcegroups/my_resourcegroup1/providers/microsoft.compute/virtualmachines/my_vm1' \\\n    --warning-average-utilization-percentage='90' \\\n    --critical-average-utilization-percentage='95'\n")),(0,n.kt)("p",null,"Expected command output is shown below:"),(0,n.kt)("pre",null,(0,n.kt)("code",l({parentName:"pre"},{className:"language-bash"}),"OK: 2 CPU(s) average utilization: 2.18 % - All CPUs are ok | 'azure.insights.cpu.average.utilization.percentage'=2.18%;0:90;0:95;0;100\n'1#azure.insights.cpu.core.utilization.percentage'=2.12%;;;0;100 '2#azure.insights.cpu.core.utilization.percentage'=2.25%;;;0;100\nComputer 'my_vm1'\n2 CPU(s) average utilization: 2.18 %\nCPU #1 usage : 2.12 %\nCPU #2 usage : 2.25 %\n")),(0,n.kt)("p",null,"The command above checks the ",(0,n.kt)("em",{parentName:"p"},"CPU")," of an Azure ",(0,n.kt)("em",{parentName:"p"},"Virtual Machine")," account using the 'api' custom-mode\ntargetting the ",(0,n.kt)("em",{parentName:"p"},"LogAnalytics")," API (",(0,n.kt)("inlineCode",{parentName:"p"},"--plugin=cloud::azure::management::insightsmetrics::plugin --mode=cpu --custommode=api \n--management-endpoint='https://api.loganalytics.io'"),").\nThe authentication parameters to be used with the custom mode are specified in the options (",(0,n.kt)("inlineCode",{parentName:"p"},"--subscription='xxxxxxxxx'\n--tenant='xxxxxxx' --client-id='xxxxxxxx' --client-secret='xxxxxxxxxx'"),"). The Resource ID of the Azure VM ",(0,n.kt)("em",{parentName:"p"},"my_vm1")," is specified in the filter\n(",(0,n.kt)("inlineCode",{parentName:"p"},"--filter-resourceid='/subscriptions/XXXX/resourcegroups/my_resourcegroup1/providers/microsoft.compute/virtualmachines/my_vm1'"),")."),(0,n.kt)("p",null,"This command would trigger a WARNING alarm if the ",(0,n.kt)("em",{parentName:"p"},"average utilization")," is reported as over 90% (",(0,n.kt)("inlineCode",{parentName:"p"},"--warning-average-utilization-percentage='90'"),")\nand a CRITICAL alarm over 95% (",(0,n.kt)("inlineCode",{parentName:"p"},"--critical-average-utilization-percentage='95'"),")."),(0,n.kt)("p",null,"All the available options for a given mode can be displayed by adding the ",(0,n.kt)("inlineCode",{parentName:"p"},"--help")," parameter to the command:"),(0,n.kt)("pre",null,(0,n.kt)("code",l({parentName:"pre"},{className:"language-bash"}),"/usr/lib/centreon/plugins/centreon_azure_management_insightsmetrics_api.pl \\\n    --plugin=cloud::azure::management::insightsmetrics::plugin \\\n    --mode=cpu\n    --help\n")),(0,n.kt)("h3",l({},{id:"troubleshooting"}),"Troubleshooting"),(0,n.kt)("p",null,"Please find all the troubleshooting documentation for the API-based Plugins in the ",(0,n.kt)("a",l({parentName:"p"},{href:"/centreon-documentation/pr-preview/pr-2832/pp/integrations/plugin-packs/getting-started/how-to-guides/troubleshooting-plugins#http-and-api-checks"}),"dedicated chapter"),"\nof the Centreon documentation."))}k.isMDXComponent=!0},7626:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(67294),r=a(86010);const i="tabItem_Ymn6";function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},l.apply(this,arguments)}function o({children:e,hidden:t,className:a}){return n.createElement("div",l({role:"tabpanel",className:(0,r.Z)(i,a)},{hidden:t}),e)}},67709:(e,t,a)=>{a.d(t,{Z:()=>d});var n=a(67294),r=a(86010),i=a(90980),l=a(35715),o=a(8854),s=a(8241);const p="tabList__CuJ",u="tabItem_LNqP";function m(){return m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},m.apply(this,arguments)}function c(e){var t;const{lazy:a,block:i,defaultValue:c,values:d,groupId:k,className:g}=e,N=n.Children.map(e.children,(e=>{if((0,n.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),h=null!=d?d:N.map((({props:{value:e,label:t,attributes:a}})=>({value:e,label:t,attributes:a}))),f=(0,l.l)(h,((e,t)=>e.value===t.value));if(f.length>0)throw new Error(`Docusaurus error: Duplicate values "${f.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);var b;const v=null===c?c:null!==(b=null!=c?c:null===(t=N.find((e=>e.props.default)))||void 0===t?void 0:t.props.value)&&void 0!==b?b:N[0].props.value;if(null!==v&&!h.some((e=>e.value===v)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${v}" but none of its children has the corresponding value. Available values are: ${h.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:y,setTabGroupChoices:x}=(0,o.U)(),[C,z]=(0,n.useState)(v),A=[],{blockElementScrollPositionUntilNextRender:O}=(0,s.o5)();if(null!=k){const e=y[k];null!=e&&e!==C&&h.some((t=>t.value===e))&&z(e)}const I=e=>{const t=e.currentTarget,a=A.indexOf(t),n=h[a].value;n!==C&&(O(t),z(n),null!=k&&x(k,String(n)))},w=e=>{let t=null;switch(e.key){case"ArrowRight":{const n=A.indexOf(e.currentTarget)+1;var a;t=null!==(a=A[n])&&void 0!==a?a:A[0];break}case"ArrowLeft":{const a=A.indexOf(e.currentTarget)-1;var n;t=null!==(n=A[a])&&void 0!==n?n:A[A.length-1];break}}null==t||t.focus()};return n.createElement("div",{className:(0,r.Z)("tabs-container",p)},n.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":i},g)},h.map((({value:e,label:t,attributes:a})=>n.createElement("li",m({role:"tab",tabIndex:C===e?0:-1,"aria-selected":C===e,key:e,ref:e=>A.push(e),onKeyDown:w,onFocus:I,onClick:I},a,{className:(0,r.Z)("tabs__item",u,null==a?void 0:a.className,{"tabs__item--active":C===e})}),null!=t?t:e)))),a?(0,n.cloneElement)(N.filter((e=>e.props.value===C))[0],{className:"margin-top--md"}):n.createElement("div",{className:"margin-top--md"},N.map(((e,t)=>(0,n.cloneElement)(e,{key:t,hidden:e.props.value!==C})))))}function d(e){const t=(0,i.Z)();return n.createElement(c,m({key:String(t)},e))}}}]);