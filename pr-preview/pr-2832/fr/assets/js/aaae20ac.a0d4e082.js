"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[52912],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>d});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var u=r.createContext({}),i=function(e){var t=r.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=i(e.components);return r.createElement(u.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,u=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=i(n),d=a,k=m["".concat(u,".").concat(d)]||m[d]||c[d]||o;return n?r.createElement(k,l(l({ref:t},p),{},{components:n})):r.createElement(k,l({ref:t},p))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,l=new Array(o);l[0]=m;var s={};for(var u in t)hasOwnProperty.call(t,u)&&(s[u]=t[u]);s.originalType=e,s.mdxType="string"==typeof e?e:a,l[1]=s;for(var i=2;i<o;i++)l[i]=n[i];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},13876:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>k,frontMatter:()=>u,metadata:()=>p,toc:()=>m});n(67294);var r=n(3905),a=n(67709),o=n(7626);function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},l.apply(this,arguments)}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const u={id:"cloud-prometheus-api",title:"Prometheus Server"},i=void 0,p={unversionedId:"integrations/plugin-packs/procedures/cloud-prometheus-api",id:"integrations/plugin-packs/procedures/cloud-prometheus-api",title:"Prometheus Server",description:"Vue d'ensemble",source:"@site/i18n/fr/docusaurus-plugin-content-docs-pp/current/integrations/plugin-packs/procedures/cloud-prometheus-api.md",sourceDirName:"integrations/plugin-packs/procedures",slug:"/integrations/plugin-packs/procedures/cloud-prometheus-api",permalink:"/centreon-documentation/pr-preview/pr-2832/fr/pp/integrations/plugin-packs/procedures/cloud-prometheus-api",draft:!1,tags:[],version:"current",frontMatter:{id:"cloud-prometheus-api",title:"Prometheus Server"},sidebar:"pp",previous:{title:"OVH",permalink:"/centreon-documentation/pr-preview/pr-2832/fr/pp/integrations/plugin-packs/procedures/cloud-ovh-restapi"},next:{title:"Node Exporter",permalink:"/centreon-documentation/pr-preview/pr-2832/fr/pp/integrations/plugin-packs/procedures/cloud-prometheus-node-exporter-api"}},c={},m=[{value:"Vue d&#39;ensemble",id:"vue-densemble",level:2},{value:"Contenu du Pack",id:"contenu-du-pack",level:2},{value:"El\xe9ments supervis\xe9s",id:"el\xe9ments-supervis\xe9s",level:3},{value:"M\xe9triques collect\xe9es",id:"m\xe9triques-collect\xe9es",level:3},{value:"Pr\xe9requis",id:"pr\xe9requis",level:2},{value:"Installation",id:"installation",level:2},{value:"Configuration",id:"configuration",level:2},{value:"H\xf4te",id:"h\xf4te",level:3},{value:"FAQ",id:"faq",level:2},{value:"Comment tester le Plugin en ligne de commande et \xe0 quoi correspondent les options?",id:"comment-tester-le-plugin-en-ligne-de-commande-et-\xe0-quoi-correspondent-les-options",level:3},{value:"Comment utiliser le mode Expression (g\xe9n\xe9rique) ?",id:"comment-utiliser-le-mode-expression-g\xe9n\xe9rique-",level:3},{value:"Option <code>--query</code> et Macro QUERIES associ\xe9e",id:"option---query-et-macro-queries-associ\xe9e",level:4},{value:"Option <code>--instance</code> et Macro associ\xe9e",id:"option---instance-et-macro-associ\xe9e",level:4},{value:"Options <code>--multiple-output</code>/<code>--output</code> et Macros MULTIPLEOUTPUT/OUTPUT associ\xe9es",id:"options---multiple-output--output-et-macros-multipleoutputoutput-associ\xe9es",level:4},{value:"Options <code>--*-status</code> et Macros *STATUS associ\xe9es",id:"options----status-et-macros-status-associ\xe9es",level:4},{value:"Sortie du Plugin et r\xe9sum\xe9 des Macros",id:"sortie-du-plugin-et-r\xe9sum\xe9-des-macros",level:4},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"UNKNOWN: 500 Can&#39;t connect to amzprometheus.int.centreon.com:9090 (&lt;error_text) |",id:"unknown-500-cant-connect-to-amzprometheusintcentreoncom9090-error_text-",level:3},{value:"UNKNOWN: 400 Bad Request |",id:"unknown-400-bad-request-",level:3}],d={toc:m};function k(e){var{components:t}=e,n=s(e,["components"]);return(0,r.kt)("wrapper",l({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",l({},{id:"vue-densemble"}),"Vue d'ensemble"),(0,r.kt)("p",null,"Prometheus est un syst\xe8me de supervision orient\xe9 m\xe9trique avec des capacit\xe9s de\ncollecte vers diff\xe9rents ",(0,r.kt)("em",{parentName:"p"},"exporters")," exposant des m\xe9triques via HTTP. "),(0,r.kt)("p",null,"Le Centreon Plugin Pack utilise les capacit\xe9 des APIs de Prometheus et de son\nlanguage PromQL pour executer des requ\xeates sur les donn\xe9es contenu dans sa base\nde donn\xe9es orient\xe9e s\xe9ries temporelles."),(0,r.kt)("h2",l({},{id:"contenu-du-pack"}),"Contenu du Pack"),(0,r.kt)("h3",l({},{id:"el\xe9ments-supervis\xe9s"}),"El\xe9ments supervis\xe9s"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"N'importe quelle m\xe9trique collect\xe9e et stock\xe9e par Prometheus"),(0,r.kt)("li",{parentName:"ul"},"Statut des ",(0,r.kt)("em",{parentName:"li"},"targets")," Prometheus")),(0,r.kt)("h3",l({},{id:"m\xe9triques-collect\xe9es"}),"M\xe9triques collect\xe9es"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"Expression",label:"Expression",mdxType:"TabItem"},(0,r.kt)("p",null,"Mode g\xe9n\xe9rique pour executer des requ\xeates PromQL"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",l({parentName:"tr"},{align:"left"}),"Metric name"),(0,r.kt)("th",l({parentName:"tr"},{align:"left"}),"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),(0,r.kt)("em",{parentName:"td"},"instance"),"#",(0,r.kt)("em",{parentName:"td"},"centreon_prometheus_metric_display_name")),(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"Any metric"))))),(0,r.kt)(o.Z,{value:"Target-Status",label:"Target-Status",mdxType:"TabItem"},(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",l({parentName:"tr"},{align:"left"}),"Metric name"),(0,r.kt)("th",l({parentName:"tr"},{align:"left"}),"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"targets.active.count"),(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"Number of active targets")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"targets.dropped.count"),(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"Number of dropped targets")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"targets.up.count"),(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"Number of up targets")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"targets.down.count"),(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"Number of down targets")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"targets.unknown.count"),(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"Number of unknown targets")))))),(0,r.kt)("h2",l({},{id:"pr\xe9requis"}),"Pr\xe9requis"),(0,r.kt)("p",null,"Le Collecteur Centreon doit \xeatre en mesure d'executer des requ\xeates HTTP(S) vers le\nServeur Prometheus."),(0,r.kt)("h2",l({},{id:"installation"}),"Installation"),(0,r.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,r.kt)(o.Z,{value:"Online License",label:"Online License",mdxType:"TabItem"},(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Installer le Plugin Centreon sur les Collecteurs interrogeant Prometheus:")),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-bash"}),"yum install centreon-plugin-Cloud-Prometheus-Api\n")),(0,r.kt)("ol",l({},{start:2}),(0,r.kt)("li",{parentName:"ol"},"Dans l'interface Centreon, installer le Plugin Pack ",(0,r.kt)("em",{parentName:"li"},"Prometheus API"),' via le menu "Configuration > Plugin Packs > Gestionnaire"'))),(0,r.kt)(o.Z,{value:"Offline License",label:"Offline License",mdxType:"TabItem"},(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Installer le Plugin Centreon sur les Collecteurs interrogeant Prometheus:")),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-bash"}),"yum install centreon-plugin-Cloud-Prometheus-Api\n")),(0,r.kt)("ol",l({},{start:2}),(0,r.kt)("li",{parentName:"ol"},"Installer le package RPM du Plugin Pack sur le serveur Central:")),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-bash"}),"yum install centreon-pack-cloud-prometheus-api\n")),(0,r.kt)("ol",l({},{start:3}),(0,r.kt)("li",{parentName:"ol"},"Dans l'interface Centreon, installer le Plugin Pack ",(0,r.kt)("em",{parentName:"li"},"Prometheus API"),' via le menu "Configuration > Plugin Packs > Gestionnaire"')))),(0,r.kt)("h2",l({},{id:"configuration"}),"Configuration"),(0,r.kt)("h3",l({},{id:"h\xf4te"}),"H\xf4te"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},'Connectez vous \xe0 l\'interface Centreon et ajouter un nouvel H\xf4te via le menu "Configuration > H\xf4tes".'),(0,r.kt)("li",{parentName:"ul"},"Appliquez le Mod\xe8le ",(0,r.kt)("em",{parentName:"li"},"Cloud-Prometheus-Api-custom")),(0,r.kt)("li",{parentName:"ul"},"Une fois le Mod\xe8le appliqu\xe9, saisissez la valeur des Macros obligatoires list\xe9es ci-dessous:")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",l({parentName:"tr"},{align:"left"}),"Mandatory"),(0,r.kt)("th",l({parentName:"tr"},{align:"left"}),"Nom"),(0,r.kt)("th",l({parentName:"tr"},{align:"left"}),"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"X"),(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"PROMETHEUSAPIHOSTNAME"),(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"Nom ou IP du serveur Prometheus")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"X"),(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"PROMETHEUSAPIPORT"),(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"Port d'\xe9coute de l'API Prometheus")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"X"),(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"PROMETHEUSAPIURL"),(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"Chemin URL d'acc\xe8s \xe0 l'API (Par d\xe9faut: '/api/v1)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"X"),(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"PROMETHEUSAPIPROTO"),(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"Protocol used by Prom API (Par d\xe9faut: 'http')")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",l({parentName:"tr"},{align:"left"})),(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"EXTRAOPTIONS"),(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"Options suppl\xe9mentaires, e.g: --use-new-perfdata")))),(0,r.kt)("h2",l({},{id:"faq"}),"FAQ"),(0,r.kt)("h3",l({},{id:"comment-tester-le-plugin-en-ligne-de-commande-et-\xe0-quoi-correspondent-les-options"}),"Comment tester le Plugin en ligne de commande et \xe0 quoi correspondent les options?"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Note: Le mode d\xe9crit ci-dessous ne fonctionne que lorsque le Mod\xe8le est appliqu\xe9 sur\nun H\xf4te \xe9tant un serveur Prometheus.")),(0,r.kt)("p",null,"Une fois le Plugin install\xe9, connectez-vous au Collecteur Centreon et utilisez l'utilisateur\n",(0,r.kt)("em",{parentName:"p"},"centreon-engine")," pour lancer la commande suivante: "),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-bash"}),"/usr/lib/centreon/plugins//centreon_prometheus_api.pl \\\n    --plugin=cloud::prometheus::restapi::plugin \\\n    --mode=target-status \\\n    --hostname=amzprometheus.int.centreon.com \\\n    --url-path='/api/v1' --port='80' --proto='http' \\\n    --filter-label='job,coredns' \\\n    --warning-status='' --critical-status='%{health} !~ /up/' \n")),(0,r.kt)("p",null,"Expected command output is shown below:"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-bash"}),"OK: Targets Active: 2, Dropped: 175, Up: 2, Down: 0, Unknown: 0 - All targets status are ok | 'targets.active.count'=2;;;0; 'targets.dropped.count'=175;;;0; 'targets.up.count'=2;;;0; 'targets.down.count'=0;;;0; 'targets.unknown.count'=0;;;0;\nTarget 'http://10.244.1.249:9153/metrics' health is 'up' [pod = coredns-74ff55c5b-g4hmt][namespace = kube-system][service = prometheus-operator-coredns][instance = 10.244.1.249:9153][job = coredns][endpoint = http-metrics]\nTarget 'http://10.244.2.5:9153/metrics' health is 'up' [pod = coredns-74ff55c5b-vh9zt][namespace = kube-system][service = prometheus-operator-coredns][instance = 10.244.2.5:9153][job = coredns][endpoint = http-metrics]\n")),(0,r.kt)("p",null,"The command above check the status of the targets (",(0,r.kt)("inlineCode",{parentName:"p"},"--mode=target-status"),") linked\nto a Prometheus server (",(0,r.kt)("inlineCode",{parentName:"p"},"--hostname=amzprometheus.int.centreon.com"),")  exposing its API\nover HTTP and listnening on port 80 (",(0,r.kt)("inlineCode",{parentName:"p"},"--port='80' --proto='http'"),"). "),(0,r.kt)("p",null,"Only targets linked with the coredns job label are checked (",(0,r.kt)("inlineCode",{parentName:"p"},"--filter-label='job,coredns'"),"). "),(0,r.kt)("p",null,'The command triggers a CRITICAL if any of the Target status is not equal to "up". '),(0,r.kt)("h3",l({},{id:"comment-utiliser-le-mode-expression-g\xe9n\xe9rique-"}),"Comment utiliser le mode Expression (g\xe9n\xe9rique) ?"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Note: Ce mode peut \xeatre utilis\xe9 \xe0 la fois directement sur un H\xf4te \xe9tant un\nserveur Prometheus et \xe0 la fois sur un H\xf4te pour lequel Prometheus r\xe9cup\xe8re des\nm\xe9triques. Dans les deux cas, l'h\xf4te doit h\xe9rit\xe9 du Mod\xe8le ",(0,r.kt)("em",{parentName:"p"},"Cloud-Prometheus-Api-custom"),"\net le Service doit \xeatre cr\xe9\xe9 manuellement au moyen du Mod\xe8le de Service ",(0,r.kt)("em",{parentName:"p"},"Cloud-Prometheus-Expression-Api-custom"))),(0,r.kt)("p",null,"Voici un exemple pour illuster comment le mode ",(0,r.kt)("em",{parentName:"p"},"Expression")," fonctionne: "),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-bash"}),"/usr/lib/centreon/plugins//centreon_prometheus_api.pl \\\n    --plugin=cloud::prometheus::restapi::plugin \\\n    --mode=expression \\\n    --hostname=amzprometheus.int.centreon.com \\\n    --url-path='/api/v1' --port='80' --proto='http' \\\n    --query='cpu_requests,sum by (node) (kube_pod_container_resource_requests_cpu_cores) / sum by (node) (kube_node_status_capacity_cpu_cores) * 100' \\\n    --output='%{instance} CPU Requests: %{cpu_requests}%' --multiple-output='Nodes CPU Requests within bounds' \\\n    --instance='node' \\\n    --warning-status='%{cpu_requests} > 60' --critical-status='%{cpu_requests} > 70' \\\n    --use-new-perfdata --verbose \n")),(0,r.kt)("h4",l({},{id:"option---query-et-macro-queries-associ\xe9e"}),"Option ",(0,r.kt)("inlineCode",{parentName:"h4"},"--query")," et Macro QUERIES associ\xe9e"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"--query")," option allows to define two things:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"the Centreon metric name (",(0,r.kt)("inlineCode",{parentName:"li"},"cpu_requests"),")"),(0,r.kt)("li",{parentName:"ul"},"the PromQL query (",(0,r.kt)("inlineCode",{parentName:"li"},"sum by (node) (kube_pod_container_resource_requests_cpu_cores) / sum by (node) (kube_node_status_capacity_cpu_cores) * 100"),")")),(0,r.kt)("p",null,"In the Service definition, you can specify several queries that's why the QUERIES macro\nexceptionnaly includes the option definition. Here, QUERIES value would be \"--query='cpu_requests,sum by (node) (kube_pod_container_resource_requests_cpu_cores) / sum by (node) (kube_node_status_capacity_cpu_cores) * 100'\". "),(0,r.kt)("h4",l({},{id:"option---instance-et-macro-associ\xe9e"}),"Option ",(0,r.kt)("inlineCode",{parentName:"h4"},"--instance")," et Macro associ\xe9e"),(0,r.kt)("p",null,"The instance option explicits the Prometheus metric dimension/label the Plugin will highlight\nin the graphs (",(0,r.kt)("inlineCode",{parentName:"p"},"--instance='node'"),'). The INSTANCE macro value would be "node" in this example. '),(0,r.kt)("h4",l({},{id:"options---multiple-output--output-et-macros-multipleoutputoutput-associ\xe9es"}),"Options ",(0,r.kt)("inlineCode",{parentName:"h4"},"--multiple-output"),"/",(0,r.kt)("inlineCode",{parentName:"h4"},"--output")," et Macros MULTIPLEOUTPUT/OUTPUT associ\xe9es"),(0,r.kt)("p",null,"The output-related options gives ability to tune output messages of the\ncheck in the following cases:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Check a metric on multiple instances"),(0,r.kt)("li",{parentName:"ul"},"Check returning an error")),(0,r.kt)("p",null,'Values can be specified through the corresponding macros, in this example the value of OUTPUT macro\nwould be "%{instance} CPU Requests: %{cpu_requests}%". Note that we use the Centreon label defined in the ',(0,r.kt)("inlineCode",{parentName:"p"},"--query"),"\noption to use the obtained value). We also use the '%{instance}' keyword to display the node name. "),(0,r.kt)("p",null,'The MULTIPLEOUTPUT value would be "Nodes CPU Requests within bounds"'),(0,r.kt)("h4",l({},{id:"options----status-et-macros-status-associ\xe9es"}),"Options ",(0,r.kt)("inlineCode",{parentName:"h4"},"--\\*-status")," et Macros *STATUS associ\xe9es"),(0,r.kt)("p",null,"--warning-status and --critical-status purpose is to define when the Plugin will raise an alert. "),(0,r.kt)("p",null,"In the command above, the check triggers a ",(0,r.kt)("em",{parentName:"p"},"WARNING")," alarm when the 'cpu_requests' value is above 60 and a\n",(0,r.kt)("em",{parentName:"p"},"CRITICAL")," one when it is above 70. "),(0,r.kt)("p",null,"Note that the Centreon label defined in the ",(0,r.kt)("inlineCode",{parentName:"p"},"--query")," options is used again to compare\nthe obtained value with thresholds. "),(0,r.kt)("p",null,"The macros value would be '%{cpu_requests} > 60' for WARNINGSTATUS and '%{cpu_requests} > 70'\nfor CRITICALSTATUS."),(0,r.kt)("h4",l({},{id:"sortie-du-plugin-et-r\xe9sum\xe9-des-macros"}),"Sortie du Plugin et r\xe9sum\xe9 des Macros"),(0,r.kt)("p",null,"Si tout fonctionne correctement, un message similaire au suivant devrait s'afficher:"),(0,r.kt)("pre",null,(0,r.kt)("code",l({parentName:"pre"},{className:"language-bash"}),"OK: Nodes CPU Requests within bounds | 'amzkubemaster.int.centreon.com#cpu_requests'=37.5;;;; 'amzkubenode1.int.centreon.com#cpu_requests'=35;;;; 'amzkubenode2.int.centreon.com#cpu_requests'=30;;;;\namzkubemaster.int.centreon.com CPU Requests: 37.5%\namzkubenode1.int.centreon.com CPU Requests: 35%\namzkubenode2.int.centreon.com CPU Requests: 30%\n")),(0,r.kt)("p",null,"Voici un r\xe9sum\xe9 des Macros \xe0 d\xe9finir au niveau du Service:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",l({parentName:"tr"},{align:"left"}),"Nom"),(0,r.kt)("th",l({parentName:"tr"},{align:"left"}),"Value"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"QUERIES"),(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"--query='cpu_requests,sum by (node) (kube_pod_container_resource_requests_cpu_cores) / sum by (node) (kube_node_status_capacity_cpu_cores) * 100'")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"INSTANCE"),(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"node")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"OUTPUT"),(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"URL Path to reach API (Default: '/api/v1)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"MULTIPLEOUTPUT"),(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"Nodes CPU Requests within bounds")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"WARNINGSTATUS"),(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"%{cpu_requests} > 60")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"CRITICALSTATUS"),(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"%{cpu_requests} > 70")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"EXTRAOPTIONS"),(0,r.kt)("td",l({parentName:"tr"},{align:"left"}),"--verbose --use-new-perfdata")))),(0,r.kt)("h2",l({},{id:"troubleshooting"}),"Troubleshooting"),(0,r.kt)("h3",l({},{id:"unknown-500-cant-connect-to-amzprometheusintcentreoncom9090-error_text-"}),"UNKNOWN: 500 Can't connect to amzprometheus.int.centreon.com:9090 (<error_text) |"),(0,r.kt)("p",null,"Lorsque cette erreur est renvoy\xe9e, v\xe9rifier que les informations pour contacter\nle serveur Prometheus sont correctes (Port, Nom d'H\xf4te) et que la connexion est\npossible."),(0,r.kt)("p",null,"Le contenu de la balise <error_text> donne des indications suppl\xe9mentaires sur la\ncause du dysfonctionnement."),(0,r.kt)("h3",l({},{id:"unknown-400-bad-request-"}),"UNKNOWN: 400 Bad Request |"),(0,r.kt)("p",null,"La requ\xeate PromQL contient probablement une erreur de syntaxe. Il est n\xe9cessaire\nde valider son fonctionnement dans l'interface Prometheus."))}k.isMDXComponent=!0},7626:(e,t,n)=>{n.d(t,{Z:()=>s});var r=n(67294),a=n(86010);const o="tabItem_Ymn6";function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},l.apply(this,arguments)}function s({children:e,hidden:t,className:n}){return r.createElement("div",l({role:"tabpanel",className:(0,a.Z)(o,n)},{hidden:t}),e)}},67709:(e,t,n)=>{n.d(t,{Z:()=>d});var r=n(67294),a=n(86010),o=n(90980),l=n(35715),s=n(8854),u=n(8241);const i="tabList__CuJ",p="tabItem_LNqP";function c(){return c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},c.apply(this,arguments)}function m(e){var t;const{lazy:n,block:o,defaultValue:m,values:d,groupId:k,className:h}=e,g=r.Children.map(e.children,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),b=null!=d?d:g.map((({props:{value:e,label:t,attributes:n}})=>({value:e,label:t,attributes:n}))),f=(0,l.l)(b,((e,t)=>e.value===t.value));if(f.length>0)throw new Error(`Docusaurus error: Duplicate values "${f.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);var N;const v=null===m?m:null!==(N=null!=m?m:null===(t=g.find((e=>e.props.default)))||void 0===t?void 0:t.props.value)&&void 0!==N?N:g[0].props.value;if(null!==v&&!b.some((e=>e.value===v)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${v}" but none of its children has the corresponding value. Available values are: ${b.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:y,setTabGroupChoices:P}=(0,s.U)(),[T,q]=(0,r.useState)(v),O=[],{blockElementScrollPositionUntilNextRender:C}=(0,u.o5)();if(null!=k){const e=y[k];null!=e&&e!==T&&b.some((t=>t.value===e))&&q(e)}const _=e=>{const t=e.currentTarget,n=O.indexOf(t),r=b[n].value;r!==T&&(C(t),q(r),null!=k&&P(k,String(r)))},w=e=>{let t=null;switch(e.key){case"ArrowRight":{const r=O.indexOf(e.currentTarget)+1;var n;t=null!==(n=O[r])&&void 0!==n?n:O[0];break}case"ArrowLeft":{const n=O.indexOf(e.currentTarget)-1;var r;t=null!==(r=O[n])&&void 0!==r?r:O[O.length-1];break}}null==t||t.focus()};return r.createElement("div",{className:(0,a.Z)("tabs-container",i)},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.Z)("tabs",{"tabs--block":o},h)},b.map((({value:e,label:t,attributes:n})=>r.createElement("li",c({role:"tab",tabIndex:T===e?0:-1,"aria-selected":T===e,key:e,ref:e=>O.push(e),onKeyDown:w,onFocus:_,onClick:_},n,{className:(0,a.Z)("tabs__item",p,null==n?void 0:n.className,{"tabs__item--active":T===e})}),null!=t?t:e)))),n?(0,r.cloneElement)(g.filter((e=>e.props.value===T))[0],{className:"margin-top--md"}):r.createElement("div",{className:"margin-top--md"},g.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==T})))))}function d(e){const t=(0,o.Z)();return r.createElement(m,c({key:String(t)},e))}}}]);