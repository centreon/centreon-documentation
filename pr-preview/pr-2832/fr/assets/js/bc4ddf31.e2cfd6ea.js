"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[86719],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>d});var n=r(67294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var i=n.createContext({}),u=function(e){var t=n.useContext(i),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},c=function(e){var t=u(e.components);return n.createElement(i.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=u(r),d=a,k=m["".concat(i,".").concat(d)]||m[d]||p[d]||o;return r?n.createElement(k,l(l({ref:t},c),{},{components:r})):n.createElement(k,l({ref:t},c))}));function d(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,l=new Array(o);l[0]=m;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s.mdxType="string"==typeof e?e:a,l[1]=s;for(var u=2;u<o;u++)l[u]=r[u];return n.createElement.apply(null,l)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},7626:(e,t,r)=>{r.d(t,{Z:()=>s});var n=r(67294),a=r(86010);const o="tabItem_Ymn6";function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},l.apply(this,arguments)}function s({children:e,hidden:t,className:r}){return n.createElement("div",l({role:"tabpanel",className:(0,a.Z)(o,r)},{hidden:t}),e)}},67709:(e,t,r)=>{r.d(t,{Z:()=>d});var n=r(67294),a=r(86010),o=r(90980),l=r(35715),s=r(8854),i=r(8241);const u="tabList__CuJ",c="tabItem_LNqP";function p(){return p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},p.apply(this,arguments)}function m(e){var t;const{lazy:r,block:o,defaultValue:m,values:d,groupId:k,className:v}=e,f=n.Children.map(e.children,(e=>{if((0,n.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),g=null!=d?d:f.map((({props:{value:e,label:t,attributes:r}})=>({value:e,label:t,attributes:r}))),b=(0,l.l)(g,((e,t)=>e.value===t.value));if(b.length>0)throw new Error(`Docusaurus error: Duplicate values "${b.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);var h;const N=null===m?m:null!==(h=null!=m?m:null===(t=f.find((e=>e.props.default)))||void 0===t?void 0:t.props.value)&&void 0!==h?h:f[0].props.value;if(null!==N&&!g.some((e=>e.value===N)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${N}" but none of its children has the corresponding value. Available values are: ${g.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:y,setTabGroupChoices:P}=(0,s.U)(),[A,C]=(0,n.useState)(N),T=[],{blockElementScrollPositionUntilNextRender:z}=(0,i.o5)();if(null!=k){const e=y[k];null!=e&&e!==A&&g.some((t=>t.value===e))&&C(e)}const M=e=>{const t=e.currentTarget,r=T.indexOf(t),n=g[r].value;n!==A&&(z(t),C(n),null!=k&&P(k,String(n)))},x=e=>{let t=null;switch(e.key){case"ArrowRight":{const n=T.indexOf(e.currentTarget)+1;var r;t=null!==(r=T[n])&&void 0!==r?r:T[0];break}case"ArrowLeft":{const r=T.indexOf(e.currentTarget)-1;var n;t=null!==(n=T[r])&&void 0!==n?n:T[T.length-1];break}}null==t||t.focus()};return n.createElement("div",{className:(0,a.Z)("tabs-container",u)},n.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.Z)("tabs",{"tabs--block":o},v)},g.map((({value:e,label:t,attributes:r})=>n.createElement("li",p({role:"tab",tabIndex:A===e?0:-1,"aria-selected":A===e,key:e,ref:e=>T.push(e),onKeyDown:x,onFocus:M,onClick:M},r,{className:(0,a.Z)("tabs__item",c,null==r?void 0:r.className,{"tabs__item--active":A===e})}),null!=t?t:e)))),r?(0,n.cloneElement)(f.filter((e=>e.props.value===A))[0],{className:"margin-top--md"}):n.createElement("div",{className:"margin-top--md"},f.map(((e,t)=>(0,n.cloneElement)(e,{key:t,hidden:e.props.value!==A})))))}function d(e){const t=(0,o.Z)();return n.createElement(m,p({key:String(t)},e))}},78400:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>p,contentTitle:()=>u,default:()=>k,frontMatter:()=>i,metadata:()=>c,toc:()=>m});r(67294);var n=r(3905),a=r(67709),o=r(7626);function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},l.apply(this,arguments)}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}const i={id:"secure-your-map-platform",title:"S\xe9curisez votre plateforme MAP"},u=void 0,c={unversionedId:"graph-views/secure-your-map-platform",id:"version-23.10/graph-views/secure-your-map-platform",title:"S\xe9curisez votre plateforme MAP",description:"Ce chapitre d\xe9crit les proc\xe9dures avanc\xe9es permettant de s\xe9curiser votre plateforme MAP et MAP (Legacy).",source:"@site/i18n/fr/docusaurus-plugin-content-docs/version-23.10/graph-views/secure-your-map-platform.md",sourceDirName:"graph-views",slug:"/graph-views/secure-your-map-platform",permalink:"/centreon-documentation/pr-preview/pr-2832/fr/docs/graph-views/secure-your-map-platform",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/next/i18n/fr/docusaurus-plugin-content-docs/version-23.10/graph-views/secure-your-map-platform.md",tags:[],version:"23.10",lastUpdatedAt:1700565273,formattedLastUpdatedAt:"21 nov. 2023",frontMatter:{id:"secure-your-map-platform",title:"S\xe9curisez votre plateforme MAP"},sidebar:"version-23.10/docs",previous:{title:"S\xe9curisez votre plateforme",permalink:"/centreon-documentation/pr-preview/pr-2832/fr/docs/administration/secure-platform"},next:{title:"Principes de base de la supervision",permalink:"/centreon-documentation/pr-preview/pr-2832/fr/docs/monitoring/about"}},p={},m=[{value:"Configurer HTTPS/TLS sur le serveur MAP (ou MAP Legacy)",id:"configurer-httpstls-sur-le-serveur-map-ou-map-legacy",level:2},{value:"Configurer HTTPS/TLS avec une cl\xe9 reconnue",id:"configurer-httpstls-avec-une-cl\xe9-reconnue",level:3},{value:"Configuration HTTPS/TLS avec une cl\xe9 auto-sign\xe9e",id:"configuration-httpstls-avec-une-cl\xe9-auto-sign\xe9e",level:3},{value:"Activer le profil TLS du service Centreon MAP",id:"activer-le-profil-tls-du-service-centreon-map",level:3},{value:"Configurer TLS sur la connexion Broker",id:"configurer-tls-sur-la-connexion-broker",level:2},{value:"Configuration de Broker",id:"configuration-de-broker",level:3},{value:"Configuration du serveur MAP",id:"configuration-du-serveur-map",level:3},{value:"Configuration avec un certificat auto-sign\xe9",id:"configuration-avec-un-certificat-auto-sign\xe9",level:4},{value:"Configuration avec un certificat CA reconnu",id:"configuration-avec-un-certificat-ca-reconnu",level:4}],d={toc:m};function k(e){var{components:t}=e,i=s(e,["components"]);return(0,n.kt)("wrapper",l({},d,i,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"Ce chapitre d\xe9crit les proc\xe9dures avanc\xe9es permettant de s\xe9curiser votre plateforme MAP et MAP (Legacy)."),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"Si vous souhaitez utiliser MAP et MAP (Legacy) en HTTPS, vous devez s\xe9curiser \xe0 la fois votre plateforme Centreon et MAP (ou MAP Legacy). Suivez cette ",(0,n.kt)("a",l({parentName:"p"},{href:"/centreon-documentation/pr-preview/pr-2832/fr/docs/administration/secure-platform"}),"proc\xe9dure")," pour s\xe9curiser votre plateforme Centreon.")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"Des erreurs de modification de fichiers de configuration peuvent entra\xeener des dysfonctionnements du logiciel. Nous vous recommandons de faire une sauvegarde du fichier avant de le modifier et de ne changer que les param\xe8tres conseill\xe9s par Centreon.")),(0,n.kt)("h2",l({},{id:"configurer-httpstls-sur-le-serveur-map-ou-map-legacy"}),"Configurer HTTPS/TLS sur le serveur MAP (ou MAP Legacy)"),(0,n.kt)("h3",l({},{id:"configurer-httpstls-avec-une-cl\xe9-reconnue"}),"Configurer HTTPS/TLS avec une cl\xe9 reconnue"),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"Cette section d\xe9crit comment ajouter une ",(0,n.kt)("strong",{parentName:"p"},"cl\xe9 reconnue")," au serveur MAP (ou MAP Legacy)."),(0,n.kt)("p",{parentName:"blockquote"},"Si vous souhaitez cr\xe9er une cl\xe9 auto-sign\xe9e et l'ajouter \xe0 votre serveur, veuillez vous r\xe9f\xe9rer \xe0 la ",(0,n.kt)("a",l({parentName:"p"},{href:"#configuration-httpstls-avec-une-cl%C3%A9-auto-sign%C3%A9e"}),"section suivante"),".")),(0,n.kt)("p",null,"Vous aurez besoin de :"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Un fichier de cl\xe9, appel\xe9 ",(0,n.kt)("strong",{parentName:"li"},"key.key"),"."),(0,n.kt)("li",{parentName:"ul"},"Un fichier de certificat, appel\xe9 ",(0,n.kt)("strong",{parentName:"li"},"certificate.crt"),".")),(0,n.kt)("p",null,"Acc\xe9dez au serveur Centreon MAP par SSH."),(0,n.kt)("p",null,"Cr\xe9ez un fichier PKCS12 avec la ligne de commande suivante :"),(0,n.kt)("pre",null,(0,n.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"openssl pkcs12 -inkey key.key -in certificate.crt -export -out keys.pkcs12\n")),(0,n.kt)("p",null,"Ensuite, importez ce fichier dans un nouveau keystore (un d\xe9p\xf4t Java de certificats de s\xe9curit\xe9) :"),(0,n.kt)("pre",null,(0,n.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"keytool -importkeystore -srckeystore keys.pkcs12 -srcstoretype pkcs12 -destkeystore studio.jks\n")),(0,n.kt)("p",null,"Placez le fichier keystore ci-dessus (studio.jks) dans le dossier ",(0,n.kt)("strong",{parentName:"p"},"/etc/centreon-map/"),", et d\xe9finissez les param\xe8tres ci-dessous dans ",(0,n.kt)("strong",{parentName:"p"},"/etc/centreon-map/map-config.properties")," :"),(0,n.kt)("pre",null,(0,n.kt)("code",l({parentName:"pre"},{className:"language-text"}),"centreon-map.keystore=/etc/centreon-map/studio.jks\ncentreon-map.keystore-pass=xxx\n")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},'Remplacez la valeur "xxx" de keystore-pass par le mot de passe que vous avez utilis\xe9 pour le keystore et adaptez le chemin vers le keystore (s\'il a \xe9t\xe9 modifi\xe9).')),(0,n.kt)("h3",l({},{id:"configuration-httpstls-avec-une-cl\xe9-auto-sign\xe9e"}),"Configuration HTTPS/TLS avec une cl\xe9 auto-sign\xe9e"),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"L'activation du mode TLS avec une cl\xe9 auto-sign\xe9e obligera chaque utilisateur \xe0 ajouter une exception pour le certificat avant d'utiliser l'interface web."),(0,n.kt)("p",{parentName:"blockquote"},"Ne l'activez que si votre Centreon utilise \xe9galement ce protocole."),(0,n.kt)("p",{parentName:"blockquote"},"Les utilisateurs devront ouvrir l'URL :"),(0,n.kt)("ul",{parentName:"blockquote"},(0,n.kt)("li",{parentName:"ul"},"MAP :")),(0,n.kt)("pre",{parentName:"blockquote"},(0,n.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"https://<MAP_IP>:9443/centreon-map/api/beta/actuator/health\n")),(0,n.kt)("ul",{parentName:"blockquote"},(0,n.kt)("li",{parentName:"ul"},"MAP (Legacy) :")),(0,n.kt)("pre",{parentName:"blockquote"},(0,n.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"https://<MAP_IP>:8443/centreon-studio/api/beta/actuator/health\n")),(0,n.kt)("p",{parentName:"blockquote"},(0,n.kt)("em",{parentName:"p"},"La solution que nous recommandons est d'utiliser une m\xe9thode de cl\xe9 reconnue, comme expliqu\xe9 ci-dessus."))),(0,n.kt)("p",null,"Sur le serveur Centreon MAP, cr\xe9ez un keystore."),(0,n.kt)("p",null,"Allez dans le dossier o\xf9 Java est install\xe9 :"),(0,n.kt)("pre",null,(0,n.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"cd $JAVA_HOME/bin\n")),(0,n.kt)("p",null,"Ensuite, g\xe9n\xe9rez un fichier keystore avec la commande suivante :"),(0,n.kt)("pre",null,(0,n.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"keytool -genkey -alias studio -keyalg RSA -keystore /etc/centreon-studio/studio.jks\n")),(0,n.kt)("p",null,'La valeur de l\'alias "studio" et le chemin du fichier keystore ',(0,n.kt)("strong",{parentName:"p"},"/etc/centreon-studio/studio.jks")," peuvent \xeatre modifi\xe9s, mais \xe0 moins d'une raison sp\xe9cifique, nous conseillons de conserver les valeurs par d\xe9faut."),(0,n.kt)("p",null,"Fournissez les informations n\xe9cessaires lors de la cr\xe9ation du keystore."),(0,n.kt)("p",null,'\xc0 la fin du formulaire, lorsque le "mot de passe de la cl\xe9" est demand\xe9, utilisez le m\xeame mot de passe que celui utilis\xe9 pour le keystore lui-m\xeame en appuyant sur la touche ',(0,n.kt)("strong",{parentName:"p"},"Entr\xe9e"),"."),(0,n.kt)("p",null,"Placez le fichier keystore ci-dessus (",(0,n.kt)("strong",{parentName:"p"},"studio.jks"),") dans le dossier ",(0,n.kt)("strong",{parentName:"p"},"/etc/centreon-map/"),", et d\xe9finissez les param\xe8tres ci-dessous dans ",(0,n.kt)("strong",{parentName:"p"},"/etc/centreon-map/map-config.properties")," :"),(0,n.kt)("pre",null,(0,n.kt)("code",l({parentName:"pre"},{className:"language-text"}),"centreon-map.keystore=/etc/centreon-map/studio.jks\ncentreon-map.keystore-pass=xxx\n")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},'Remplacez la valeur keystore-pass "xxx" par le mot de passe que vous avez utilis\xe9 pour le keystore et adaptez le chemin (s\'il a \xe9t\xe9 modifi\xe9 dans le keystore).')),(0,n.kt)("h3",l({},{id:"activer-le-profil-tls-du-service-centreon-map"}),"Activer le profil TLS du service Centreon MAP"),(0,n.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,n.kt)(o.Z,{value:"MAP",label:"MAP",mdxType:"TabItem"},(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Arr\xeatez le service Centreon MAP :"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"systemctl stop centreon-map-engine\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Modifiez le fichier ",(0,n.kt)("inlineCode",{parentName:"p"},"/etc/centreon-map/centreon-map.conf"),', en ajoutant ",tls" apr\xe8s le profil "prod" :'),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",l({parentName:"pre"},{className:"language-text"}),'RUN_ARGS="--spring.profiles.active=prod,tls"\n'))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Red\xe9marrez le service Centreon MAP :"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"systemctl start centreon-map-engine\n"))))),(0,n.kt)(o.Z,{value:"MAP (Legacy)",label:"MAP (Legacy)",mdxType:"TabItem"},(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Arr\xeatez le service Centreon MAP :"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"systemctl stop centreon-map\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Modifiez le fichier ",(0,n.kt)("inlineCode",{parentName:"p"},"/etc/centreon-studio/centreon-map.conf"),', en ajoutant ",tls" apr\xe8s le profil "prod" :'),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",l({parentName:"pre"},{className:"language-text"}),'RUN_ARGS="--spring.profiles.active=prod,tls"\n'))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Red\xe9marrez le service Centreon MAP :"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"systemctl start centreon-map\n")))))),(0,n.kt)("p",null,"Le serveur MAP est maintenant configur\xe9 pour r\xe9pondre aux demandes provenant de HTTPS :"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"sur le port 9443 pour MAP,"),(0,n.kt)("li",{parentName:"ul"},"sur le port 8443 pour MAP (Legacy).")),(0,n.kt)("p",null,"Pour modifier le port par d\xe9faut, reportez-vous \xe0 la ",(0,n.kt)("a",l({parentName:"p"},{href:"/centreon-documentation/pr-preview/pr-2832/fr/docs/graph-views/advanced-configuration#changer-le-port-du-serveur-centreon-map"}),"proc\xe9dure d\xe9di\xe9e"),"."),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"N'oubliez pas de modifier l'URL c\xf4t\xe9 Centreon dans le champ ",(0,n.kt)("strong",{parentName:"p"},"Adresse du serveur Centreon MAP")," du menu ",(0,n.kt)("strong",{parentName:"p"},"Administration > Extensions > Map > Options"),".")),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"image",src:r(17464).Z,width:"1671",height:"851"})),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"N'oubliez pas de mettre \xe0 jour votre profil de connexion dans le client lourd en cochant la case SSL.")),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"image",src:r(49254).Z,width:"500",height:"290"})),(0,n.kt)("h2",l({},{id:"configurer-tls-sur-la-connexion-broker"}),"Configurer TLS sur la connexion Broker"),(0,n.kt)("p",null,"Une sortie Broker suppl\xe9mentaire pour Centreon Central (centreon-broker-master) a \xe9t\xe9 cr\xe9\xe9e pendant l'installation."),(0,n.kt)("p",null,"Vous pouvez la v\xe9rifier dans votre interface web Centreon, \xe0 la page ",(0,n.kt)("strong",{parentName:"p"},"Configuration > Collecteurs > Configuration de Centreon Broker"),", en \xe9ditant la configuration ",(0,n.kt)("strong",{parentName:"p"},"centreon-broker-master"),"."),(0,n.kt)("p",null,"La configuration \xe9dit\xe9e doit ressembler \xe0 ceci :"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"image",src:r(58862).Z,width:"1749",height:"862"})),(0,n.kt)("h3",l({},{id:"configuration-de-broker"}),"Configuration de Broker"),(0,n.kt)("p",null,"Vous pouvez activer la sortie TLS et configurer la cl\xe9 priv\xe9e et le certificat public de Broker comme d\xe9crit ci-dessous :"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"image",src:r(31207).Z,width:"1222",height:"471"})),(0,n.kt)("p",null,"Pour cr\xe9er un certificat auto-sign\xe9, vous pouvez utiliser les commandes suivantes :"),(0,n.kt)("pre",null,(0,n.kt)("code",l({parentName:"pre"},{className:"language-text"}),"openssl req -new -newkey rsa:2048 -nodes -keyout broker_private.key -out broker.csr\nopenssl x509 -req -in broker.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out broker_public.crt -days 365 -sha256\n")),(0,n.kt)("p",null,"Et ensuite, copiez la cl\xe9 priv\xe9e et le certificat dans le r\xe9pertoire ",(0,n.kt)("strong",{parentName:"p"},"/etc/centreon/broker_cert/")," :"),(0,n.kt)("pre",null,(0,n.kt)("code",l({parentName:"pre"},{className:"language-text"}),"mv broker_private.key /etc/centreon/broker_cert/\nmv broker_public.crt /etc/centreon/broker_cert/\n")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},'Le champ "Trusted CA\'s certificate" est facultatif. Si vous activez l\'authentification client de Broker en d\xe9finissant ce "ca',"_",'certificate.crt", vous devez alors configurer un ',(0,n.kt)("a",l({parentName:"p"},{href:"#configurer-httpstls-sur-le-serveur-map"}),"keystore pour le serveur MAP")),(0,n.kt)("p",{parentName:"blockquote"},"Vous devez pousser la nouvelle configuration du broker et red\xe9marrer le broker apr\xe8s la configuration.")),(0,n.kt)("h3",l({},{id:"configuration-du-serveur-map"}),"Configuration du serveur MAP"),(0,n.kt)("p",null,"Tout d'abord, vous devez ",(0,n.kt)("a",l({parentName:"p"},{href:"/centreon-documentation/pr-preview/pr-2832/fr/docs/administration/secure-platform#activer-le-mode-https-sur-le-serveur-web"}),"activer HTTPS/TLS sur le serveur web")),(0,n.kt)("p",null,"Ensuite, d\xe9finissez les param\xe8tres suivants dans la configuration du serveur MAP dans :"),(0,n.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,n.kt)(o.Z,{value:"MAP",label:"MAP",mdxType:"TabItem"},(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"/etc/centreon-map/centreon-map.conf"))),(0,n.kt)(o.Z,{value:"MAP (Legacy)",label:"MAP (Legacy)",mdxType:"TabItem"},(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"/etc/centreon-studio/studio-config.properties")))),(0,n.kt)("p",null,"D\xe9finissez le protocole de communication avec le serveur Centreon comme \xe9tant HTTPS :"),(0,n.kt)("pre",null,(0,n.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"centreon.url=https://<server-address>\n")),(0,n.kt)("p",null,"Pour activer la connexion par socket TLS avec le Broker :"),(0,n.kt)("pre",null,(0,n.kt)("code",l({parentName:"pre"},{className:"language-text"}),"broker.tls=true\n")),(0,n.kt)("h4",l({},{id:"configuration-avec-un-certificat-auto-sign\xe9"}),"Configuration avec un certificat auto-sign\xe9"),(0,n.kt)("p",null,"Si le certificat public de Broker est auto-sign\xe9, vous devez cr\xe9er un trust store contenant le certificat donn\xe9 ou son certificat CA avec la ligne de commande suivante :"),(0,n.kt)("pre",null,(0,n.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"keytool -import -alias centreon-broker -file broker_public.crt -keystore truststore.jks\n")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},'"broker',"_",'public.crt" est le certificat public de Broker ou son certificat CA au format PEM,'),(0,n.kt)("li",{parentName:"ul"},'"truststore.jks" est le trust store g\xe9n\xe9r\xe9 au format JKS,'),(0,n.kt)("li",{parentName:"ul"},"un mot de passe du trust store est requis pendant la g\xe9n\xe9ration.")),(0,n.kt)("p",null,"Ensuite, mettez le fichier de sortie g\xe9n\xe9r\xe9 ",(0,n.kt)("strong",{parentName:"p"},"truststore.jks")," dans ",(0,n.kt)("strong",{parentName:"p"},"/etc/centreon-studio")," de l'h\xf4te du serveur MAP."),(0,n.kt)("p",null,"Et ajoutez les param\xe8tres de trust store dans ",(0,n.kt)("strong",{parentName:"p"},"/etc/centreon-studio/studio-config.properties")," :"),(0,n.kt)("pre",null,(0,n.kt)("code",l({parentName:"pre"},{className:"language-text"}),"centreon-map.truststore=/etc/centreon-studio/truststore.jks\ncentreon-map.truststore-pass=XXXX\n")),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},'Remplacez la valeur "xxx" de trustStorePassword par le mot de passe que vous avez utilis\xe9 pour g\xe9n\xe9rer le trust store.')),(0,n.kt)("p",null,'En attendant, vous devez activer le profil "tls_broker" du service Centreon MAP.'),(0,n.kt)("p",null,"Editez le fichier ",(0,n.kt)("strong",{parentName:"p"},"/etc/centreon-studio/centreon-map.conf"),', et remplacez ",tls" par ",tls_broker" apr\xe8s le profil "prod" :'),(0,n.kt)("pre",null,(0,n.kt)("code",l({parentName:"pre"},{className:"language-text"}),'RUN_ARGS="--spring.profiles.active=prod,tls_broker"\n')),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},'Le profil "tls_broker" implique le profil "tls". Ainsi, le service Centreon MAP sert n\xe9cessairement HTTPS.')),(0,n.kt)("p",null,"Une fois que vous avez ajout\xe9 un truststore, Centreon MAP l'utilisera pour valider les certificats auto-sign\xe9s.\nCela signifie que si vous utilisez un certificat auto-sign\xe9 pour le serveur central, vous devez l'ajouter au truststore.\nSi vous ne le faites pas, la page ",(0,n.kt)("strong",{parentName:"p"},"Supervision > Map")," sera vide, et les journaux (",(0,n.kt)("strong",{parentName:"p"},"/var/log/centreon-map/centreon-map.log"),") afficheront l'erreur suivante : ",(0,n.kt)("inlineCode",{parentName:"p"},"unable to find valid certification path to requested target"),"."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Copiez le certificat ",(0,n.kt)("strong",{parentName:"p"},".crt")," du serveur central sur le serveur MAP.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Ajoutez le certificat au truststore :"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",l({parentName:"pre"},{className:"language-shell"}),"keytool -import -alias centreon-broker -file central_public.crt -keystore truststore.jks\n")))),(0,n.kt)("h4",l({},{id:"configuration-avec-un-certificat-ca-reconnu"}),"Configuration avec un certificat CA reconnu"),(0,n.kt)("p",null,'Si le certificat public de Broker est sign\xe9 par une autorit\xe9 de certification reconnue, le truststore par d\xe9faut de la JVM "cacerts ',(0,n.kt)("strong",{parentName:"p"},"/etc/pki/java/cacerts"),"\" sera utilis\xe9. Il n'y a rien \xe0 configurer pour le service Centreon MAP."))}k.isMDXComponent=!0},49254:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/desktop-ssl-option-c197b2980434a9b031c9da253615b09e.png"},17464:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/map-address-https-fc6a107dda2236d28ff090b466462bde.png"},58862:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/output_broker-d0802d9221a4f83e7394ad8134607b35.png"},31207:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/output_broker_tls-06c7ceab462d3430c573d0546159aef1.png"}}]);