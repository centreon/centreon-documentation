"use strict";(self.webpackChunkcentreon_docs=self.webpackChunkcentreon_docs||[]).push([[11755],{3905:(e,r,n)=>{n.d(r,{Zo:()=>p,kt:()=>m});var t=n(67294);function a(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function o(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function s(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?o(Object(n),!0).forEach((function(r){a(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function l(e,r){if(null==e)return{};var n,t,a=function(e,r){if(null==e)return{};var n,t,a={},o=Object.keys(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||(a[n]=e[n]);return a}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var i=t.createContext({}),u=function(e){var r=t.useContext(i),n=r;return e&&(n="function"==typeof e?e(r):s(s({},r),e)),n},p=function(e){var r=u(e.components);return t.createElement(i.Provider,{value:r},e.children)},d={inlineCode:"code",wrapper:function(e){var r=e.children;return t.createElement(t.Fragment,{},r)}},c=t.forwardRef((function(e,r){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=u(n),m=a,g=c["".concat(i,".").concat(m)]||c[m]||d[m]||o;return n?t.createElement(g,s(s({ref:r},p),{},{components:n})):t.createElement(g,s({ref:r},p))}));function m(e,r){var n=arguments,a=r&&r.mdxType;if("string"==typeof e||a){var o=n.length,s=new Array(o);s[0]=c;var l={};for(var i in r)hasOwnProperty.call(r,i)&&(l[i]=r[i]);l.originalType=e,l.mdxType="string"==typeof e?e:a,s[1]=l;for(var u=2;u<o;u++)s[u]=n[u];return t.createElement.apply(null,s)}return t.createElement.apply(null,n)}c.displayName="MDXCreateElement"},7626:(e,r,n)=>{n.d(r,{Z:()=>l});var t=n(67294),a=n(86010);const o="tabItem_Ymn6";function s(){return s=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},s.apply(this,arguments)}function l({children:e,hidden:r,className:n}){return t.createElement("div",s({role:"tabpanel",className:(0,a.Z)(o,n)},{hidden:r}),e)}},67709:(e,r,n)=>{n.d(r,{Z:()=>m});var t=n(67294),a=n(86010),o=n(90980),s=n(35715),l=n(8854),i=n(8241);const u="tabList__CuJ",p="tabItem_LNqP";function d(){return d=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},d.apply(this,arguments)}function c(e){var r;const{lazy:n,block:o,defaultValue:c,values:m,groupId:g,className:v}=e,k=t.Children.map(e.children,(e=>{if((0,t.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),b=null!=m?m:k.map((({props:{value:e,label:r,attributes:n}})=>({value:e,label:r,attributes:n}))),f=(0,s.l)(b,((e,r)=>e.value===r.value));if(f.length>0)throw new Error(`Docusaurus error: Duplicate values "${f.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);var h;const N=null===c?c:null!==(h=null!=c?c:null===(r=k.find((e=>e.props.default)))||void 0===r?void 0:r.props.value)&&void 0!==h?h:k[0].props.value;if(null!==N&&!b.some((e=>e.value===N)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${N}" but none of its children has the corresponding value. Available values are: ${b.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:y,setTabGroupChoices:x}=(0,l.U)(),[I,j]=(0,t.useState)(N),w=[],{blockElementScrollPositionUntilNextRender:O}=(0,i.o5)();if(null!=g){const e=y[g];null!=e&&e!==I&&b.some((r=>r.value===e))&&j(e)}const R=e=>{const r=e.currentTarget,n=w.indexOf(r),t=b[n].value;t!==I&&(O(r),j(t),null!=g&&x(g,String(t)))},C=e=>{let r=null;switch(e.key){case"ArrowRight":{const t=w.indexOf(e.currentTarget)+1;var n;r=null!==(n=w[t])&&void 0!==n?n:w[0];break}case"ArrowLeft":{const n=w.indexOf(e.currentTarget)-1;var t;r=null!==(t=w[n])&&void 0!==t?t:w[w.length-1];break}}null==r||r.focus()};return t.createElement("div",{className:(0,a.Z)("tabs-container",u)},t.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.Z)("tabs",{"tabs--block":o},v)},b.map((({value:e,label:r,attributes:n})=>t.createElement("li",d({role:"tab",tabIndex:I===e?0:-1,"aria-selected":I===e,key:e,ref:e=>w.push(e),onKeyDown:C,onFocus:R,onClick:R},n,{className:(0,a.Z)("tabs__item",p,null==n?void 0:n.className,{"tabs__item--active":I===e})}),null!=r?r:e)))),n?(0,t.cloneElement)(k.filter((e=>e.props.value===I))[0],{className:"margin-top--md"}):t.createElement("div",{className:"margin-top--md"},k.map(((e,r)=>(0,t.cloneElement)(e,{key:r,hidden:e.props.value!==I})))))}function m(e){const r=(0,o.Z)();return t.createElement(c,d({key:String(r)},e))}},9623:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>d,contentTitle:()=>u,default:()=>g,frontMatter:()=>i,metadata:()=>p,toc:()=>c});n(67294);var t=n(3905),a=n(67709),o=n(7626);function s(){return s=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},s.apply(this,arguments)}function l(e,r){if(null==e)return{};var n,t,a=function(e,r){if(null==e)return{};var n,t,a={},o=Object.keys(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||(a[n]=e[n]);return a}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}const i={id:"backup-restore",title:"Sauvegarde et restauration"},u=void 0,p={unversionedId:"reporting/backup-restore",id:"version-23.10/reporting/backup-restore",title:"Sauvegarde et restauration",description:"Sauvegarde de Centreon MBI",source:"@site/i18n/fr/docusaurus-plugin-content-docs/version-23.10/reporting/backup-restore.md",sourceDirName:"reporting",slug:"/reporting/backup-restore",permalink:"/centreon-documentation/pr-preview/pr-2832/fr/docs/reporting/backup-restore",draft:!1,editUrl:"https://github.com/centreon/centreon-documentation/edit/next/i18n/fr/docusaurus-plugin-content-docs/version-23.10/reporting/backup-restore.md",tags:[],version:"23.10",lastUpdatedAt:1700565273,formattedLastUpdatedAt:"21 nov. 2023",frontMatter:{id:"backup-restore",title:"Sauvegarde et restauration"},sidebar:"version-23.10/docs",previous:{title:"Migrer l'extension",permalink:"/centreon-documentation/pr-preview/pr-2832/fr/docs/reporting/migrate"},next:{title:"Centreon UI",permalink:"/centreon-documentation/pr-preview/pr-2832/fr/docs/administration/parameters/centreon-ui"}},d={},c=[{value:"Sauvegarde de Centreon MBI",id:"sauvegarde-de-centreon-mbi",level:2},{value:"Sauvegarde des donn\xe9es de configuration",id:"sauvegarde-des-donn\xe9es-de-configuration",level:3},{value:"Elements sauvegard\xe9s",id:"elements-sauvegard\xe9s",level:4},{value:"Fonctionnement du script de sauvegarde",id:"fonctionnement-du-script-de-sauvegarde",level:4},{value:"P\xe9riodicit\xe9 des sauvegardes",id:"p\xe9riodicit\xe9-des-sauvegardes",level:4},{value:"Sauvegarde du serveur de reporting d\xe9di\xe9",id:"sauvegarde-du-serveur-de-reporting-d\xe9di\xe9",level:3},{value:"\xc9l\xe9ments sauvegard\xe9s",id:"\xe9l\xe9ments-sauvegard\xe9s",level:4},{value:"Fonctionnement du script de sauvegarde sur un serveur central",id:"fonctionnement-du-script-de-sauvegarde-sur-un-serveur-central",level:4},{value:"P\xe9riodicit\xe9 des sauvegardes",id:"p\xe9riodicit\xe9-des-sauvegardes-1",level:4},{value:"Restauration de Centreon MBI",id:"restauration-de-centreon-mbi",level:2},{value:"Restauration des donn\xe9es de configuration",id:"restauration-des-donn\xe9es-de-configuration",level:3},{value:"R\xe9installation du module Centreon MBI",id:"r\xe9installation-du-module-centreon-mbi",level:4},{value:"Int\xe9gration des anciens rapports g\xe9n\xe9r\xe9s",id:"int\xe9gration-des-anciens-rapports-g\xe9n\xe9r\xe9s",level:4},{value:"Int\xe9gration des param\xe8tres de rapports personnalis\xe9s",id:"int\xe9gration-des-param\xe8tres-de-rapports-personnalis\xe9s",level:4},{value:"Int\xe9gration des donn\xe9es de configuration Centreon MBI",id:"int\xe9gration-des-donn\xe9es-de-configuration-centreon-mbi",level:4},{value:"Supprimer les donn\xe9es extraites de la sauvegarde",id:"supprimer-les-donn\xe9es-extraites-de-la-sauvegarde",level:4},{value:"Restauration des param\xe8tres du serveur de reporting Centreon MBI",id:"restauration-des-param\xe8tres-du-serveur-de-reporting-centreon-mbi",level:3},{value:"R\xe9installation du module Centreon MBI",id:"r\xe9installation-du-module-centreon-mbi-1",level:4},{value:"Int\xe9gration de la configuration du moteur CBIS",id:"int\xe9gration-de-la-configuration-du-moteur-cbis",level:4},{value:"Int\xe9gration des mod\xe8les de rapports personnalis\xe9s",id:"int\xe9gration-des-mod\xe8les-de-rapports-personnalis\xe9s",level:4},{value:"Int\xe9gration des donn\xe9es MariaDB",id:"int\xe9gration-des-donn\xe9es-mariadb",level:3},{value:"Red\xe9marrer le moteur CBIS",id:"red\xe9marrer-le-moteur-cbis",level:4},{value:"Supprimer les donn\xe9es extraites de la sauvegarde",id:"supprimer-les-donn\xe9es-extraites-de-la-sauvegarde-1",level:4}],m={toc:c};function g(e){var{components:r}=e,n=l(e,["components"]);return(0,t.kt)("wrapper",s({},m,n,{components:r,mdxType:"MDXLayout"}),(0,t.kt)("h2",s({},{id:"sauvegarde-de-centreon-mbi"}),"Sauvegarde de Centreon MBI"),(0,t.kt)("h3",s({},{id:"sauvegarde-des-donn\xe9es-de-configuration"}),"Sauvegarde des donn\xe9es de configuration"),(0,t.kt)("h4",s({},{id:"elements-sauvegard\xe9s"}),"Elements sauvegard\xe9s"),(0,t.kt)("p",null,"Les \xe9l\xe9ments sauvegard\xe9s sont les suivants :"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Sauvegarde des mod\xe8les de rapports personnalis\xe9s et de leur\nparam\xe8trage"),(0,t.kt)("li",{parentName:"ul"},"Sauvegarde des rapports g\xe9n\xe9r\xe9s")),(0,t.kt)("h4",s({},{id:"fonctionnement-du-script-de-sauvegarde"}),"Fonctionnement du script de sauvegarde"),(0,t.kt)("p",null,"Le script de sauvegarde est ex\xe9cut\xe9 de mani\xe8re journali\xe8re via un cron\nd\xe9fini dans le fichier ",(0,t.kt)("strong",{parentName:"p"},"/etc/cron.d/centreon-bi-backup-web")," :"),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{}),'#\n# Cron to backup Centreon MBI Engine frontend module\n#\nPATH=/sbin:/bin:/usr/sbin:/usr/bin\n\n# rewrite file with new cron line\nCRONTAB_EXEC_USER=""\n\n0 12 * * * root bash /usr/share/centreon-bi-backup/centreon-bi-backup-web.sh >> /var/log/centreon-bi/centreon-bi-backup-web.log 2>&1\n')),(0,t.kt)("p",null,"Les donn\xe9es sauvegard\xe9es se trouvent par d\xe9faut dans le r\xe9pertoire :\n",(0,t.kt)("strong",{parentName:"p"},"/var/backup"),"."),(0,t.kt)("p",null,"Pour modifier ce r\xe9pertoire, mettre \xe0 jour la valeur ",(0,t.kt)("strong",{parentName:"p"},"BACKUP","_","DIR"),"\n(ligne ",(0,t.kt)("strong",{parentName:"p"},"63"),") dans le script de sauvegarde :\n",(0,t.kt)("strong",{parentName:"p"},"/usr/share/centreon-bi-backup/centreon-bi-backup-web.sh")),(0,t.kt)("p",null,"Sur un server Centreon seule la configuration, les rapports g\xe9n\xe9r\xe9s et\nles mod\xe8les de rapports personnalis\xe9s ont besoin d'\xeatre sauvegard\xe9s. La\nsauvegarde est au format suivant :\ncentreon-bi-front-reports-and-custom-conf-aaaa-mm-jj.tar.gz"),(0,t.kt)("h4",s({},{id:"p\xe9riodicit\xe9-des-sauvegardes"}),"P\xe9riodicit\xe9 des sauvegardes"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"P\xe9riodicit\xe9 des sauvegardes : journali\xe8res"),(0,t.kt)("li",{parentName:"ul"},"Rotation des sauvegardes : 8 jours")),(0,t.kt)("p",null,"Pour modifier la valeur de rotation des sauvegardes, \xe9diter la valeur\n",(0,t.kt)("strong",{parentName:"p"},"RETENTION","_","AGE")," (ligne ",(0,t.kt)("strong",{parentName:"p"},"67"),") dans le script de sauvegarde :\n",(0,t.kt)("strong",{parentName:"p"},"/usr/share/centreon-bi-backup/centreon-bi-backup-web.sh")),(0,t.kt)("blockquote",null,(0,t.kt)("p",{parentName:"blockquote"},"Il est important d'exporter les sauvegardes sur une autre machine\nafin d'assurer leurs p\xe9rennit\xe9s.")),(0,t.kt)("h3",s({},{id:"sauvegarde-du-serveur-de-reporting-d\xe9di\xe9"}),"Sauvegarde du serveur de reporting d\xe9di\xe9"),(0,t.kt)("blockquote",null,(0,t.kt)("p",{parentName:"blockquote"},"Il est important de disposer d'au moins 5 Go d'espace libre sur le\n",(0,t.kt)("strong",{parentName:"p"},"Volume Group")," h\xe9bergeant l'espace de stockage ",(0,t.kt)("strong",{parentName:"p"},"data")," du SGBD\nMariaDB. Pour cela, ex\xe9cuter la commande suivante en renseignant\nle nom du ",(0,t.kt)("strong",{parentName:"p"},"Volume Group")," :")),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{}),"vgdisplay vg_data | grep -i free \n")),(0,t.kt)("h4",s({},{id:"\xe9l\xe9ments-sauvegard\xe9s"}),"\xc9l\xe9ments sauvegard\xe9s"),(0,t.kt)("p",null,"Les \xe9l\xe9ments sauvegard\xe9s sont les suivants :"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Param\xe8tres de configuration du moteur de g\xe9n\xe9ration de rapports"),(0,t.kt)("li",{parentName:"ul"},"Donn\xe9es agr\xe9gg\xe9es"),(0,t.kt)("li",{parentName:"ul"},"Rapports & ressources")),(0,t.kt)("h4",s({},{id:"fonctionnement-du-script-de-sauvegarde-sur-un-serveur-central"}),"Fonctionnement du script de sauvegarde sur un serveur central"),(0,t.kt)("p",null,"Le script de sauvegarde est ex\xe9cut\xe9 de mani\xe8re journali\xe8re via un cron\nd\xe9fini dans le fichier\n",(0,t.kt)("strong",{parentName:"p"},"/etc/cron.d/centreon-bi-backup-reporting-server")," :"),(0,t.kt)("blockquote",null,(0,t.kt)("pre",{parentName:"blockquote"},(0,t.kt)("code",s({parentName:"pre"},{}),'#\n# Cron to backup Centreon MBI reporting server\n#\nPATH=/sbin:/bin:/usr/sbin:/usr/bin\n\n# rewrite file with new cron line\nCRONTAB_EXEC_USER=""\n\n30 12 * * 0 root bash /usr/share/centreon-bi-backup/centreon-bi-backup-reporting-server.sh --total >> /var/log/centreon-bi/centreon-bi-backup-reporting-server-db.log 2>&1\n30 12 * * 1-6 root bash /usr/share/centreon-bi-backup/centreon-bi-backup-reporting-server.sh --totalincr >> /var/log/centreon-bi/centreon-bi-backup-reporting-server-db.log 2>&1\n0 12 * * * root bash /usr/share/centreon-bi-backup/centreon-bi-backup-reporting-server.sh --centreonbifiles >> /var/log/centreon-bi/centreon-bi-backup-reporting-server-files.log 2>&1\n'))),(0,t.kt)("p",null,"Les donn\xe9es sauvegard\xe9es se trouvent par d\xe9faut dans le r\xe9pertoire :\n",(0,t.kt)("strong",{parentName:"p"},"/var/backup"),"."),(0,t.kt)("p",null,"Pour modifier ce r\xe9pertoire, mettre \xe0 jour la valeur ",(0,t.kt)("strong",{parentName:"p"},"BACKUP","_","DIR"),"\n(ligne ",(0,t.kt)("strong",{parentName:"p"},"83"),") dans le script de sauvegarde :\n",(0,t.kt)("strong",{parentName:"p"},"/usr/share/centreon-bi-backup/centreon-bi-backup-reporting-server.sh")),(0,t.kt)("p",null,"Trois types de sauvegarde sont ex\xe9cut\xe9s dans la semaine :"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"tous les jours une sauvegarde des fichiers de configuration du\nmoteur de g\xe9n\xe9ration des rapports, format :\ncentreon-bin-reports-and-conf-aaaa-mm-jj.tar.gz"),(0,t.kt)("li",{parentName:"ul"},"tous les dimanches une sauvegarde compl\xe8te de l'ETL, format :\nmysql-centreon","_","storage-bi-aaaa-mm-jj.tar.gz"),(0,t.kt)("li",{parentName:"ul"},"du lundi au samedi une sauvegarde incr\xe9mentale de l'ETL (toutes les\ntables et seulement la derni\xe8re partition des tables partitionn\xe9es),\nformat : mysql-centreon","_","storage-bi-aaaa-mm-jj.tar.gz")),(0,t.kt)("blockquote",null,(0,t.kt)("p",{parentName:"blockquote"},(0,t.kt)("strong",{parentName:"p"},"Important")),(0,t.kt)("p",{parentName:"blockquote"},"Bien s'assurer que pendant la sauvegarde du serveur de repoting, les\nscipts ETL ne doivent pas \xeatre en cours d'execution. De plus, aucun\nrapport ne doit \xeatre en cours de g\xe9n\xe9ration.")),(0,t.kt)("h4",s({},{id:"p\xe9riodicit\xe9-des-sauvegardes-1"}),"P\xe9riodicit\xe9 des sauvegardes"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"P\xe9riodicit\xe9 des sauvegardes : journali\xe8res"),(0,t.kt)("li",{parentName:"ul"},"Rotation des sauvegardes : 8 jours")),(0,t.kt)("p",null,"Pour modifier la valeur de rotation des sauvegardes, \xe9diter la valeur\n",(0,t.kt)("strong",{parentName:"p"},"RETENTION","_","AGE")," (ligne ",(0,t.kt)("strong",{parentName:"p"},"88"),") dans le script de sauvegarde :\n",(0,t.kt)("strong",{parentName:"p"},"/usr/share/centreon-bi-backup/centreon-bi-backup-reporting-server.sh")),(0,t.kt)("blockquote",null,(0,t.kt)("p",{parentName:"blockquote"},"Il est important d'exporter les sauvegardes sur une autre machine\nafin d'assurer leurs p\xe9rennit\xe9s.")),(0,t.kt)("h2",s({},{id:"restauration-de-centreon-mbi"}),"Restauration de Centreon MBI"),(0,t.kt)("h3",s({},{id:"restauration-des-donn\xe9es-de-configuration"}),"Restauration des donn\xe9es de configuration"),(0,t.kt)("p",null,"Le processus de restauration comprend plusieurs \xe9tapes :"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"R\xe9installation du module ",(0,t.kt)("strong",{parentName:"li"},"centreon-bi-server")," dans une version\nidentique \xe0 celle sauvegard\xe9e."),(0,t.kt)("li",{parentName:"ul"},"Int\xe9gration des anciens rapports g\xe9n\xe9r\xe9s."),(0,t.kt)("li",{parentName:"ul"},"Int\xe9gration des param\xe8tres de rapports personnalis\xe9s."),(0,t.kt)("li",{parentName:"ul"},"Int\xe9gration des donn\xe9es de configuration Centreon MBI."),(0,t.kt)("li",{parentName:"ul"},"Int\xe9gration des donn\xe9es MariaDB."),(0,t.kt)("li",{parentName:"ul"},"Supprimer les donn\xe9es extraites de la sauvegarde."),(0,t.kt)("li",{parentName:"ul"},"R\xe9installer la sauvegarde.")),(0,t.kt)("h4",s({},{id:"r\xe9installation-du-module-centreon-mbi"}),"R\xe9installation du module Centreon MBI"),(0,t.kt)("p",null,"Sur le serveur central Centreon, lancer la commande :"),(0,t.kt)(a.Z,{groupId:"sync",mdxType:"Tabs"},(0,t.kt)(o.Z,{value:"Alma / RHEL / Oracle Linux 8",label:"Alma / RHEL / Oracle Linux 8",mdxType:"TabItem"},(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{className:"language-shell"}),"dnf install centreon-bi-server-x.y.z\n"))),(0,t.kt)(o.Z,{value:"Alma / RHEL / Oracle Linux 9",label:"Alma / RHEL / Oracle Linux 9",mdxType:"TabItem"},(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{className:"language-shell"}),"dnf install centreon-bi-server-x.y.z\n"))),(0,t.kt)(o.Z,{value:"Debian 11",label:"Debian 11",mdxType:"TabItem"},(0,t.kt)("p",null,"Install ",(0,t.kt)("strong",{parentName:"p"},"gpg"),":"),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{className:"language-shell"}),"apt install gpg\n")),(0,t.kt)("p",null,"Import the repository key:"),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{className:"language-shell"}),"wget -O- https://apt-key.centreon.com | gpg --dearmor | tee /etc/apt/trusted.gpg.d/centreon.gpg > /dev/null 2>&1\n")),(0,t.kt)("p",null,"Add the following external repository (for Java 8):"),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{className:"language-shell"}),"wget -qO - https://adoptopenjdk.jfrog.io/adoptopenjdk/api/gpg/key/public | apt-key add -\nadd-apt-repository --yes https://adoptopenjdk.jfrog.io/adoptopenjdk/deb/\napt update\n")),(0,t.kt)("p",null,"Then install Centreon MBI:"),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{className:"language-shell"}),"apt update && apt install centreon-bi-server-x.y.z\n")))),(0,t.kt)("h4",s({},{id:"int\xe9gration-des-anciens-rapports-g\xe9n\xe9r\xe9s"}),"Int\xe9gration des anciens rapports g\xe9n\xe9r\xe9s"),(0,t.kt)("p",null,"R\xe9cup\xe9rer la derni\xe8re sauvegarde \xe0 jour, format\n",(0,t.kt)("strong",{parentName:"p"},"centreon-bi-front-reports-and-custom-conf-aaaa-mm-jj.tar.gz")," et\nextraire celle-ci dans le r\xe9pertoire ",(0,t.kt)("strong",{parentName:"p"},"/tmp")," ::"),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{}),"cd /tmp\ntar xzf centreon-bi-front-reports-and-custom-conf-YYYY-MM-DD.tar.gz\n")),(0,t.kt)("p",null,"Int\xe9grer les rapports g\xe9n\xe9r\xe9s via la commande ::"),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{}),"/bin/cp -rf /tmp/var/lib/centreon/centreon-bi-server/archives/* /var/lib/centreon/centreon-bi-server/archives\n")),(0,t.kt)("blockquote",null,(0,t.kt)("p",{parentName:"blockquote"},"Si le r\xe9pertoire est diff\xe9rent, c'est que les param\xe8tres par d\xe9faut ont\n\xe9t\xe9 modifi\xe9s par l'utilisateur. Il suffit simplement de reprendre la\nbonne arborescence.")),(0,t.kt)("p",null,"Modifier les droits sur les fichiers ::"),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{}),"chown -R centreonBI:centreonBI /var/lib/centreon/centreon-bi-server/archives \n")),(0,t.kt)("h4",s({},{id:"int\xe9gration-des-param\xe8tres-de-rapports-personnalis\xe9s"}),"Int\xe9gration des param\xe8tres de rapports personnalis\xe9s"),(0,t.kt)("p",null,"R\xe9cup\xe9rer la derni\xe8re sauvegarde \xe0 jour, format\n",(0,t.kt)("strong",{parentName:"p"},"centreon-bi-front-reports-and-custom-conf-aaaa-mm-jj.tar.gz")," et\nextraire celle-ci dans le r\xe9pertoire ",(0,t.kt)("strong",{parentName:"p"},"/tmp")," ::"),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{}),"# cd /tmp\ntar xzf centreon-bi-front-reports-and-custom-conf-YYYY-MM-DD.tar.gz\n")),(0,t.kt)("p",null,"Int\xe9gration des anciens param\xe8tres ::"),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{}),"/bin/cp -rf /tmp/usr/share/centreon/www/modules/centreon-bi-server/configuration/generation/xsl/* /usr/share/centreon/www/modules/centreon-bi-server/configuration/generation/xsl\n/bin/cp -rf /tmp/var/lib/centreon/centreon-bi-server/reports/infos/* /var/lib/centreon/centreon-bi-server/reports/infos\n")),(0,t.kt)("p",null,"Modifier les droits sur les fichiers ::"),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{}),"chown -R apache:apache /usr/share/centreon/www/modules/centreon-bi-server/configuration/generation/xsl\n")),(0,t.kt)("h4",s({},{id:"int\xe9gration-des-donn\xe9es-de-configuration-centreon-mbi"}),"Int\xe9gration des donn\xe9es de configuration Centreon MBI"),(0,t.kt)("p",null,"Int\xe9grer la sauvegarde SQL via la commande suivante ::"),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{}),"mysql -u root -p centreon_storage < /tmp/var/backup/dump_centreon_storage.sql\n")),(0,t.kt)("h4",s({},{id:"supprimer-les-donn\xe9es-extraites-de-la-sauvegarde"}),"Supprimer les donn\xe9es extraites de la sauvegarde"),(0,t.kt)("p",null,"Supprimer les donn\xe9es extraites via les commandes suivantes ::"),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{}),"cd /tmp\nrm -Rf /tmp/usr\nrm -Rf /tmp/var\n")),(0,t.kt)("h3",s({},{id:"restauration-des-param\xe8tres-du-serveur-de-reporting-centreon-mbi"}),"Restauration des param\xe8tres du serveur de reporting Centreon MBI"),(0,t.kt)("p",null,"Le processus de restauration comprend plusieurs \xe9tapes :"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"R\xe9installation du module ",(0,t.kt)("strong",{parentName:"li"},"centreon-bi-reporting-server")," dans une\nversion identique \xe0 celle sauvegard\xe9e."),(0,t.kt)("li",{parentName:"ul"},"Int\xe9gration de la configuration du moteur CBIS."),(0,t.kt)("li",{parentName:"ul"},"Int\xe9gration des mod\xe8les de rapports personnalis\xe9s."),(0,t.kt)("li",{parentName:"ul"},"Int\xe9gration des donn\xe9es."),(0,t.kt)("li",{parentName:"ul"},"Red\xe9marrer le moteur CBIS."),(0,t.kt)("li",{parentName:"ul"},"Supprimer les donn\xe9es extraites de la sauvegarde."),(0,t.kt)("li",{parentName:"ul"},"R\xe9installer la sauvegarde.")),(0,t.kt)("h4",s({},{id:"r\xe9installation-du-module-centreon-mbi-1"}),"R\xe9installation du module Centreon MBI"),(0,t.kt)("p",null,"Sur le serveur central Centreon, lancer la commande ::"),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{}),"yum install centreon-bi-reporting-server-x.y.z\n")),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"*x.y.z")," correspond \xe0 la version exacte du module sauvegard\xe9.*"),(0,t.kt)("h4",s({},{id:"int\xe9gration-de-la-configuration-du-moteur-cbis"}),"Int\xe9gration de la configuration du moteur CBIS"),(0,t.kt)("p",null,"R\xe9cup\xe9rer la derni\xe8re sauvegarde \xe0 jour, format\n",(0,t.kt)("strong",{parentName:"p"},"centreon-bin-reports-and-conf-aaaa-mm-jj.tar.gz")," et extraire celle-ci\ndans le r\xe9pertoire ",(0,t.kt)("strong",{parentName:"p"},"/tmp")," ::"),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{}),"cd /tmp\ntar xzf centreon-bin-reports-and-conf-YYYY-MM-DD.tar.gz\n")),(0,t.kt)("p",null,"Int\xe9grer la configuration via la commande ::"),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{}),"# /bin/cp -rf /tmp/etc/centreon-bi/* /etc/centreon-bi\n")),(0,t.kt)("h4",s({},{id:"int\xe9gration-des-mod\xe8les-de-rapports-personnalis\xe9s"}),"Int\xe9gration des mod\xe8les de rapports personnalis\xe9s"),(0,t.kt)("p",null,"R\xe9cup\xe9rer la derni\xe8re sauvegarde \xe0 jour, format\n",(0,t.kt)("strong",{parentName:"p"},"centreon-bin-reports-and-conf-aaaa-mm-jj.tar.gz")," et extraire celle-ci\ndans le r\xe9pertoire ",(0,t.kt)("strong",{parentName:"p"},"/tmp")," ::"),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{}),"cd /tmp\ntar xzf /var/backup/centreon-bin-reports-and-conf-YYYY-MM-DD.tar.gz\n")),(0,t.kt)("p",null,"Int\xe9grer les mod\xe8les de rapports via les commandes ::"),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{}),"/bin/cp -rf /tmp/usr/share/centreon-bi/reports/* /usr/share/centreon-bi/reports\nchown -R centreonBI:centreonBI /usr/share/centreon-bi/reports\n/bin/cp -rf /tmp/usr/share/centreon-bi/Resources/* /usr/share/centreon-bi/Resources\nchown -R centreonBI:centreonBI /usr/share/centreon-bi/Resources\n")),(0,t.kt)("h3",s({},{id:"int\xe9gration-des-donn\xe9es-mariadb"}),"Int\xe9gration des donn\xe9es MariaDB"),(0,t.kt)("p",null,"Arr\xeater le service MariaDB ::"),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{}),"systemctl stop mysql\n")),(0,t.kt)("p",null,"Supprimer le r\xe9p\xe9rtoire ",(0,t.kt)("em",{parentName:"p"},"/var/lib/mysql")," du serveur de reporting::"),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{}),"rm -rf /var/lib/mysql\n")),(0,t.kt)("p",null,"D\xe9compresser la derni\xe8re sauvegarde totale ( par d\xe9faut la sauvegarde\ntotale est faite le dimanche)::"),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{}),"tar -xzf /var/backup/mysql-centreon_storage-bi-xxxx-xx-xx.tar.gz -C /\n")),(0,t.kt)("p",null,"D\xe9compresser l'ensemble des sauvegardes partielles faites entre la\nsauvegarde totale et la date du jour, ",(0,t.kt)("strong",{parentName:"p"},"de la plus ancienne \xe0 la plus\nr\xe9cente")," en lan\xe7ant la commande ::"),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{}),"tar -xzf /var/backup/mysql-centreon_storage-bi-xxxx-xx-xx.tar.gz -C /\n")),(0,t.kt)("p",null,"Modifier les droits sur le r\xe9p\xe9rtoire ",(0,t.kt)("em",{parentName:"p"},"/var/lib/mysql")," ::"),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{}),"chown -R mysql:root /var/lib/mysql\n")),(0,t.kt)("p",null,"D\xe9marrer le service MariaDB::"),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{}),"systemctl start mariadb\n")),(0,t.kt)("h4",s({},{id:"red\xe9marrer-le-moteur-cbis"}),"Red\xe9marrer le moteur CBIS"),(0,t.kt)("p",null,"Red\xe9marrer le processus via la commande ::"),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{}),"systemctl restart cbis\nStopping Centreon MBI scheduler : cbis\nWaiting for cbis to exit .. done.\nStarting Centreon MBI scheduler : cbis\nService started...\n")),(0,t.kt)("h4",s({},{id:"supprimer-les-donn\xe9es-extraites-de-la-sauvegarde-1"}),"Supprimer les donn\xe9es extraites de la sauvegarde"),(0,t.kt)("p",null,"Supprimer les donn\xe9es extraites via les commandes suivantes ::"),(0,t.kt)("pre",null,(0,t.kt)("code",s({parentName:"pre"},{}),"cd /tmp\nrm -Rf /tmp/etc\nrm -Rf /tmp/usr\n")))}g.isMDXComponent=!0}}]);